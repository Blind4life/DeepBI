!function(e){function t(t){for(var r,i,l=t[0],s=t[1],c=t[2],d=0,m=[];d<l.length;d++)i=l[d],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&m.push(n[i][0]),n[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(u&&u(t);m.length;)m.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],r=!0,l=1;l<a.length;l++){var s=a[l];0!==n[s]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=a[0]))}return e}var r={},n={0:0},o=[];function i(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.e=function(e){var t=[],a=n[e];if(0!==a)if(a)t.push(a[2]);else{var r=new Promise((function(t,r){a=n[e]=[t,r]}));t.push(a[2]=r);var o,l=document.createElement("script");l.charset="utf-8",l.timeout=120,i.nc&&l.setAttribute("nonce",i.nc),l.src=function(e){return i.p+""+({}[e]||e)+"."+{3:"f6b5d7fb9cc387b81a2c",4:"9d8350dabf431e6de48b"}[e]+".js"}(e);var s=new Error;o=function(t){l.onerror=l.onload=null,clearTimeout(c);var a=n[e];if(0!==a){if(a){var r=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;s.message="Loading chunk "+e+" failed.\n("+r+": "+o+")",s.name="ChunkLoadError",s.type=r,s.request=o,a[1](s)}n[e]=void 0}};var c=setTimeout((function(){o({type:"timeout",target:l})}),12e4);l.onerror=l.onload=o,document.head.appendChild(l)}return Promise.all(t)},i.m=e,i.c=r,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(a,r,function(t){return e[t]}.bind(null,r));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/static/",i.oe=function(e){throw console.error(e),e};var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;o.push([700,2]),a()}({101:function(e,t,a){e.exports=a.p+"images/icon_small.png"},1105:function(e,t,a){},1106:function(e,t,a){},1231:function(e,t,a){},1232:function(e,t,a){},1233:function(e,t,a){},1234:function(e,t,a){},1235:function(e,t,a){},1236:function(e,t,a){},1240:function(e,t,a){},1241:function(e,t,a){},1255:function(e,t,a){},1256:function(e,t,a){},1257:function(e,t,a){},1258:function(e,t,a){},1259:function(e,t,a){},1263:function(e,t,a){},1264:function(e,t,a){},1265:function(e,t,a){},1266:function(e,t,a){},1267:function(e,t,a){},1268:function(e,t,a){},1278:function(e,t,a){},1279:function(e,t,a){},1280:function(e,t,a){},1283:function(e,t,a){},1284:function(e,t,a){},1287:function(e,t,a){},1288:function(e,t,a){},1300:function(e,t,a){},1322:function(e,t,a){},1329:function(e,t,a){},1330:function(e,t,a){},1331:function(e,t,a){},1332:function(e,t,a){},1333:function(e,t,a){},1334:function(e,t,a){},1335:function(e,t,a){},1337:function(e,t,a){},1338:function(e,t,a){},1339:function(e,t,a){},1340:function(e,t,a){},1341:function(e,t,a){},1342:function(e,t,a){},1354:function(e,t,a){},1355:function(e,t,a){},1356:function(e,t,a){},1357:function(e,t,a){},1358:function(e,t,a){},1363:function(e,t,a){},1364:function(e,t,a){},1365:function(e,t,a){},1368:function(e,t,a){},1371:function(e,t,a){},1372:function(e,t,a){},1373:function(e,t,a){},1374:function(e,t,a){},1380:function(e,t,a){},1397:function(e,t,a){},1398:function(e,t,a){},1399:function(e,t,a){},1458:function(e,t,a){},1459:function(e,t,a){},1460:function(e,t,a){},1461:function(e,t,a){},1462:function(e,t,a){},1463:function(e,t,a){},1464:function(e,t,a){},1465:function(e,t,a){},1476:function(e,t,a){},1557:function(e,t,a){},1558:function(e,t,a){},1559:function(e,t,a){},1560:function(e,t,a){},1563:function(e,t,a){},1564:function(e,t,a){},1565:function(e,t,a){},1570:function(e,t,a){},1571:function(e,t,a){},1572:function(e,t,a){},1573:function(e,t,a){},1574:function(e,t,a){},1575:function(e,t,a){var r={"./analysis.png":1576,"./avatar.svg":437,"./cn/img/doc_0.png":1577,"./cn/img/doc_1.png":1578,"./cn/img/doc_10.png":1579,"./cn/img/doc_11.png":1580,"./cn/img/doc_12.png":1581,"./cn/img/doc_13.png":1582,"./cn/img/doc_14.png":1583,"./cn/img/doc_15.png":1584,"./cn/img/doc_16.png":1585,"./cn/img/doc_17.png":1586,"./cn/img/doc_18.png":1587,"./cn/img/doc_19.png":1588,"./cn/img/doc_2.png":1589,"./cn/img/doc_20.png":1590,"./cn/img/doc_21.png":1591,"./cn/img/doc_22.png":1592,"./cn/img/doc_3.png":1593,"./cn/img/doc_4.png":1594,"./cn/img/doc_5.png":1595,"./cn/img/doc_6.png":1596,"./cn/img/doc_7.png":1597,"./cn/img/doc_8.png":1598,"./cn/img/doc_9.png":1599,"./copy.png":422,"./db-logos/Cassandra.png":1600,"./db-logos/arangodb.png":1601,"./db-logos/athena.png":1602,"./db-logos/aws_es.png":1603,"./db-logos/axibasetsd.png":1604,"./db-logos/azure_kusto.png":1605,"./db-logos/bigquery.png":1606,"./db-logos/bigquery_gce.png":1607,"./db-logos/clickhouse.png":1608,"./db-logos/cloudwatch.png":1609,"./db-logos/cloudwatch_insights.png":1610,"./db-logos/cockroach.png":1611,"./db-logos/corporate_memory.png":1612,"./db-logos/couchbase.png":1613,"./db-logos/csv.png":1614,"./db-logos/databend.png":1615,"./db-logos/databricks.png":1616,"./db-logos/db2.png":1617,"./db-logos/dgraph.png":1618,"./db-logos/doris.png":1619,"./db-logos/drill.png":1620,"./db-logos/druid.png":1621,"./db-logos/dynamodb_sql.png":1622,"./db-logos/elasticsearch.png":1623,"./db-logos/elasticsearch2.png":1624,"./db-logos/elasticsearch2_OpenDistroSQLElasticSearch.png":1625,"./db-logos/elasticsearch2_XPackSQLElasticSearch.png":1626,"./db-logos/exasol.png":1627,"./db-logos/excel.png":245,"./db-logos/firebolt.png":1628,"./db-logos/google_analytics.png":1629,"./db-logos/google_spreadsheets.png":1630,"./db-logos/graphite.png":1631,"./db-logos/hive.png":1632,"./db-logos/hive_http.png":1633,"./db-logos/impala.png":1634,"./db-logos/influxdb.png":1635,"./db-logos/jirajql.png":1636,"./db-logos/json.png":1637,"./db-logos/kibana.png":1638,"./db-logos/kylin.png":1639,"./db-logos/mapd.png":1640,"./db-logos/memsql.png":1641,"./db-logos/mongodb.png":1642,"./db-logos/mssql.png":1643,"./db-logos/mssql_odbc.png":1644,"./db-logos/mysql.png":419,"./db-logos/nz.png":1645,"./db-logos/oracle.png":1646,"./db-logos/pg.png":418,"./db-logos/phoenix.png":1647,"./db-logos/pinot.png":1648,"./db-logos/presto.png":1649,"./db-logos/prometheus.png":1650,"./db-logos/python.png":1651,"./db-logos/qubole.png":1652,"./db-logos/rds_mysql.png":1653,"./db-logos/redshift.png":1654,"./db-logos/redshift_iam.png":1655,"./db-logos/results.png":1656,"./db-logos/rockset.png":1657,"./db-logos/salesforce.png":1658,"./db-logos/scylla.png":1659,"./db-logos/snowflake.png":1660,"./db-logos/sparql_endpoint.png":1661,"./db-logos/sqlite.png":1662,"./db-logos/starrocks.png":1663,"./db-logos/treasuredata.png":1664,"./db-logos/trino.png":1665,"./db-logos/uptycs.png":1666,"./db-logos/url.png":1667,"./db-logos/vertica.png":1668,"./db-logos/yandex_appmetrika.png":1669,"./db-logos/yandex_metrika.png":1670,"./destinations/chatwork.png":1671,"./destinations/email.png":1672,"./destinations/hangouts_chat.png":1673,"./destinations/hipchat.png":1674,"./destinations/mattermost.png":1675,"./destinations/microsoft_teams_webhook.png":1676,"./destinations/pagerduty.png":1677,"./destinations/slack.png":1678,"./destinations/webhook.png":1679,"./en/img/doc_0.png":1680,"./en/img/doc_1.png":1681,"./en/img/doc_10.png":1682,"./en/img/doc_11.png":1683,"./en/img/doc_12.png":1684,"./en/img/doc_13.png":1685,"./en/img/doc_14.png":1686,"./en/img/doc_15.png":1687,"./en/img/doc_16.png":1688,"./en/img/doc_17.png":1689,"./en/img/doc_18.png":1690,"./en/img/doc_19.png":1691,"./en/img/doc_2.png":1692,"./en/img/doc_20.png":1693,"./en/img/doc_21.png":1694,"./en/img/doc_22.png":1695,"./en/img/doc_3.png":1696,"./en/img/doc_4.png":1697,"./en/img/doc_5.png":1698,"./en/img/doc_6.png":1699,"./en/img/doc_7.png":1700,"./en/img/doc_8.png":1701,"./en/img/doc_9.png":1702,"./favicon-16x16.png":1703,"./favicon-32x32.png":1704,"./favicon-96x96.png":1705,"./fixtures/map-tile.png":1706,"./google_logo.svg":1707,"./gravatar.png":1708,"./icon_small.png":101,"./illustrations/alert.svg":1709,"./illustrations/dashboard.svg":1710,"./illustrations/no-query-results.svg":1711,"./illustrations/query.svg":1712,"./loading.png":1713,"./logo.png":1714,"./logo_white.png":1715,"./next.png":1716,"./retry.png":1717,"./send-active.png":1718,"./send-default.png":1719};function n(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=o,e.exports=n,n.id=1575},1576:function(e,t,a){e.exports=a.p+"images/analysis.png"},1577:function(e,t,a){e.exports=a.p+"images/cn/img/doc_0.png"},1578:function(e,t,a){e.exports=a.p+"images/cn/img/doc_1.png"},1579:function(e,t,a){e.exports=a.p+"images/cn/img/doc_10.png"},1580:function(e,t,a){e.exports=a.p+"images/cn/img/doc_11.png"},1581:function(e,t,a){e.exports=a.p+"images/cn/img/doc_12.png"},1582:function(e,t,a){e.exports=a.p+"images/cn/img/doc_13.png"},1583:function(e,t,a){e.exports=a.p+"images/cn/img/doc_14.png"},1584:function(e,t,a){e.exports=a.p+"images/cn/img/doc_15.png"},1585:function(e,t,a){e.exports=a.p+"images/cn/img/doc_16.png"},1586:function(e,t,a){e.exports=a.p+"images/cn/img/doc_17.png"},1587:function(e,t,a){e.exports=a.p+"images/cn/img/doc_18.png"},1588:function(e,t,a){e.exports=a.p+"images/cn/img/doc_19.png"},1589:function(e,t,a){e.exports=a.p+"images/cn/img/doc_2.png"},1590:function(e,t,a){e.exports=a.p+"images/cn/img/doc_20.png"},1591:function(e,t,a){e.exports=a.p+"images/cn/img/doc_21.png"},1592:function(e,t,a){e.exports=a.p+"images/cn/img/doc_22.png"},1593:function(e,t,a){e.exports=a.p+"images/cn/img/doc_3.png"},1594:function(e,t,a){e.exports=a.p+"images/cn/img/doc_4.png"},1595:function(e,t,a){e.exports=a.p+"images/cn/img/doc_5.png"},1596:function(e,t,a){e.exports=a.p+"images/cn/img/doc_6.png"},1597:function(e,t,a){e.exports=a.p+"images/cn/img/doc_7.png"},1598:function(e,t,a){e.exports=a.p+"images/cn/img/doc_8.png"},1599:function(e,t,a){e.exports=a.p+"images/cn/img/doc_9.png"},1600:function(e,t,a){e.exports=a.p+"images/db-logos/Cassandra.png"},1601:function(e,t,a){e.exports=a.p+"images/db-logos/arangodb.png"},1602:function(e,t,a){e.exports=a.p+"images/db-logos/athena.png"},1603:function(e,t,a){e.exports=a.p+"images/db-logos/aws_es.png"},1604:function(e,t,a){e.exports=a.p+"images/db-logos/axibasetsd.png"},1605:function(e,t,a){e.exports=a.p+"images/db-logos/azure_kusto.png"},1606:function(e,t,a){e.exports=a.p+"images/db-logos/bigquery.png"},1607:function(e,t,a){e.exports=a.p+"images/db-logos/bigquery_gce.png"},1608:function(e,t,a){e.exports=a.p+"images/db-logos/clickhouse.png"},1609:function(e,t,a){e.exports=a.p+"images/db-logos/cloudwatch.png"},1610:function(e,t,a){e.exports=a.p+"images/db-logos/cloudwatch_insights.png"},1611:function(e,t,a){e.exports=a.p+"images/db-logos/cockroach.png"},1612:function(e,t,a){e.exports=a.p+"images/db-logos/corporate_memory.png"},1613:function(e,t,a){e.exports=a.p+"images/db-logos/couchbase.png"},1614:function(e,t,a){e.exports=a.p+"images/db-logos/csv.png"},1615:function(e,t,a){e.exports=a.p+"images/db-logos/databend.png"},1616:function(e,t,a){e.exports=a.p+"images/db-logos/databricks.png"},1617:function(e,t,a){e.exports=a.p+"images/db-logos/db2.png"},1618:function(e,t,a){e.exports=a.p+"images/db-logos/dgraph.png"},1619:function(e,t,a){e.exports=a.p+"images/db-logos/doris.png"},1620:function(e,t,a){e.exports=a.p+"images/db-logos/drill.png"},1621:function(e,t,a){e.exports=a.p+"images/db-logos/druid.png"},1622:function(e,t,a){e.exports=a.p+"images/db-logos/dynamodb_sql.png"},1623:function(e,t,a){e.exports=a.p+"images/db-logos/elasticsearch.png"},1624:function(e,t,a){e.exports=a.p+"images/db-logos/elasticsearch2.png"},1625:function(e,t,a){e.exports=a.p+"images/db-logos/elasticsearch2_OpenDistroSQLElasticSearch.png"},1626:function(e,t,a){e.exports=a.p+"images/db-logos/elasticsearch2_XPackSQLElasticSearch.png"},1627:function(e,t,a){e.exports=a.p+"images/db-logos/exasol.png"},1628:function(e,t,a){e.exports=a.p+"images/db-logos/firebolt.png"},1629:function(e,t,a){e.exports=a.p+"images/db-logos/google_analytics.png"},1630:function(e,t,a){e.exports=a.p+"images/db-logos/google_spreadsheets.png"},1631:function(e,t,a){e.exports=a.p+"images/db-logos/graphite.png"},1632:function(e,t,a){e.exports=a.p+"images/db-logos/hive.png"},1633:function(e,t,a){e.exports=a.p+"images/db-logos/hive_http.png"},1634:function(e,t,a){e.exports=a.p+"images/db-logos/impala.png"},1635:function(e,t,a){e.exports=a.p+"images/db-logos/influxdb.png"},1636:function(e,t,a){e.exports=a.p+"images/db-logos/jirajql.png"},1637:function(e,t,a){e.exports=a.p+"images/db-logos/json.png"},1638:function(e,t,a){e.exports=a.p+"images/db-logos/kibana.png"},1639:function(e,t,a){e.exports=a.p+"images/db-logos/kylin.png"},1640:function(e,t,a){e.exports=a.p+"images/db-logos/mapd.png"},1641:function(e,t,a){e.exports=a.p+"images/db-logos/memsql.png"},1642:function(e,t,a){e.exports=a.p+"images/db-logos/mongodb.png"},1643:function(e,t,a){e.exports=a.p+"images/db-logos/mssql.png"},1644:function(e,t,a){e.exports=a.p+"images/db-logos/mssql_odbc.png"},1645:function(e,t,a){e.exports=a.p+"images/db-logos/nz.png"},1646:function(e,t,a){e.exports=a.p+"images/db-logos/oracle.png"},1647:function(e,t,a){e.exports=a.p+"images/db-logos/phoenix.png"},1648:function(e,t,a){e.exports=a.p+"images/db-logos/pinot.png"},1649:function(e,t,a){e.exports=a.p+"images/db-logos/presto.png"},1650:function(e,t,a){e.exports=a.p+"images/db-logos/prometheus.png"},1651:function(e,t,a){e.exports=a.p+"images/db-logos/python.png"},1652:function(e,t,a){e.exports=a.p+"images/db-logos/qubole.png"},1653:function(e,t,a){e.exports=a.p+"images/db-logos/rds_mysql.png"},1654:function(e,t,a){e.exports=a.p+"images/db-logos/redshift.png"},1655:function(e,t,a){e.exports=a.p+"images/db-logos/redshift_iam.png"},1656:function(e,t,a){e.exports=a.p+"images/db-logos/results.png"},1657:function(e,t,a){e.exports=a.p+"images/db-logos/rockset.png"},1658:function(e,t,a){e.exports=a.p+"images/db-logos/salesforce.png"},1659:function(e,t,a){e.exports=a.p+"images/db-logos/scylla.png"},1660:function(e,t,a){e.exports=a.p+"images/db-logos/snowflake.png"},1661:function(e,t,a){e.exports=a.p+"images/db-logos/sparql_endpoint.png"},1662:function(e,t,a){e.exports=a.p+"images/db-logos/sqlite.png"},1663:function(e,t,a){e.exports=a.p+"images/db-logos/starrocks.png"},1664:function(e,t,a){e.exports=a.p+"images/db-logos/treasuredata.png"},1665:function(e,t,a){e.exports=a.p+"images/db-logos/trino.png"},1666:function(e,t,a){e.exports=a.p+"images/db-logos/uptycs.png"},1667:function(e,t,a){e.exports=a.p+"images/db-logos/url.png"},1668:function(e,t,a){e.exports=a.p+"images/db-logos/vertica.png"},1669:function(e,t,a){e.exports=a.p+"images/db-logos/yandex_appmetrika.png"},1670:function(e,t,a){e.exports=a.p+"images/db-logos/yandex_metrika.png"},1671:function(e,t,a){e.exports=a.p+"images/destinations/chatwork.png"},1672:function(e,t,a){e.exports=a.p+"images/destinations/email.png"},1673:function(e,t,a){e.exports=a.p+"images/destinations/hangouts_chat.png"},1674:function(e,t,a){e.exports=a.p+"images/destinations/hipchat.png"},1675:function(e,t,a){e.exports=a.p+"images/destinations/mattermost.png"},1676:function(e,t,a){e.exports=a.p+"images/destinations/microsoft_teams_webhook.png"},1677:function(e,t,a){e.exports=a.p+"images/destinations/pagerduty.png"},1678:function(e,t,a){e.exports=a.p+"images/destinations/slack.png"},1679:function(e,t,a){e.exports=a.p+"images/destinations/webhook.png"},1680:function(e,t,a){e.exports=a.p+"images/en/img/doc_0.png"},1681:function(e,t,a){e.exports=a.p+"images/en/img/doc_1.png"},1682:function(e,t,a){e.exports=a.p+"images/en/img/doc_10.png"},1683:function(e,t,a){e.exports=a.p+"images/en/img/doc_11.png"},1684:function(e,t,a){e.exports=a.p+"images/en/img/doc_12.png"},1685:function(e,t,a){e.exports=a.p+"images/en/img/doc_13.png"},1686:function(e,t,a){e.exports=a.p+"images/en/img/doc_14.png"},1687:function(e,t,a){e.exports=a.p+"images/en/img/doc_15.png"},1688:function(e,t,a){e.exports=a.p+"images/en/img/doc_16.png"},1689:function(e,t,a){e.exports=a.p+"images/en/img/doc_17.png"},1690:function(e,t,a){e.exports=a.p+"images/en/img/doc_18.png"},1691:function(e,t,a){e.exports=a.p+"images/en/img/doc_19.png"},1692:function(e,t,a){e.exports=a.p+"images/en/img/doc_2.png"},1693:function(e,t,a){e.exports=a.p+"images/en/img/doc_20.png"},1694:function(e,t,a){e.exports=a.p+"images/en/img/doc_21.png"},1695:function(e,t,a){e.exports=a.p+"images/en/img/doc_22.png"},1696:function(e,t,a){e.exports=a.p+"images/en/img/doc_3.png"},1697:function(e,t,a){e.exports=a.p+"images/en/img/doc_4.png"},1698:function(e,t,a){e.exports=a.p+"images/en/img/doc_5.png"},1699:function(e,t,a){e.exports=a.p+"images/en/img/doc_6.png"},1700:function(e,t,a){e.exports=a.p+"images/en/img/doc_7.png"},1701:function(e,t,a){e.exports=a.p+"images/en/img/doc_8.png"},1702:function(e,t,a){e.exports=a.p+"images/en/img/doc_9.png"},1703:function(e,t,a){e.exports=a.p+"images/favicon-16x16.png"},1704:function(e,t,a){e.exports=a.p+"images/favicon-32x32.png"},1705:function(e,t,a){e.exports=a.p+"images/favicon-96x96.png"},1706:function(e,t,a){e.exports=a.p+"images/fixtures/map-tile.png"},1707:function(e,t,a){e.exports=a.p+"images/google_logo.svg"},1708:function(e,t,a){e.exports=a.p+"images/gravatar.png"},1709:function(e,t,a){e.exports=a.p+"images/illustrations/alert.svg"},1710:function(e,t,a){e.exports=a.p+"images/illustrations/dashboard.svg"},1711:function(e,t,a){e.exports=a.p+"images/illustrations/no-query-results.svg"},1712:function(e,t,a){e.exports=a.p+"images/illustrations/query.svg"},1713:function(e,t,a){e.exports=a.p+"images/loading.png"},1714:function(e,t,a){e.exports=a.p+"images/logo.png"},1715:function(e,t,a){e.exports=a.p+"images/logo_white.png"},1716:function(e,t,a){e.exports=a.p+"images/next.png"},1717:function(e,t,a){e.exports=a.p+"images/retry.png"},1718:function(e,t,a){e.exports=a.p+"images/send-active.png"},1719:function(e,t,a){e.exports=a.p+"images/send-default.png"},1720:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=1720},1726:function(e,t,a){},1727:function(e,t,a){},1730:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(32),i=a.n(o),l=(a(8),a(5),a(2)),s=a.n(l),c=(a(437),a(62)),u=a.n(c),d=(a(9),a(11)),m=a.n(d);function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function f(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function b(e){var t=e.children,a=f(e,["children"]);return n.a.createElement(b.Component,a,t)}function h(e){return n.a.createElement(h.Component,e)}b.Component=function(e){var t=e.children,a=f(e,["children"]);return n.a.createElement("a",a,t)},b.WithIcon=function(e){var t=e.icon,a=e.alt,r=e.children,o=f(e,["icon","alt","children"]);return n.a.createElement(b.Component,o,r," ",t," ",n.a.createElement("span",{className:"sr-only"},a))},b.External=function(e){var t=e.icon,a=void 0===t?n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}):t,r=e.alt,o=void 0===r?"(opens in a new tab)":r,i=f(e,["icon","alt"]);return n.a.createElement(b.WithIcon,p({target:"_blank",rel:"noopener noreferrer",icon:a,alt:o},i))},h.Component=function(e){return n.a.createElement(m.a,e)},b.Button=h;var g=b,y=(a(12),a(14),a(128)),v=a.n(y);function w(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var O=v()("redash:errors"),E=n.a.createContext({handleError:e=>{setTimeout(()=>{throw e})},reset:()=>{}});function _(e){var t=e.children;return n.a.createElement(u.a,{message:t,type:"error",showIcon:!0})}_.defaultProps={children:window.W_L.generic};class j extends n.a.Component{constructor(){super(...arguments),w(this,"state",{error:null}),w(this,"handleError",e=>{this.setState(this.constructor.getDerivedStateFromError(e)),this.componentDidCatch(e,null),Object(l.isFunction)(window.handleException)&&window.handleException(e)}),w(this,"reset",()=>{this.setState({error:null})})}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e,t){O(e,t)}render(){var e=this.props,t=e.renderError,a=e.children,r=this.state.error;return r?Object(l.isFunction)(t)?t(r):n.a.createElement(_,null):n.a.createElement(E.Provider,{value:this},a)}}w(j,"defaultProps",{children:null,renderError:null});a(110),a(72);var S=a(143),C=a.n(S),P=a(697),x=Object(P.a)();function L(e){var t=e.pathname,a=e.search,r=e.hash,n={};return n.path=t,n.search=Object(l.mapValues)(C.a.parse(a),e=>!!Object(l.isNil)(e)||e),n.hash=Object(l.trimStart)(r,"#"),n.url="".concat(t).concat(a).concat(r),n}var k={listen:e=>Object(l.isFunction)(e)?x.listen((t,a)=>e(k,a)):()=>{},confirmChange:e=>Object(l.isFunction)(e)?x.block(t=>e(L(t),k)):()=>{},update(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(l.isObject)(e)&&(e=Object(l.omitBy)({pathname:e.path,search:e.search,hash:e.hash},l.isUndefined),e=Object(l.extend)({pathname:k.path,search:k.search,hash:k.hash},e),Object(l.isObject)(e.search)&&(e.search=Object(l.omitBy)(Object(l.extend)({},k.search,e.search),l.isNil),e.search=Object(l.mapValues)(e.search,e=>!0===e?null:e),e.search=C.a.stringify(e.search))),t?x.replace(e):x.push(e)},url:void 0,path:void 0,setPath(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k.update({path:e},t)},search:void 0,setSearch(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k.update({search:e},t)},hash:void 0,setHash(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k.update({hash:e},t)}};function N(){Object(l.extend)(k,L(x.location))}x.listen(N),N();var A=k,T=a(242),W=a.n(T),I=a(425),q=a.n(I),D=a(25),R=a.n(D);function M(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function z(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?M(Object(a),!0).forEach((function(t){F(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):M(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function F(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function V(e,t){var a=null;R.a.warning({content:"Your session has expired. Please login to continue.",okText:n.a.createElement(n.a.Fragment,null,"Login ",n.a.createElement("i",{className:"fa fa-external-link m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")),centered:!0,mask:!0,maskClosable:!1,keyboard:!1,onOk:r=>{if(!a||a.closed){var n,o,i,s,c,u,d=z(z({},(n=640,o=640,i=window.screenX,s=window.screenY,c=window.innerWidth,u=window.innerHeight,{left:Math.floor((c-n)/2+i),top:Math.floor((u-o)/2+s),width:Math.floor(n),height:Math.floor(o)})),{},{menubar:"no",toolbar:"no",location:"yes",resizable:"yes",scrollbars:"yes",status:"yes"});a=window.open(e,"Restore Session",Object(l.map)(d,(e,t)=>"".concat(t,"=").concat(e)).join(","));var m=e=>{"redash_session_restored"===e.data.type&&(a&&a.close(),a=null,window.removeEventListener("message",m),r(),t())};window.addEventListener("message",m,!1)}else a.focus()}})}var U=null;var B=W.a.create({paramsSerializer:e=>C.a.stringify(e),xsrfCookieName:"csrf_token",xsrfHeaderName:"X-CSRF-TOKEN"});B.interceptors.response.use(e=>e.data);q()(B,e=>{var t=Object(l.get)(e,"response.data.message");return e.isAxiosError&&Object(l.includes)(t,"CSRF")?B.get("/ping"):Promise.reject(e)},{statusCodes:[400]}),q()(B,e=>{var t=parseInt(Object(l.get)(e,"response.status")),a=Object(l.get)(e,"response.data.message"),r=Object(l.get)(e,"config.url");return e.isAxiosError&&(401===t||Object(l.includes)(a,"Please login"))&&"api/session"!==r?(U||(U=new Promise(e=>{V(X.getLoginUrl(),()=>{U=null,e()})})),U):Promise.reject(e)},{statusCodes:[401,404],pauseInstanceWhileRefreshing:!1});B.interceptors.request.use(e=>{var t=X.getApiKey();return t&&(e.headers.Authorization="Key ".concat(t)),e});var H={_isAdmin:void 0,canEdit(e){var t=e.user_id||e.user&&e.user.id;return this.isAdmin||t&&t===this.id},canCreate(){return this.hasPermission("create_query")||this.hasPermission("create_dashboard")||this.hasPermission("list_alerts")},hasPermission(e){return"admin"===e&&void 0!==this._isAdmin?this._isAdmin:Object(l.includes)(this.permissions,e)},get isAdmin(){return this.hasPermission("admin")},set isAdmin(e){this._isAdmin=e}},Y={},Q=[],K=v()("redash:auth"),$={loaded:!1},G={Login:"login"};function J(e){K("Updating session to be:",e),Object(l.extend)($,e,{loaded:!0}),Object(l.extend)(H,$.user),Object(l.extend)(Y,$.client_config),Object(l.extend)(Q,$.messages)}var X={isAuthenticated:()=>$.loaded&&$.user.id,getLoginUrl:()=>G.Login,setLoginUrl(e){G.Login=e},login(){var e=encodeURI(A.url);K("Calling login with next = %s",e),window.location.href="".concat(G.Login,"?next=").concat(e)},logout(){K("Logout."),window.location.href="logout"},loadSession:()=>(K("Loading session"),$.loaded&&$.user.id?(K("Resolving with local value."),Promise.resolve($)):(X.setApiKey(null),B.get("api/session").then(e=>(J(e),$)))),loadConfig:()=>(K("Loading config"),B.get("/api/config").then(e=>(J({client_config:e.client_config,user:{permissions:[]},messages:[]}),e))),setApiKey(e){K("Set API key to: %s",e),X.apiKey=e},getApiKey:()=>X.apiKey,requireSession:()=>(K("Requested authentication"),X.isAuthenticated()?Promise.resolve($):X.loadSession().then(()=>{if(X.isAuthenticated())return K("Loaded session"),window.opener&&window.opener.postMessage({type:"redash_session_restored"},window.location.origin),$;K("Need to login, redirecting"),X.login()}).catch(()=>{K("Need to login, redirecting"),X.login()}))};var Z=new class{refresh(){return Promise.resolve(this)}canCreateDataSource(){return H.isAdmin}isCreateDataSourceEnabled(){return H.isAdmin}canCreateDestination(){return H.isAdmin}isCreateDestinationEnabled(){return H.isAdmin}canCreateDashboard(){return H.hasPermission("create_dashboard")}isCreateDashboardEnabled(){return H.hasPermission("create_dashboard")}canCreateAlert(){return!0}canCreateUser(){return H.isAdmin}isCreateUserEnabled(){return H.isAdmin}isCreateQuerySnippetEnabled(){return!0}getDashboardRefreshIntervals(){var e=Y.dashboardRefreshIntervals;return Object(l.isArray)(e)?e:null}getQueryRefreshIntervals(){var e=Y.queryRefreshIntervals;return Object(l.isArray)(e)?e:null}canEdit(e){return Object(l.get)(e,"can_edit",!1)}canRun(){return!0}};var ee=new class{constructor(){this.objectCounters={}}refresh(){return B.get("api/organization/status").then(e=>(this.objectCounters=e.object_counters,this))}},te=(a(211),a(178),a(3)),ae=a.n(te);function re(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ne(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var oe=new Map,ie=new Set;function le(e,t){Object(l.isString)(e)&&""!==e&&(oe.set(e,Object(l.isFunction)(t)?t:null),ie.forEach(t=>{t.props.name===e&&t.forceUpdate()}))}class se extends n.a.Component{componentDidMount(){ie.add(this)}componentWillUnmount(){ie.delete(this)}render(){var e=this.props,t=e.name,a=e.children,r=e.fallback,o=re(e,["name","children","fallback"]),i=oe.get(t);return i?n.a.createElement(i,o,a):Object(l.isUndefined)(r)?a:r}}ne(se,"propTypes",{name:ae.a.string.isRequired,fallback:ae.a.node,children:ae.a.node}),ne(se,"defaultProps",{children:null});var ce=a(18),ue=a.n(ce),de=a(4),me=a.n(de);a(808);function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function fe(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var be=function(e){var t=e.className,a=e.type,r=fe(e,["className","type"]);return n.a.createElement("button",pe({className:me()("plain-button","clickable",{"plain-button-link":"link"===a},t),type:"button"},r))},he=(a(97),a(54)),ge=a.n(he);function ye(){return(ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ve(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function we(e){var t=e.title,a=ve(e,["title"]),r=Object(l.isNil)(t)?null:n.a.createElement("span",{role:"status","aria-live":"assertive","aria-relevant":"additions"},t);return n.a.createElement(ge.a,ye({trigger:["hover","focus"],title:r},a))}var Oe=a(652),Ee=a.n(Oe),_e=a(65),je=a.n(_e);function Se(e){var t,a;return(t=()=>Object(l.uniqueId)(e),null===(a=Object(r.useRef)(null)).current&&(a.current=t()),a).current}function Ce(e){var t=e.message,a=e.icon,r=e.children,o=e.className,i=Se("bm-message");return n.a.createElement("div",{className:"big-message p-15 text-center "+o,role:"status","aria-live":"assertive","aria-relevant":"additions removals"},n.a.createElement("h3",{className:"m-t-0 m-b-0","aria-labelledby":i},n.a.createElement("i",{className:me()("fa",a),"aria-hidden":"true"})),n.a.createElement("br",null),n.a.createElement("span",{id:i},t),r)}Ce.propTypes={message:ae.a.string,icon:ae.a.string.isRequired,children:ae.a.node,className:ae.a.string},Ce.defaultProps={message:"",children:null,className:"tiled bg-white"};var Pe=Ce,xe=a(248),Le=a.n(xe);Le.a.setConfig({ADD_ATTR:["target"]}),Le.a.addHook("afterSanitizeAttributes",(function(e){var t=e.getAttribute("target");Object(l.isString)(t)&&"_blank"===t.toLowerCase()?e.setAttribute("rel","noopener noreferrer"):e.removeAttribute("target")}));var ke=Le.a.sanitize;function Ne(){return(Ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ae(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Te=n.a.memo((function(e){var t=e.children,a=Ae(e,["children"]);return n.a.createElement("div",Ne({},a,{dangerouslySetInnerHTML:{__html:ke(t)}}))}));Te.propTypes={children:ae.a.string},Te.defaultProps={children:""};var We=Te,Ie=a(114),qe=a(650),De=a.n(qe),Re=a(651),Me=a.n(Re);a(815);function ze(){return(ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Fe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ve(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(a),!0).forEach((function(t){Ue(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Fe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ue(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return He(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return He(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var Ye=Object(l.mapValues)({HOME:["",window.W_L.help],VALUE_SOURCE_OPTIONS:["/user-guide/querying/query-parameters#Value-Source-Options",window.W_L.guide_list_option],AUTHENTICATION_OPTIONS:["/user-guide/users/authentication-options",window.W_L.guide_authentication],USAGE_DATA_SHARING:["/open-source/admin-guide/usage-data",window.W_L.help_share_anonymous_data],DS_ATHENA:["/data-sources/amazon-athena-setup",window.W_L.guide_amazon_athena],DS_BIGQUERY:["/data-sources/bigquery-setup",window.W_L.guide_set_bigquery],DS_URL:["/data-sources/querying-urls",window.W_L.guide_set_url_port],DS_MONGODB:["/data-sources/mongodb-setup",window.W_L.guide_set_mongodb],DS_GOOGLE_SPREADSHEETS:["/data-sources/querying-a-google-spreadsheet",window.W_L.guide_set_google_spread],DS_GOOGLE_ANALYTICS:["/data-sources/google-analytics-setup",window.W_L.guide_set_google_analytics],DS_AXIBASETSD:["/data-sources/axibase-time-series-database",window.W_L.guide_set_axibase],DS_RESULTS:["/user-guide/querying/query-results-data-source",window.W_L.guide_set_query_result],ALERT_SETUP:["/user-guide/alerts/setting-up-an-alert",window.W_L.guide_set_alert],MAIL_CONFIG:["/open-source/setup/#Mail-Configuration",window.W_L.guide_set_mail],ALERT_NOTIF_TEMPLATE_GUIDE:["/user-guide/alerts/custom-alert-notifications",window.W_L.guide_set_notice],FAVORITES:["/user-guide/querying/favorites-tagging/#Favorites",window.W_L.guide_favorite],MANAGE_PERMISSIONS:["/user-guide/querying/writing-queries#Managing-Query-Permissions",window.W_L.guide_query_permissions],NUMBER_FORMAT_SPECS:["/user-guide/visualizations/formatting-numbers",window.W_L.guide_formatting_number],GETTING_STARTED:["/user-guide/getting-started",window.W_L.guide_menu_start],DASHBOARDS:["/user-guide/dashboards",window.W_L.guide_dashboard],QUERIES:["/help/user-guide/querying",window.W_L.guide_query],ALERTS:["/user-guide/alerts",window.W_L.guide_alert]},e=>{var t=Be(e,2);return["https://xxx/help"+t[0],t[1]]}),Qe={type:ae.a.string,href:ae.a.string,title:ae.a.node,className:ae.a.string,showTooltip:ae.a.bool,renderAsLink:ae.a.bool,children:ae.a.node},Ke={type:null,href:null,title:null,className:null,showTooltip:!0,renderAsLink:!1,children:n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"})};function $e(e){return n.a.createElement(se,ze({},e,{name:"HelpTrigger"}))}le("HelpTrigger",function(e){var t,a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return a=t=class extends n.a.Component{constructor(){super(...arguments),Ue(this,"iframeRef",n.a.createRef()),Ue(this,"iframeLoadingTimeout",null),Ue(this,"state",{visible:!1,loading:!1,error:!1,currentUrl:null,richText:null}),Ue(this,"loadIframe",e=>{clearTimeout(this.iframeLoadingTimeout),this.setState({loading:!0,error:!1}),this.iframeRef.current.src=e,this.iframeLoadingTimeout=setTimeout(()=>{this.setState({error:e,loading:!1})},2e4)}),Ue(this,"onIframeLoaded",()=>{this.setState({loading:!1}),clearTimeout(this.iframeLoadingTimeout)}),Ue(this,"onPostMessageReceived",e=>{if(Object(l.some)(r,t=>Object(l.startsWith)(e.origin,t))){var t=e.data||{},a=t.type,n=t.message;"iframe_url"===a&&this.setState({currentUrl:n})}}),Ue(this,"getUrl",()=>{var t=Object(l.get)(e,this.props.type);return t?t[0]:this.props.href}),Ue(this,"getRichText",()=>{var e;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:e=Ie.markdown.toHTML("CN"===window.W_L.language_mode?De.a:Me.a),this.setState({richText:e,loading:!1});case 2:case"end":return t.stop()}}),null,this,null,Promise)}),Ue(this,"openDrawer",e=>{if("HOME"===this.props.type)return this.setState({visible:!0,loading:!0}),void this.getRichText();e.shiftKey||e.ctrlKey||e.metaKey||(e.preventDefault(),this.setState({visible:!0}),setTimeout(()=>this.loadIframe(this.getUrl()),300))}),Ue(this,"closeDrawer",e=>{e&&e.preventDefault(),this.setState({visible:!1}),this.setState({visible:!1,currentUrl:null,richText:null})})}componentDidMount(){window.addEventListener("message",this.onPostMessageReceived,!1)}componentWillUnmount(){window.removeEventListener("message",this.onPostMessageReceived),clearTimeout(this.iframeLoadingTimeout)}render(){var t=this.getUrl();if(!t)return null;var a=Object(l.get)(e,"".concat(this.props.type,"[1]"),this.props.title),i=me()("help-trigger",this.props.className),s=this.state.currentUrl,c=Object(l.some)(r,e=>Object(l.startsWith)(s||t,e)),u=this.props.renderAsLink||!c,d=this.props.type;return n.a.createElement(n.a.Fragment,null,n.a.createElement(we,{title:this.props.showTooltip?n.a.createElement(n.a.Fragment,null,a,u&&n.a.createElement(n.a.Fragment,null," ",n.a.createElement("i",{className:"fa fa-external-link",style:{marginLeft:5},"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))):null},"HOME"===d?n.a.createElement(g,{className:i,onClick:this.openDrawer},this.props.children):n.a.createElement(g,{href:s||this.getUrl(),className:i,rel:"noopener noreferrer",target:"_blank",onClick:u?()=>{}:this.openDrawer})),n.a.createElement(Ee.a,{placement:"right",closable:!1,onClose:this.closeDrawer,visible:this.state.visible,className:me()("help-drawer",o),destroyOnClose:!0,width:1e3},n.a.createElement("div",{className:"drawer-wrapper"},n.a.createElement("div",{className:"drawer-menu"},s&&n.a.createElement(we,{title:"Open page in a new window",placement:"left"},n.a.createElement(g,{href:s,target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))),n.a.createElement(we,{title:"Close",placement:"bottom"},n.a.createElement(be,{onClick:this.closeDrawer},n.a.createElement(je.a,null)))),this.state.richText&&n.a.createElement(We,{className:"preview markdown"},this.state.richText),this.state.loading&&n.a.createElement(Pe,{icon:"fa-spinner fa-2x fa-pulse",message:"Loading...",className:"help-message"}),this.state.error&&n.a.createElement(Pe,{icon:"fa-exclamation-circle",className:"help-message"},"Something went wrong.",n.a.createElement("br",null),n.a.createElement(g,{href:this.state.error,target:"_blank",rel:"noopener"},window.W_L.click_here)," ",window.W_L.open_new_window)),n.a.createElement(se,{name:"HelpDrawerExtraContent",onLeave:this.closeDrawer,openPageUrl:this.loadIframe})))}},Ue(t,"propTypes",Ve(Ve({},Qe),{},{type:ae.a.oneOf(Object.keys(e))})),Ue(t,"defaultProps",Ke),a}(Ye,["https://xxx"])),$e.propTypes=Qe,$e.defaultProps=Ke;var Ge=a(653),Je=document.createElement("a");Je.style.display="none",document.body.appendChild(Je);var Xe=["origin","protocol","host","hostname","port","pathname","search","hash","href"];var Ze={parse:function(e){return Je.setAttribute("href",e),Object(l.pick)(Je,Xe)},stringify:function(e){return Object(l.extend)(Je,Object(l.pick)(e,Xe)),Je.href},normalize:function(e){return Je.setAttribute("href",e),Je.href}};a(816);function et(e){return n.a.createElement("h4",null,e.message)}function tt(){return(tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function at(e,t){switch(e){case 404:return window.W_L.web_404;case 401:case 403:return window.W_L.web_403;default:return t}}function rt(e){var t=window.W_L.web_error;if(Object(l.isObject)(e)){if(e.isAxiosError&&Object(l.isObject)(e.response))return at(e.response.status,Object(l.get)(e,"response.data.message",t));if(e.status)return at(e.status,t)}return t}function nt(e){var t=e.error,a=e.message;if(!t)return null;console.error(t);var r={error:t,message:a||rt(t)};return n.a.createElement("div",{className:"error-message-container","data-test":"ErrorMessage",role:"alert"},n.a.createElement("div",{className:"error-state bg-white tiled"},n.a.createElement("div",{className:"error-state__icon"},n.a.createElement("i",{className:"zmdi zmdi-alert-circle-o","aria-hidden":"true"})),n.a.createElement("div",{className:"error-state__details"},n.a.createElement(se,tt({name:"ErrorMessageDetails",fallback:n.a.createElement(et,r)},r)))))}function ot(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function it(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(a),!0).forEach((function(t){lt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ot(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function lt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function st(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ct(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ct(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}et.propTypes={error:ae.a.instanceOf(Error).isRequired,message:ae.a.string.isRequired},nt.propTypes={error:ae.a.object.isRequired,message:ae.a.string};var ut=n.a.createContext(null);function dt(e){var t=Object(l.trimEnd)(Ze.normalize(""),"/")+"/";return e=Ze.normalize(e),!!Object(l.startsWith)(e,t)&&"/"+Object(l.trimStart)(e.substr(t.length),"/")}function mt(e){var t=e.routes,a=e.onRouteChange,o=st(Object(r.useState)(null),2),i=o[0],s=o[1],c=Object(r.useRef)(null),u=Object(r.useRef)();return Object(r.useEffect)(()=>{var e=!1,a=new Ge.a(t,{resolveRoute(e,t){var a=e.route;if(Object(l.isFunction)(a.render))return it(it({},a),{},{routeParams:t})}});function r(t){if(!e){u.current&&u.current.reset();var r=dt(A.path)||"/";if(r===c.current)return;if(c.current=r,"REPLACE"===t)return;a.resolve({pathname:r}).then(t=>{e||c.current!==r||s(it(it({},t),{},{key:Math.random().toString(32).substr(2)}))}).catch(t=>{e||c.current!==r||s({render:e=>n.a.createElement(nt,e.routeParams),routeParams:{error:t}})})}}r("PUSH");var o=A.listen((e,t)=>r(t));return()=>{e=!0,c.current=null,o()}},[t]),Object(r.useEffect)(()=>{a(i)},[i,a]),i?n.a.createElement(ut.Provider,{value:i},n.a.createElement(j,{ref:u,renderError:e=>n.a.createElement(nt,{error:e})},i.render(i))):null}function pt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ft(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pt(Object(a),!0).forEach((function(t){bt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function bt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}mt.propTypes={routes:ae.a.arrayOf(ae.a.shape({path:ae.a.string.isRequired,render:ae.a.func,resolve:ae.a.objectOf(ae.a.any)})),onRouteChange:ae.a.func},mt.defaultProps={routes:[],onRouteChange:()=>{}};class ht{constructor(e){Object(l.extend)(this,{pathPrefix:"/".concat(e.path)},Object(l.omit)(e,["isActive","isAvailable"])),Object(l.isFunction)(e.isActive)&&(this.isActive=e.isActive),Object(l.isFunction)(e.isAvailable)&&(this.isAvailable=e.isAvailable)}isActive(e){return e.startsWith(this.pathPrefix)}isAvailable(){return void 0===this.permission||H.hasPermission(this.permission)}}var gt=new class{constructor(){bt(this,"items",[])}add(e,t){e=Object(l.isString)(e)?e:null,this.remove(e),Object(l.isObject)(t)&&(this.items.push(new ht(ft(ft({},t),{},{id:e}))),this.items=Object(l.sortBy)(this.items,"order"))}remove(e){Object(l.isString)(e)&&(this.items=Object(l.filter)(this.items,t=>t.id!==e))}getAvailableItems(){return Object(l.filter)(this.items,e=>e.isAvailable())}getActiveItem(e){var t=dt(e);return Object(l.find)(this.items,e=>e.isActive(t))}},yt=a(101),vt=a.n(yt),wt=a(654),Ot=a.n(wt),Et=a(655),_t=a.n(Et),jt=a(656),St=a.n(jt),Ct=a(657),Pt=a.n(Ct),xt=a(311),Lt=a.n(xt),kt=a(658),Nt=a.n(kt),At=a(426);function Tt(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,window.W_L.version,": ",Y.Holmes_version,At!==Y.version&&" (".concat(At.substring(0,8),")")),Y.newVersionAvailable&&H.hasPermission("super_admin")&&n.a.createElement("div",{className:"m-t-10"},n.a.createElement(g,{href:"https://version.redash.io/",className:"update-available",target:"_blank",rel:"noopener"},"Update Available ",n.a.createElement("i",{className:"fa fa-external-link m-l-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))))}var Wt,It=a(240),qt=!1,Dt=0,Rt=!0,Mt=new It.EventEmitter,zt="ws";"https:"===window.location.protocol&&(zt="wss");var Ft=()=>{if(!Wt||1!==Wt.readyState){var e="".concat(zt,"://").concat("192.168.5.126:8339/chat/").concat(H.id,"_").concat(H.name);(Wt=new WebSocket(e)).onopen=function(){Ut.reset().start(),qt=!0,Rt=!1,Dt=1,Mt.emit("change",Dt)},Wt.onerror=function(t){Vt(e)},Wt.onclose=function(e){qt=!1,Dt=0,Mt.emit("change",Dt)},Wt.onmessage=function(e){qt=!0,Dt=1,Mt.emit("change",Dt)}}},Vt=e=>{qt||setTimeout((function(){Ft(),qt=!1,Dt=2,Mt.emit("change",Dt)}),4e3)},Ut={timeout:6e4,timeoutObj:null,reset:function(){return clearInterval(this.timeoutObj),this},start:function(){this.timeoutObj=setInterval((function(){Bt({state:200,sender:"heartCheck",data:{content:"HeartBeat"}})}),this.timeout)}},Bt=e=>{Wt&&1===Wt.readyState&&Wt.send(JSON.stringify(e))},Ht=e=>{Rt=e};a(817);function Yt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qt(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Qt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Kt(){return(Kt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function $t(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Gt(e){var t=e.children,a=$t(e,["children"]);return n.a.createElement(ue.a,Kt({selectable:!1,mode:"vertical",theme:"dark"},a),t)}function Jt(){var e=Object(r.useContext)(ut);return Object(r.useMemo)(()=>({dashboards:Object(l.includes)(["Dashboards.List","Dashboards.Favorites","Dashboards.My","Dashboards.ViewOrEdit","Dashboards.LegacyViewOrEdit"],e.id),queries:Object(l.includes)(["Queries.List","Queries.Favorites","Queries.Archived","Queries.My","Queries.View","Queries.New","Queries.Edit"],e.id),dataSources:Object(l.includes)(["DataSources.List"],e.id),alerts:Object(l.includes)(["Alerts.List","Alerts.New","Alerts.View","Alerts.Edit"],e.id),testdialogue:Object(l.includes)(["Dialogue.List"],e.id),report_route:Object(l.includes)(["Dialogue.List.Report"],e.id),dialogue_list:Object(l.includes)(["Dialogue.List.Dialogue"],e.id),autopilot:Object(l.includes)(["Dialogue.List.autopilot"],e.id),autopilot_list:Object(l.includes)(["Dialogue.List.autopilot_list"],e.id),autopilot_view:Object(l.includes)(["Dialogue.List.autopilot_view"],e.id)}),[e.id])}function Xt(){var e=Object(l.first)(gt.getAvailableItems()),t=Jt(),a=Yt(Object(r.useState)(0),2),o=a[0],i=a[1];return Object(r.useEffect)(()=>{var e=e=>{i(e)};return Mt.on("change",e),()=>{Mt.off("change",e)}},[]),n.a.createElement("nav",{className:"desktop-navbar"},n.a.createElement(Gt,{className:"desktop-navbar-logo"},n.a.createElement("div",{role:"menuitem"},n.a.createElement(g,{href:"./"},n.a.createElement("img",{src:vt.a,alt:"Holmes"})))),n.a.createElement(Gt,{className:"desktop-navbar-spacer",style:{flex:"0"}},n.a.createElement(ue.a.SubMenu,{key:"create",popupClassName:"desktop-navbar-submenu","data-test":"dialogueButton",className:t.testdialogue||t.dialogue_list?"navbar-active-item":null,tabIndex:0,title:n.a.createElement(n.a.Fragment,null,n.a.createElement(Ot.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.data_analysis))},n.a.createElement(ue.a.Item,{key:"testdialogue"},n.a.createElement(g,{href:"./","data-test":"testdialogue"},window.W_L.dialogue)),n.a.createElement(ue.a.Item,{key:"dialogue_list"},n.a.createElement(g,{"data-test":"dialogue-list",href:"dialogue-list"},window.W_L.history_dialogue)))),n.a.createElement(Gt,{className:"desktop-navbar-spacer",style:{flex:"0"}},n.a.createElement(ue.a.SubMenu,{key:"create",popupClassName:"desktop-navbar-submenu","data-test":"queriesButton",tabIndex:0,className:t.report_route||t.queries?"navbar-active-item":null,title:n.a.createElement(n.a.Fragment,null,n.a.createElement(_t.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.query_builder))},n.a.createElement(ue.a.Item,{key:"report_route"},n.a.createElement(g,{href:"report-route","data-test":"report-route"},window.W_L.report_generation)),n.a.createElement(ue.a.Item,{key:"queries"},n.a.createElement(g,{"data-test":"queries",href:"queries"},window.W_L.report_list)))),n.a.createElement(Gt,{style:{flex:"0"}},n.a.createElement(ue.a.Item,{key:"dashboards",className:t.dashboards?"navbar-active-item":null},n.a.createElement(g,{href:"dashboards"},n.a.createElement(St.a,{"aria-label":"dashboards navigation button"}),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.dashboards)))),n.a.createElement(Gt,{className:"desktop-navbar-spacer",style:{flex:"1"}},n.a.createElement(ue.a.SubMenu,{key:"create",popupClassName:"desktop-navbar-submenu","data-test":"autopilotButton",className:t.autopilot||t.autopilot_view||t.autopilot_list?"navbar-active-item":null,tabIndex:0,title:n.a.createElement(n.a.Fragment,null,n.a.createElement(Pt.a,{"aria-label":"autopilot navigation button"}),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.auto_pilot))},n.a.createElement(ue.a.Item,{key:"autopilot"},n.a.createElement(g,{href:"autopilot","data-test":"autopilot"},window.W_L.auto_pilot)),n.a.createElement(ue.a.Item,{key:"autopilot_list"},n.a.createElement(g,{"data-test":"autopilot_list",href:"autopilot_list"},window.W_L.history_autopilot)))),n.a.createElement(Gt,null,n.a.createElement(ue.a.Item,{key:"help"},n.a.createElement($e,{showTooltip:!1,type:"HOME",tabIndex:0},n.a.createElement(Lt.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.help))),e&&n.a.createElement(ue.a.Item,{key:"settings",className:t.dataSources?"navbar-active-item":null},n.a.createElement(g,{href:e.path,"data-test":"SettingsLink"},n.a.createElement(Nt.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.setting)))),n.a.createElement(Gt,{className:"desktop-navbar-profile-menu"},n.a.createElement(ue.a.SubMenu,{key:"profile",popupClassName:"desktop-navbar-submenu",tabIndex:0,title:n.a.createElement("span",{"data-test":"ProfileDropdown",className:"desktop-navbar-profile-menu-title"},n.a.createElement("img",{className:"profile__image_thumb",src:H.profile_image_url,alt:H.name}),n.a.createElement("div",{className:"profile__live__type"},n.a.createElement("span",{style:{background:0===o?"red":1===o?"green":"yellow"}}),n.a.createElement("div",null,0===o?window.W_L.offline:1===o?window.W_L.online:window.W_L.pending)))},n.a.createElement(ue.a.Item,{key:"profile"},n.a.createElement(g,{href:"users/me"},window.W_L.personal_setting)),H.hasPermission("super_admin")&&n.a.createElement(ue.a.Item,{key:"status"},n.a.createElement(g,{href:"admin/status"},window.W_L.sys_status)),n.a.createElement(ue.a.Divider,null),n.a.createElement(ue.a.Item,{key:"logout"},n.a.createElement(be,{"data-test":"LogOutButton",onClick:()=>X.logout()},window.W_L.log_out)),n.a.createElement(ue.a.Divider,null),n.a.createElement(ue.a.Item,{key:"version",role:"presentation",disabled:!0,className:"version-info"},n.a.createElement(Tt,null)))))}var Zt=a(659),ea=a.n(Zt),ta=a(70),aa=a.n(ta);a(843);function ra(e){var t=e.getPopupContainer,a=Object(l.first)(gt.getAvailableItems());return n.a.createElement("div",{className:"mobile-navbar"},n.a.createElement("div",{className:"mobile-navbar-logo"},n.a.createElement(g,{href:"./"},n.a.createElement("img",{src:vt.a,alt:"Holmes"}))),n.a.createElement("div",null,n.a.createElement(aa.a,{overlayStyle:{minWidth:200},trigger:["click"],getPopupContainer:t,overlay:n.a.createElement(ue.a,{mode:"vertical",theme:"dark",selectable:!1,className:"mobile-navbar-menu"},n.a.createElement(ue.a.Item,{key:"testdialogue"},n.a.createElement(g,{href:"./"},window.W_L.data_analysis)),n.a.createElement(ue.a.Item,{key:"report-route"},n.a.createElement(g,{href:"report-route"},window.W_L.report_generation)),n.a.createElement(ue.a.Item,{key:"queries"},n.a.createElement(g,{href:"queries"},window.W_L.report_list)),n.a.createElement(ue.a.Item,{key:"dashboards"},n.a.createElement(g,{href:"dashboards"},window.W_L.dashboard)),n.a.createElement(ue.a.Item,{key:"autopilot"},n.a.createElement(g,{href:"autopilot"},window.W_L.auto_pilot)),n.a.createElement(ue.a.Item,{key:"autopilot_list"},n.a.createElement(g,{href:"autopilot_list"},window.W_L.history_autopilot)),a&&n.a.createElement(ue.a.Item,{key:"settings"},n.a.createElement(g,{href:a.path},window.W_L.setting)),H.hasPermission("super_admin")&&n.a.createElement(ue.a.Divider,null),n.a.createElement(ue.a.Item,{key:"logout",onClick:()=>X.logout()},window.W_L.log_out))},n.a.createElement(m.a,{className:"mobile-navbar-toggle-button",ghost:!0},n.a.createElement(ea.a,null)))))}ra.propTypes={getPopupContainer:ae.a.func},ra.defaultProps={getPopupContainer:null};a(849);function na(e){var t=e.children,a=Object(r.useRef)(),o=Object(r.useCallback)(()=>a.current,[]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(se,{name:"ApplicationWrapper"},n.a.createElement("div",{className:"application-layout-side-menu"},n.a.createElement(se,{name:"ApplicationDesktopNavbar"},n.a.createElement(Xt,null))),n.a.createElement("div",{className:"application-layout-content"},n.a.createElement("nav",{className:"application-layout-top-menu",ref:a},n.a.createElement(se,{name:"ApplicationMobileNavbar",getPopupContainer:o},n.a.createElement(ra,{getPopupContainer:o}))),t)))}function oa(){return(oa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ia(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function la(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function sa(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?la(Object(a),!0).forEach((function(t){ca(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):la(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ca(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ua(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return da(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return da(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function da(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ma(e){var t=e.bodyClass,a=e.currentRoute,o=e.render,i=ua(Object(r.useState)(!!X.isAuthenticated()),2),l=i[0],s=i[1];return Object(r.useEffect)(()=>{var e=!1;return Promise.all([X.requireSession(),ee.refresh(),Z.refresh()]).then(()=>{e||s(!!X.isAuthenticated())}).catch(()=>{e||s(!1)}),()=>{e=!0}},[]),Object(r.useEffect)(()=>{if(t)return document.body.classList.toggle(t,!0),()=>{document.body.classList.toggle(t,!1)}},[t]),l?n.a.createElement(na,null,n.a.createElement(n.a.Fragment,{key:a.key},n.a.createElement(j,{renderError:e=>n.a.createElement(nt,{error:e})},n.a.createElement(E.Consumer,null,e=>{var t=e.handleError;return o(sa(sa({},a.routeParams),{},{pageTitle:a.title,onError:t}))})))):null}na.propTypes={children:ae.a.node},na.defaultProps={children:null};function pa(e){var t=e.render,a=e.bodyClass;return sa(sa({},ia(e,["render","bodyClass"])),{},{render:e=>{var r={render:t,bodyClass:a,currentRoute:e};return n.a.createElement(se,oa({},r,{name:"UserSessionWrapper",fallback:n.a.createElement(ma,r)}))}})}var fa=a(20),ba=a.n(fa);a(69);function ha(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ga(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ha(Object(a),!0).forEach((function(t){ya(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ha(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ya(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function va(){return(va=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var wa=ae.a.shape({props:ae.a.shape({visible:ae.a.bool,onOk:ae.a.func,onCancel:ae.a.func,afterClose:ae.a.func}).isRequired,close:ae.a.func.isRequired,dismiss:ae.a.func.isRequired});function Oa(e){return{Component:e,showModal:t=>function(e,t){var a={props:{visible:!0,okButtonProps:{},cancelButtonProps:{},onOk:()=>{},onCancel:()=>{},afterClose:()=>{}},close:()=>{},dismiss:()=>{}},r=null,o={onClose:()=>{},onDismiss:()=>{}},s=document.createElement("div");function c(){i.a.render(n.a.createElement(e,va({},t,{dialog:a})),s)}function u(e,t){return a.props.okButtonProps={disabled:!0},a.props.cancelButtonProps={disabled:!0},t(),c(),Promise.resolve(e).then(()=>{a.props.visible=!1}).finally(()=>{a.props.okButtonProps={},a.props.cancelButtonProps={},c()})}function d(e){return r||(r=u(o.onClose(e),()=>{a.props.okButtonProps.loading=!0}).finally(()=>{r=null})),r}function m(e){return r||(r=u(o.onDismiss(e),()=>{a.props.cancelButtonProps.loading=!0}).finally(()=>{r=null})),r}document.body.appendChild(s),a.props.onOk=d,a.props.onCancel=m,a.props.afterClose=function(){setTimeout(()=>{i.a.unmountComponentAtNode(s),document.body.removeChild(s)},10)},a.close=d,a.dismiss=m;var p={close:d,dismiss:m,update:e=>{t=ga(ga({},t),e),c()},onClose:e=>(Object(l.isFunction)(e)&&(o.onClose=e),p),onDismiss:e=>(Object(l.isFunction)(e)&&(o.onDismiss=e),p)};return c(),p}(e,t)}}function Ea(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];setTimeout(()=>{!1===dt(e)?window.location=e:(e=Ze.parse(e),A.update({path:e.pathname,search:e.search,hash:e.hash},t))},10)}var _a=[],ja=Object(l.debounce)(()=>{var e=_a;_a=[],B.post("api/events",e)},1e3);function Sa(e,t,a,r){var n={action:e,object_type:t,object_id:a,timestamp:Date.now()/1e3,screen_resolution:"".concat(window.screen.width,"x").concat(window.screen.height)};Object(l.extend)(n,r),_a.push(n),ja()}var Ca=6,Pa=50,xa=15,La=800,ka=3,Na=3,Aa=1,Ta=6,Wa=1,Ia=1e3,qa=a(15),Da=a.n(qa);var Ra=class{constructor(e,t){this.title=e.title,this.name=e.name,this.type=e.type,this.global=e.global,this.parentQueryId=t,this.locals=[],this.urlPrefix="p_"}static getExecutionValue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(l.isObject)(e)&&Object(l.isFunction)(e.getExecutionValue)?e.getExecutionValue(t):null}static setValue(e,t){return Object(l.isObject)(e)&&Object(l.isFunction)(e.setValue)?e.setValue(t):null}get isEmpty(){return Object(l.isNull)(this.normalizedValue)}get hasPendingValue(){return void 0!==this.pendingValue&&!Object(l.isEqual)(this.pendingValue,this.normalizedValue)}get normalizedValue(){return this.$$value}isEmptyValue(e){return Object(l.isNull)(this.normalizeValue(e))}normalizeValue(e){return Object(l.isUndefined)(e)?null:e}updateLocals(){Object(l.isArray)(this.locals)&&Object(l.each)(this.locals,e=>{e.setValue(this.value)})}setValue(e){var t=this.normalizeValue(e);return this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){return this.value}setPendingValue(e){this.pendingValue=this.normalizeValue(e)}applyPendingValue(){this.hasPendingValue&&this.setValue(this.pendingValue)}clearPendingValue(){this.pendingValue=void 0}toUrlParams(){var e=this.urlPrefix;return{["".concat(e).concat(this.name)]:this.isEmpty?null:this.value}}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);Object(l.has)(e,a)&&this.setValue(e[a])}toQueryTextFragment(){return"{{ ".concat(this.name," }}")}toSaveableObject(){return Object(l.omit)(this,["$$value","urlPrefix","pendingValue","parentQueryId"])}};var Ma=class extends Ra{constructor(e,t){super(e,t),this.setValue(e.value)}normalizeValue(e){var t=Object(l.toString)(e);return Object(l.isEmpty)(t)?null:t}};var za=class extends Ra{constructor(e,t){super(e,t),this.setValue(e.value)}normalizeValue(e){if(Object(l.isNull)(e))return null;var t=Object(l.toNumber)(e);return isNaN(t)?null:t}};a(106);var Fa=class extends Ra{constructor(e,t){super(e,t),this.enumOptions=e.enumOptions,this.multiValuesOptions=e.multiValuesOptions,this.setValue(e.value)}normalizeValue(e){if(Object(l.isEmpty)(this.enumOptions))return null;var t=this.enumOptions.split("\n")||[];return this.multiValuesOptions?(Object(l.isArray)(e)||(e=[e]),e=Object(l.intersection)(e,t)):e&&!Object(l.isArray)(e)&&Object(l.includes)(t,e)||(e=t[0]),Object(l.isArray)(e)&&Object(l.isEmpty)(e)?null:e}getExecutionValue(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).joinListValues&&Object(l.isArray)(this.value)){var e=Object(l.get)(this.multiValuesOptions,"separator",","),t=Object(l.get)(this.multiValuesOptions,"prefix",""),a=Object(l.get)(this.multiValuesOptions,"suffix",""),r=Object(l.map)(this.value,e=>"".concat(t).concat(e).concat(a));return Object(l.join)(r,e)}return this.value}toUrlParams(){var e=this.urlPrefix,t=this.value;return this.multiValuesOptions&&Object(l.isArray)(this.value)&&(t=JSON.stringify(this.value)),{["".concat(e).concat(this.name)]:this.isEmpty?null:t}}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);if(Object(l.has)(e,a))if(this.multiValuesOptions)try{var r=JSON.parse(e[a]);this.setValue(Object(l.isArray)(r)?r:e[a])}catch(t){this.setValue(e[a])}else this.setValue(e[a])}},Va=(a(482),a(250)),Ua=a.n(Va),Ba=v()("redash:services:QueryResult"),Ha=["filter","multi-filter","multiFilter"];function Ya(e){return function(e){var t;if(-1!==e.indexOf("::"))t="::";else{if(-1===e.indexOf("__"))return e;t="__"}var a=e.split(t);return""===a[0]&&2===a.length?a[1]:Object(l.includes)(Ha,a[1])?a[0]:e}(e).replace(/(?:^|\s)\S/g,e=>e.toUpperCase())}var Qa=e=>{var t=e.id;return B.get("api/query_results/".concat(t))},Ka=e=>B.post((e=>e.id?"api/query_results/".concat(e.id):"api/query_results")(e),e),$a="waiting",Ga="processing",Ja="done",Xa="failed",Za="loading-result",er={1:$a,2:Ga,3:Ja,4:Xa};function tr(e,t){switch(Object(l.get)(t,"response.status")){case 403:return void e.update(t.response.data);case 400:if("job"in t.response.data)return void e.update(t.response.data);break;case 404:return void e.update({job:{error:"cached query result unavailable, please execute again.",status:4}})}Ba("Unknown error",t),e.update({job:{error:Object(l.get)(t,"response.data.message","Unknown error occurred. Please try again later."),status:4}})}function ar(e){return new Promise(t=>setTimeout(t,e))}function rr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return B.get("api/jobs/".concat(e)).then(e=>{var a=er[e.job.status];return a===$a||a===Ga?ar(t).then(()=>rr(e.job.id)):a===Ja?e.job.result:a===Xa?Promise.reject(e.job.error):void 0})}class nr{constructor(e){var t;this.deferred=((t={onStatusChange:e=>{}}).promise=new Promise((e,a)=>{t.resolve=e,t.reject=a}),t),this.job={},this.query_result={},this.status="waiting",this.updatedAt=Da()(),this.isLoadingResult=!1,e&&this.update(e)}update(e){if(Object(l.extend)(this,e),"query_result"in e){this.status=Ja,this.deferred.onStatusChange(Ja);var t={};Object(l.each)(this.query_result.data.rows,e=>{Object(l.forOwn)(e,(a,r)=>{var n=null;Object(l.isNumber)(a)?n="float":Object(l.isString)(a)&&a.match(/^\d{4}-\d{2}-\d{2}T/)?(e[r]=Da.a.utc(a),n="datetime"):Object(l.isString)(a)&&a.match(/^\d{4}-\d{2}-\d{2}$/)?(e[r]=Da.a.utc(a),n="date"):"object"==typeof a&&null!==a?e[r]=JSON.stringify(a):n="string",null!==n&&(void 0!==t[r]&&t[r]!==n?t[r]="string":t[r]=n)})}),Object(l.each)(this.query_result.data.columns,e=>{e.name=""+e.name,t[e.name]&&(null!=e.type&&"string"!==e.type||(e.type=t[e.name]))}),this.deferred.resolve(this)}else 3===this.job.status||2===this.job.status?(this.deferred.onStatusChange(Ga),this.status="processing"):4===this.job.status?(this.status=er[this.job.status],this.deferred.reject(new br(this.job.error))):(this.deferred.onStatusChange(void 0),this.status=void 0)}getId(){var e=null;return"query_result"in this&&(e=this.query_result.id),e}cancelExecution(){B.delete("api/jobs/".concat(this.job.id))}getStatus(){return this.isLoadingResult?Za:this.status||er[this.job.status]}getError(){if("None"!==this.job.error)return this.job.error}getLog(){return this.query_result.data&&this.query_result.data.log&&0!==this.query_result.data.log.length?this.query_result.data.log:null}getUpdatedAt(){return this.query_result.retrieved_at||1e3*this.job.updated_at||this.updatedAt}getRuntime(){return this.query_result.runtime}getRawData(){return this.query_result.data?this.query_result.data.rows:null}getData(){return this.query_result.data?this.query_result.data.rows:null}isEmpty(){return null===this.getData()||0===this.getData().length}getColumns(){return void 0===this.columns&&this.query_result.data&&(this.columns=this.query_result.data.columns),this.columns}getColumnNames(){return void 0===this.columnNames&&this.query_result.data&&(this.columnNames=this.query_result.data.columns.map(e=>e.name)),this.columnNames}getColumnFriendlyNames(){return this.getColumnNames().map(e=>Ya(e))}getTruncated(){return this.query_result.data?this.query_result.data.truncated:null}getFilters(){if(!this.getColumns())return[];var e=[];return this.getColumns().forEach(t=>{var a=t.name,r=a.split("::")[1]||a.split("__")[1];if(Object(l.includes)(Ha,r)){var n={name:a,friendlyName:Ya(a),column:t,values:[],multiple:"multiFilter"===r||"multi-filter"===r};e.push(n)}},this),this.getRawData().forEach(t=>{e.forEach(e=>{e.values.push(t[e.name]),1===e.values.length&&(e.multiple?e.current=[t[e.name]]:e.current=t[e.name])})}),e.forEach(e=>{e.values=Object(l.uniqBy)(e.values,e=>Da.a.isMoment(e)?e.unix():e),e.values.length>1&&e.multiple&&(e.current=e.values.slice())}),e}toPromise(e){return e&&(this.deferred.onStatusChange=e),this.deferred.promise}static getById(e,t){var a=new nr;return a.isLoadingResult=!0,a.deferred.onStatusChange(Za),B.get("api/queries/".concat(e,"/results/").concat(t,".json")).then(e=>{a.isLoadingResult=!1,a.update(e)}).catch(e=>{a.isLoadingResult=!1,tr(a,e)}),a}loadLatestCachedResult(e,t){B.post("api/queries/".concat(e,"/results"),{queryId:e,parameters:t}).then(e=>{this.update(e)}).catch(e=>{tr(this,e)})}loadResult(e){this.isLoadingResult=!0,this.deferred.onStatusChange(Za),Qa({id:this.job.query_result_id}).then(e=>{this.update(e),this.isLoadingResult=!1}).catch(t=>{void 0===e&&(e=0),e>3?(Ba("Connection error while trying to load result",t),this.update({job:{error:"failed communicating with server. Please check your Internet connection and try again.",status:4}}),this.isLoadingResult=!1):setTimeout(()=>{this.loadResult(e+1)},1e3*Math.pow(2,e))})}refreshStatus(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=()=>X.isAuthenticated()?this.loadResult():this.loadLatestCachedResult(e,t);(X.isAuthenticated()?B.get("api/jobs/".concat(this.job.id)):B.get("api/queries/".concat(e,"/jobs/").concat(this.job.id))).then(n=>{if(this.update(n),"processing"===this.getStatus()&&this.job.query_result_id&&"None"!==this.job.query_result_id)r();else if("failed"!==this.getStatus()){setTimeout(()=>{this.refreshStatus(e,t,a+1)},a>10?3e3:500)}}).catch(e=>{Ba("Connection error",e),this.update({job:{error:"failed communicating with server. Please check your Internet connection and try again.",status:4}})})}getLink(e,t,a){var r="api/queries/".concat(e,"/results/").concat(this.getId(),".").concat(t);return a&&(r="".concat(r,"?api_key=").concat(a)),r}getName(e,t){return"".concat(e.replace(/ /g,"_")+Da()(this.getUpdatedAt()).format("_YYYY_MM_DD"),".").concat(t)}static getByQueryId(e,t,a,r){var n=new nr;return B.post("api/queries/".concat(e,"/results"),{id:e,parameters:t,apply_auto_limit:a,max_age:r}).then(a=>{n.update(a),"job"in a&&n.refreshStatus(e,t)}).catch(e=>{tr(n,e)}),n}static get(e,t,a,r,n,o){var i=new nr,l={data_source_id:e,parameters:a,query:t,apply_auto_limit:r,max_age:n};return void 0!==o&&(l.query_id=o),Ka(l).then(e=>{i.update(e),"job"in e&&i.refreshStatus(t,a)}).catch(e=>{tr(i,e)}),i}}var or=nr,ir="localOptions:";var lr={get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=ir+e;return a in window.localStorage?JSON.parse(window.localStorage.getItem(a)):t},set:function(e,t){var a=ir+e;window.localStorage.setItem(a,JSON.stringify(t))}};function sr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function cr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?sr(Object(a),!0).forEach((function(t){ur(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):sr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ur(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function dr(){return(dr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}Ua.a.escape=l.identity;var mr=v()("redash:services:query");class pr{constructor(e){Object(l.extend)(this,e),Object(l.has)(this,"options")||(this.options={}),this.options.apply_auto_limit=!!this.options.apply_auto_limit,Object(l.isArray)(this.options.parameters)||(this.options.parameters=[])}isNew(){return void 0===this.id}hasDailySchedule(){return this.schedule&&null!==this.schedule.match(/\d\d:\d\d/)}scheduleInLocalTime(){var e=this.schedule.split(":");return Da.a.utc().hour(e[0]).minute(e[1]).local().format("HH:mm")}hasResult(){return!(!this.latest_query_data&&!this.latest_query_data_id)}paramsRequired(){return this.getParameters().isRequired()}hasParameters(){return this.getParametersDefs().length>0}prepareQueryResultExecution(e,t){var a=this.getParameters(),r=a.getMissing();if(r.length>0){var n="parameter",o="value";return r.length>1&&(n="parameters",o="values"),new or({job:{error:"missing ".concat(o," for ").concat(r.join(", ")," ").concat(n,"."),status:4}})}return a.isRequired()&&(this.latest_query_data=null,this.latest_query_data_id=null),this.latest_query_data&&0!==t?this.queryResult||(this.queryResult=new or({query_result:this.latest_query_data})):this.latest_query_data_id&&0!==t?this.queryResult||(this.queryResult=or.getById(this.id,this.latest_query_data_id)):this.queryResult=e(),this.queryResult}getQueryResult(e){return this.prepareQueryResultExecution(()=>or.getByQueryId(this.id,this.getParameters().getExecutionValues(),this.getAutoLimit(),e),e)}getQueryResultByText(e,t){var a=t||this.query;if(!a)return new br(window.W_L.empty_query);var r=this.getParameters().getExecutionValues({joinListValues:!0});return this.prepareQueryResultExecution(()=>or.get(this.data_source_id,a,r,this.getAutoLimit(),e,this.id),e)}getUrl(e,t){var a="queries/".concat(this.id);e&&(a+="/source");var r={};return this.getParameters().isRequired()&&this.getParametersDefs().forEach(e=>{Object(l.extend)(r,e.toUrlParams())}),Object.keys(r).forEach(e=>null==r[e]&&delete r[e]),""!==(r=Object(l.map)(r,(e,t)=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e))).join("&"))&&(a+="?".concat(r)),t&&(a+="#".concat(t)),a}getQueryResultPromise(){return this.getQueryResult().toPromise()}getParameters(){return this.$parameters||(this.$parameters=new fr(this,A.search)),this.$parameters}getAutoLimit(){return this.options.apply_auto_limit}getParametersDefs(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.getParameters().get(e)}favorite(){return pr.favorite(this)}unfavorite(){return pr.unfavorite(this)}clone(){var e=Object(l.clone)(this);return e.$parameters=null,e.getParameters(),e}}class fr{constructor(e,t){this.query=e,this.updateParameters(),this.initFromQueryString(t)}parseQuery(){var e=()=>Object(l.map)(this.query.options.parameters,e=>e.name),t=[];if(void 0!==this.query.query)try{var a=Ua.a.parse(this.query.query);t=Object(l.uniq)(function e(t){var a=[];return t.forEach(t=>{"name"===t[0]||"&"===t[0]?a.push(t[1].split(".")[0]):"#"===t[0]&&(a=Object(l.union)(a,e(t[4])))}),a}(a))}catch(a){mr("Failed parsing parameters: ",a),t=e()}else t=e();return t}updateParameters(e){if(this.query.query!==this.cachedQueryText){this.cachedQueryText=this.query.query;var t=e?this.parseQuery():Object(l.map)(this.query.options.parameters,e=>e.name);this.query.options.parameters=this.query.options.parameters||[];var a={};this.query.options.parameters.forEach(e=>{a[e.name]=e}),t.forEach(e=>{Object(l.has)(a,e)||this.query.options.parameters.push(zr({title:e,name:e,type:"text",value:null,global:!1}))});var r=this.query.options.parameters;this.query.options.parameters=r.filter(e=>Object(l.includes)(t,e.name)).map(e=>e instanceof Ra?e:zr(e,this.query.id))}else{var n=this.query.options.parameters;Object(l.find)(n,e=>!(e instanceof Ra))&&(this.query.options.parameters=Object(l.map)(n,e=>e instanceof Ra?e:zr(e,this.query.id)))}}initFromQueryString(e){this.get().forEach(t=>{t.fromUrlParams(e)})}get(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.updateParameters(e),this.query.options.parameters}add(e){this.query.options.parameters=this.query.options.parameters.filter(t=>t.name!==e.name);var t=zr(e);return this.query.options.parameters.push(t),t}getMissing(){return Object(l.map)(Object(l.filter)(this.get(),e=>e.isEmpty),e=>e.title)}isRequired(){return!Object(l.isEmpty)(this.get())}getExecutionValues(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.get();return Object(l.zipObject)(Object(l.map)(t,e=>e.name),Object(l.map)(t,t=>t.getExecutionValue(e)))}hasPendingValues(){return Object(l.some)(this.get(),e=>e.hasPendingValue)}applyPendingValues(){Object(l.each)(this.get(),e=>e.applyPendingValue())}toUrlParams(){if(0===this.get().length)return"";var e=dr(...this.get().map(e=>e.toUrlParams()));return Object.keys(e).forEach(t=>null==e[t]&&delete e[t]),Object.keys(e).map(t=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))).join("&")}}class br{constructor(e){this.errorMessage=e,this.updatedAt=Da.a.utc()}getUpdatedAt(){return this.updatedAt}getError(){return this.errorMessage}toPromise(){return Promise.reject(this)}getStatus(){return"failed"}getData(){return null}getLog(){return null}}var hr=e=>new pr(e),gr=e=>cr(cr({},e),{},{results:Object(l.map)(e.results,hr)}),yr={query:e=>B.get("api/queries",{params:e}).then(gr),get:e=>B.get("api/queries/".concat(e.id),e).then(hr),save:e=>B.post((e=>e.id?"api/queries/".concat(e.id):"api/queries")(e),e).then(hr),delete:e=>B.delete("api/queries/".concat(e.id)),recent:e=>B.get("api/queries/recent",{params:e}).then(e=>Object(l.map)(e,hr)),archive:e=>B.get("api/queries/archive",{params:e}).then(gr),myQueries:e=>B.get("api/queries/my",{params:e}).then(gr),fork:e=>{var t=e.id;return B.post("api/queries/".concat(t,"/fork"),{id:t}).then(hr)},resultById:e=>B.get("api/queries/".concat(e.id,"/results.json")),asDropdown:e=>B.get("api/queries/".concat(e.id,"/dropdown")),associatedDropdown:e=>{var t=e.queryId,a=e.dropdownQueryId;return B.get("api/queries/".concat(t,"/dropdowns/").concat(a))},favorites:e=>B.get("api/queries/favorites",{params:e}).then(gr),favorite:e=>B.post("api/queries/".concat(e.id,"/favorite")),unfavorite:e=>B.delete("api/queries/".concat(e.id,"/favorite")),newQuery:function(){return new pr({query:"",name:window.W_L.new_Query,schedule:null,user:H,options:{apply_auto_limit:lr.get("applyAutoLimit",!0)},tags:[],can_edit:!0})}};Object(l.extend)(pr,yr);var vr=class extends Ra{constructor(e,t){super(e,t),this.queryId=e.queryId,this.multiValuesOptions=e.multiValuesOptions,this.setValue(e.value)}normalizeValue(e){return Object(l.isUndefined)(e)||Object(l.isNull)(e)||Object(l.isArray)(e)&&Object(l.isEmpty)(e)?null:e=this.multiValuesOptions?Object(l.isArray)(e)?e:[e]:Object(l.isArray)(e)?e[0]:e}getExecutionValue(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).joinListValues&&Object(l.isArray)(this.value)){var e=Object(l.get)(this.multiValuesOptions,"separator",","),t=Object(l.get)(this.multiValuesOptions,"prefix",""),a=Object(l.get)(this.multiValuesOptions,"suffix",""),r=Object(l.map)(this.value,e=>"".concat(t).concat(e).concat(a));return Object(l.join)(r,e)}return this.value}toUrlParams(){var e=this.urlPrefix,t=this.value;return this.multiValuesOptions&&Object(l.isArray)(this.value)&&(t=JSON.stringify(this.value)),{["".concat(e).concat(this.name)]:this.isEmpty?null:t}}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);if(Object(l.has)(e,a))if(this.multiValuesOptions)try{var r=JSON.parse(e[a]);this.setValue(Object(l.isArray)(r)?r:e[a])}catch(t){this.setValue(e[a])}else this.setValue(e[a])}loadDropdownValues(){return this.parentQueryId?pr.associatedDropdown({queryId:this.parentQueryId,dropdownQueryId:this.queryId}).catch(()=>Promise.resolve([])):pr.asDropdown({id:this.queryId}).catch(Promise.resolve([]))}},wr={date:"YYYY-MM-DD","datetime-local":"YYYY-MM-DD HH:mm","datetime-with-seconds":"YYYY-MM-DD HH:mm:ss"},Or={now:{name:"Today/Now",value:()=>Da()()},yesterday:{name:"Yesterday",value:()=>Da()().subtract(1,"day")}},Er=ae.a.oneOf(Object(l.values)(Or));function _r(e){return Object(l.startsWith)(e,"d_")&&Object(l.has)(Or,e.substring("d_".length))}function jr(e){return Object(l.includes)(Or,e)}function Sr(e){return _r(e)?Or[e.substring("d_".length)]:null}var Cr=class extends Ra{constructor(e,t){super(e,t),this.useCurrentDateTime=e.useCurrentDateTime,this.setValue(e.value)}get hasDynamicValue(){return jr(this.normalizedValue)}normalizeValue(e){if(_r(e))return Sr(e);if(jr(e))return e;var t=Da()(e);return t.isValid()?t:null}setValue(e){var t=this.normalizeValue(e);return jr(t)?this.value="d_"+Object(l.findKey)(Or,t):Da.a.isMoment(t)?this.value=t.format(wr[this.type]):this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){return this.hasDynamicValue?this.normalizedValue.value().format(wr[this.type]):Object(l.isNull)(this.value)&&this.useCurrentDateTime?Da()().format(wr[this.type]):this.value}};function Pr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xr(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xr(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var Lr={"date-range":"YYYY-MM-DD","datetime-range":"YYYY-MM-DD HH:mm","datetime-range-with-seconds":"YYYY-MM-DD HH:mm:ss"},kr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>Da()();return function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return[e(),a?t():void 0]}},Nr={today:{name:"Today",value:()=>[Da()().startOf("day"),Da()().endOf("day")]},yesterday:{name:"Yesterday",value:()=>[Da()().subtract(1,"day").startOf("day"),Da()().subtract(1,"day").endOf("day")]},this_week:{name:"This week",value:()=>[Da()().startOf("week"),Da()().endOf("week")]},this_month:{name:"This month",value:()=>[Da()().startOf("month"),Da()().endOf("month")]},this_year:{name:"This year",value:()=>[Da()().startOf("year"),Da()().endOf("year")]},last_week:{name:"Last week",value:()=>[Da()().subtract(1,"week").startOf("week"),Da()().subtract(1,"week").endOf("week")]},last_month:{name:"Last month",value:()=>[Da()().subtract(1,"month").startOf("month"),Da()().subtract(1,"month").endOf("month")]},last_year:{name:"Last year",value:()=>[Da()().subtract(1,"year").startOf("year"),Da()().subtract(1,"year").endOf("year")]},last_hour:{name:"Last hour",value:kr(()=>Da()().subtract(1,"hour"))},last_8_hours:{name:"Last 8 hours",value:kr(()=>Da()().subtract(8,"hour"))},last_24_hours:{name:"Last 24 hours",value:kr(()=>Da()().subtract(24,"hour"))},last_7_days:{name:"Last 7 days",value:kr(()=>Da()().subtract(7,"days").startOf("day"),()=>Da()().endOf("day"))},last_14_days:{name:"Last 14 days",value:kr(()=>Da()().subtract(14,"days").startOf("day"),()=>Da()().endOf("day"))},last_30_days:{name:"Last 30 days",value:kr(()=>Da()().subtract(30,"days").startOf("day"),()=>Da()().endOf("day"))},last_60_days:{name:"Last 60 days",value:kr(()=>Da()().subtract(60,"days").startOf("day"),()=>Da()().endOf("day"))},last_90_days:{name:"Last 90 days",value:kr(()=>Da()().subtract(90,"days").startOf("day"),()=>Da()().endOf("day"))},last_12_months:{name:"Last 12 months",value:kr(()=>Da()().subtract(12,"months").startOf("day"),()=>Da()().endOf("day"))}},Ar=ae.a.oneOf(Object(l.values)(Nr));function Tr(e){return!!Object(l.startsWith)(e,"d_")&&!!Nr[e.substring("d_".length)]}function Wr(e){return Object(l.includes)(Nr,e)}function Ir(e){return Tr(e)?Nr[e.substring("d_".length)]:null}var qr=class extends Ra{constructor(e,t){super(e,t),this.setValue(e.value)}get hasDynamicValue(){return Wr(this.normalizedValue)}normalizeValue(e){return Tr(e)?Ir(e):Wr(e)?e:(Object(l.isObject)(e)&&!Object(l.isArray)(e)&&(e=[e.start,e.end]),Object(l.isArray)(e)&&2===e.length&&(e=[Da()(e[0]),Da()(e[1])])[0].isValid()&&e[1].isValid()?e:null)}setValue(e){var t=this.normalizeValue(e);return Wr(t)?this.value="d_"+Object(l.findKey)(Nr,t):Object(l.isArray)(t)?this.value={start:t[0].format(Lr[this.type]),end:t[1].format(Lr[this.type])}:this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){if(this.hasDynamicValue){var e=Pr(this.normalizedValue.value().map(e=>e.format(Lr[this.type])),2);return{start:e[0],end:e[1]}}return this.value}toUrlParams(){var e=this.urlPrefix;return Object(l.isObject)(this.value)&&this.value.start&&this.value.end?{["".concat(e).concat(this.name)]:"".concat(this.value.start,"--").concat(this.value.end)}:super.toUrlParams()}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name),r="".concat(t).concat(this.name,".start"),n="".concat(t).concat(this.name,".end");if(Object(l.has)(e,a)){var o=e[a].split("--");2===o.length?this.setValue(o):this.setValue(e[a])}else Object(l.has)(e,r)&&Object(l.has)(e,n)&&this.setValue([e[r],e[n]])}toQueryTextFragment(){return"{{ ".concat(this.name,".start }} {{ ").concat(this.name,".end }}")}};function Dr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Rr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Dr(Object(a),!0).forEach((function(t){Mr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Dr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Mr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function zr(e,t){switch(e.type){case"number":return new za(e,t);case"enum":return new Fa(e,t);case"query":return new vr(e,t);case"date":case"datetime-local":case"datetime-with-seconds":return new Cr(e,t);case"date-range":case"datetime-range":case"datetime-range-with-seconds":return new qr(e,t);default:return new Ma(Rr(Rr({},e),{},{type:"text"}),t)}}function Fr(e){return zr(e,e.parentQueryId)}var Vr=a(17),Ur=a.n(Vr),Br=new Map;function Hr(){Br.size>0&&(Br.forEach((e,t)=>{var a=t.getBoundingClientRect(),r=Math.round(10*a.width),n=Math.round(10*a.height);e.width===r&&e.height===n||(e.width=r,e.height=n,e.callback(t))}),setTimeout(Hr,100))}function Yr(e,t){if(e&&!Br.has(e)){var a=0===Br.size;return Br.set(e,{callback:t}),a&&Hr(),()=>Br.delete(e)}return()=>{}}var Qr=ae.a.object,Kr=ae.a.shape({columns:ae.a.arrayOf(ae.a.object).isRequired,rows:ae.a.arrayOf(ae.a.object).isRequired}),$r=ae.a.shape({id:ae.a.number,type:ae.a.string.isRequired,name:ae.a.string.isRequired,options:Qr.isRequired}),Gr={visualizationName:ae.a.string,data:Kr.isRequired,options:Qr.isRequired,onOptionsChange:ae.a.func},Jr={visualizationName:ae.a.string,data:Kr.isRequired,options:Qr.isRequired,onOptionsChange:ae.a.func.isRequired};a(212);function Xr(e){return[0,e.length-1]}function Zr(e){return[d3.quantile(e,.25),d3.quantile(e,.5),d3.quantile(e,.75)]}var en=function(){var e=1,t=1,a=0,r=null,n=Number,o=Xr,i=Zr,l=null;function s(s){s.each((function(s,c){s=s.map(n).sort(d3.ascending);var u=d3.select(this),d=s.length,m=s[0],p=s[d-1],f=s.quartiles=i(s),b=o&&o.call(this,s,c),h=b&&b.map(e=>s[e]),g=b?d3.range(0,b[0]).concat(d3.range(b[1]+1,d)):d3.range(d),y=d3.scale.linear().domain(r&&r.call(this,s,c)||[m,p]).range([t,0]),v=this.__chart__||d3.scale.linear().domain([0,1/0]).range(y.range());this.__chart__=y;var w=u.selectAll("line.center").data(h?[h]:[]);w.enter().insert("line","rect").attr("class","center").attr("x1",e/2).attr("y1",e=>v(e[0])).attr("x2",e/2).attr("y2",e=>v(e[1])).style("opacity",1e-6).transition().duration(a).style("opacity",1).attr("y1",e=>y(e[0])).attr("y2",e=>y(e[1])),w.transition().duration(a).style("opacity",1).attr("y1",e=>y(e[0])).attr("y2",e=>y(e[1])),w.exit().transition().duration(a).style("opacity",1e-6).attr("y1",e=>y(e[0])).attr("y2",e=>y(e[1])).remove();var O=u.selectAll("rect.box").data([f]);O.enter().append("rect").attr("class","box").attr("x",0).attr("y",e=>v(e[2])).attr("width",e).attr("height",e=>v(e[0])-v(e[2])).transition().duration(a).attr("y",e=>y(e[2])).attr("height",e=>y(e[0])-y(e[2])),O.transition().duration(a).attr("y",e=>y(e[2])).attr("height",e=>y(e[0])-y(e[2])),O.exit().remove();var E=u.selectAll("line.median").data([f[1]]);E.enter().append("line").attr("class","median").attr("x1",0).attr("y1",v).attr("x2",e).attr("y2",v).transition().duration(a).attr("y1",y).attr("y2",y),E.transition().duration(a).attr("y1",y).attr("y2",y),E.exit().remove();var _=u.selectAll("line.whisker").data(h||[]);_.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",v).attr("x2",e).attr("y2",v).style("opacity",1e-6).transition().duration(a).attr("y1",y).attr("y2",y).style("opacity",1),_.transition().duration(a).attr("y1",y).attr("y2",y).style("opacity",1),_.exit().transition().duration(a).attr("y1",y).attr("y2",y).style("opacity",1e-6).remove();var j=u.selectAll("circle.outlier").data(g,Number);j.enter().insert("circle","text").attr("class","outlier").attr("r",5).attr("cx",e/2).attr("cy",e=>v(s[e])).style("opacity",1e-6).transition().duration(a).attr("cy",e=>y(s[e])).style("opacity",1),j.transition().duration(a).attr("cy",e=>y(s[e])).style("opacity",1),j.exit().transition().duration(a).attr("cy",e=>y(s[e])).style("opacity",1e-6).remove();var S=l||y.tickFormat(8),C=u.selectAll("text.box").data(f);C.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",(e,t)=>1&t?6:-6).attr("x",(t,a)=>1&a?e:0).attr("y",v).attr("text-anchor",(e,t)=>1&t?"start":"end").text(S).transition().duration(a).attr("y",y),C.transition().duration(a).text(S).attr("y",y),C.exit().remove();var P=u.selectAll("text.whisker").data(h||[]);P.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",e).attr("y",v).text(S).style("opacity",1e-6).transition().duration(a).attr("y",y).style("opacity",1),P.transition().duration(a).text(S).attr("y",y).style("opacity",1),P.exit().transition().duration(a).attr("y",y).style("opacity",1e-6).remove()})),d3.timer.flush()}return s.width=function(t){return arguments.length?(e=t,s):e},s.height=function(e){return arguments.length?(t=e,s):t},s.tickFormat=function(e){return arguments.length?(l=e,s):l},s.duration=function(e){return arguments.length?(a=e,s):a},s.domain=function(e){return arguments.length?(r=null==e?e:d3.functor(e),s):r},s.value=function(e){return arguments.length?(n=e,s):n},s.whiskers=function(e){return arguments.length?(o=e,s):o},s.quartiles=function(e){return arguments.length?(i=e,s):i},s};a(855);function tn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return an(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return an(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function an(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function rn(e,t,a){var r,n=a.xAxisLabel,o=a.yAxisLabel,i=(e=Ur.a.select(e)).node().getBoundingClientRect(),s=Math.floor(i.width),c=Math.floor(i.height),u={top:10,right:50,bottom:40,left:50,inner:25},d=s-u.right-u.left,m=c-u.top-u.bottom,p=1/0,f=-1/0,b=[],h=0,g=[],y=Object(l.map)(t.columns,e=>e.name),v=Ur.a.scale.ordinal().domain(y).rangeBands([0,s-u.left-u.right]);r=y.length>1?Math.min(v(y[1]),120):120,u.inner=r/3,Object(l.each)(y,(e,a)=>{g=b[a]=[],Object(l.each)(t.rows,t=>{h=t[e],g.push(h),h>f&&(f=Math.ceil(h)),h<p&&(p=Math.floor(h))})});var w,O=Ur.a.scale.linear().domain([.99*p,1.01*f]).range([m,0]),E=en().whiskers((w=1.5,e=>{var t=e.quartiles[0],a=e.quartiles[2],r=(a-t)*w,n=-1,o=e.length;for(n+=1;e[n]<t-r;)n+=1;for(o-=1;e[o]>a+r;)o-=1;return[n,o]})).width(r-2*u.inner).height(m).domain([.99*p,1.01*f]),_=Ur.a.svg.axis().scale(v).orient("bottom"),j=Ur.a.svg.axis().scale(O).orient("left"),S=Ur.a.svg.axis().scale(v).tickSize(m).orient("bottom"),C=Ur.a.svg.axis().scale(O).tickSize(d).orient("right");e.selectAll("*").remove();var P=e.append("svg").attr("width",s).attr("height",m+u.bottom+u.top),x=P.append("g").attr("width",s-u.left-u.right).attr("transform","translate(".concat(u.left,",").concat(u.top,")"));P.append("text").attr("class","box").attr("x",s/2).attr("text-anchor","middle").attr("y",m+u.bottom).text(n),P.append("text").attr("class","box").attr("transform","translate(10,".concat((m+u.top+u.bottom)/2,")rotate(-90)")).attr("text-anchor","middle").text(o),x.append("rect").attr("class","grid-background").attr("width",d).attr("height",m),x.append("g").attr("class","grid").call(C),x.append("g").attr("class","grid").call(S),x.append("g").attr("class","x axis").attr("transform","translate(0,".concat(m,")")).call(_),x.append("g").attr("class","y axis").call(j),x.selectAll(".box").data(b).enter().append("g").attr("class","box").attr("width",r).attr("height",m).attr("transform",(e,t)=>"translate(".concat(function(e){return v(y[e])+(v(y[1])-u.inner)/2}(t),",",0,")")).call(E)}function nn(e){var t=e.data,a=e.options,o=tn(Object(r.useState)(null),2),i=o[0],l=o[1];return Object(r.useEffect)(()=>{if(i)return rn(i,t,a),Yr(i,()=>{rn(i,t,a)})},[i,t,a]),n.a.createElement("div",{className:"box-plot-deprecated-visualization-container",ref:l})}nn.propTypes=Gr;var on=a(23),ln=a.n(on),sn=a(116),cn=a.n(sn),un=a(50),dn=a.n(un),mn=a(142),pn=a.n(mn),fn=a(103),bn=a.n(fn),hn=a(96),gn=a.n(hn);function yn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["#ffffff","#333333"];try{return e=gn()(e),Object(l.maxBy)(t,t=>gn.a.contrast(e,t))}catch(e){return null}}var vn=a(155),wn=a.n(vn),On=a(80),En=a.n(On),_n=a(76),jn=a.n(_n);a(856);function Sn(){return(Sn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Cn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Pn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Cn(Object(a),!0).forEach((function(t){xn(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Cn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function xn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ln(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function kn(e){var t=e.className,a=e.color,r=e.title,o=e.size,i=e.style,s=Ln(e,["className","color","title","size","style"]),c=n.a.createElement("span",Sn({className:me()("color-swatch",t),style:Pn({backgroundColor:a,width:o},i)},s));return Object(l.isString)(r)&&""!==r?n.a.createElement(ge.a,{title:r,mouseEnterDelay:0,mouseLeaveDelay:0},c):c}kn.defaultProps={className:null,style:null,title:null,color:"transparent",size:12};a(857);function Nn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return An(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return An(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function An(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Tn(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#";Object(l.isNil)(e)&&t(null),(e=En()(e)).isValid()&&t(a+e.toHex().toUpperCase())}function Wn(e){var t=e.color,a=e.presetColors,o=e.presetColumns,i=e.onChange,s=e.onPressEnter,c=Nn(Object(r.useState)(""),2),u=c[0],d=c[1],m=Nn(Object(r.useState)(!1),2),p=m[0],f=m[1],b=function(e,t){return e=Object(l.isArray)(e)?Object(l.map)(e,e=>[null,e]):Object(l.toPairs)(e),e=Object(l.map)(e,e=>{var t=Nn(e,2),a=t[0],r=t[1];return Object(l.isNil)(r)?[a,null]:(r=En()(r)).isValid()?[a,"#"+r.toHex().toUpperCase()]:null}),Object(l.chunk)(Object(l.filter)(e),t)}(a,o);return Object(r.useEffect)(()=>{p||Tn(t,d,"")},[t,p]),n.a.createElement(n.a.Fragment,null,Object(l.map)(b,(e,t)=>n.a.createElement("div",{className:"color-picker-input-swatches",key:"preset-row-".concat(t)},Object(l.map)(e,e=>{var t=Nn(e,2),a=t[0],r=t[1];return n.a.createElement(kn,{key:r,color:r,title:a,size:30,onClick:()=>Tn(r,i)})}))),n.a.createElement("div",{className:"color-picker-input"},n.a.createElement(ba.a,{"data-test":"ColorPicker.CustomColor",addonBefore:n.a.createElement(jn.a.Text,{type:"secondary"},"#"),value:u,onChange:e=>{return t=e.target.value,d(t),void Tn(t,i);var t},onFocus:()=>f(!0),onBlur:()=>f(!1),onPressEnter:s})))}function In(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(e=En()(e)).isValid()?"#"+e.toHex().toUpperCase():t}Wn.defaultProps={color:"#FFFFFF",presetColors:null,presetColumns:8,onChange:()=>{},onPressEnter:()=>{}};a(886);function qn(){return(qn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Dn(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Rn(e){var t=e.className,a=e.color,o=e.presetColors,i=Dn(e,["className","color","presetColors"]),s=Object(r.useMemo)(()=>function(e,t){return Object(l.isArray)(t)?e:Object(l.findKey)(t,t=>In(t)===e)||e}(In(a),o),[a,o]);return n.a.createElement("span",qn({className:me()("color-label",t)},i),s)}Rn.defaultProps={className:null,color:"#FFFFFF",presetColors:null};a(887);function Mn(){return(Mn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function zn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fn(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Fn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fn(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Vn(e){var t=e.color,a=e.placement,o=e.presetColors,i=e.presetColumns,s=e.interactive,c=e.children,u=e.onChange,d=e.triggerProps,m=e.addonBefore,p=e.addonAfter,f=zn(Object(r.useState)(!1),2),b=f[0],h=f[1],g=Object(r.useMemo)(()=>In(t),[t]),y=zn(Object(r.useState)(""),2),v=y[0],w=y[1];function O(){h(!1),s||u(v)}var E=[];return s||(E.push(n.a.createElement(ge.a,{key:"cancel",title:window.W_L.cancel},n.a.createElement(je.a,{onClick:function(){h(!1)}}))),E.push(n.a.createElement(ge.a,{key:"apply",title:window.W_L.apply},n.a.createElement(wn.a,{onClick:O})))),Object(r.useEffect)(()=>{b&&w(g)},[g,b]),n.a.createElement("span",{className:"color-picker-wrapper"},m,n.a.createElement(pn.a,{arrowPointAtCenter:!0,overlayClassName:"color-picker ".concat(s?"color-picker-interactive":"color-picker-with-actions"),overlayStyle:{"--color-picker-selected-color":v},content:n.a.createElement(bn.a,{"data-test":"ColorPicker",className:"color-picker-panel",bordered:!1,title:Object(l.toString)(v).toUpperCase(),headStyle:{backgroundColor:v,color:yn(v)},actions:E},n.a.createElement(Wn,{color:v,presetColors:o,presetColumns:i,onChange:function(e){w(e),s&&u(e)},onPressEnter:O})),trigger:"click",placement:a,visible:b,onVisibleChange:h},c||n.a.createElement(kn,Mn({color:g,size:30},d,{className:me()("color-picker-trigger",d.className)}))),p)}Vn.defaultProps={color:"#FFFFFF",placement:"top",presetColors:null,presetColumns:8,interactive:!1,triggerProps:{},children:null,addonBefore:null,addonAfter:null,onChange:()=>{}},Vn.Input=Wn,Vn.Swatch=kn,Vn.Label=Rn;var Un=a(47),Bn=a.n(Un),Hn=a(660),Yn=a.n(Hn),Qn=a(661),Kn=a.n(Qn),$n=a(662),Gn=a.n($n);a(895);function Jn(){return(Jn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Xn(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Zn(e){var t=e.className,a=Xn(e,["className"]);return n.a.createElement("div",Object(l.pickBy)(a,(e,t)=>Object(l.startsWith)(t,"data-")),n.a.createElement(Bn.a.Group,Jn({className:me()("text-alignment-select",t)},a),n.a.createElement(ge.a,{title:window.W_L.left_align,mouseEnterDelay:0,mouseLeaveDelay:0},n.a.createElement(Bn.a.Button,{value:"left","data-test":"TextAlignmentSelect.Left"},n.a.createElement(Yn.a,null))),n.a.createElement(ge.a,{title:window.W_L.center,mouseEnterDelay:0,mouseLeaveDelay:0},n.a.createElement(Bn.a.Button,{value:"center","data-test":"TextAlignmentSelect.Center"},n.a.createElement(Kn.a,null))),n.a.createElement(ge.a,{title:window.W_L.right_align,mouseEnterDelay:0,mouseLeaveDelay:0},n.a.createElement(Bn.a.Button,{value:"right","data-test":"TextAlignmentSelect.Right"},n.a.createElement(Gn.a,null)))))}Zn.defaultProps={className:null};var eo=a(313),to=a.n(eo),ao=a(36);a(905);function ro(){return(ro=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function no(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function oo(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?no(Object(a),!0).forEach((function(t){io(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):no(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function io(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function lo(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function so(e){var t=e.layout,a=e.label,r=e.labelProps,o=e.disabled,i=e.children;return"vertical"===t&&a?n.a.createElement("div",{className:"visualization-editor-control-label visualization-editor-control-label-vertical"},n.a.createElement("label",r,n.a.createElement(jn.a.Text,{disabled:o},a)),i):"horizontal"===t&&a?n.a.createElement(ao.Row,{className:"visualization-editor-control-label visualization-editor-control-label-horizontal",type:"flex",align:"middle",gutter:15},n.a.createElement(ao.Col,{span:12},n.a.createElement("label",r,n.a.createElement(jn.a.Text,{disabled:o},a))),n.a.createElement(ao.Col,{span:12},i)):i}function co(e){function t(t){var a=t.className,o=t.id,i=t.layout,l=t.label,s=t.labelProps,c=t.disabled,u=lo(t,["className","id","layout","label","labelProps","disabled"]),d=Object(r.useMemo)(()=>"visualization-editor-control-".concat(Math.random().toString(36).substr(2,10)),[]);return s=oo(oo({},s),{},{htmlFor:o||d}),n.a.createElement(so,{layout:i,label:l,labelProps:s,disabled:c},n.a.createElement(e,ro({className:me()("visualization-editor-input",a),id:s.htmlFor,disabled:c},u)))}return to()(t,e),t}so.defaultProps={layout:"vertical",label:null,disabled:!1,children:null};var uo=a(104),mo=a.n(uo);function po(){return(po=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function fo(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var bo={replace:(e,t)=>Object(l.merge)({},t),shallowMerge:(e,t)=>Object(l.extend)({},e,t),deepMerge:(e,t)=>Object(l.merge)({},e,t)};function ho(e){var t=e.tabs,a=e.options,r=e.data,o=e.onOptionsChange,i=fo(e,["tabs","options","data","onOptionsChange"]),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bo.deepMerge;o(t(a,e))};return t=Object(l.filter)(t,e=>!Object(l.isFunction)(e.isAvailable)||e.isAvailable(a,r)),n.a.createElement(mo.a,{animated:!1,tabBarGutter:20},Object(l.map)(t,e=>{var t=e.key,o=e.title,c=e.component;return n.a.createElement(mo.a.TabPane,{key:t,tab:n.a.createElement("span",{"data-test":"VisualizationEditor.Tabs.".concat(t)},Object(l.isFunction)(o)?o(a):o)},n.a.createElement(c,po({options:a,data:r,onOptionsChange:s},i)))}))}function go(e){return function(t){return n.a.createElement(ho,po({},t,{tabs:e}))}}ho.defaultProps={tabs:[]};a(906);function yo(){return(yo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function vo(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function wo(e){var t=e.className,a=e.children,r=vo(e,["className","children"]);return a?n.a.createElement("h4",yo({className:me()("visualization-editor-section-title",t)},r),a):null}function Oo(e){var t=e.className,a=e.children,r=vo(e,["className","children"]);return n.a.createElement("div",yo({className:me()("visualization-editor-section",t)},r),a)}wo.defaultProps={className:null,children:null},Oo.defaultProps={className:null,children:null},Oo.Title=wo;var Eo=a(115),_o=a.n(Eo);a(907);function jo(){return(jo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function So(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Co(e){var t=e.id,a=e.children,o=e.disabled,i=So(e,["id","children","disabled"]),l=Object(r.useMemo)(()=>"visualization-editor-control-".concat(Math.random().toString(36).substr(2,10)),[]);return t=t||l,a?n.a.createElement("label",{htmlFor:t,className:"switch-with-label"},n.a.createElement(_o.a,jo({id:t,disabled:o},i)),n.a.createElement(jn.a.Text,{className:"switch-text",disabled:o},a)):n.a.createElement(_o.a,i)}Co.defaultProps={id:null,disabled:!1,children:null};a(909);function Po(){return(Po=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xo(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Lo=co((function(e){var t=e.className,a=xo(e,["className"]);return n.a.createElement(ba.a.TextArea,Po({className:me()("visualization-editor-text-area",t)},a))})),ko=a(314),No=a.n(ko);function Ao(e){var t=e.title,a=e.href,r=e.className,o=e.children;return n.a.createElement(ge.a,{title:n.a.createElement(n.a.Fragment,null,t,n.a.createElement("i",{className:"fa fa-external-link",style:{marginLeft:5}}))},n.a.createElement("a",{className:r,href:a,target:"_blank",rel:"noopener noreferrer"},o))}Ao.defaultValues={title:null,className:null,children:null};var To={HelpTriggerComponent:Ao,LinkComponent:function(e){return n.a.createElement("a",e)},dateFormat:"DD/MM/YYYY",dateTimeFormat:"DD/MM/YYYY HH:mm",integerFormat:"0,0",floatFormat:"0,0.00",booleanValues:["false","true"],tableCellMaxJSONSize:5e4,allowCustomJSVisualizations:!1,hidePlotlyModeBar:!1,choroplethAvailableMaps:{}};a(910);function Wo(){return(Wo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Io(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function qo(e){var t=e.icon,a=e.children,r=Io(e,["icon","children"]);return n.a.createElement(pn.a,Wo({},r,{content:a}),t||qo.defaultIcon)}qo.defaultProps={icon:null,children:null},qo.defaultIcon=n.a.createElement(No.a,{className:"context-help-default-icon"}),qo.NumberFormatSpecs=function(){var e=To.HelpTriggerComponent;return n.a.createElement(e,{type:"NUMBER_FORMAT_SPECS",title:window.W_L.formatting_numbers,href:"https://redash.io/help/user-guide/visualizations/formatting-numbers",className:"visualization-editor-context-help"},qo.defaultIcon)},qo.DateTimeFormatSpecs=function(){var e=To.HelpTriggerComponent;return n.a.createElement(e,{title:window.W_L.formatting_dates_and_times,href:"https://momentjs.com/docs/#/displaying/format/",className:"visualization-editor-context-help"},qo.defaultIcon)};var Do=co(ln.a),Ro=co(ba.a),Mo=co(cn.a),zo=co(Vn),Fo=co(Zn);function Vo(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Uo(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Vo(Object(a),!0).forEach((function(t){Bo(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Vo(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Bo(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ho(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Ro,{label:window.W_L.x_axis_label,"data-test":"BoxPlot.XAxisLabel",value:t.xAxisLabel,onChange:e=>{return r=e.target.value,n=Uo(Uo({},t),{},{xAxisLabel:r}),void a(n);var r,n}})),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:window.W_L.y_axis_label,"data-test":"BoxPlot.YAxisLabel",value:t.yAxisLabel,onChange:e=>{return r=e.target.value,n=Uo(Uo({},t),{},{yAxisLabel:r}),void a(n);var r,n}})))}function Yo(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Qo(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Ho.propTypes=Jr;var Ko={type:"BOXPLOT",name:"箱线图(Boxplot)",isDeprecated:!0,getOptions:e=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Yo(Object(a),!0).forEach((function(t){Qo(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yo(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e),Renderer:nn,Editor:Ho,defaultRows:8,minRows:5},$o={globalSeriesType:"column",sortX:!0,legend:{enabled:!0,placement:"auto",traceorder:"normal"},xAxis:{type:"-",labels:{enabled:!0}},yAxis:[{type:"linear"},{type:"linear",opposite:!0}],alignYAxesAtZero:!1,error_y:{type:"data",visible:!0},series:{stacking:null,error_y:{type:"data",visible:!0}},seriesOptions:{},valuesOptions:{},columnMapping:{},direction:{type:"counterclockwise"},sizemode:"diameter",coefficient:1,numberFormat:"0,0[.]00000",percentFormat:"0[.]00%",textFormat:"",missingValuesAsZero:!0};var Go=a(117),Jo=a.n(Go);function Xo(e,t,a){void 0===t[a]&&(t[a]={name:a,type:"column",data:[]}),t[a].data.push(e)}function Zo(e,t){var a={},r=t.columnMapping;return Object(l.each)(e,e=>{var t={$raw:e},n=null,o=0,i={},s=null,c=null,u=null;Object(l.forOwn)(e,(e,a)=>{var l=(a=""+a).split("::")||a.split("__"),d=l[0],m=r?r[a]:l[1];"unused"!==m&&("x"===m&&(o=e,t[m]=e),"y"===m&&(i[d]=e,t[m]=e),"yError"===m&&(s=e,t[m]=e),"series"===m&&(n=String(e)),"size"===m&&(t[m]=e,c=e),"zVal"===m&&(t[m]=e,u=e),"multiFilter"!==m&&"multi-filter"!==m||(n=String(e)))}),Object(l.isNil)(n)?Object(l.each)(i,(e,r)=>{t={x:o,y:e,$raw:t.$raw},null!==s&&(t.yError=s),null!==c&&(t.size=c),null!==u&&(t.zVal=u),Xo(t,a,r)}):Xo(t,a,n)}),Object(l.sortBy)(Object(l.values)(a),e=>{var a=e.name;return Object(l.isObject)(t.seriesOptions[a])&&t.seriesOptions[a].zIndex||0})}var ei=a(315),ti=a.n(ei),ai=a(663),ri=a.n(ai),ni=a(664),oi=a.n(ni),ii=a(665),li=a.n(ii),si=a(666),ci=a.n(si),ui=a(667),di=a.n(ui);function mi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function pi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?mi(Object(a),!0).forEach((function(t){fi(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function fi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var bi={Blue:"#356AFF",Red:"#E92828",Green:"#3BD973",Purple:"#604FE9",Cyan:"#50F5ED",Orange:"#FB8D3D","Light Blue":"#799CFF",Lilac:"#B554FF","Light Green":"#8CFFB4",Brown:"#A55F2A",Black:"#000000",Gray:"#494949",Pink:"#FF7DE3","Dark Blue":"#002FB4"},hi=Object(l.values)(bi),gi=pi(pi({},bi),{"Indian Red":"#981717","Green 2":"#17BF51","Green 3":"#049235","Dark Turquoise":"#00B6EB","Dark Violet":"#A58AFF","Pink 2":"#C63FA9"}),yi=a(416),vi=a.n(yi);function wi(e){return Object(l.isUndefined)(e)?e:vi()(e)}function Oi(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"YYYY-MM-DD HH:mm:ss";return"datetime"===t&&Da.a.utc(e).isValid()&&(e=Da.a.utc(e)),Da.a.isMoment(e)?e.format(a):e}function Ei(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function _i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ei(Object(a),!0).forEach((function(t){ji(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ei(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ji(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Si(e){var t=e.length>2?2:1,a=Math.ceil(e.length/t);return{rows:t,cellsInRow:a,cellWidth:1/a,cellHeight:1/t,xPadding:.02,yPadding:.1}}function Ci(e){var t="text";return/{{\s*@@x\s*}}/.test(e.textFormat)||(t+="+label"),t}function Pi(e,t){var a=Ur.a.scale.ordinal().domain([]).range(hi),r={};Object(l.each)(t.valuesOptions,(e,t)=>{Object(l.isString)(e.color)&&""!==e.color&&(r[t]=e.color)});var n=_i(_i({},Si(e)),{},{hasX:Object(l.includes)(t.columnMapping,"x"),hoverInfoPattern:Ci(t),getValueColor:e=>r[e]||a(e)});return Object(l.map)(e,(e,a)=>function(e,t,a){var r=a.cellWidth,n=a.cellHeight,o=a.xPadding,i=a.yPadding,s=a.cellsInRow,c=a.hasX,u=a.index,d=a.hoverInfoPattern,m=a.getValueColor,p=Object(l.extend)({type:t.globalSeriesType,yAxis:0},t.seriesOptions[e.name]),f=u%s*r,b=Math.floor(u/s)*n,h=[],g=[],y=new Map,v=Object(l.reduce)(e.data,(e,t)=>{var a=wi(t.y);return e+Math.abs(a)},0);Object(l.each)(e.data,e=>{var a=c?Oi(e.x,t.xAxis.type):"Slice ".concat(u),r=wi(e.y);h.push(a),g.push(r),y.set(a,{x:a,y:r,yPercent:r/v*100,row:e})});var w=Object(l.map)(e.data,e=>m(e.x)),O=Object(l.map)(w,e=>yn(e));return{visible:!0,values:g,labels:h,type:"pie",hole:.4,marker:{colors:w},hoverinfo:d,text:[],textinfo:t.showDataLabels?"percent":"none",textposition:"inside",textfont:{color:O},name:p.name||e.name,direction:t.direction.type,domain:{x:[f,f+r-o],y:[b,b+n-i]},sourceData:y}}(e,t,_i(_i({},n),{},{index:a})))}var xi=a(668),Li=a.n(xi),ki=a(160),Ni=a.n(ki);Ni.a.options.scalePercentBy100=!1;var Ai=/(^|[\s\n]|<br\/?>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi,Ti=Object.prototype.hasOwnProperty;function Wi(e){return Object(l.isString)(e)&&""!==e?t=>{var a=function(e){return Da.a.isMoment(e)?e:Object(l.isFinite)(e)?Da()(e):Da()(Object(l.toString)(e),[Da.a.ISO_8601,Da.a.RFC_2822])}(t);return a.isValid()?a.format(e):Object(l.toString)(t)}:e=>Object(l.toString)(e)}function Ii(e){if(Object(l.isString)(e)&&""!==e){var t=Ni()(0);return a=>null===a||""===a?"":t.set(a).format(e)}return e=>Object(l.toString)(e)}function qi(e,t){return Object(l.isString)(e)?e.replace(/{{\s*([^\s]+?)\s*}}/g,(e,a)=>Ti.call(t,a)&&!Object(l.isUndefined)(t[a])?t[a]:e):""}var Di=[[0,"#356aff"],[.14,"#4a7aff"],[.28,"#5d87ff"],[.42,"#7398ff"],[.56,"#fb8c8c"],[.71,"#ec6463"],[.86,"#ec4949"],[1,"#e92827"]];function Ri(e,t){var a={colorScheme:t.colorScheme?"Custom..."===t.colorScheme?[[0,t.heatMinColor],[1,t.heatMaxColor]]:t.colorScheme:Di,formatNumber:Ii(t.numberFormat)};return Object(l.flatten)(Object(l.map)(e,e=>function(e,t,a){var r=a.colorScheme,n=a.formatNumber,o={x:[],y:[],z:[],type:"heatmap",name:"",colorscale:r};o.x=Object(l.uniq)(Object(l.map)(e.data,e=>e.x)),o.y=Object(l.uniq)(Object(l.map)(e.data,e=>e.y)),t.sortX&&(o.x=Object(l.sortBy)(o.x)),t.sortY&&(o.y=Object(l.sortBy)(o.y)),t.reverseX&&o.x.reverse(),t.reverseY&&o.y.reverse();for(var i=Object(l.max)(Object(l.map)(e.data,e=>e.zVal)),s={x:[],y:[],mode:"text",hoverinfo:"skip",showlegend:!1,text:[],textfont:{color:[]}},c=0;c<o.y.length;c+=1){for(var u=[],d=0;d<o.x.length;d+=1){var m=Object(l.find)(e.data,{x:o.x[d],y:o.y[c]}),p=m&&m.zVal||0;u.push(p),isFinite(i)&&t.showDataLabels&&(s.x.push(o.x[d]),s.y.push(o.y[c]),s.text.push(n(p)),t.colorScheme&&"Custom..."===t.colorScheme?s.textfont.color.push("white"):s.textfont.color.push(p/i<.25?"white":"black"))}o.z.push(u)}return isFinite(i)&&t.showDataLabels?[o,s]:[o]}(e,t,a)))}function Mi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function zi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Mi(Object(a),!0).forEach((function(t){Fi(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Mi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Fi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Vi(e){var t="text";return/{{\s*@@x\s*}}/.test(e.textFormat)||(t+="+x"),/{{\s*@@name\s*}}/.test(e.textFormat)||(t+="+name"),t}function Ui(e,t,a){var r=a,n=r.hoverInfoPattern,o=r.index,i=Object(l.extend)({type:t.globalSeriesType,yAxis:0},t.seriesOptions[e.name]),s=function(e,t){return e.color||hi[t%hi.length]}(i,o),c=function(e,t){var a=t.seriesOptions[e.name]||{type:t.globalSeriesType};return 1!==a.yAxis||t.series.stacking&&"line"!==a.type?"y":"y2"}(e,t),u=t.sortX?Object(l.sortBy)(e.data,e=>Oi(e.x,t.xAxis.type)):e.data,d=Object(l.includes)(["bubble","scatter"],i.type)?Oi:e=>(e=wi(e),t.missingValuesAsZero&&Object(l.isNil)(e)?0:e),m=new Map,p=[],f=[],b=[];Object(l.each)(u,e=>{var a=Oi(e.x,t.xAxis.type),r=d(e.y,"y2"===c?t.yAxis[1].type:t.yAxis[0].type),n=wi(e.yError),o=wi(e.size);m.set(a,{x:a,y:r,yError:n,size:o,yPercent:null,row:e}),p.push(a),f.push(r),b.push(n)});var h={visible:!0,hoverinfo:n,x:p,y:f,error_y:{array:b,color:s},name:i.name||e.name,marker:{color:s},insidetextfont:{color:yn(s)},yaxis:c,sourceData:m};switch(a=zi(zi({},a),{},{seriesColor:s,data:u}),i.type){case"column":return function(e,t,a){return e.type="bar",e.offsetgroup=Object(l.toString)(a.index),t.showDataLabels&&(e.textposition="inside"),e}(h,t,a);case"line":return function(e,t){return e.mode="lines"+(t.showDataLabels?"+text":""),e}(h,t);case"area":return function(e,t){return e.mode="lines"+(t.showDataLabels?"+text":""),e.fill=t.series.stacking?"tonexty":"tozeroy",e}(h,t);case"scatter":return function(e,t){return e.type="scatter",e.mode="markers"+(t.showDataLabels?"+text":""),e}(h,t);case"bubble":return function(e,t,a){var r=a.seriesColor,n=a.data,o=t.coefficient||1;return e.mode="markers",e.marker={color:r,size:Object(l.map)(n,e=>e.size*o),sizemode:t.sizemode||"diameter"},e}(h,t,a);case"box":return function(e,t,a){var r=a.seriesColor;return e.type="box",e.mode="markers",e.boxpoints="outliers",e.hoverinfo=!1,e.marker={color:r,size:3},t.showpoints&&(e.boxpoints="all",e.jitter=.3,e.pointpos=-1.8),e}(h,t,a);default:return h}}function Bi(e){return e.sortX&&"category"===e.xAxis.type&&"box"!==e.globalSeriesType}function Hi(e){var t=e["@@y"];return void 0!==e["@@yError"]&&(t="".concat(t," ± ").concat(e["@@yError"])),void 0!==e["@@yPercent"]&&(t="".concat(e["@@yPercent"]," (").concat(t,")")),void 0!==e["@@size"]&&(t="".concat(t,": ").concat(e["@@size"])),t}function Yi(e){return e["@@yPercent"]+" ("+e["@@y"]+")"}function Qi(e,t,a){var r=null;switch(t){case"x":r=a.xAxis.type;break;case"y":r=a.yAxis[0].type;break;case"y2":r=a.yAxis[1].type}return Oi(e,r,a.dateTimeFormat)}function Ki(e,t){var a=Ii(t.numberFormat),r=Ii(t.percentFormat),n=function(e){return""===e.textFormat?"pie"===e.globalSeriesType?Yi:Hi:t=>qi(e.textFormat,t)}(t),o=t.missingValuesAsZero?0:null;Object(l.each)(e,e=>{var i=t.seriesOptions[e.name]||{type:t.globalSeriesType};e.text=[],e.hover=[],("pie"===t.globalSeriesType?e.labels:e.x).forEach(s=>{var c={"@@name":e.name},u=e.sourceData.get(s)||{x:s,y:o,row:{x:s,y:o}},d=Object(l.includes)(["bubble","scatter"],i.type);c["@@x"]=Qi(u.row.x,"x",t),c["@@y"]=d?Qi(u.row.y,e.yaxis,t):a(u.y),void 0!==u.yError&&(c["@@yError"]=a(u.yError)),void 0!==u.size&&(c["@@size"]=a(u.size)),(t.series.percentValues||"pie"===t.globalSeriesType)&&(c["@@yPercent"]=r(Math.abs(u.yPercent))),Object(l.extend)(c,u.row.$raw),e.text.push(n(c))})})}function $i(e,t){if(t.series.percentValues){var a=new Map;Object(l.each)(e,e=>{e.sourceData.forEach(e=>{var t=a.get(e.x)||0;a.set(e.x,t+Math.abs(e.y||0))})}),Object(l.each)(e,e=>{var r=[];e.sourceData.forEach(e=>{if(Object(l.isNil)(e.y)&&!t.missingValuesAsZero)e.yPercent=null;else{var n=a.get(e.x);e.yPercent=e.y/n*100}r.push(e.yPercent)}),e.y=r})}}function Gi(e,t){var a=function(e,t){var a=new Set;Object(l.each)(e,e=>{e.sourceData.forEach(e=>{a.add(e.x)})});var r=[...a];return t?Object(l.sortBy)(r,l.identity):r}(e,t.sortX),r=t.missingValuesAsZero?0:null;Object(l.each)(e,e=>{e.x=[],e.y=[],e.error_y.array=[],Object(l.each)(a,a=>{e.x.push(a);var n=e.sourceData.get(a);n?(e.y.push(t.series.percentValues?n.yPercent:n.y),e.error_y.array.push(n.yError)):(e.y.push(r),e.error_y.array.push(null))})})}function Ji(e,t){var a=Object(l.filter)(e,e=>!0===e.visible);if(a.length>0)switch(t.globalSeriesType){case"pie":!function(e,t){Ki(e,t)}(a,t);break;case"line":case"area":!function(e,t){if($i(e,t),t.series.stacking){Gi(e,t);var a={};Object(l.each)(e,e=>{e.y=Object(l.map)(e.y,(r,n)=>{if(Object(l.isNil)(r)&&!t.missingValuesAsZero)return null;var o=e.x[n],i=r+(a[o]||0);return a[o]=i,i})})}else Bi(t)&&Gi(e,t);Ki(e,t)}(a,t);break;case"heatmap":break;default:!function(e,t){$i(e,t),t.series.stacking||Bi(t)&&Gi(e,t),Ki(e,t)}(a,t)}return e}function Xi(e,t){switch(t.globalSeriesType){case"pie":return Ji(Pi(e,t),t);case"heatmap":return Ji(Ri(e,t));default:return Ji(function(e,t){var a={hoverInfoPattern:Vi(t)};return Object(l.map)(e,(e,r)=>Ui(e,t,zi(zi({},a),{},{index:r})))}(e,t),t)}}function Zi(e){return Object(l.isObject)(e.title)?e.title.text:null}function el(e){switch(e.type){case"datetime":return"date";case"logarithmic":return"log";default:return e.type}}function tl(e){return{title:Zi(e),type:el(e),automargin:!0,autorange:!0,range:null}}function al(e,t,a){var r,n,o,i=a.filter(e=>"y2"===e.yaxis);return e.xaxis=(r=t.xAxis,n=t,o={title:Zi(r),type:el(r),automargin:!0},n.sortX&&"category"===o.type&&(n.reverseX?o.categoryorder="category descending":o.categoryorder="category ascending"),Object(l.isUndefined)(r.labels)||(o.showticklabels=r.labels.enabled),o),e.yaxis=tl(t.yAxis[0]),i.length>0&&(e.yaxis2=tl(t.yAxis[1]),e.yaxis2.overlaying="y",e.yaxis2.side="right"),t.series.stacking&&(e.barmode="relative"),e}function rl(e,t,a){var r={margin:{l:10,r:10,b:5,t:20,pad:4},width:Math.max(5,Math.floor(e.offsetWidth)),height:Math.max(5,Math.floor(e.offsetHeight)),autosize:!1,showlegend:t.legend.enabled,legend:{traceorder:t.legend.traceorder},hoverlabel:{namelength:-1}};switch(t.globalSeriesType){case"pie":return function(e,t,a){var r=/{{\s*@@name\s*}}/.test(t.textFormat),n=Si(a),o=n.cellsInRow,i=n.cellWidth,s=n.cellHeight,c=n.xPadding;return e.annotations=r?[]:Object(l.filter)(Object(l.map)(a,(e,t)=>{var a=t%o*i,r=Math.floor(t/o)*s;return{x:a+(i-c)/2,y:r+s-.015,xanchor:"center",yanchor:"top",text:e.name,showarrow:!1}})),e}(r,t,a);case"box":return function(e,t,a){return(e=al(e,t,a)).boxmode="group",e.boxgroupgap=.5,e}(r,t,a);default:return al(r,t,a)}}function nl(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ol(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?nl(Object(a),!0).forEach((function(t){il(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):nl(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function il(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ll(e,t,a){return[Object(l.isNumber)(t)?t:e[0],Object(l.isNumber)(a)?a:e[1]]}function sl(e,t,a){return a*t/(1-Math.abs(e)/t-a)}function cl(e,t,a,r){var n={};return Object(l.isObject)(a.yaxis)&&(n.yaxis=ol(ol({},a.yaxis),{},{autorange:!0,range:null})),Object(l.isObject)(a.yaxis2)&&(n.yaxis2=ol(ol({},a.yaxis2),{},{autorange:!0,range:null})),[n,()=>{if(Object(l.isObject)(a.yaxis)){var o=r.yAxis[0],i=e.layout.yaxis.range;n.yaxis.autorange=!1,n.yaxis.range=ll(i,o.rangeMin,o.rangeMax)}if(Object(l.isObject)(a.yaxis2)){var s=r.yAxis[1],c=e.layout.yaxis2.range;n.yaxis2.autorange=!1,n.yaxis2.range=ll(c,s.rangeMin,s.rangeMax)}if(r.swappedAxes){Object(l.each)(t,e=>{e.orientation="h";var t=e.x,a=e.y;e.x=a,e.y=t});var u=a.xaxis,d=n.yaxis,m=n.yaxis2;Object(l.isObject)(u)&&Object(l.isObject)(d)&&(n.xaxis=d,n.yaxis=u),Object(l.isObject)(m)&&(n.yaxis2=null)}return r.alignYAxesAtZero&&Object(l.isObject)(a.yaxis)&&Object(l.isObject)(a.yaxis2)&&function(e,t){e.range[1]=Math.max(0,e.range[1]),t.range[1]=Math.max(0,t.range[1]),e.range[0]=Math.min(0,e.range[0]),t.range[0]=Math.min(0,t.range[0]);var a=e.range[1]-e.range[0],r=e.range[1]/a,n=t.range[1]-t.range[0],o=t.range[1]/n,i=Math.abs(o-r)/2;i<.01||(r<o?(e.range[1]+=sl(e.range[1],a,i),t.range[0]-=sl(e.range[0],n,i)):(t.range[1]+=sl(t.range[1],n,i),e.range[0]-=sl(e.range[0],a,i)))}(n.yaxis,n.yaxis2),[n,null]}]}function ul(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return dl(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dl(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ml(e,t){var a=Object(l.find)(["transform","WebkitTransform","MozTransform","MsTransform","OTransform"],t=>t in e.style),r=t.height;return t.legend=Object(l.extend)({},t.legend,{orientation:"h",y:0,x:0,xanchor:"left",yanchor:"bottom"}),function(e){var t=e.querySelector(".legend");if(t)for(var a=t.parentNode;a;){if("svg"===a.tagName.toLowerCase()){a.style.overflow="visible";break}a=a.parentNode}}(e),[Object(l.pick)(t,["width","height","legend"]),()=>{var n=e.querySelector(".legend");if(n){var o=n.getBoundingClientRect();return t.height=Math.floor(Math.max(r/2,r-(o.bottom-o.top))),n.style[a]="translate(0, "+t.height+"px)",[Object(l.pick)(t,["height"]),null]}}]}function pl(e,t){return t.width<=600?ml(e,t):function(e,t){var a=Object(l.find)(["transform","WebkitTransform","MozTransform","MsTransform","OTransform"],t=>t in e.style);t.legend=Object(l.extend)({},t.legend,{orientation:"v",y:1,x:1,xanchor:"left",yanchor:"top"});var r=e.querySelector(".legend");return r&&(r.style[a]=null),[Object(l.pick)(t,["width","height","legend"]),null]}(e,t)}function fl(e,t,a){t.width=Math.max(5,Math.floor(e.offsetWidth)),t.height=Math.max(5,Math.floor(e.offsetHeight));var r=ul(e.__previousSize||[],2),n=r[0],o=r[1];if(t.width!==n||t.height!==o){if(e.__previousSize=[t.width,t.height],!a.legend.enabled)return[Object(l.pick)(t,["width","height"]),null];switch(a.legend.placement){case"auto":return pl(e,t);case"below":return ml(e,t)}}}function bl(e,t,a,r,n){var o,i=(o=n,e=>{Object(l.isString)(e)&&Object(l.startsWith)(e,"ax.dtick error")||o(e)}),s={showLink:!1,displaylogo:!1};r.hidePlotlyModeBar&&(s.displayModeBar=!1);var c=Xi(a,t),u=rl(e,t,c),d=!1,m=function(){var e=[],t={append:a=>(Object(l.isArray)(a)&&Object(l.isObject)(a[0])&&e.push(a),t),process(a){if(e.length>0){var r=Object(l.reduce)(e,(e,t)=>Object(l.merge)(e,t[0]),{}),n=Object(l.map)(e,e=>Object(l.isFunction)(e[1])?e[1]:()=>null);return e=[],ti.a.relayout(a,r).then(()=>(Object(l.each)(n,e=>t.append(e())),t.process(a)))}return Promise.resolve()}};return t}();function p(e){return function(){if(!d)try{return e(...arguments)}catch(e){i(e)}}}var f=()=>{},b={initialized:Promise.resolve().then(()=>ti.a.newPlot(e,c,u,s)).then(p(()=>m.append(cl(e,c,u,t)).append(fl(e,u,t)).process(e))).then(p(()=>{e.on("plotly_restyle",p(a=>{Object(l.isArray)(a)&&Object(l.isObject)(a[0])&&a[0].visible&&(Ji(c,t),m.append(cl(e,c,u,t)).process(e))})),t.onHover&&e.on("plotly_hover",t.onHover),t.onUnHover&&e.on("plotly_unhover",t.onUnHover),f=Yr(e,p(()=>{m.append(fl(e,u,t)).process(e)}))})).catch(i).then(()=>b),setZoomEnabled:p(t=>{var a={dragmode:!!t&&"zoom"};return ti.a.relayout(e,a)}),destroy:p(()=>{d=!0,e.removeAllListeners("plotly_restyle"),f(),delete e.__previousSize,ti.a.purge(e)})};return b}function hl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return gl(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return gl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gl(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function yl(e){var t=e.options,a=e.data,o=hl(Object(r.useState)(null),2),i=o[0],l=o[1],s=hl(Object(r.useState)(null),2),c=s[0],u=s[1],d=Object(r.useContext)(E),m=Object(r.useRef)();m.current=d;var p=Jo()({maxWidth:768});return Object(r.useRef)().current=p,Object(r.useEffect)(()=>{if(i){var e=!1,r=Zo(a.rows,t),n=bl(i,t,r,To,e=>{m.current.handleError(e)});return n.initialized.then(()=>{e||u(n)}),()=>{e=!0,n.destroy()}}},[t,a,i]),Object(r.useEffect)(()=>{c&&c.setZoomEnabled(!p)},[c,p]),n.a.createElement("div",{className:"chart-visualization-container",ref:l})}function vl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return wl(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return wl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wl(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ol(e){var t=e.options,a=e.data,o=vl(Object(r.useState)(null),2),i=o[0],s=o[1],c=Object(r.useMemo)(()=>function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=()=>{};try{a=new Function("x, ys, element, Plotly",e)}catch(e){t&&console.log("Error while executing custom graph: ".concat(e))}return(e,r,n,o)=>{try{a(e,r,n,o)}catch(e){t&&console.log("Error while executing custom graph: ".concat(e))}}}(t.customCode,t.enableConsoleLogs),[t.customCode,t.enableConsoleLogs]),u=Object(r.useMemo)(()=>{return e=Zo(a.rows,t),r=[],n={},Object(l.each)(e,e=>{var t=e.name,a=e.data;n[t]=[],Object(l.each)(a,e=>{r.push(Oi(e.x)),n[t].push(Oi(e.y))})}),{x:r,ys:n};var e,r,n},[t,a]);return Object(r.useEffect)(()=>{if(i)return Yr(i,()=>{ti.a.purge(i),c(u.x,u.ys,i,ti.a)})},[i,u,c]),Object(r.useEffect)(()=>{if(i)return()=>ti.a.purge(i)},[i]),n.a.createElement("div",{className:"chart-visualization-container",ref:s})}ti.a.register([ri.a,oi.a,li.a,ci.a,di.a]),ti.a.setPlotConfig({modeBarButtonsToRemove:["sendDataToCloud"]}),yl.propTypes=Gr,Ol.propTypes=Gr;a(1105);function El(){return(El=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function _l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function jl(e){var t=e.options,a=_l(e,["options"]);return"custom"===t.globalSeriesType&&To.allowCustomJSVisualizations?n.a.createElement(Ol,El({options:t},a)):n.a.createElement(yl,El({options:t},a))}function Sl(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}jl.propTypes=Gr;var Cl=[{type:"line",name:"线形图(Line)",icon:"line-chart"},{type:"column",name:"条形图(Bar)",icon:"bar-chart"},{type:"area",name:"面积图(Area)",icon:"area-chart"},{type:"pie",name:"饼形图(Pie)",icon:"pie-chart"},{type:"scatter",name:"散点图(Scatter)",icon:"circle-o"},{type:"bubble",name:"气泡图(Bubble)",icon:"circle-o"},{type:"heatmap",name:"热力图(Heatmap)",icon:"th"},{type:"box",name:"箱线图(Box)",icon:"square-o"}];function Pl(e){var t=e.hiddenChartTypes,a=Sl(e,["hiddenChartTypes"]),o=Object(r.useMemo)(()=>{var e=[...Cl];return To.allowCustomJSVisualizations&&e.push({type:"custom",name:"自定义(Custom)",icon:"code"}),t.length>0?Object(l.filter)(e,e=>{var a=e.type;return!Object(l.includes)(t,a)}):e},[]);return n.a.createElement(Do,a,Object(l.map)(o,e=>{var t=e.type,a=e.name,r=e.icon;return n.a.createElement(Do.Option,{key:t,value:t,"data-test":"Chart.ChartType.".concat(t)},n.a.createElement("i",{className:"fa fa-".concat(r),style:{marginRight:5}}),a)}))}function xl(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ll(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xl(Object(a),!0).forEach((function(t){kl(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xl(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function kl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Pl.defaultProps={hiddenChartTypes:[]};var Nl={x:{label:window.W_L.x_column},y:{label:window.W_L.y_column,multiple:!0},series:{label:window.W_L.group_by},yError:{label:window.W_L.errors_column},size:{label:"气泡尺寸(Bubble Size)"},zVal:{label:window.W_L.color_column}},Al=Ll(Ll({},Nl),{},{x:{label:window.W_L.y_column},y:{label:window.W_L.x_column,multiple:!0}});function Tl(e){var t=e.value,a=e.availableColumns,r=e.type,o=e.onChange,i=e.areAxesSwapped,s=Object(l.sortBy)(Object(l.filter)(Object(l.uniq)(Object(l.flatten)([a,t])),e=>Object(l.isString)(e)&&""!==e)),c=i?Al[r]:Nl[r],u=c.label,d=c.multiple;return n.a.createElement(Oo,null,n.a.createElement(Do,{label:u,"data-test":"Chart.ColumnMapping.".concat(r),mode:d?"multiple":"default",allowClear:!0,showSearch:!0,placeholder:d?window.W_L.choose_columns:window.W_L.choose_column,value:t||void 0,onChange:e=>o(e||null,r)},Object(l.map)(s,e=>n.a.createElement(Do.Option,{key:e,value:e,"data-test":"Chart.ColumnMapping.".concat(r,".").concat(e)},e))))}function Wl(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Il(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Wl(Object(a),!0).forEach((function(t){ql(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Wl(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ql(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Dl(e,t){var a={},r=function(e){var t=["x","y"];return Object(l.includes)(["custom","heatmap"],e.globalSeriesType)||t.push("series"),("bubble"===e.globalSeriesType||Object(l.some)(e.seriesOptions,{type:"bubble"}))&&t.push("size"),"heatmap"===e.globalSeriesType&&t.push("zVal"),Object(l.includes)(["custom","bubble","heatmap"],e.globalSeriesType)||t.push("yError"),t}(e);Object(l.each)(r,e=>{a[e]=Tl.MappingTypes[e].multiple?[]:null}),t=Object(l.map)(t,e=>e.name);var n=[];return Object(l.each)(e.columnMapping,(e,o)=>{Object(l.includes)(t,o)&&Object(l.includes)(r,e)&&(Tl.MappingTypes[e].multiple?a[e].push(o):a[e]=o,n.push(o))}),{mappedColumns:a,unusedColumns:Object(l.difference)(t,n)}}function Rl(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>Dl(t,a.columns),[t,a.columns]),s=i.mappedColumns,c=i.unusedColumns;function u(e,t){var a=function(e){var t={};return Object(l.each)(e,(e,a)=>{Object(l.isArray)(e)?Object(l.each)(e,e=>{t[e]=a}):e&&(t[e]=a)}),t}(Il(Il({},s),{},{[t]:e}));o({columnMapping:a},bo.shallowMerge)}return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Pl,{label:"Chart Type","data-test":"Chart.GlobalSeriesType",defaultValue:t.globalSeriesType,onChange:function(e){o({globalSeriesType:e,showDataLabels:"pie"===e,swappedAxes:!1,seriesOptions:Object(l.mapValues)(t.seriesOptions,t=>Il(Il({},t),{},{type:e}))})}})),Object(l.includes)(["column","line","box"],t.globalSeriesType)&&n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Chart.SwappedAxes",defaultChecked:t.swappedAxes,checked:t.swappedAxes,onChange:function(){var e=Object(l.mapValues)(t.seriesOptions,e=>Il(Il({},e),{},{yAxis:0}));o({swappedAxes:!t.swappedAxes,seriesOptions:e})}},window.W_L.Horizontal_Chart)),Object(l.map)(s,(e,a)=>n.a.createElement(Tl,{key:a,type:a,value:e,areAxesSwapped:t.swappedAxes,availableColumns:c,onChange:u})),Object(l.includes)(["bubble"],t.globalSeriesType)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Mo,{label:window.W_L.bubble_size_coefficient,"data-test":"Chart.BubbleCoefficient",defaultValue:t.coefficient,onChange:e=>o({coefficient:Object(l.toNumber)(e)})})),n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.bubble_size_proportional_to,"data-test":"Chart.SizeMode",defaultValue:t.sizemode,onChange:e=>o({sizemode:e})},n.a.createElement(Do.Option,{value:"area","data-test":"Chart.SizeMode.Area"},window.W_L.Area),n.a.createElement(Do.Option,{value:"diameter","data-test":"Chart.SizeMode.Diameter"},window.W_L.Diameter)))),Object(l.includes)(["pie"],t.globalSeriesType)&&n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.direction,"data-test":"Chart.PieDirection",defaultValue:t.direction.type,onChange:e=>o({direction:{type:e}})},n.a.createElement(Do.Option,{value:"counterclockwise","data-test":"Chart.PieDirection.Counterclockwise"},window.W_L.Counterclockwise),n.a.createElement(Do.Option,{value:"clockwise","data-test":"Chart.PieDirection.Clockwise"},window.W_L.Clockwise))),!Object(l.includes)(["custom","heatmap"],t.globalSeriesType)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.legend_placement,"data-test":"Chart.LegendPlacement",value:t.legend.enabled?t.legend.placement:"hidden",onChange:function(e){o("hidden"===e?{legend:{enabled:!1}}:{legend:{enabled:!0,placement:e}})}},n.a.createElement(Do.Option,{value:"hidden","data-test":"Chart.LegendPlacement.HideLegend"},window.W_L.Hide_legend),n.a.createElement(Do.Option,{value:"auto","data-test":"Chart.LegendPlacement.Auto"},window.W_L.Right),n.a.createElement(Do.Option,{value:"below","data-test":"Chart.LegendPlacement.Below"},window.W_L.Bottom))),t.legend.enabled&&n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.legend_items_order,"data-test":"Chart.LegendItemsOrder",value:t.legend.traceorder,onChange:e=>o({legend:{traceorder:e}})},n.a.createElement(Do.Option,{value:"normal","data-test":"Chart.LegendItemsOrder.Normal"},window.W_L.Normal),n.a.createElement(Do.Option,{value:"reversed","data-test":"Chart.LegendItemsOrder.Reversed"},window.W_L.Reversed)))),Object(l.includes)(["box"],t.globalSeriesType)&&n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Chart.ShowPoints",defaultChecked:t.showpoints,onChange:e=>o({showpoints:e.target.checked})},window.W_L.Show_All_Points)),!Object(l.includes)(["custom","heatmap"],t.globalSeriesType)&&n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.stacking,"data-test":"Chart.Stacking",defaultValue:t.series.stacking,disabled:!Object(l.includes)(["line","area","column"],t.globalSeriesType),onChange:e=>o({series:{stacking:e}})},n.a.createElement(Do.Option,{value:null,"data-test":"Chart.Stacking.Disabled"},window.W_L.Disabled),n.a.createElement(Do.Option,{value:"stack","data-test":"Chart.Stacking.Stack"},window.W_L.Stack))),Object(l.includes)(["line","area","column"],t.globalSeriesType)&&n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Chart.NormalizeValues",defaultChecked:t.series.percentValues,onChange:e=>o({series:{percentValues:e.target.checked}})},window.W_L.Normalize_values_to_percentage)),!Object(l.includes)(["custom","heatmap","bubble","scatter"],t.globalSeriesType)&&n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.missing_and_NULL_values,"data-test":"Chart.MissingValues",defaultValue:t.missingValuesAsZero?1:0,onChange:e=>o({missingValuesAsZero:!!e})},n.a.createElement(Do.Option,{value:0,"data-test":"Chart.MissingValues.Keep"},window.W_L.Do_not_display_in_chart),n.a.createElement(Do.Option,{value:1,"data-test":"Chart.MissingValues.Zero"},window.W_L.Convert_to_0_and_display_in_chart))))}Tl.defaultProps={value:null,availableColumns:[],type:null,onChange:()=>{}},Tl.MappingTypes=Nl,Rl.propTypes=Jr;var Ml=a(1752);function zl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fl(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Fl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fl(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Vl(e){return e=Object(l.isNumber)(e)?e:parseFloat(e),Object(l.isFinite)(e)?e:null}function Ul(e){var t=e.id,a=e.options,r=e.features,o=e.onChange;function i(e){o(Object(l.merge)({},a,e))}var s=zl(Object(Ml.a)(e=>{i({title:Object(l.isString)(e)&&""!==e?{text:e}:null})},200),1)[0],c=zl(Object(Ml.a)(e=>i(e),200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.scale,"data-test":"Chart.".concat(t,".Type"),defaultValue:a.type,onChange:e=>i({type:e})},r.autoDetectType&&n.a.createElement(Do.Option,{value:"-","data-test":"Chart.".concat(t,".Type.Auto")},window.W_L.auto_detect),n.a.createElement(Do.Option,{value:"datetime","data-test":"Chart.".concat(t,".Type.DateTime")},window.W_L.datetime),n.a.createElement(Do.Option,{value:"linear","data-test":"Chart.".concat(t,".Type.Linear")},window.W_L.linear),n.a.createElement(Do.Option,{value:"logarithmic","data-test":"Chart.".concat(t,".Type.Logarithmic")},window.W_L.logarithmic),n.a.createElement(Do.Option,{value:"category","data-test":"Chart.".concat(t,".Type.Category")},window.W_L.category))),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:window.W_L.name,"data-test":"Chart.".concat(t,".Name"),defaultValue:Object(l.isObject)(a.title)?a.title.text:null,onChange:e=>s(e.target.value)})),r.range&&n.a.createElement(Oo,null,n.a.createElement(ao.Row,{gutter:15,type:"flex",align:"middle"},n.a.createElement(ao.Col,{span:12},n.a.createElement(Mo,{label:window.W_L.min_value,placeholder:window.W_L.auto,"data-test":"Chart.".concat(t,".RangeMin"),defaultValue:Vl(a.rangeMin),onChange:e=>c({rangeMin:Vl(e)})})),n.a.createElement(ao.Col,{span:12},n.a.createElement(Mo,{label:window.W_L.max_value,placeholder:window.W_L.auto,"data-test":"Chart.".concat(t,".RangeMax"),defaultValue:Vl(a.rangeMax),onChange:e=>c({rangeMax:Vl(e)})})))))}function Bl(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Ul,{id:"XAxis",features:{autoDetectType:!0},options:t.xAxis,onChange:e=>a({xAxis:e})}),n.a.createElement(Oo,null,n.a.createElement(Co,{"data-test":"Chart.XAxis.Sort",defaultChecked:t.sortX,onChange:e=>a({sortX:e})},window.W_L.sort_values)),n.a.createElement(Oo,null,n.a.createElement(Co,{"data-test":"Chart.XAxis.Reverse",defaultChecked:t.reverseX,onChange:e=>a({reverseX:e})},window.W_L.reverse_order)),n.a.createElement(Oo,null,n.a.createElement(Co,{"data-test":"Chart.XAxis.ShowLabels",defaultChecked:t.xAxis.labels.enabled,onChange:e=>a({xAxis:{labels:{enabled:e}}})},window.W_L.Show_Labels)))}function Hl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Yl(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Yl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yl(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ql(e){var t=e.options,a=e.onOptionsChange,r=Hl(t.yAxis,2),o=r[0],i=r[1];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo.Title,null,t.swappedAxes?window.W_L.x_axis:window.W_L.left_y_axis),n.a.createElement(Oo,null,n.a.createElement(Ul,{id:"LeftYAxis",features:{range:!0},options:o,onChange:e=>a({yAxis:[e,i]})})),"heatmap"!==t.globalSeriesType&&!t.swappedAxes&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo.Title,null,window.W_L.right_y_axis),n.a.createElement(Oo,null,n.a.createElement(Ul,{id:"RightYAxis",features:{range:!0},options:i,onChange:e=>a({yAxis:[o,e]})})),n.a.createElement(Oo,null,n.a.createElement(Co,{id:"chart-editor-y-axis-align-at-zero","data-test":"Chart.YAxis.AlignAtZero",defaultChecked:t.alignYAxesAtZero,onChange:e=>a({alignYAxesAtZero:e})},window.W_L.align_Y_axes_at_zero))),"heatmap"===t.globalSeriesType&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Co,{id:"chart-editor-y-axis-sort","data-test":"Chart.LeftYAxis.Sort",defaultChecked:t.sortY,onChange:e=>a({sortY:e})},window.W_L.sort_values)),n.a.createElement(Oo,null,n.a.createElement(Co,{id:"chart-editor-y-axis-reverse","data-test":"Chart.LeftYAxis.Reverse",defaultChecked:t.reverseY,onChange:e=>a({reverseY:e})},window.W_L.reverse_order))))}Ul.defaultProps={features:{},onChange:()=>{}},Bl.propTypes=Jr,Ql.propTypes=Jr;var Kl=a(48),$l=a.n(Kl),Gl=a(159);a(1106);function Jl(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Xl(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Jl(Object(a),!0).forEach((function(t){Zl(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Jl(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Zl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function es(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ts(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ts(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ts(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function as(){return(as=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function rs(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var ns=Object(Gl.c)(e=>{var t=e.className,a=rs(e,["className"]);return n.a.createElement("div",as({className:me()("drag-handle",t)},a))}),os=Object(Gl.a)(e=>e.children),is=Object(Gl.b)(e=>e.children);function ls(e){var t=e.disabled,a=e.containerComponent,o=e.containerProps,i=e.children,s=rs(e,["disabled","containerComponent","containerProps","children"]),c=Object(r.useRef)(),u=es(Object(r.useState)(!1),2),d=u[0],m=u[1];s=Xl({},s),o=Xl({},o),t?s.shouldCancelStart=()=>!0:(s.helperContainer=Object(l.wrap)(s.helperContainer,e=>Object(l.isFunction)(e)?e(c.current):c.current),s.updateBeforeSortStart=Object(l.wrap)(s.updateBeforeSortStart,(function(e){if(m(!0),Object(l.isFunction)(e)){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];e(...a)}})),s.onSortStart=Object(l.wrap)(s.onSortStart,(function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];if(Object(l.isFunction)(e))e(...a);else{var n=a[1];n.preventDefault()}})),s.onSortEnd=Object(l.wrap)(s.onSortEnd,(function(e){if(m(!1),Object(l.isFunction)(e)){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];e(...a)}})),o.className=me()("sortable-container",{"sortable-container-dragging":d},o.className),o.ref=c);var p=a;return n.a.createElement(os,s,n.a.createElement(p,o,i))}function ss(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return cs(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return cs(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cs(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}ls.defaultProps={disabled:!1,containerComponent:"div",containerProps:{},children:null};var us=Object(Gl.b)(e=>n.a.createElement("tr",e));function ds(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>Object(l.map)(Zo(a.rows,t),(e,a)=>{var r=e.name;return Object(l.extend)({key:r,type:t.globalSeriesType},t.seriesOptions[r],{zIndex:a})}),[t,a]),s=Object(r.useCallback)(e=>{var t=e.oldIndex,a=e.newIndex,r=[...i];r.splice(a,0,...r.splice(t,1)),o({seriesOptions:Object(l.fromPairs)(Object(l.map)(r,(e,t)=>[e.key,{zIndex:t}]))})},[o,i]),c=Object(r.useCallback)((e,t,a)=>{o({seriesOptions:{[e]:{[t]:a}}})},[o]),u=ss(Object(Ml.a)(c,200),1)[0],d=Object(r.useMemo)(()=>function(e,t,a){var r=[{title:window.W_L.order,dataIndex:"zIndex",render:(e,t)=>n.a.createElement("span",{className:"series-settings-order"},n.a.createElement(ns,null),t.zIndex+1)},{title:window.W_L.label,dataIndex:"name",render:(e,t)=>n.a.createElement(ba.a,{"data-test":"Chart.Series.".concat(t.key,".Label"),placeholder:t.key,defaultValue:t.name,onChange:e=>a(t.key,"name",e.target.value)})}];return Object(l.includes)(["pie","heatmap"],e.globalSeriesType)||(e.swappedAxes||r.push({title:window.W_L.y_axis,dataIndex:"yAxis",render:(e,a)=>n.a.createElement(Bn.a.Group,{className:"series-settings-y-axis",value:1===a.yAxis?1:0,onChange:e=>t(a.key,"yAxis",e.target.value)},n.a.createElement(Bn.a,{value:0,"data-test":"Chart.Series.".concat(a.key,".UseLeftAxis")},window.W_L.Left),n.a.createElement(Bn.a,{value:1,"data-test":"Chart.Series.".concat(a.key,".UseRightAxis")},window.W_L.Right))}),r.push({title:window.W_L.type,dataIndex:"type",render:(e,a)=>n.a.createElement(Pl,{"data-test":"Chart.Series.".concat(a.key,".Type"),dropdownMatchSelectWidth:!1,value:a.type,hiddenChartTypes:["pie","heatmap","bubble","box"],onChange:e=>t(a.key,"type",e)})})),r}(t,c,u),[t,c,u]);return n.a.createElement(ls,{axis:"y",lockAxis:"y",lockToContainerEdges:!0,useDragHandle:!0,helperClass:"chart-editor-series-dragged-item",helperContainer:e=>e.querySelector("tbody"),onSortEnd:s,containerProps:{className:"chart-editor-series"}},n.a.createElement($l.a,{dataSource:i,columns:d,components:{body:{row:us}},onRow:e=>({index:e.zIndex}),pagination:!1}))}function ms(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ps(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function fs(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ms(Object(a),!0).forEach((function(t){ps(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ms(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({Automatic:null},gi),[]),s=Object(r.useMemo)(()=>{return Object(l.map)((e=Zo(a.rows,t),r=new Set,Object(l.each)(e,e=>{Object(l.each)(e.data,e=>{r.add(e.x)})}),[...r]),e=>({key:e,color:(t.valuesOptions[e]||{}).color||null}));var e,r},[t,a]),c=Object(r.useCallback)((e,t,a)=>{o({valuesOptions:{[e]:{[t]:a}}})},[o]),u=[{title:window.W_L.value,dataIndex:"key"},{title:window.W_L.color,dataIndex:"color",width:"1%",render:(e,t)=>n.a.createElement(Vn,{"data-test":"Chart.Series.".concat(t.key,".Color"),interactive:!0,presetColors:i,placement:"topRight",color:t.color,onChange:e=>c(t.key,"color",e),addonAfter:n.a.createElement(Vn.Label,{color:t.color,presetColors:i})})}];return n.a.createElement($l.a,{showHeader:!1,dataSource:s,columns:u,pagination:!1})}ds.propTypes=Jr,fs.propTypes=Jr;var bs=["Blackbody","Bluered","Blues","Earth","Electric","Greens","Greys","Hot","Jet","Picnic","Portland","Rainbow","RdBu","Reds","Viridis","YlGnBu","YlOrRd","Custom..."];function hs(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.color_scheme,"data-test":"Chart.Colors.Heatmap.ColorScheme",placeholder:window.W_L.choose_color_scheme,allowClear:!0,value:t.colorScheme||void 0,onChange:e=>a({colorScheme:e||null})},Object(l.map)(bs,e=>n.a.createElement(Do.Option,{key:e,value:e,"data-test":"Chart.Colors.Heatmap.ColorScheme.".concat(e)},e)))),"Custom..."===t.colorScheme&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.min_color,"data-test":"Chart.Colors.Heatmap.MinColor",interactive:!0,placement:"topLeft",presetColors:gi,color:t.heatMinColor,onChange:e=>a({heatMinColor:e}),addonAfter:n.a.createElement(zo.Label,{color:t.heatMinColor,presetColors:gi})})),n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.max_color,"data-test":"Chart.Colors.Heatmap.MaxColor",interactive:!0,placement:"topRight",presetColors:gi,color:t.heatMaxColor,onChange:e=>a({heatMaxColor:e}),addonAfter:n.a.createElement(zo.Label,{color:t.heatMaxColor,presetColors:gi})}))))}function gs(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ys(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function vs(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?gs(Object(a),!0).forEach((function(t){ys(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):gs(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({Automatic:null},gi),[]),s=Object(r.useMemo)(()=>Object(l.map)(Zo(a.rows,t),e=>{var a=e.name;return{key:a,color:(t.seriesOptions[a]||{}).color||null}}),[t,a]),c=Object(r.useCallback)((e,t,a)=>{o({seriesOptions:{[e]:{[t]:a}}})},[o]),u=[{title:window.W_L.series,dataIndex:"key"},{title:window.W_L.color,dataIndex:"color",width:"1%",render:(e,t)=>n.a.createElement(Vn,{"data-test":"Chart.Series.".concat(t.key,".Color"),interactive:!0,presetColors:i,placement:"topRight",color:t.color,onChange:e=>c(t.key,"color",e),addonAfter:n.a.createElement(Vn.Label,{color:t.color,presetColors:i})})}];return n.a.createElement($l.a,{showHeader:!1,dataSource:s,columns:u,pagination:!1})}function ws(){return(ws=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Os(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}hs.propTypes=Jr,vs.propTypes=Jr;var Es={pie:fs,heatmap:hs};function _s(e){var t=e.options,a=Os(e,["options"]),r=Es[t.globalSeriesType]||vs;return n.a.createElement(r,ws({options:t},a))}function js(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ss(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ss(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ss(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Cs(e){var t=e.options,a=e.onOptionsChange,r=Object(l.includes)(["line","area","column","scatter","pie","heatmap"],t.globalSeriesType),o=js(Object(Ml.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,r&&n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Chart.DataLabels.ShowDataLabels",defaultChecked:t.showDataLabels,onChange:e=>a({showDataLabels:e.target.checked})},window.W_L.Show_Data_Labels)),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Number_format,n.a.createElement(qo.NumberFormatSpecs,null)),"data-test":"Chart.DataLabels.NumberFormat",defaultValue:t.numberFormat,onChange:e=>o({numberFormat:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Percent_Values_Format,n.a.createElement(qo.NumberFormatSpecs,null)),"data-test":"Chart.DataLabels.PercentFormat",defaultValue:t.percentFormat,onChange:e=>o({percentFormat:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Date_Time_format,n.a.createElement(qo.DateTimeFormatSpecs,null)),"data-test":"Chart.DataLabels.DateTimeFormat",defaultValue:t.dateTimeFormat,onChange:e=>o({dateTimeFormat:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Data_Labels,n.a.createElement(qo,{placement:"topRight",arrowPointAtCenter:!0},n.a.createElement("div",{style:{paddingBottom:5}},"Use special names to access additional properties:"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@name }}")," series name;"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@x }}")," x-value;"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@y }}")," y-value;"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@yPercent }}")," relative y-value;"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@yError }}")," y deviation;"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@size }}")," bubble size;"),n.a.createElement("div",{style:{paddingTop:5}},window.W_L.Also_all_query_result_columns_can_be_referenced,n.a.createElement("br",null),window.W_L.using,n.a.createElement("code",{style:{whiteSpace:"nowrap"}},"{{ column_name }}"),"  ",window.W_L.syntax))),"data-test":"Chart.DataLabels.TextFormat",placeholder:"(auto)",defaultValue:t.textFormat,onChange:e=>o({textFormat:e.target.value})})))}_s.propTypes=Jr,Cs.propTypes=Jr;var Ps=Object(l.trimStart)("\n// Available variables are x, ys, element, and Plotly\n// Type console.log(x, ys); for more info about x and ys\n// To plot your graph call Plotly.plot(element, ...)\n// Plotly examples and docs: https://plot.ly/javascript/\n");function xs(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Lo,{label:"Custom code","data-test":"Chart.Custom.Code",rows:"10",defaultValue:Object(l.isNil)(t.customCode)?Ps:t.customCode,onChange:e=>a({customCode:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Co,{"data-test":"Chart.Custom.EnableConsoleLogs",defaultChecked:t.enableConsoleLogs,onChange:e=>a({enableConsoleLogs:e})},"Show errors in the console")),n.a.createElement(Oo,null,n.a.createElement(Co,{id:"chart-editor-auto-update-custom-chart","data-test":"Chart.Custom.AutoUpdate",defaultChecked:t.autoRedraw,onChange:e=>a({autoRedraw:e})},"Auto update graph")))}xs.propTypes=Jr;a(1231);var Ls=e=>"custom"===e.globalSeriesType,ks=e=>"pie"===e.globalSeriesType,Ns={type:"CHART",name:"图表(Chart)",isDefault:!0,getOptions:function(e){var t=Object(l.merge)({},$o,{showDataLabels:"pie"===e.globalSeriesType,dateTimeFormat:To.dateTimeFormat},e);return["normal","percent"].indexOf(t.series.stacking)>=0&&(t.series.percentValues="percent"===t.series.stacking,t.series.stacking="stack"),t},Renderer:jl,Editor:go([{key:"General",title:window.W_L.general,component:e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Rl,e),Ls(e.options)&&n.a.createElement(xs,e))},{key:"XAxis",title:e=>e.swappedAxes?window.W_L.y_column:window.W_L.x_column,component:Bl,isAvailable:e=>!Ls(e)&&!ks(e)},{key:"YAxis",title:e=>e.swappedAxes?window.W_L.x_column:window.W_L.y_column,component:Ql,isAvailable:e=>!Ls(e)&&!ks(e)},{key:"Series",title:window.W_L.series,component:ds,isAvailable:e=>!Ls(e)},{key:"Colors",title:window.W_L.color,component:_s,isAvailable:e=>!Ls(e)},{key:"DataLabels",title:window.W_L.data_labels,component:Cs,isAvailable:e=>!Ls(e)}]),defaultColumns:3,defaultRows:8,minColumns:1,minRows:5},As=Object(l.extend)({White:"#ffffff",Black:"#000000","Light Gray":"#dddddd"},gi);var Ts={mapType:"countries",keyColumn:null,targetField:null,valueColumn:null,clusteringMode:"e",steps:5,valueFormat:"0,0.00",noValuePlaceholder:"N/A",colors:{min:As["Light Blue"],max:As["Dark Blue"],background:As.White,borders:As.White,noValue:As["Light Gray"]},legend:{visible:!0,position:"bottom-left",alignText:"right"},tooltip:{enabled:!0,template:"<b>{{ @@name }}</b>: {{ @@value }}"},popup:{enabled:!0,template:"地区: <b>{{ @@name_long }} ({{ @@iso_a2 }})</b>\n<br>\n值: <b>{{ @@value }}</b>"}};function Ws(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Is(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Is(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Is(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var qs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cleanupDelay,a=void 0===t?2e3:t,r={},n=Object(l.debounce)(()=>{Object(l.each)(r,(e,t)=>{e.refCount<=0&&delete r[t]})},a);function o(e,t){r[e]||(r[e]={value:t(),refCount:0});var a=r[e];return a.refCount+=1,a.value}function i(e){if(r[e]){var t=r[e];t.refCount>0&&(t.refCount-=1,t.refCount<=0&&n())}}return{get:o,release:i}}();function Ds(e){var t=Ws(Object(r.useState)(null),2),a=t[0],n=t[1],o=Ws(Object(r.useState)(!1),2),i=o[0],s=o[1];return Object(r.useEffect)(()=>{var t=Object(l.get)(To,"choroplethAvailableMaps.".concat(e,".url"),void 0);if(Object(l.isString)(t)){s(!0);var a=!1;return qs.get(t,()=>W.a.get(t).catch(()=>null)).then(e=>{var t=e.data;a||(n(Object(l.isObject)(t)?t:null),s(!1))}),()=>{a=!0,qs.release(t)}}n(null),s(!1)},[e]),[a,i]}var Rs=a(57),Ms=a.n(Rs);a(583),a(584),a(585);function zs(e){return gn()(e).darken().hex()}function Fs(e,t,a){var r=e.properties[a];return Object(l.isString)(r)&&Object(l.isObject)(t[r])?t[r].value:Object(l.isNumber)(r)&&Object(l.isObject)(t[r.toString()])?t[r.toString()].value:void 0}function Vs(e){var t=e.items,a=e.alignText;return n.a.createElement("div",{className:"choropleth-visualization-legend"},Object(l.map)(t,(e,t)=>n.a.createElement("div",{key:"legend".concat(t),className:"legend-item"},n.a.createElement(Vn.Swatch,{color:e.color}),n.a.createElement("div",{className:"legend-item-text text-".concat(a)},e.text))))}function Us(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Bs(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Us(Object(a),!0).forEach((function(t){Hs(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Us(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Hs(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Vs.defaultProps={items:[],alignText:"left"};var Ys=Ms.a.Control.extend({options:{position:"topright"},onAdd(){var e=document.createElement("div");return e.className="leaflet-bar leaflet-custom-toolbar",e.style.background="#fff",e.style.backgroundClip="padding-box",e},onRemove(){i.a.unmountComponentAtNode(this.getContainer())}});function Qs(e){var t=e.feature,a=e.layer,r=e.data,n=e.options,o=e.limits,i=e.colors,s=e.formatValue,c=Fs(t,r,n.targetField),u=function(e,t,a,r){var n={};Object(l.each)(e.properties,(e,t)=>{n["@@"+t]=e}),n["@@value"]=t;var o=a[e.properties[r]]||{};return Object(l.extend)(n,o.item)}(t,s(c),r,n.targetField),d=function(e,t,a,r){if(Object(l.isFinite)(e))for(var n=0;n<t.length;n+=1)if(e<=t[n])return a[n];return r}(c,o,i,n.colors.noValue);a.setStyle({color:n.colors.borders,weight:1,fillColor:d,fillOpacity:1}),n.tooltip.enabled&&a.bindTooltip(ke(qi(n.tooltip.template,u)),{sticky:!0}),n.popup.enabled&&a.bindPopup(ke(qi(n.popup.template,u))),a.on("mouseover",()=>{a.setStyle({weight:2,fillColor:zs(d)})}),a.on("mouseout",()=>{a.setStyle({weight:1,fillColor:d})})}function Ks(e,t){return e&&(e=Ms.a.latLngBounds(e[0],e[1])).isValid()?e:t&&t.isValid()?t:null}function $s(e,t){var a=Ms.a.map(e,{center:[0,0],zoom:1,zoomSnap:0,scrollWheelZoom:!1,maxBoundsViscosity:1,attributionControl:!1,fullscreenControl:!0}),r=null,o=new Ys;var s=!1,c=()=>{!function(){if(Object(l.isFunction)(t)){var e=a.getBounds();t([[e._southWest.lat,e._southWest.lng],[e._northEast.lat,e._northEast.lng]])}}()};a.on("focus",()=>{s=!0,a.on("moveend",c)}),a.on("blur",()=>{a.off("moveend",c),s=!1});var u=Yr(e,()=>{a.invalidateSize(!1)});return{updateLayers:function(e,t,s){if(a.eachLayer(e=>a.removeLayer(e)),a.removeControl(o),!Object(l.isObject)(e)||!Object(l.isArray)(e.features))return r=null,void a.setMaxBounds(null);var c,u,d,m=function(e,t,a){var r=Object(l.uniq)(Object(l.filter)(Object(l.map)(e,e=>Fs(e,t,a.targetField)),l.isFinite));if(0===r.length)return{limits:[],colors:[],legend:[]};var n=Math.min(r.length,a.steps);if(1===n)return{limits:r,colors:[a.colors.max],legend:[{color:a.colors.max,limit:Object(l.first)(r)}]};var o=gn.a.limits(r,a.clusteringMode,n-1),i=gn.a.scale([a.colors.min,a.colors.max]).colors(o.length),s=Object(l.map)(i,(e,t)=>({color:e,limit:o[t]})).reverse();return{limits:o,colors:i,legend:s}}(e.features,t,s),p=m.limits,f=m.colors,b=m.legend,h=(c=s.valueFormat,u=s.noValuePlaceholder,d=Ii(c),e=>Object(l.isFinite)(e)?d(e):u),g=(r=Ms.a.geoJSON(e,{onEachFeature(e,a){Qs({feature:e,layer:a,data:t,options:s,limits:p,colors:f,formatValue:h})}}).addTo(a)).getBounds(),y=Ks(s.bounds,g);a.fitBounds(y,{animate:!1,duration:0}),a.options.maxBounds=g,a.panInsideBounds(g,{animate:!1,duration:0}),s.legend.visible&&b.length>0&&(o.setPosition(s.legend.position.replace("-","")),a.addControl(o),i.a.render(n.a.createElement(Vs,{items:Object(l.map)(b,e=>Bs(Bs({},e),{},{text:h(e.limit)})),alignText:s.legend.alignText}),o.getContainer()))},updateBounds:function(e){s||(e=Ks(e,r?r.getBounds():a.getBounds()))&&a.fitBounds(e,{animate:!1,duration:0})},destroy(){u(),a.removeControl(o),a.remove()}}}a(1232);function Gs(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Js(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Gs(Object(a),!0).forEach((function(t){Xs(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Gs(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Xs(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Zs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ec(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ec(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ec(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function tc(e){var t=e.data,a=e.options,o=e.onOptionsChange,i=Zs(Object(r.useState)(null),2),s=i[0],c=i[1],u=Zs(Ds(a.mapType),1)[0],d=Object(r.useRef)();d.current=o?e=>o(Js(Js({},a),{},{bounds:e})):l.noop;var m,p,f,b,h=(m=()=>Object(l.omit)(a,["bounds"]),p=[a],f=Object(r.useRef)(),b=Object(r.useMemo)(m,p),Object(l.isEqual)(b,f.current)||(f.current=b),f.current),g=Zs(Object(r.useState)(null),2),y=g[0],v=g[1];return Object(r.useEffect)(()=>{if(s){var e=$s(s,(function(){return d.current(...arguments)}));return v(e),()=>{e.destroy()}}},[s]),Object(r.useEffect)(()=>{y&&y.updateLayers(u,function(e,t,a){if(!t||!a)return{};var r={};return Object(l.each)(e,e=>{if(e[t]){var n=parseFloat(e[a]);r[e[t]]={code:e[t],value:Object(l.isFinite)(n)?n:void 0,item:e}}}),r}(t.rows,h.keyColumn,h.valueColumn),a)},[y,u,t.rows,h]),Object(r.useEffect)(()=>{y&&y.updateBounds(a.bounds)},[y,a,o]),n.a.createElement("div",{className:"map-visualization-container",style:{background:a.colors.background},ref:c})}function ac(e){var t=Object(l.isObject)(e)&&Object(l.isArray)(e.features)?e.features:[];return Object(l.reduce)(t,(e,t)=>{var a=Object(l.isObject)(t)&&Object(l.isObject)(t.properties)?t.properties:{};return Object(l.uniq)([...e,...Object(l.keys)(a)])},[])}function rc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return nc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return nc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function oc(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=rc(Ds(t.mapType),2),s=i[0],c=i[1],u=Object(r.useMemo)(()=>ac(s),[s]),d=c?Object(l.filter)([t.targetField],l.isString):u,m=Object(l.get)(To,"choroplethAvailableMaps.".concat(t.mapType,".fieldNames"),{}),p=Object(r.useCallback)(e=>{o({mapType:e||null})},[o]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.Map,"data-test":"Choropleth.Editor.MapType",defaultValue:t.mapType,onChange:p},Object(l.map)(To.choroplethAvailableMaps,(e,t)=>n.a.createElement(Do.Option,{key:t,"data-test":"Choropleth.Editor.MapType.".concat(t)},Object(l.get)(To,"choroplethAvailableMaps.".concat(t,".name"),t))))),n.a.createElement(Oo,null,n.a.createElement(ao.Row,{gutter:15},n.a.createElement(ao.Col,{span:12},n.a.createElement(Do,{label:window.W_L.Key_Column,className:"w-100","data-test":"Choropleth.Editor.KeyColumn",disabled:0===a.columns.length,defaultValue:t.keyColumn,onChange:e=>o({keyColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Do.Option,{key:t,"data-test":"Choropleth.Editor.KeyColumn.".concat(t)},t)}))),n.a.createElement(ao.Col,{span:12},n.a.createElement(Do,{label:window.W_L.Target_Field,className:"w-100","data-test":"Choropleth.Editor.TargetField",disabled:c||0===d.length,loading:c,value:t.targetField,onChange:e=>o({targetField:e})},Object(l.map)(d,e=>n.a.createElement(Do.Option,{key:e,"data-test":"Choropleth.Editor.TargetField.".concat(e)},m[e]||e)))))),n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.Value_Column,"data-test":"Choropleth.Editor.ValueColumn",disabled:0===a.columns.length,defaultValue:t.valueColumn,onChange:e=>o({valueColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Do.Option,{key:t,"data-test":"Choropleth.Editor.ValueColumn.".concat(t)},t)}))))}function ic(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function sc(e){var t=e.options,a=e.onOptionsChange,r=ic(Object(Ml.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:window.W_L.Clustering_Mode,"data-test":"Choropleth.Editor.ClusteringMode",defaultValue:t.clusteringMode,onChange:e=>a({clusteringMode:e})},n.a.createElement(Do.Option,{value:"q","data-test":"Choropleth.Editor.ClusteringMode.q"},"分位数(quantile)"),n.a.createElement(Do.Option,{value:"e","data-test":"Choropleth.Editor.ClusteringMode.e"},"等距(equidistant)"),n.a.createElement(Do.Option,{value:"k","data-test":"Choropleth.Editor.ClusteringMode.k"},"K均值(k-means)"))),n.a.createElement(Oo,null,n.a.createElement(Mo,{layout:"horizontal",label:window.W_L.Steps,"data-test":"Choropleth.Editor.ColorSteps",min:3,max:11,defaultValue:t.steps,onChange:e=>r({steps:e})})),n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.min_color,interactive:!0,presetColors:As,placement:"topRight",color:t.colors.min,triggerProps:{"data-test":"Choropleth.Editor.Colors.Min"},onChange:e=>a({colors:{min:e}}),addonAfter:n.a.createElement(zo.Label,{color:t.colors.min,presetColors:As})})),n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.max_color,interactive:!0,presetColors:As,placement:"topRight",color:t.colors.max,triggerProps:{"data-test":"Choropleth.Editor.Colors.Max"},onChange:e=>a({colors:{max:e}}),addonAfter:n.a.createElement(zo.Label,{color:t.colors.max,presetColors:As})})),n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.No_Value_Color,interactive:!0,presetColors:As,placement:"topRight",color:t.colors.noValue,triggerProps:{"data-test":"Choropleth.Editor.Colors.NoValue"},onChange:e=>a({colors:{noValue:e}}),addonAfter:n.a.createElement(zo.Label,{color:t.colors.noValue,presetColors:As})})),n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.Background_Color,interactive:!0,presetColors:As,placement:"topRight",color:t.colors.background,triggerProps:{"data-test":"Choropleth.Editor.Colors.Background"},onChange:e=>a({colors:{background:e}}),addonAfter:n.a.createElement(zo.Label,{color:t.colors.background,presetColors:As})})),n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.Borders_Color,interactive:!0,presetColors:As,placement:"topRight",color:t.colors.borders,triggerProps:{"data-test":"Choropleth.Editor.Colors.Borders"},onChange:e=>a({colors:{borders:e}}),addonAfter:n.a.createElement(zo.Label,{color:t.colors.borders,presetColors:As})})))}function cc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return uc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return uc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function dc(e){var t=e.geoJsonProperties;return n.a.createElement(qo,{placement:"topLeft",arrowPointAtCenter:!0},n.a.createElement("div",{style:{paddingBottom:5}},n.a.createElement("div",null,window.W_L.Also_all_query_result_columns_can_be_referenced,"：",n.a.createElement("code",null,"{{ column_name }}"),"。"),n.a.createElement("div",null,"Use",n.a.createElement("code",null,"{{ @@value }}")," to access formatted value.")),t.length>0&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"p-b-5"},"GeoJSON properties could be accessed by these names:"),n.a.createElement("div",{style:{maxHeight:300,overflow:"auto"}},Object(l.map)(t,e=>n.a.createElement("div",{key:e},n.a.createElement("code",null,"{{ @@".concat(e,"}}")))))))}function mc(e){var t=e.options,a=e.onOptionsChange,o=cc(Object(Ml.a)(a,200),1)[0],i=cc(Ds(t.mapType),1)[0],l=Object(r.useMemo)(()=>ac(i),[i]),s=n.a.createElement(dc,{geoJsonProperties:l});return n.a.createElement("div",{className:"choropleth-visualization-editor-format-settings"},n.a.createElement(Oo,null,n.a.createElement(ao.Row,{gutter:15},n.a.createElement(ao.Col,{span:12},n.a.createElement(Ro,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Value_Format,n.a.createElement(qo.NumberFormatSpecs,null)),"data-test":"Choropleth.Editor.ValueFormat",defaultValue:t.valueFormat,onChange:e=>o({valueFormat:e.target.value})})),n.a.createElement(ao.Col,{span:12},n.a.createElement(Ro,{label:window.W_L.Value_Placeholder,"data-test":"Choropleth.Editor.ValuePlaceholder",defaultValue:t.noValuePlaceholder,onChange:e=>o({noValuePlaceholder:e.target.value})})))),n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Choropleth.Editor.LegendVisibility",checked:t.legend.visible,onChange:e=>a({legend:{visible:e.target.checked}})},window.W_L.Show_Legend)),n.a.createElement(Oo,null,n.a.createElement(ao.Row,{gutter:15},n.a.createElement(ao.Col,{span:12},n.a.createElement(Do,{label:window.W_L.Legend_Position,"data-test":"Choropleth.Editor.LegendPosition",disabled:!t.legend.visible,defaultValue:t.legend.position,onChange:e=>a({legend:{position:e}})},n.a.createElement(Do.Option,{value:"top-left","data-test":"Choropleth.Editor.LegendPosition.TopLeft"},"top / left"),n.a.createElement(Do.Option,{value:"top-right","data-test":"Choropleth.Editor.LegendPosition.TopRight"},"top / right"),n.a.createElement(Do.Option,{value:"bottom-left","data-test":"Choropleth.Editor.LegendPosition.BottomLeft"},"bottom / left"),n.a.createElement(Do.Option,{value:"bottom-right","data-test":"Choropleth.Editor.LegendPosition.BottomRight"},"bottom / right"))),n.a.createElement(ao.Col,{span:12},n.a.createElement(Fo,{"data-test":"Choropleth.Editor.LegendTextAlignment",label:window.W_L.Legend_Text_Alignment,disabled:!t.legend.visible,defaultValue:t.legend.alignText,onChange:e=>a({legend:{alignText:e.target.value}})})))),n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Choropleth.Editor.TooltipEnabled",checked:t.tooltip.enabled,onChange:e=>a({tooltip:{enabled:e.target.checked}})},window.W_L.Show_tooltip)),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Tooltip_template," ",s),"data-test":"Choropleth.Editor.TooltipTemplate",disabled:!t.tooltip.enabled,defaultValue:t.tooltip.template,onChange:e=>o({tooltip:{template:e.target.value}})})),n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Choropleth.Editor.PopupEnabled",checked:t.popup.enabled,onChange:e=>a({popup:{enabled:e.target.checked}})},window.W_L.Show_popup)),n.a.createElement(Oo,null,n.a.createElement(Lo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Popup_template," ",s),"data-test":"Choropleth.Editor.PopupTemplate",disabled:!t.popup.enabled,rows:4,defaultValue:t.popup.template,onChange:e=>o({popup:{template:e.target.value}})})))}function pc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function bc(e){var t=e.options,a=e.onOptionsChange,o=pc(Object(r.useState)(t.bounds),2),i=o[0],s=o[1],c=pc(Object(Ml.a)(a,200),1)[0],u=pc(Ds(t.mapType),1)[0];Object(r.useEffect)(()=>{if(t.bounds)s(t.bounds);else{var e=function(e){if(Object(l.isObject)(e)){var t=Ms.a.geoJSON(e).getBounds();if(t.isValid())return[[t._southWest.lat,t._southWest.lng],[t._northEast.lat,t._northEast.lng]]}return null}(u);e&&s(e)}},[t.bounds,u]);var d=Object(r.useCallback)((e,t,a)=>{if(a=parseFloat(a),Object(l.isFinite)(a)){var r=Object(l.cloneDeep)(i);r[e][t]=a,s(r),c({bounds:r})}},[i,c]),m=Object(l.isArray)(i);return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(so,{label:window.W_L.North_East_Latitude_and_Longitude},n.a.createElement(ao.Row,{gutter:15},n.a.createElement(ao.Col,{span:12},n.a.createElement(Mo,{disabled:!m,value:m?i[1][0]:void 0,onChange:e=>d(1,0,e)})),n.a.createElement(ao.Col,{span:12},n.a.createElement(Mo,{disabled:!m,value:m?i[1][1]:void 0,onChange:e=>d(1,1,e)}))))),n.a.createElement(Oo,null,n.a.createElement(so,{label:window.W_L.South_West_Latitude_and_Longitude},n.a.createElement(ao.Row,{gutter:15},n.a.createElement(ao.Col,{span:12},n.a.createElement(Mo,{disabled:!m,value:m?i[0][0]:void 0,onChange:e=>d(0,0,e)})),n.a.createElement(ao.Col,{span:12},n.a.createElement(Mo,{disabled:!m,value:m?i[0][1]:void 0,onChange:e=>d(0,1,e)}))))))}tc.propTypes=Gr,oc.propTypes=Jr,sc.propTypes=Jr,dc.defaultProps={geoJsonProperties:[]},mc.propTypes=Jr,bc.propTypes=Jr;var hc={type:"CHOROPLETH",name:"地理分布图(Choropleth Map)",getOptions:function(e){var t=Object(l.merge)({},Ts,e);return t.bounds=Object(l.get)(e,"bounds"),Object(l.isNil)(To.choroplethAvailableMaps[t.mapType])&&(t.mapType=Object(l.first)(Object(l.keys)(To.choroplethAvailableMaps))||null),Object(l.isNil)(t.countryCodeColumn)||(t.keyColumn=t.countryCodeColumn),delete t.countryCodeColumn,Object(l.isNil)(t.countryCodeType)||(t.targetField=t.countryCodeType),delete t.countryCodeType,t},Renderer:tc,Editor:go([{key:"General",title:"通用",component:oc},{key:"Colors",title:"颜色",component:sc},{key:"Format",title:"格式化",component:mc},{key:"Bounds",title:"边界",component:bc}]),defaultColumns:3,defaultRows:8,minColumns:2},gc={timeInterval:"daily",mode:"diagonal",dateColumn:"date",stageColumn:"day_number",totalColumn:"total",valueColumn:"value",showTooltips:!0,percentValues:!0,timeColumnTitle:"Time",peopleColumnTitle:"Users",stageColumnTitle:"{{ @ }}",numberFormat:"0,0[.]00",percentFormat:"0.00%",noValuePlaceholder:"-",colors:{min:"#ffffff",max:gi["Dark Blue"],steps:7}};var yc={weekly:"weeks",daily:"days",monthly:"months"};function vc(e){var t={};return s.a.each(e,e=>{var a=Da()(e.date),r=a.valueOf();t[r]=t[r]||{date:a,total:parseInt(e.total,10)||0,values:{}},t[r].values[e.stage]=parseInt(e.value,10)||null}),s.a.values(t)}function wc(e,t){if(!function(e,t){var a=s.a.map(e.columns,e=>e.name);return e.rows.length>0&&s.a.includes(a,t.dateColumn)&&s.a.includes(a,t.stageColumn)&&s.a.includes(a,t.totalColumn)&&s.a.includes(a,t.valueColumn)}(e,t))return{data:[],initialDate:null};e=s.a.map(e.rows,e=>({date:e[t.dateColumn],stage:parseInt(e[t.stageColumn],10),total:parseFloat(e[t.totalColumn]),value:parseFloat(e[t.valueColumn])}));var a,r=s.a.sortBy(e,e=>e.date+e.stage),n=Da()(r[0].date).toDate();switch(t.mode){case"simple":a=function(e,t){var a=t.timeInterval,r=vc(e),n=s.a.map(e,e=>e.stage),o=s.a.min(n),i=s.a.max(n),l=null,c=[];return s.a.each(r,e=>{if(null!==l)for(var t=Math.abs(l.diff(e.date,yc[a]));t>1;)c.push([0]),t-=1;l=e.date;for(var r=[e.total],n=o;n<=i;n+=1)r.push(e.values[n]);c.push(r)}),c}(r,t);break;default:a=function(e,t){var a=t.timeInterval,r=vc(e),n=s.a.min(s.a.map(e,e=>e.stage)),o=Da()(s.a.last(r).date).diff(s.a.first(r).date,yc[a]),i=n+o,l=null,c=[];return s.a.each(r,e=>{if(null!==l)for(var t=Math.abs(l.diff(e.date,yc[a]));t>1;){for(var r=[0],o=n;o<=i;o+=1)r.push(e.values[o]||0);c.push(r),i-=1,t-=1}l=e.date;for(var s=[e.total],u=n;u<=i;u+=1)s.push(e.values[u]||0);i-=1,c.push(s)}),c}(r,t)}return{data:a,initialDate:n}}a(1233),a(1234);var Oc={daily:"days",weekly:"weeks",monthly:"months",yearly:"years"},Ec={daily:"MMMM D, YYYY",weekly:"[Week of] MMM D, YYYY",monthly:"MMMM YYYY",yearly:"YYYY"},_c={initialDate:null,timeInterval:"monthly",noValuePlaceholder:"-",rawNumberOnHover:!0,displayAbsoluteValues:!1,initialIntervalNumber:1,maxColumns:1/0,title:null,timeColumnTitle:"Time",peopleColumnTitle:"People",stageColumnTitle:"{{ @ }}",numberFormat:"0,0[.]00",percentFormat:"0.00%",timeLabelFormat:Ec.monthly,colors:{min:"#ffffff",max:"#041d66",steps:7}};function jc(e){e=gn()(e);return gn.a.contrast(e,"#ffffff")<gn.a.contrast(e,"#000000")}function Sc(e,t){return qi(e.stageColumnTitle,{"@":e.initialIntervalNumber-1+t})}function Cc(e){for(var t=e.options,a=e.maxRowLength,r=[],o=1;o<a;o+=1)r.push(n.a.createElement("th",{key:"col".concat(o),className:"cornelius-stage"},Sc(t,o)));return n.a.createElement("tr",null,n.a.createElement("th",{className:"cornelius-time"},t.timeColumnTitle),n.a.createElement("th",{className:"cornelius-people"},t.peopleColumnTitle),r)}function Pc(e){for(var t=e.options,a=e.data,r=e.index,o=e.maxRowLength,i=a[0]||0,s=[],c=1;c<o;c+=1){var u=a[c],d=Object(l.isFinite)(u/i)?u/i*100:null,m={key:"col".concat(c)};if(Object(l.isNil)(d))m.className="cornelius-empty",m.children=t.noValuePlaceholder;else{m.className=t.displayAbsoluteValues?"cornelius-absolute":"cornelius-percentage",m.children=t.displayAbsoluteValues?t.formatNumber(u):t.formatPercent(d);var p=t.getColorForValue(d);m.style={backgroundColor:p,color:yn(p)},jc(m.style.color)&&(m.className+=" cornelius-white-text"),t.rawNumberOnHover&&!t.displayAbsoluteValues&&(m.children=n.a.createElement(ge.a,{title:t.formatNumber(u),mouseEnterDelay:0,mouseLeaveDelay:0},n.a.createElement("div",null,m.children)))}s.push(n.a.createElement("td",m))}return n.a.createElement("tr",null,n.a.createElement("td",{className:"cornelius-label"},function(e,t){var a=Oc[e.timeInterval];return e.initialDate.clone().add(t,a).format(e.timeLabelFormat)}(t,r)),n.a.createElement("td",{className:"cornelius-people"},t.formatNumber(i)),s)}function xc(e){var t=e.data,a=e.options;a=Object(r.useMemo)(()=>function(e){return e=Object(l.extend)({},_c,e,{initialDate:Da()(e.initialDate),colors:Object(l.extend)({},_c.colors,e.colors)}),Object(l.extend)(e,{timeLabelFormat:Ec[e.timeInterval],formatNumber:Ii(e.numberFormat),formatPercent:Ii(e.percentFormat),getColorForValue:gn.a.scale([e.colors.min,e.colors.max]).mode("hsl").domain([0,100]).classes(e.colors.steps)})}(a),[a]);var o=Object(r.useMemo)(()=>Object(l.min)([Object(l.max)(Object(l.map)(t,e=>e.length))||0,a.maxColumns+1]),[t,a.maxColumns]);return 0===t.length?null:n.a.createElement("div",{className:"cornelius-container"},a.title&&n.a.createElement("div",{className:"cornelius-title"},a.title),n.a.createElement("table",{className:"cornelius-table"},n.a.createElement("thead",null,n.a.createElement(Cc,{options:a,maxRowLength:o})),n.a.createElement("tbody",null,Object(l.map)(t,(e,t)=>n.a.createElement(Pc,{key:"row".concat(t),options:a,data:e,index:t,maxRowLength:o})))))}function Lc(e){var t=e.data,a=e.options,o=Object(r.useMemo)(()=>wc(t,a),[t,a]),i=o.data,l=o.initialDate,s=Object(r.useMemo)(()=>({initialDate:l,timeInterval:a.timeInterval,noValuePlaceholder:a.noValuePlaceholder,rawNumberOnHover:a.showTooltips,displayAbsoluteValues:!a.percentValues,timeColumnTitle:a.timeColumnTitle,peopleColumnTitle:a.peopleColumnTitle,stageColumnTitle:a.stageColumnTitle,numberFormat:a.numberFormat,percentFormat:a.percentFormat,colors:a.colors}),[a,l]);return 0===i.length?null:n.a.createElement("div",{className:"cohort-visualization-container"},n.a.createElement(xc,{data:i,options:s}))}function kc(e){var t=e.options,a=e.data,r=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:"Date (Bucket)","data-test":"Cohort.DateColumn",value:t.dateColumn,onChange:e=>r({dateColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Do.Option,{key:t,"data-test":"Cohort.DateColumn."+t},t)}))),n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:window.W_L.Steps,"data-test":"Cohort.StageColumn",value:t.stageColumn,onChange:e=>r({stageColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Do.Option,{key:t,"data-test":"Cohort.StageColumn."+t},t)}))),n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:"Bucket Population Size","data-test":"Cohort.TotalColumn",value:t.totalColumn,onChange:e=>r({totalColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Do.Option,{key:t,"data-test":"Cohort.TotalColumn."+t},t)}))),n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:window.W_L.Stage_Value,"data-test":"Cohort.ValueColumn",value:t.valueColumn,onChange:e=>r({valueColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Do.Option,{key:t,"data-test":"Cohort.ValueColumn."+t},t)}))))}xc.defaultProps={data:[],options:{}},Lc.propTypes=Gr,kc.propTypes=Jr;var Nc={daily:window.W_L.Daily,weekly:window.W_L.Weekly,monthly:window.W_L.Monthly},Ac={diagonal:window.W_L.Fill_gaps_with_zeros,simple:window.W_L.Show_data_as_is};function Tc(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:window.W_L.Time_Interval,"data-test":"Cohort.TimeInterval",value:t.timeInterval,onChange:e=>a({timeInterval:e})},Object(l.map)(Nc,(e,t)=>n.a.createElement(Do.Option,{key:t,"data-test":"Cohort.TimeInterval."+t},e)))),n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:window.W_L.Mode,"data-test":"Cohort.Mode",value:t.mode,onChange:e=>a({mode:e})},Object(l.map)(Ac,(e,t)=>n.a.createElement(Do.Option,{key:t,"data-test":"Cohort.Mode."+t},e)))))}function Wc(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ic(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Tc.propTypes=Jr;var qc=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Wc(Object(a),!0).forEach((function(t){Ic(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Wc(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({White:"#FFFFFF"},gi);function Dc(e){return e=Object(l.isFinite)(e)?e:parseInt(e,10),e=Object(l.isFinite)(e)?e:0,Math.max(3,Math.min(e,20))}function Rc(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.min_color,presetColors:qc,interactive:!0,color:t.colors.min,onChange:e=>a({colors:{min:e}}),addonAfter:n.a.createElement(zo.Label,{color:t.colors.min,presetColors:qc})})),n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.max_color,presetColors:qc,interactive:!0,color:t.colors.max,onChange:e=>a({colors:{max:e}}),addonAfter:n.a.createElement(zo.Label,{color:t.colors.max,presetColors:qc})})),n.a.createElement(Oo,null,n.a.createElement(Mo,{layout:"horizontal",label:window.W_L.Steps,min:3,max:20,value:t.colors.steps,onChange:e=>a({colors:{steps:Dc(e)}})})))}function Mc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return zc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return zc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Fc(e){var t=e.options,a=e.onOptionsChange,r=Mc(Object(Ml.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:window.W_L.Time_Column_Title,defaultValue:t.timeColumnTitle,onChange:e=>r({timeColumnTitle:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:window.W_L.People_Column_Title,defaultValue:t.peopleColumnTitle,onChange:e=>r({peopleColumnTitle:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.Stage_Column_Title,n.a.createElement(qo,{placement:"topRight",arrowPointAtCenter:!0},n.a.createElement("div",null,"Use ",n.a.createElement("code",null,"{{ @ }}")," to insert a stage number"))),defaultValue:t.stageColumnTitle,onChange:e=>r({stageColumnTitle:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.Number_format,n.a.createElement(qo.NumberFormatSpecs,null)),defaultValue:t.numberFormat,onChange:e=>r({numberFormat:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.Percent_Values_Format,n.a.createElement(qo.NumberFormatSpecs,null)),defaultValue:t.percentFormat,onChange:e=>r({percentFormat:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:window.W_L.No_Value_Placeholder,defaultValue:t.noValuePlaceholder,onChange:e=>r({noValuePlaceholder:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(dn.a,{defaultChecked:t.showTooltips,onChange:e=>a({showTooltips:e.target.checked})},window.W_L.Show_Tooltips)),n.a.createElement(Oo,null,n.a.createElement(dn.a,{defaultChecked:t.percentValues,onChange:e=>a({percentValues:e.target.checked})},window.W_L.Normalize_values_to_percentage)))}Rc.propTypes=Jr,Fc.propTypes=Jr;var Vc={type:"COHORT",name:"同期群分析(Cohort)",getOptions:function(e){return Object(l.merge)({},gc,e)},Renderer:Lc,Editor:go([{key:"Columns",title:"列",component:kc},{key:"Options",title:"选项",component:Tc},{key:"Colors",title:"颜色",component:Rc},{key:"Appearance",title:"外观",component:Fc}]),autoHeight:!0,defaultRows:8};function Uc(e,t){if(0===(e=parseInt(e,10)||0))return e;var a=(Math.abs(e)-1)%t;return e>0?a:t-a-1}function Bc(e,t){var a=t.stringPrefix,r=t.stringSuffix,n=t.stringDecimal,o=t.stringDecChar,i=t.stringThouSep;return Object(l.isNumber)(e)?(e=function(e,t,a,r){var n=Ni.a.localeData(),o=n.delimiters;n.delimiters={thousands:",",decimal:"."};var i="0,0.000";if((Number.isFinite(t)&&t>=0||a||r)&&(n.delimiters={thousands:r,decimal:a||"."},i="0,0",t>0))for(i+=".";t>0;)i+="0",t-=1;var l=Ni()(e).format(i);return n.delimiters=o,l}(e,n,o,i),Object(l.toString)(a)+e+Object(l.toString)(r)):Object(l.toString)(e)}function Hc(e,t){return Object(l.isNumber)(e)?Ni()(e).format(t):Object(l.toString)(e)}a(1235);function Yc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Qc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Kc(e){return{msTransform:"scale(".concat(e,")"),MozTransform:"scale(".concat(e,")"),WebkitTransform:"scale(".concat(e,")"),transform:"scale(".concat(e,")")}}function $c(e){var t=e.firstChild,a=Math.min(e.offsetWidth/t.offsetWidth,e.offsetHeight/t.offsetHeight);return Number(Object(l.isFinite)(a)?a:1).toFixed(2)}function Gc(e){var t=e.data,a=e.options,o=e.visualizationName,i=Yc(Object(r.useState)("1.00"),2),s=i[0],c=i[1],u=Yc(Object(r.useState)(null),2),d=u[0],m=u[1];Object(r.useEffect)(()=>{if(d)return Yr(d,()=>{c($c(d))})},[d]),Object(r.useEffect)(()=>{d&&c($c(d))},[t,a,d]);var p=function(e,t,a){var r={},n=e.length;if(n>0||t.countRow){var o=t.counterColName,i=t.targetColName;if(r.counterLabel=t.counterLabel||a,t.countRow)r.counterValue=n;else if(o){var s=Uc(t.rowNumber,n);r.counterValue=e[s][o]}if(r.showTrend=!1,i){var c=Uc(t.targetRowNumber,n);if(r.targetValue=e[c][i],Number.isFinite(r.counterValue)&&Object(l.isFinite)(r.targetValue)){var u=r.counterValue-r.targetValue;r.showTrend=!0,r.trendPositive=u>=0}}else r.targetValue=null;r.counterValueTooltip=Hc(r.counterValue,t.tooltipFormat),r.targetValueTooltip=Hc(r.targetValue,t.tooltipFormat),r.counterValue=Bc(r.counterValue,t),t.formatTargetValue?r.targetValue=Bc(r.targetValue,t):Object(l.isFinite)(r.targetValue)&&(r.targetValue=Ni()(r.targetValue).format("0[.]00[0]"))}return r}(t.rows,a,o),f=p.showTrend,b=p.trendPositive,h=p.counterValue,g=p.counterValueTooltip,y=p.targetValue,v=p.targetValueTooltip,w=p.counterLabel;return n.a.createElement("div",{className:me()("counter-visualization-container",{"trend-positive":f&&b,"trend-negative":f&&!b})},n.a.createElement("div",{className:"counter-visualization-content",ref:m},n.a.createElement("div",{style:Kc(s)},n.a.createElement("div",{className:"counter-visualization-value",title:g},h),y&&n.a.createElement("div",{className:"counter-visualization-target",title:v},"(",y,")"),n.a.createElement("div",{className:"counter-visualization-label"},w))))}function Jc(e){var t=e.options,a=e.data,r=e.visualizationName,o=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:"Counter Label","data-test":"Counter.General.Label",defaultValue:t.counterLabel,placeholder:r,onChange:e=>o({counterLabel:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:"Counter Value Column Name","data-test":"Counter.General.ValueColumn",defaultValue:t.counterColName,disabled:t.countRow,onChange:e=>o({counterColName:e})},Object(l.map)(a.columns,e=>n.a.createElement(Do.Option,{key:e.name,"data-test":"Counter.General.ValueColumn."+e.name},e.name)))),n.a.createElement(Oo,null,n.a.createElement(Mo,{layout:"horizontal",label:"Counter Value Row Number","data-test":"Counter.General.ValueRowNumber",defaultValue:t.rowNumber,disabled:t.countRow,onChange:e=>o({rowNumber:e})})),n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:"Target Value Column Name","data-test":"Counter.General.TargetValueColumn",defaultValue:t.targetColName,onChange:e=>o({targetColName:e})},n.a.createElement(Do.Option,{value:""},"No target value"),Object(l.map)(a.columns,e=>n.a.createElement(Do.Option,{key:e.name,"data-test":"Counter.General.TargetValueColumn."+e.name},e.name)))),n.a.createElement(Oo,null,n.a.createElement(Mo,{layout:"horizontal",label:"Target Value Row Number","data-test":"Counter.General.TargetValueRowNumber",defaultValue:t.targetRowNumber,onChange:e=>o({targetRowNumber:e})})),n.a.createElement(Oo,null,n.a.createElement(Co,{"data-test":"Counter.General.CountRows",defaultChecked:t.countRow,onChange:e=>o({countRow:e})},"Count Rows")))}function Xc(e){var t=e.options,a=e.data,r=e.onOptionsChange,o=function(e,t){if(t.countRow)return!0;var a=e.length;if(a>0){var r=Uc(t.rowNumber,a),n=t.counterColName;if(n)return Object(l.isNumber)(e[r][n])}return!1}(a.rows,t);return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Mo,{layout:"horizontal",label:"Formatting Decimal Place","data-test":"Counter.Formatting.DecimalPlace",defaultValue:t.stringDecimal,disabled:!o,onChange:e=>r({stringDecimal:e})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:"Formatting Decimal Character","data-test":"Counter.Formatting.DecimalCharacter",defaultValue:t.stringDecChar,disabled:!o,onChange:e=>r({stringDecChar:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:"Formatting Thousands Separator","data-test":"Counter.Formatting.ThousandsSeparator",defaultValue:t.stringThouSep,disabled:!o,onChange:e=>r({stringThouSep:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:"Formatting String Prefix","data-test":"Counter.Formatting.StringPrefix",defaultValue:t.stringPrefix,disabled:!o,onChange:e=>r({stringPrefix:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:"Formatting String Suffix","data-test":"Counter.Formatting.StringSuffix",defaultValue:t.stringSuffix,disabled:!o,onChange:e=>r({stringSuffix:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Co,{"data-test":"Counter.Formatting.FormatTargetValue",defaultChecked:t.formatTargetValue,onChange:e=>r({formatTargetValue:e})},"Format Target Value")))}Gc.propTypes=Gr,Jc.propTypes=Jr,Xc.propTypes=Jr;var Zc=go([{key:"General",title:"通用",component:Jc},{key:"Format",title:"格式化",component:Xc}]);function eu(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function tu(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?eu(Object(a),!0).forEach((function(t){au(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):eu(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function au(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ru={counterLabel:"",counterColName:"counter",rowNumber:1,targetRowNumber:1,stringDecimal:0,stringDecChar:".",stringThouSep:",",tooltipFormat:"0,0.000"},nu={type:"COUNTER",name:"计数器(Counter)",getOptions:e=>tu(tu({},ru),e),Renderer:Gc,Editor:Zc,defaultColumns:2,defaultRows:5},ou=a(173),iu=a.n(ou),lu=a(194),su=a.n(lu);a(1236);function cu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return uu(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return uu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uu(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function du(e){var t=e.data,a=cu(Object(r.useState)(0),2),o=a[0],i=a[1];if(!t||!t.rows||0===t.rows.length)return null;var s=Object(l.mapValues)(Object(l.keyBy)(t.columns,"name"),"type"),c=t.columns.map(e=>e.name),u=t.rows[o];return n.a.createElement("div",{className:"details-viz"},n.a.createElement(iu.a,{size:"small",column:1,bordered:!0},Object(l.map)(c,e=>{return n.a.createElement(iu.a.Item,{key:e,label:e},(t=u[e],a=s[e],r={date:To.dateFormat,datetime:To.dateTimeFormat},"date"!==a&&"datetime"!==a||!Da.a.isMoment(t)?""+t:t.format(r[a])));var t,a,r})),t.rows.length>1&&n.a.createElement("div",{className:"paginator-container"},n.a.createElement(su.a,{showSizeChanger:!1,current:o+1,defaultPageSize:1,total:t.rows.length,onChange:e=>i(e-1)})))}function mu(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function pu(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?mu(Object(a),!0).forEach((function(t){fu(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mu(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function fu(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}du.propTypes=Gr;var bu={},hu={type:"DETAILS",name:"<记录明细显示>",getOptions:e=>pu(pu({},bu),e),Renderer:du,defaultColumns:2,defaultRows:2},gu={stepCol:{colName:null,displayAs:"Steps"},valueCol:{colName:null,displayAs:"Value"},autoSort:!0,sortKeyCol:{colName:null,reverse:!1},itemsLimit:100,percentValuesRange:{min:.01,max:1e3},numberFormat:"0,0[.]00",percentFormat:"0[.]00%"};function yu(e){if(Da.a.isMoment(e)){var t=To.dateTimeFormat||"DD/MM/YYYY HH:mm";return e.format(t)}return Object(l.toString)(e)}a(1240);function vu(e){var t=e.color,a=e.value,r=e.align,o=e.className,i=e.children;return n.a.createElement("div",{className:me()("funnel-bar","funnel-bar-".concat(r),o)},n.a.createElement("div",{className:"funnel-bar-value",style:{backgroundColor:t,width:a+"%"}}),n.a.createElement("div",{className:"funnel-bar-label"},i))}vu.defaultProps={color:"#dadada",value:0,align:"left",className:null,children:null};a(1241);function wu(e){var t=e.data,a=e.options,o=Object(r.useMemo)(()=>function(e,t){if(0===e.length||!t.stepCol.colName||!t.valueCol.colName)return[];e=[...e],t.sortKeyCol.colName&&(e=Object(l.sortBy)(e,t.sortKeyCol.colName)),t.sortKeyCol.reverse&&(e=e.reverse());var a=Object(l.map)(e,e=>({step:yu(e[t.stepCol.colName]),value:parseFloat(e[t.valueCol.colName])||0})),r=Object(l.maxBy)(a,e=>e.value).value;return a.forEach((e,t)=>{e.pctMax=e.value/r*100,e.pctPrevious=0===t||e.value===a[t-1].value?100:e.value/a[t-1].value*100}),a.slice(0,t.itemsLimit)}(t.rows,a),[t,a]),i=Object(r.useMemo)(()=>Math.trunc(Math.random()*Number.MAX_SAFE_INTEGER).toString(36)+":",[o]),s=Object(r.useMemo)(()=>Ii(a.numberFormat),[a.numberFormat]),c=Object(r.useMemo)(()=>{var e=Ii(a.percentFormat);return t=>t<a.percentValuesRange.min?"<".concat(e(a.percentValuesRange.min)):t>a.percentValuesRange.max?">".concat(e(a.percentValuesRange.max)):e(t)},[a.percentFormat,a.percentValuesRange]),u=Object(r.useMemo)(()=>{if(0===o.length)return[];var e=Object(l.maxBy)(o,e=>isFinite(e.pctPrevious)?e.pctPrevious:0).pctPrevious;return[{title:a.stepCol.displayAs,dataIndex:"step",width:"25%",className:"text-ellipsis",render:e=>n.a.createElement(ge.a,{title:e,mouseEnterDelay:0,mouseLeaveDelay:0},e)},{title:a.valueCol.displayAs,dataIndex:"value",width:"45%",align:"center",render:(e,t)=>n.a.createElement(vu,{align:"center",color:gi.Cyan,value:t.pctMax},s(e))},{title:"% Max",dataIndex:"pctMax",width:"15%",align:"center",render:e=>c(e)},{title:"% Previous",dataIndex:"pctPrevious",width:"15%",align:"center",render:t=>n.a.createElement(vu,{className:"funnel-percent-column",value:t/e*100},c(t))}]},[a.stepCol.displayAs,a.valueCol.displayAs,o,s,c]);return 0===o.length?null:n.a.createElement("div",{className:"funnel-visualization-container"},n.a.createElement($l.a,{columns:u,dataSource:o,rowKey:(e,t)=>i+t,pagination:!1}))}function Ou(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Eu(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Eu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Eu(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _u(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>Object(l.map)(a.columns,e=>e.name),[a]),s=Ou(Object(Ml.a)(o,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:"Step Column","data-test":"Funnel.StepColumn",placeholder:"Choose column...",defaultValue:t.stepCol.colName||void 0,onChange:e=>o({stepCol:{colName:e||null}})},Object(l.map)(i,e=>n.a.createElement(Do.Option,{key:e,"data-test":"Funnel.StepColumn.".concat(e)},e)))),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:"Step Column Title","data-test":"Funnel.StepColumnTitle",defaultValue:t.stepCol.displayAs,onChange:e=>s({stepCol:{displayAs:e.target.value}})})),n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:"Value Column","data-test":"Funnel.ValueColumn",placeholder:"Choose column...",defaultValue:t.valueCol.colName||void 0,onChange:e=>o({valueCol:{colName:e||null}})},Object(l.map)(i,e=>n.a.createElement(Do.Option,{key:e,"data-test":"Funnel.ValueColumn.".concat(e)},e)))),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:"Value Column Title","data-test":"Funnel.ValueColumnTitle",defaultValue:t.valueCol.displayAs,onChange:e=>s({valueCol:{displayAs:e.target.value}})})),n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Funnel.CustomSort",checked:!t.autoSort,onChange:e=>o({autoSort:!e.target.checked})},"Custom Sorting")),!t.autoSort&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:"Sort Column","data-test":"Funnel.SortColumn",allowClear:!0,placeholder:"Choose column...",defaultValue:t.sortKeyCol.colName||void 0,onChange:e=>o({sortKeyCol:{colName:e||null}})},Object(l.map)(i,e=>n.a.createElement(Do.Option,{key:e,"data-test":"Funnel.SortColumn.".concat(e)},e)))),n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:"Sort Order","data-test":"Funnel.SortDirection",disabled:!t.sortKeyCol.colName,defaultValue:t.sortKeyCol.reverse?"desc":"asc",onChange:e=>o({sortKeyCol:{reverse:"desc"===e}})},n.a.createElement(Do.Option,{value:"asc","data-test":"Funnel.SortDirection.Ascending"},"ascending"),n.a.createElement(Do.Option,{value:"desc","data-test":"Funnel.SortDirection.Descending"},"descending")))))}function ju(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Su(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Su(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Su(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Cu(e){var t=e.options,a=e.onOptionsChange,r=ju(Object(Ml.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.Number_format,n.a.createElement(qo.NumberFormatSpecs,null)),"data-test":"Funnel.NumberFormat",defaultValue:t.numberFormat,onChange:e=>r({numberFormat:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.Percent_Values_Format,n.a.createElement(qo.NumberFormatSpecs,null)),"data-test":"Funnel.PercentFormat",defaultValue:t.percentFormat,onChange:e=>r({percentFormat:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Mo,{layout:"horizontal",label:window.W_L.Items_Count_Limit,"data-test":"Funnel.ItemsLimit",min:2,defaultValue:t.itemsLimit,onChange:e=>r({itemsLimit:e})})),n.a.createElement(Oo,null,n.a.createElement(Mo,{layout:"horizontal",label:window.W_L.Min_Percent_Value,"data-test":"Funnel.PercentRangeMin",min:0,defaultValue:t.percentValuesRange.min,onChange:e=>r({percentValuesRange:{min:e}})})),n.a.createElement(Oo,null,n.a.createElement(Mo,{layout:"horizontal",label:window.W_L.Max_Percent_Value,"data-test":"Funnel.PercentRangeMax",min:0,defaultValue:t.percentValuesRange.max,onChange:e=>r({percentValuesRange:{max:e}})})))}wu.propTypes=Gr,_u.propTypes=Jr,Cu.propTypes=Jr;var Pu={type:"FUNNEL",name:"漏斗分析(Funnel)",getOptions:function(e,t){var a=t.columns;e=Object(l.merge)({},gu,e);var r=Object(l.map)(a,e=>e.name);return Object(l.includes)(r,e.stepCol.colName)||(e.stepCol.colName=null),Object(l.includes)(r,e.valueCol.colName)||(e.valueCol.colName=null),Object(l.includes)(r,e.sortKeyCol.colName)||(e.sortKeyCol.colName=null),Object(l.isFinite)(e.itemsLimit)||(e.itemsLimit=gu.itemsLimit),e.itemsLimit<2&&(e.itemsLimit=2),e.autoSort&&(e.sortKeyCol.colName=e.valueCol.colName,e.sortKeyCol.reverse=!0),e},Renderer:wu,Editor:go([{key:"General",title:"通用",component:_u},{key:"Appearance",title:"外观",component:Cu}]),defaultRows:10},xu={latColName:"lat",lonColName:"lon",classify:null,groups:{},mapTileUrl:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",clusterMarkers:!0,customizeMarkers:!1,iconShape:"marker",iconFont:"circle",foregroundColor:"#ffffff",backgroundColor:"#356AFF",borderColor:"#356AFF",bounds:null,tooltip:{enabled:!1,template:""},popup:{enabled:!0,template:""}};function Lu(e,t){var a=Ur.a.scale.category10(),r=t.classify,n=t.latColName,o=t.lonColName,i=r?Object(l.groupBy)(e.rows,r):{All:e.rows};return Object(l.filter)(Object(l.map)(i,(e,r)=>{var i=Object(l.filter)(Object(l.map)(e,e=>{var t=e[n],a=e[o];return Object(l.isNil)(t)||Object(l.isNil)(a)?null:{lat:t,lon:a,row:Object(l.omit)(e,[n,o])}}));if(0===i.length)return null;var s=Object(l.extend)({},t.groups[r],{name:r,points:i});return Object(l.isNil)(s.color)&&(s.color=a(r)),s}))}a(1242),a(1243),a(1244),a(1245),a(1246);var ku=a(669),Nu=a.n(ku),Au=a(670),Tu=a.n(Au),Wu=a(671),Iu=a.n(Wu);Ms.a.Icon.Default.mergeOptions({iconUrl:Nu.a,iconRetinaUrl:Tu.a,shadowUrl:Iu.a}),delete Ms.a.Icon.Default.prototype._getIconUrl;var qu={marker:[14,32],circle:[10,10],rectangle:[11,11],"circle-dot":[1,2],"rectangle-dot":[1,2],doughnut:[8,8]},Du={rectangle:[0,-3],circle:[1,-3]};function Ru(e,t){var a=t.color,r=t.points,n=e.classify,o=e.clusterMarkers,i=e.customizeMarkers,s=o?function(e){return Ms.a.markerClusterGroup({iconCreateFunction:t=>Ms.a.markerClusterIcon({color:e,html:t.getChildCount()})})}(a):Ms.a.featureGroup();return Object(l.each)(r,t=>{var r,o=t.lat,c=t.lon,u=t.row,d=Object(l.clone)(u);d[e.latColName]=o,d[e.lonColName]=c,r=n?((e,t,a)=>Ms.a.circleMarker([e,t],{fillColor:a,fillOpacity:.9,stroke:!1}))(o,c,a):i?function(e,t,a){var r=a.iconShape,n=a.iconFont,o=a.foregroundColor,i=a.backgroundColor,l=a.borderColor,s=Ms.a.BeautifyIcon.icon({iconShape:r,icon:n,iconSize:"rectangle"===r&&[22,22],iconAnchor:qu[r],popupAnchor:Du[r],prefix:"fa",textColor:o,backgroundColor:i,borderColor:l});return Ms.a.marker([e,t],{icon:s})}(o,c,e):Ms.a.marker([o,c]),e.tooltip.enabled&&(""!==e.tooltip.template?r.bindTooltip(ke(qi(e.tooltip.template,d))):r.bindTooltip("\n          <strong>".concat(o,", ").concat(c,"</strong>\n        "))),e.popup.enabled&&(""!==e.popup.template?r.bindPopup(ke(qi(e.popup.template,d))):r.bindPopup('\n          <ul style="list-style-type: none; padding-left: 0">\n            <li><strong>'.concat(o,", ").concat(c,"</strong>\n            ").concat(Object(l.map)(u,(e,t)=>"<li>".concat(t,": ").concat(e,"</li>")).join(""),"\n          </ul>\n        "))),s.addLayer(r)}),s}function Mu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return zu(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return zu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zu(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Fu(e){var t,a,o,i,s=e.data,c=e.options,u=e.onOptionsChange,d=Mu(Object(r.useState)(null),2),m=d[0],p=d[1],f=(t=()=>Object(l.omit)(c,["bounds"]),a=[c],o=Object(r.useRef)(),i=Object(r.useMemo)(t,a),Object(l.isEqual)(i,o.current)||(o.current=i),o.current),b=Object(r.useMemo)(()=>Lu(s,f),[s,f]),h=Mu(Object(r.useState)(null),2),g=h[0],y=h[1];return Object(r.useEffect)(()=>{if(m){var e=function(e){var t=Ms.a.map(e,{center:[0,0],zoom:1,scrollWheelZoom:!1,fullscreenControl:!0}),a=Ms.a.tileLayer("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t),r=Ms.a.featureGroup().addTo(t),n=Ms.a.control.layers().addTo(t),o=()=>{},i=!1,s=()=>{o(t.getBounds())};t.on("focus",()=>{i=!0,t.on("moveend",s)}),t.on("blur",()=>{t.off("moveend",s),i=!1});var c=Yr(e,()=>{t.invalidateSize(!1)});return{get onBoundsChange(){return o},set onBoundsChange(e){o=Object(l.isFunction)(e)?e:()=>{}},updateLayers:function(e,o){a.setUrl(o.mapTileUrl),r.eachLayer(e=>{r.removeLayer(e),n.removeLayer(e)}),Object(l.each)(e,e=>{var t=Ru(o,e);r.addLayer(t),n.addOverlay(t,e.name)}),e.length>0?n.addTo(t):n.remove()},updateBounds:function(e){i||(e=e?Ms.a.latLngBounds([e._southWest.lat,e._southWest.lng],[e._northEast.lat,e._northEast.lng]):r.getBounds()).isValid()&&t.fitBounds(e,{animate:!1,duration:0})},destroy(){c(),t.remove()}}}(m);return y(e),()=>{e.destroy()}}},[m]),Object(r.useEffect)(()=>{g&&g.updateLayers(b,f)},[g,b,f]),Object(r.useEffect)(()=>{g&&g.updateBounds(c.bounds)},[g,c.bounds]),Object(r.useEffect)(()=>{g&&u&&(g.onBoundsChange=e=>{u(Object(l.merge)({},c,{bounds:e}))})},[g,c,u]),n.a.createElement("div",{className:"map-visualization-container",ref:p})}function Vu(e,t){return Object(l.filter)([e,...t],e=>!Object(l.isNil)(e))}function Uu(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>Object(l.difference)(Object(l.map)(a.columns,e=>e.name),[t.latColName,t.lonColName,t.classify]),[a,t.latColName,t.lonColName,t.classify]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.Latitude_Column_Name,"data-test":"Map.Editor.LatitudeColumnName",value:t.latColName,onChange:e=>o({latColName:e})},Object(l.map)(Vu(t.latColName,i),e=>n.a.createElement(Do.Option,{key:e,"data-test":"Map.Editor.LatitudeColumnName."+e},e)))),n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.Longitude_Column_Name,"data-test":"Map.Editor.LongitudeColumnName",value:t.lonColName,onChange:e=>o({lonColName:e})},Object(l.map)(Vu(t.lonColName,i),e=>n.a.createElement(Do.Option,{key:e,"data-test":"Map.Editor.LongitudeColumnName."+e},e)))),n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.group_by,"data-test":"Map.Editor.GroupBy",allowClear:!0,placeholder:"none",value:t.classify||void 0,onChange:e=>o({classify:e||null})},Object(l.map)(Vu(t.classify,i),e=>n.a.createElement(Do.Option,{key:e,"data-test":"Map.Editor.GroupBy."+e},e)))))}function Bu(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Hu(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Yu(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>Object(l.map)(Lu(a,t),e=>{var a=e.name;return{name:a,color:(t.groups[a]||{}).color||null}}),[a,t]),s=Object(r.useMemo)(()=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Bu(Object(a),!0).forEach((function(t){Hu(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Bu(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({Automatic:null},gi),[]),c=Object(r.useCallback)((e,t,a)=>{o({groups:{[e]:{[t]:a}}})},[o]),u=[{title:"Group",dataIndex:"name"},{title:"Color",dataIndex:"color",width:"1%",render:(e,t)=>n.a.createElement(Vn,{interactive:!0,presetColors:s,placement:"topRight",color:t.color,triggerProps:{"data-test":"Map.Editor.Groups.".concat(t.name,".Color")},onChange:e=>c(t.name,"color",e),addonAfter:n.a.createElement(Vn.Label,{color:t.color,presetColors:s})})}];return n.a.createElement($l.a,{columns:u,dataSource:i,rowKey:"name",showHeader:!1,pagination:!1})}function Qu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ku(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ku(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ku(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function $u(){return n.a.createElement(qo,{placement:"topLeft",arrowPointAtCenter:!0},n.a.createElement("div",{style:{paddingBottom:5}},window.W_L.Also_all_query_result_columns_can_be_referenced," ",n.a.createElement("code",null,"{{ column_name }}")," syntax."),n.a.createElement("div",{style:{paddingBottom:5}},window.W_L.Leave_empty_to_use_default_value))}function Gu(e){var t=e.options,a=e.onOptionsChange,r=Qu(Object(Ml.a)(a,200),1)[0],o=n.a.createElement($u,null);return n.a.createElement("div",{className:"map-visualization-editor-format-settings"},n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Map.Editor.TooltipEnabled",checked:t.tooltip.enabled,onChange:e=>a({tooltip:{enabled:e.target.checked}})},window.W_L.Show_tooltip)),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Tooltip_template," ",o),"data-test":"Map.Editor.TooltipTemplate",disabled:!t.tooltip.enabled,placeholder:window.W_L.default_template,defaultValue:t.tooltip.template,onChange:e=>r({tooltip:{template:e.target.value}})})),n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Map.Editor.PopupEnabled",checked:t.popup.enabled,onChange:e=>a({popup:{enabled:e.target.checked}})},window.W_L.Show_popup)),n.a.createElement(Oo,null,n.a.createElement(Lo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Popup_template," ",o),"data-test":"Map.Editor.PopupTemplate",disabled:!t.popup.enabled,rows:4,placeholder:window.W_L.default_template,defaultValue:t.popup.template,onChange:e=>r({popup:{template:e.target.value}})})))}function Ju(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Xu(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Xu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xu(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Zu(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ed(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Ms.a.MarkerClusterIcon=Ms.a.DivIcon.extend({options:{color:null,className:"marker-cluster",iconSize:new Ms.a.Point(40,40)},createIcon(){for(var e=gn()(this.options.color),t=yn(e),a=e.alpha(.4).css(),r=e.alpha(.8).css(),n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];var s=Ms.a.DivIcon.prototype.createIcon.call(this,...o);return s.innerHTML='\n      <div style="background: '.concat(r,'">\n        <span style="color: ').concat(t,'">').concat(Object(l.toString)(this.options.html),"</span>\n      </div>\n    "),s.style.background=a,s}}),Ms.a.markerClusterIcon=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return new Ms.a.MarkerClusterIcon(...t)},Fu.propTypes=Gr,Uu.propTypes=Jr,Yu.propTypes=Jr,Gu.propTypes=Jr;var td=[{name:"OpenStreetMap",url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"},{name:"OpenStreetMap BW",url:"//{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png"},{name:"OpenStreetMap DE",url:"//{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png"},{name:"OpenStreetMap FR",url:"//{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png"},{name:"OpenStreetMap Hot",url:"//{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"},{name:"Thunderforest",url:"//{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png"},{name:"Thunderforest Spinal",url:"//{s}.tile.thunderforest.com/spinal-map/{z}/{x}/{y}.png"},{name:"OpenMapSurfer",url:"//korona.geog.uni-heidelberg.de/tiles/roads/x={x}&y={y}&z={z}"},{name:"Stamen Toner",url:"//stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.png"},{name:"Stamen Toner Background",url:"//stamen-tiles-{s}.a.ssl.fastly.net/toner-background/{z}/{x}/{y}.png"},{name:"Stamen Toner Lite",url:"//stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png"},{name:"OpenTopoMap",url:"//{s}.tile.opentopomap.org/{z}/{x}/{y}.png"}],ad=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Zu(Object(a),!0).forEach((function(t){ed(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Zu(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({White:"#ffffff"},gi);function rd(e){var t=e.options,a=e.onOptionsChange,o=Ju(Object(Ml.a)(a,200),1)[0],i=Object(r.useMemo)(()=>function(e){switch(e){case"doughnut":return{showIcon:!1,showBackgroundColor:!0,showBorderColor:!0};case"circle-dot":case"rectangle-dot":return{showIcon:!1,showBackgroundColor:!1,showBorderColor:!0};default:return{showIcon:!0,showBackgroundColor:!0,showBorderColor:!0}}}(t.iconShape),[t.iconShape]),s=i.showIcon,c=i.showBackgroundColor,u=i.showBorderColor,d=Object(l.isNil)(t.classify);return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.Map_Tiles,"data-test":"Map.Editor.Tiles",value:t.mapTileUrl,onChange:e=>a({mapTileUrl:e})},Object(l.map)(td,e=>{var t=e.name,a=e.url;return n.a.createElement(Do.Option,{key:a,"data-test":"Map.Editor.Tiles."+t},t)}))),n.a.createElement(Oo.Title,null,window.W_L.Markers),n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Map.Editor.ClusterMarkers",defaultChecked:t.clusterMarkers,onChange:e=>a({clusterMarkers:e.target.checked})},window.W_L.Cluster_Markers)),n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Map.Editor.CustomizeMarkers",disabled:!d,defaultChecked:t.customizeMarkers,onChange:e=>a({customizeMarkers:e.target.checked})},window.W_L.Override_default_style),!d&&n.a.createElement(qo,{placement:"topLeft",arrowPointAtCenter:!0},"Custom marker styles are not available",n.a.createElement("br",null),"when ",n.a.createElement("b",null,"Group By")," column selected.")),d&&t.customizeMarkers&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{layout:"horizontal",label:window.W_L.Shape,"data-test":"Map.Editor.MarkerShape",value:t.iconShape,onChange:e=>a({iconShape:e})},n.a.createElement(Do.Option,{key:"marker","data-test":"Map.Editor.MarkerShape.marker"},window.W_L.Markers," + ",window.W_L.icon),n.a.createElement(Do.Option,{key:"doughnut","data-test":"Map.Editor.MarkerShape.doughnut"},window.W_L.Circle),n.a.createElement(Do.Option,{key:"circle-dot","data-test":"Map.Editor.MarkerShape.circle-dot"},window.W_L.Circle_Dot),n.a.createElement(Do.Option,{key:"circle","data-test":"Map.Editor.MarkerShape.circle"},window.W_L.Circle," + ",window.W_L.icon),n.a.createElement(Do.Option,{key:"rectangle-dot","data-test":"Map.Editor.MarkerShape.rectangle-dot"},window.W_L.Square_Dot),n.a.createElement(Do.Option,{key:"rectangle","data-test":"Map.Editor.MarkerShape.rectangle"},window.W_L.Square," + ",window.W_L.icon))),s&&n.a.createElement(Oo,null,n.a.createElement(Ro,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.icon,n.a.createElement(qo,{placement:"topLeft",arrowPointAtCenter:!0},n.a.createElement("div",{style:{marginBottom:5}},window.W_L.Enter_an_icon_name_from," ",n.a.createElement("a",{href:"https://fontawesome.com/v4.7.0/icons/",target:"_blank",rel:"noopener noreferrer"},"Font-Awesome 4.7")),n.a.createElement("div",{style:{marginBottom:5}},window.W_L.Examples,"：",n.a.createElement("code",null,"check"),", ",n.a.createElement("code",null,"times-circle"),", ",n.a.createElement("code",null,"flag")),n.a.createElement("div",null,window.W_L.Leave_blank_to_remove))),"data-test":"Map.Editor.MarkerIcon",defaultValue:t.iconFont,onChange:e=>o({iconFont:e.target.value})})),s&&n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.Icon_Color,interactive:!0,presetColors:ad,placement:"topRight",color:t.foregroundColor,triggerProps:{"data-test":"Map.Editor.MarkerIconColor"},onChange:e=>a({foregroundColor:e}),addonAfter:n.a.createElement(zo.Label,{color:t.foregroundColor,presetColors:ad})})),c&&n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.Background_Color,interactive:!0,presetColors:ad,placement:"topRight",color:t.backgroundColor,triggerProps:{"data-test":"Map.Editor.MarkerBackgroundColor"},onChange:e=>a({backgroundColor:e}),addonAfter:n.a.createElement(zo.Label,{color:t.backgroundColor,presetColors:ad})})),u&&n.a.createElement(Oo,null,n.a.createElement(zo,{layout:"horizontal",label:window.W_L.Borders_Color,interactive:!0,presetColors:ad,placement:"topRight",color:t.borderColor,triggerProps:{"data-test":"Map.Editor.MarkerBorderColor"},onChange:e=>a({borderColor:e}),addonAfter:n.a.createElement(zo.Label,{color:t.borderColor,presetColors:ad})}))))}rd.propTypes=Jr;var nd={type:"MAP",name:"地理标记(Map Markers)",getOptions:function(e){return(e=Object(l.merge)({},xu,e)).mapTileUrl=e.mapTileUrl||xu.mapTileUrl,"none"===e.classify&&(e.classify=null),e},Renderer:Fu,Editor:go([{key:"General",title:"通用",component:Uu},{key:"Groups",title:"角色",component:Yu},{key:"Format",title:"格式化",component:Gu},{key:"Style",title:"样式",component:rd}]),defaultColumns:3,defaultRows:8,minColumns:2},od=a(672),id=a.n(od);function ld(e){if(!e)return"";var t=Da()(e);return t.isValid()?t.format(To.dateTimeFormat):"-"}function sd(e){if(!e)return"";var t=Da()(e);return t.isValid()?t.format(To.dateFormat):"-"}a(1254),a(1255);function cd(){return(cd=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ud(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function dd(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ud(Object(a),!0).forEach((function(t){md(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ud(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function md(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function pd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fd(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fd(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var bd=["rows","cols","vals","aggregatorName","valueFilter","sorters","rowOrder","colOrder","derivedAttributes","rendererName","hiddenAttributes","hiddenFromAggregators","hiddenFromDragDrop","menuLimit","unusedOrientationCutoff","controls","rendererOptions"];function hd(e){var t=e.rows,a=e.columns;return Object(l.map)(t,e=>Object(l.mapValues)(e,(e,t)=>function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Da.a.isMoment(e)?"date"===t?sd(e):ld(e):"boolean"==typeof e?e.toString():e}(e,Object(l.find)(a,{name:t}).type)))}function gd(e){var t=e.data,a=e.options,o=e.onOptionsChange,i=pd(Object(r.useState)(dd({},a)),2),s=i[0],c=i[1],u=Object(r.useMemo)(()=>hd(t),[t]);Object(r.useEffect)(()=>{c(dd({},a))},[a]);var d=Object(l.get)(a,"controls.enabled"),m=!Object(l.get)(a,"rendererOptions.table.rowTotals"),p=!Object(l.get)(a,"rendererOptions.table.colTotals");return n.a.createElement("div",{className:"pivot-table-visualization-container","data-hide-controls":d||null,"data-hide-row-totals":m||null,"data-hide-column-totals":p||null,"data-test":"PivotTableVisualization"},n.a.createElement(id.a,cd({},Object(l.pick)(s,bd),{data:u,onChange:e=>{var t=Object(l.pick)(e,bd);c(dd({},t)),o(t)}})))}function yd(e){var t=e.options,a=e.onOptionsChange,r=e=>{a(Object(l.merge)({},t,e))};return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Co,{"data-test":"PivotEditor.HideControls",id:"pivot-show-controls",defaultChecked:!t.controls.enabled,onChange:e=>r({controls:{enabled:!e}})},window.W_L.Show_Pivot_Controls)),n.a.createElement(Oo,null,n.a.createElement(Co,{id:"pivot-show-row-totals",defaultChecked:t.rendererOptions.table.rowTotals,onChange:e=>r({rendererOptions:{table:{rowTotals:e}}})},window.W_L.Show_Row_Totals)),n.a.createElement(Oo,null,n.a.createElement(Co,{id:"pivot-show-column-totals",defaultChecked:t.rendererOptions.table.colTotals,onChange:e=>r({rendererOptions:{table:{colTotals:e}}})},window.W_L.Show_Column_Totals)))}gd.propTypes=Gr,gd.defaultProps={onOptionsChange:()=>{}},yd.propTypes=Jr;var vd={controls:{enabled:!1},rendererOptions:{table:{colTotals:!0,rowTotals:!0}}},wd={type:"PIVOT",name:"数据透视表(Pivot Table)",getOptions:e=>Object(l.merge)({},vd,e),Renderer:gd,Editor:yd,defaultRows:10,defaultColumns:3,minColumns:2};function Od(e){return e.y+e.dy/2}function Ed(e){return e.value}var _d=function(){var e={},t=24,a=8,r=[1,1],n=[],o=[];function i(){var e,a,o=n,i=0;function l(a){a.x=i,a.dx=t,a.sourceLinks.forEach(t=>{e.indexOf(t.target)<0&&e.push(t.target)})}for(;o.length;)e=[],o.forEach(l),o=e,i+=1;!function(e){n.forEach(t=>{t.sourceLinks.length||(t.x=e-1)})}(i),i=Math.max(Ur.a.max(n,e=>e.x),2),a=(r[0]-t)/(i-1),n.forEach(e=>{e.x*=a})}function l(){function e(e,t){return e.source.y-t.source.y}function t(e,t){return e.target.y-t.target.y}n.forEach(a=>{a.sourceLinks.sort(t),a.targetLinks.sort(e)}),n.forEach(e=>{var t=0,a=0;e.sourceLinks.forEach(e=>{e.sy=t,t+=e.dy}),e.targetLinks.forEach(e=>{e.ty=a,a+=e.dy})})}return e.nodeWidth=function(a){return arguments.length?(t=+a,e):t},e.nodePadding=function(t){return arguments.length?(a=+t,e):a},e.nodes=function(t){return arguments.length?(n=t,e):n},e.links=function(t){return arguments.length?(o=t,e):o},e.size=function(t){return arguments.length?(r=t,e):r},e.layout=function(t){return n.forEach(e=>{e.sourceLinks=[],e.targetLinks=[]}),o.forEach(e=>{var t=e.source,a=e.target;"number"==typeof t&&(t=e.source=n[e.source]),"number"==typeof a&&(a=e.target=n[e.target]),t.sourceLinks.push(e),a.targetLinks.push(e)}),n.forEach(e=>{e.value=Math.max(Ur.a.sum(e.sourceLinks,Ed),Ur.a.sum(e.targetLinks,Ed))}),i(),function(e){var t,i=Ur.a.nest().key(e=>e.x).sortKeys(Ur.a.ascending).entries(n).map(e=>e.values);function l(e){function t(e){return Od(e.source)*e.value}i.forEach(a=>{a.forEach(a=>{if(a.targetLinks.length){var r=Ur.a.sum(a.targetLinks,t)/Ur.a.sum(a.targetLinks,Ed);a.y+=(r-Od(a))*e}})})}function s(){i.forEach(e=>{var t,n,o,i=e.length,l=0;for(e.sort(d),o=0;o<i;++o)(n=l-(t=e[o]).y)>0&&(t.y+=n),l=t.y+t.dy+a;if((n=l-a-r[1])>0)for(l=t.y-=n,o=i-2;o>=0;--o)(n=(t=e[o]).y+t.dy+a-l)>0&&(t.y-=n),l=t.y})}t=Ur.a.min(i,e=>(r[1]-(e.length-1)*a)/Ur.a.sum(e,Ed)),i.forEach(e=>{e.forEach((e,a)=>{e.y=a,e.dy=e.value*t})}),o.forEach(e=>{e.dy=e.value*t}),s();for(var c=1;e>0;e-=1)u(c*=.99),s(),l(c),s();function u(e){function t(e){return Od(e.target)*e.value}i.slice().reverse().forEach(a=>{a.forEach(a=>{if(a.sourceLinks.length){var r=Ur.a.sum(a.sourceLinks,t)/Ur.a.sum(a.sourceLinks,Ed);a.y+=(r-Od(a))*e}})})}function d(e,t){return e.y-t.y}}(t),l(),e},e.relayout=function(){return l(),e},e.link=function(){var e=.5;function t(t){var a=t.source.x+t.source.dx,r=t.target.x,n=Ur.a.interpolateNumber(a,r),o=n(e),i=n(1-e),l=t.source.y+t.sy+t.dy/2,s=t.target.y+t.ty+t.dy/2;return"M".concat(a,",").concat(l,"C").concat(o,",").concat(l," ").concat(i,",").concat(s," ").concat(r,",").concat(s)}return t.curvature=a=>arguments.length?(e=+a,t):e,t},e};function jd(e){var t={},a={},r=[],n=Object(l.sortBy)(Object(l.filter)(Object(l.keys)(e[0]),e=>"value"!==e),l.identity);function o(e,a){e=function(e){return Object(l.isNil)(e)?"Exit":""+e}(e);var n="".concat(e,":").concat(String(a)),o=t[n];return o||((o={name:e}).id=r.push(o)-1,t[n]=o),o}function i(e,t,r,n){if(""!==e&&e||!(n>1)){var i=o(e,n),l=o(t,n+1);(function(e,t){var r=a[[e,t]];return r||(r={target:t,source:e,value:0},a[[e,t]]=r),r}(i.id,l.id)).value+=parseInt(r,10)}}e.forEach(e=>{i(e[n[0]],e[n[1]],e.value||0,1),i(e[n[1]],e[n[2]],e.value||0,2),i(e[n[2]],e[n[3]],e.value||0,3),i(e[n[3]],e[n[4]],e.value||0,4),i(e[n[4]],null,e.value||0,5)});var s=Ur.a.scale.category20();return{nodes:Object(l.map)(r,e=>Object(l.extend)(e,{color:s(e.name.replace(/ .*/,""))})),links:Object(l.values)(a)}}function Sd(e){var t;if(e.rows=(t=e.rows,Object(l.map)(t,e=>Object(l.mapValues)(e,e=>!e||Object(l.isNumber)(e)||Object(l.isNaN)(parseFloat(e))?e:parseFloat(e)))),!function(e){return!(!e||!Object(l.find)(e.columns,e=>"value"===e.name))&&Object(l.every)(e.rows,e=>Object(l.every)(e,e=>!(e&&!Object(l.isString)(e))||isFinite(e)))}(e))return e=>{Ur.a.select(e).selectAll("*").remove()};e=jd(e.rows);var a=e=>Ur.a.format(",.0f")(e);return t=>{Ur.a.select(t).selectAll("*").remove();var r=10,n=10,o=10,i=10,s=t.offsetWidth-i-n,c=t.offsetHeight-r-o;if(!(s<=0||c<=0)){var u=Ur.a.select(t).append("svg").attr("class","sankey").attr("width",s+i+n).attr("height",c+r+o).append("g").attr("transform","translate(".concat(i,",").concat(r,")")),d=_d().nodeWidth(15).nodePadding(10).size([s,c]),m=d.link();d.nodes(e.nodes).links(e.links).layout(0),function(e,t){Ur.a.nest().key(e=>e.x).entries(t.nodes).map(e=>e.values).forEach(t=>{t=Object(l.filter)(Object(l.sortBy)(t,e=>-e.value),e=>"Exit"!==e.name);var a=Ur.a.sum(t,e=>e.dy),r=(e-a)/t.length;Object(l.reduce)(t,(e,t)=>(t.y=e,e+t.dy+r),0)})}(c,e),d.relayout();var p=u.append("g").selectAll(".link").data(e.links).enter().append("path").filter(e=>"Exit"!==e.target.name).attr("class","link").attr("d",m).style("stroke-width",e=>Math.max(1,e.dy)).sort((e,t)=>t.dy-e.dy);p.append("title").text(e=>"".concat(e.source.name," → ").concat(e.target.name,"\n").concat(a(e.value)));var f=u.append("g").selectAll(".node").data(e.nodes).enter().append("g").filter(e=>"Exit"!==e.name).attr("class","node").attr("transform",e=>"translate(".concat(e.x,",").concat(e.y,")"));f.on("mouseover",(function(e){var t=function(e){console.log(e);var t=[];return e.sourceLinks.forEach(e=>{t.push(e.target)}),e.targetLinks.forEach(e=>{t.push(e.source)}),t}(e);t=Object(l.map)(t,e=>e.id),f.filter(a=>a!==e&&!Object(l.includes)(t,a.id)).style("opacity",.2),p.filter(t=>!(Object(l.includes)(e.sourceLinks,t)||Object(l.includes)(e.targetLinks,t))).style("opacity",.2)})).on("mouseout",(function(){f.style("opacity",1),p.style("opacity",1)})),f.append("rect").attr("height",e=>e.dy).attr("width",d.nodeWidth()).style("fill",e=>e.color).style("stroke",e=>Ur.a.rgb(e.color).darker(2)).append("title").text(e=>"".concat(e.name,"\n").concat(a(e.value))),f.append("text").attr("x",-6).attr("y",e=>e.dy/2).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(e=>e.name).filter(e=>e.x<s/2).attr("x",6+d.nodeWidth()).attr("text-anchor","start")}}}a(1256);function Cd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Pd(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Pd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pd(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function xd(e){var t=e.data,a=Cd(Object(r.useState)(null),2),o=a[0],i=a[1],l=Object(r.useMemo)(()=>Sd(t),[t]);return Object(r.useEffect)(()=>{if(o)return l(o),Yr(o,()=>{l(o)})},[o,l]),n.a.createElement("div",{className:"sankey-visualization-container",ref:i})}function Ld(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function kd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}xd.propTypes=Gr;var Nd={type:"SANKEY",name:"桑基图(Sankey)",getOptions:e=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ld(Object(a),!0).forEach((function(t){kd(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ld(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e),Renderer:xd,Editor:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,window.W_L.This_visualization_expects_the_query_result_to_have_rows_in_one_of_the_following_formats,"："),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("strong",null,"stage1")," - ",window.W_L.stage_1_value),n.a.createElement("li",null,n.a.createElement("strong",null,"stage2")," - ",window.W_L.stage_2_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage3")," - ",window.W_L.stage_3_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage4")," - ",window.W_L.stage_4_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage5")," - ",window.W_L.stage_5_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"value")," -",window.W_L.number_of_times_this_sequence_occurred)))},defaultRows:7},Ad=Vr.scale.category10();function Td(e){return Ad(e.name)}function Wd(e){e=function(e){var t=Object(l.first)(e);return Object(l.every)(["sequence","stage","node","value"],e=>Object(l.has)(t,e))}(e)?function(e){var t=Object(l.groupBy)(e,"sequence");return Object(l.map)(t,e=>{var t=Object(l.sortBy)(e,"stage");return{size:e[0].value||0,sequence:e[0].sequence,nodes:Object(l.map)(t,e=>e.node)}})}(e):function(e){var t=Object(l.sortBy)(Object(l.filter)(Object(l.keys)(e[0]),e=>"value"!==e),l.identity);return Object(l.map)(e,(e,a)=>({size:e.value||0,sequence:a,nodes:Object(l.compact)(Object(l.map)(t,t=>e[t]))}))}(e);var t={name:"root",children:[]};return e.forEach(e=>{for(var a=e.nodes,r=parseInt(e.size,10),n=t,o=function(e){var t=n.children,o=a[e],i=e+1===a.length;t||(n.children=t=[],t.push({name:"<<<Exit>>>",size:n.size}));var s=Object(l.find)(t,e=>e.name===o);i&&s?(s.children=s.children||[],s.children.push({name:"<<<Exit>>>",size:r})):i?t.push({name:o,size:r}):(s||(s={name:o,children:[]},t.push(s)),n=s)},i=0;i<a.length;i+=1)o(i)}),t}function Id(e){return function(e){return e&&e.rows.length>0}(e)?(e=Wd(e.rows),t=>{Vr.select(t).selectAll("*").remove();var a=t.clientWidth,r=t.offsetHeight,n={w:a/6,h:30,s:3,t:10},o=Math.min(a-n.h,r-n.h)/2-5;if(!(o<=0)){var i,l={top:o,bottom:50,left:o,right:0},s=0,c=Vr.layout.partition().size([2*Math.PI,o*o]).value(e=>e.size),u=Vr.svg.arc().startAngle(e=>e.x).endAngle(e=>e.x+e.dx).innerRadius(e=>Math.sqrt(e.y)).outerRadius(e=>Math.sqrt(e.y+e.dy)),d=Vr.select(t),m=d.append("div").classed("breadcrumbs-container",!0).append("svg").attr("width",a).attr("height",n.h).attr("fill","white").attr("font-weight",600),p=d.append("div"),f=p.append("div").classed("summary-container",!0),b=p.append("div").classed("sunburst-container",!0).append("svg").attr("width",2*o).attr("height",2*o).append("g").attr("transform","translate(".concat(l.left,",").concat(l.top,")")),h=m.append("text").classed("lastCrumb",!0),g=c.nodes(e).filter(e=>e.dx>.005&&"<<<Exit>>>"!==e.name),y=(i=[],g.forEach(e=>{-1===i.indexOf(e.name)&&i.push(e.name)}),i);Ad.domain(y);var v=b.data([e]).selectAll("path").data(g).enter().append("path").classed("nodePath",!0).attr("display",e=>e.depth?null:"none").attr("d",u).attr("fill",Td).attr("opacity",1).attr("stroke","white").on("mouseover",O);d.on("click",(function(){b.selectAll("path").on("mouseover",null),b.selectAll("path").transition().duration(1e3).attr("opacity",1).each("end",(function(){Vr.select(this).on("mouseover",O)})),m.style("visibility","hidden"),f.style("visibility","hidden")})),s=v.node().__data__.value}function w(e,t){var a=[];return a.push("0,0"),a.push("".concat(n.w,",0")),a.push("".concat(n.w+n.t,",").concat(n.h/2)),a.push("".concat(n.w,",").concat(n.h)),a.push("0,".concat(n.h)),t>0&&a.push("".concat(n.t,",").concat(n.h/2)),a.join(" ")}function O(e){var t=(100*e.value/s).toPrecision(3),a="".concat(t,"%");t<1&&(a="< 1.0%");var r=function(e){for(var t=[],a=e;a.parent;)t.unshift(a),a=a.parent;return t}(e);!function(e,t){var a=m.selectAll("g").data(e,e=>e.name+e.depth),r=a.enter().append("g");r.append("polygon").classed("breadcrumbs-shape",!0).attr("points",w).attr("fill",Td),r.append("text").classed("breadcrumbs-text",!0).attr("x",(n.w+n.t)/2).attr("y",n.h/2).attr("dy","0.35em").attr("font-size","10px").attr("text-anchor","middle").text(e=>e.name),a.attr("transform",(e,t)=>"translate(".concat(t*(n.w+n.s),", 0)")),a.exit().remove(),h.attr("x",(e.length+.5)*(n.w+n.s)).attr("y",n.h/2).attr("dy","0.35em").attr("text-anchor","middle").attr("fill","black").attr("font-weight",600).text(t)}(r,a),b.selectAll("path").attr("opacity",.3),b.selectAll("path").filter(e=>r.indexOf(e)>=0).attr("opacity",1),f.html("\n      <span>层级:".concat(e.depth,"</span>\n      <span class='percentage' style='font-size: 2em;'>").concat(a,"</span>\n      <span>").concat(e.value," / ").concat(s,"</span>\n    ")),f.style("visibility",""),m.style("visibility","")}}):e=>{Vr.select(e).selectAll("*").remove()}}a(1257);function qd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Dd(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Dd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dd(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Rd(e){var t=e.data,a=qd(Object(r.useState)(null),2),o=a[0],i=a[1],l=Object(r.useMemo)(()=>Id(t),[t]);return Object(r.useEffect)(()=>{if(o)return l(o),Yr(o,()=>{l(o)})},[o,l]),n.a.createElement("div",{className:"sunburst-visualization-container",ref:i})}function Md(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function zd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Rd.propTypes=Gr;var Fd={type:"SUNBURST_SEQUENCE",name:"旭辉图(Sunburst Sequence)",getOptions:e=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Md(Object(a),!0).forEach((function(t){zd(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Md(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e),Renderer:Rd,Editor:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,window.W_L.This_visualization_expects_the_query_result_to_have_rows_in_one_of_the_following_formats,"："),n.a.createElement(Oo,null,n.a.createElement("p",null,n.a.createElement("strong",null,window.W_L.Option,"1：")),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("strong",null,"sequence")," - ",window.W_L.sequence_id),n.a.createElement("li",null,n.a.createElement("strong",null,"stage")," - ",window.W_L.what_stage_in_sequence_this_is_1_2),n.a.createElement("li",null,n.a.createElement("strong",null,"node")," - ",window.W_L.stage_name),n.a.createElement("li",null,n.a.createElement("strong",null,"value")," - ",window.W_L.number_of_times_this_sequence_occurred))),n.a.createElement(Oo,null,n.a.createElement("p",null,n.a.createElement("strong",null,window.W_L.Option,"2：")),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("strong",null,"stage1")," - ",window.W_L.stage_1_value),n.a.createElement("li",null,n.a.createElement("strong",null,"stage2")," - ",window.W_L.stage_2_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage3")," - ",window.W_L.stage_3_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage4")," - ",window.W_L.stage_4_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage5")," - ",window.W_L.stage_5_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"value")," - ",window.W_L.number_of_times_this_sequence_occurred))))},defaultRows:7};function Vd(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ud(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Vd(Object(a),!0).forEach((function(t){Bd(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Vd(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Bd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Hd={itemsPerPage:25,paginationSize:"default"},Yd=["filter","multi-filter","multiFilter"];function Qd(e){var t;if(-1!==e.indexOf("::"))t="::";else{if(-1===e.indexOf("__"))return e;t="__"}var a=e.split(t);return""===a[0]&&2===a.length?a[1]:s.a.includes(Yd,a[1])?a[0]:e}function Kd(e,t){var a=function(e){var t={integer:"number",float:"number",boolean:"boolean",date:"datetime",datetime:"datetime"};return s.a.map(e,(e,a)=>{return{name:e.name,type:e.type,displayAs:t[e.type]||"string",visible:!0,order:1e5+a,title:Qd(e.name),allowSearch:!1,alignContent:(r=e.type,["integer","float","boolean","date","datetime"].indexOf(r)>=0?"right":"left"),allowHTML:!0,highlightLinks:!1};var r})}(e);return t=function(e,t){e=s.a.map(e,e=>e.name),t=s.a.map(t,e=>e.name),t=s.a.filter(t,t=>s.a.includes(e,t)),e=s.a.filter(e,e=>s.a.includes(t,e));for(var a=0;a<e.length;a+=1)if(t[a]!==e[a])return!0;return!1}(e,t)?s.a.fromPairs(s.a.map(t,(e,t)=>[e.name,s.a.extend({},e,{order:t})])):s.a.fromPairs(s.a.map(t,e=>[e.name,s.a.omit(e,"order")])),s.a.each(a,e=>s.a.extend(e,t[e.name])),s.a.sortBy(a,"order")}var $d=a(302),Gd=a.n($d);function Jd(e){var t=e.allowHTML&&e.highlightLinks?e=>{if(Object(l.isString)(e)){var t=To.LinkComponent;e=e.replace(Ai,(e,a,r)=>a+Li.a.renderToStaticMarkup(n.a.createElement(t,{href:r,target:"_blank",rel:"noopener noreferrer"},r)))}return Object(l.toString)(e)}:e=>Object(l.toString)(e);function a(a){return{text:t(a[e.name])}}function r(t){var r=a(t.row).text;return e.allowHTML?n.a.createElement(We,null,r):r}return r.prepareData=a,r}function Xd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Zd(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Zd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zd(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function em(e){var t=Ii(e.numberFormat);function a(a){return{text:t(a[e.name])}}function r(e){return a(e.row).text}return r.prepareData=a,r}function tm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return am(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return am(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function am(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function rm(e){var t=Wi(e.dateTimeFormat);function a(a){return{text:t(a[e.name])}}function r(e){return a(e.row).text}return r.prepareData=a,r}function nm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return om(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return om(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function om(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function im(e){var t=function(e){if(Object(l.isArray)(e)){if(e.length>=2)return t=>Object(l.isNil)(t)?"":""+e[t?1:0];if(1===e.length)return t=>t?e[0]:""}return e=>Object(l.isNil)(e)?"":e?"true":"false"}(e.booleanValues);function a(a){return{text:t(a[e.name])}}function r(e){return a(e.row).text}return r.prepareData=a,r}function lm(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function sm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return cm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return cm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function um(e){function t(t){t=Object(l.extend)({"@":t[e.name]},t);var a=Object(l.trim)(qi(e.linkUrlTemplate,t));if(""===a)return{};var r=Object(l.trim)(qi(e.linkTitleTemplate,t)),n=Object(l.trim)(qi(e.linkTextTemplate,t)),o={href:a,text:""!==n?n:a};return""!==r&&(o.title=r),e.linkOpenInNewTab&&(o.target="_blank"),o}function a(e){var a=t(e.row),r=a.text,o=lm(a,["text"]);return n.a.createElement("a",o,r)}return a.prepareData=t,a}function dm(){return(dm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function mm(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function pm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function bm(e){function t(t){t=Object(l.extend)({"@":t[e.name]},t);var a=Object(l.trim)(qi(e.imageUrlTemplate,t));if(""===a)return{};var r=parseInt(qi(e.imageWidth,t),10),n=parseInt(qi(e.imageHeight,t),10),o=Object(l.trim)(qi(e.imageTitleTemplate,t)),i={src:a};return Number.isFinite(r)&&r>0&&(i.width=r),Number.isFinite(n)&&n>0&&(i.height=n),""!==o&&(i.text=o,i.title=o,i.alt=o),i}function a(e){var a=t(e.row),r=(a.text,mm(a,["text"]));return n.a.createElement("img",dm({alt:""},r))}return a.prepareData=t,a}Jd.friendlyName=window.W_L.text,Jd.Editor=function(e){var t=e.column,a=e.onChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Table.ColumnEditor.Text.AllowHTML",checked:t.allowHTML,onChange:e=>a({allowHTML:e.target.checked})},window.W_L.Allow_HTML_content)),t.allowHTML&&n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Table.ColumnEditor.Text.HighlightLinks",checked:t.highlightLinks,onChange:e=>a({highlightLinks:e.target.checked})},window.W_L.Highlight_links)))},em.friendlyName=window.W_L.number,em.Editor=function(e){var t=e.column,a=e.onChange,r=Xd(Object(Ml.a)(a,200),1)[0];return n.a.createElement(Oo,null,n.a.createElement(Ro,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Number_format,n.a.createElement(qo.NumberFormatSpecs,null)),"data-test":"Table.ColumnEditor.Number.Format",defaultValue:t.numberFormat,onChange:e=>r({numberFormat:e.target.value})}))},rm.friendlyName=window.W_L.datetime,rm.Editor=function(e){var t=e.column,a=e.onChange,r=tm(Object(Ml.a)(a,200),1)[0];return n.a.createElement(Oo,null,n.a.createElement(Ro,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Date_Time_format,n.a.createElement(qo.DateTimeFormatSpecs,null)),"data-test":"Table.ColumnEditor.DateTime.Format",defaultValue:t.dateTimeFormat,onChange:e=>r({dateTimeFormat:e.target.value})}))},im.friendlyName=window.W_L.Boolean,im.Editor=function(e){var t=e.column,a=e.onChange,r=nm(Object(Ml.a)((function(e,r){var n=[...t.booleanValues];n.splice(e,1,r),a({booleanValues:n})}),200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Ro,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Value_for," ",n.a.createElement("code",null,"false")),"data-test":"Table.ColumnEditor.Boolean.False",defaultValue:t.booleanValues[0],onChange:e=>r(0,e.target.value)})),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Value_for," ",n.a.createElement("code",null,"true")),"data-test":"Table.ColumnEditor.Boolean.True",defaultValue:t.booleanValues[1],onChange:e=>r(1,e.target.value)})))},um.friendlyName=window.W_L.Link,um.Editor=function(e){var t=e.column,a=e.onChange,r=sm(Object(Ml.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Ro,{label:window.W_L.URL_template,"data-test":"Table.ColumnEditor.Link.UrlTemplate",defaultValue:t.linkUrlTemplate,onChange:e=>r({linkUrlTemplate:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:window.W_L.Text_template,"data-test":"Table.ColumnEditor.Link.TextTemplate",defaultValue:t.linkTextTemplate,onChange:e=>r({linkTextTemplate:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:window.W_L.Title_template,"data-test":"Table.ColumnEditor.Link.TitleTemplate",defaultValue:t.linkTitleTemplate,onChange:e=>r({linkTitleTemplate:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Table.ColumnEditor.Link.OpenInNewTab",checked:t.linkOpenInNewTab,onChange:e=>a({linkOpenInNewTab:e.target.checked})},window.W_L.Open_in_new_tab)),n.a.createElement(Oo,null,n.a.createElement(qo,{placement:"topLeft",arrowPointAtCenter:!0,icon:n.a.createElement("span",{style:{cursor:"default"}},"Format specs ",qo.defaultIcon)},n.a.createElement("div",null,window.W_L.All_columns_can_be_referenced_using,n.a.createElement("code",null,"{{ column_name }}")," ",window.W_L.syntax),n.a.createElement("div",null,window.W_L.Use," ",n.a.createElement("code",null,"{{ @ }}")," ",window.W_L.to_reference_current_this_column),n.a.createElement("div",null,window.W_L.This_syntax_is_applicable_to_URL_Text_and_Title_options))))},bm.friendlyName=window.W_L.Image,bm.Editor=function(e){var t=e.column,a=e.onChange,r=pm(Object(Ml.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Ro,{label:window.W_L.URL_template,"data-test":"Table.ColumnEditor.Image.UrlTemplate",defaultValue:t.imageUrlTemplate,onChange:e=>r({imageUrlTemplate:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(so,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Size,n.a.createElement(qo,{placement:"topLeft",arrowPointAtCenter:!0},n.a.createElement("div",{style:{marginBottom:5}},window.W_L.Any_positive_integer_value_that_specifies_size_in_pixels),n.a.createElement("div",null,window.W_L.Leave_empty_to_use_default_value)))},n.a.createElement("div",{className:"image-dimension-selector"},n.a.createElement(Ro,{"data-test":"Table.ColumnEditor.Image.Width",placeholder:window.W_L.Width,defaultValue:t.imageWidth,onChange:e=>r({imageWidth:e.target.value})}),n.a.createElement("span",{className:"image-dimension-selector-spacer"},"×"),n.a.createElement(Ro,{"data-test":"Table.ColumnEditor.Image.Height",placeholder:window.W_L.Height,defaultValue:t.imageHeight,onChange:e=>r({imageHeight:e.target.value})})))),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:window.W_L.Title_template,"data-test":"Table.ColumnEditor.Image.TitleTemplate",defaultValue:t.imageTitleTemplate,onChange:e=>r({imageTitleTemplate:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(qo,{placement:"topLeft",arrowPointAtCenter:!0,icon:n.a.createElement("span",{style:{cursor:"default"}},"Format specs ",qo.defaultIcon)},n.a.createElement("div",null,window.W_L.All_columns_can_be_referenced_using,n.a.createElement("code",null,"{{ column_name }}")," ",window.W_L.syntax),n.a.createElement("div",null,window.W_L.Use," ",n.a.createElement("code",null,"{{ @ }}")," ",window.W_L.to_reference_current_this_column),n.a.createElement("div",null,window.W_L.This_syntax_is_applicable_to_URL_Text_and_Title_options))))};a(1258);function hm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return gm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return gm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ym(e){var t=e.value,a=e.children,o=e.openingBrace,i=e.closingBrace,s=e.withKeys,c=hm(Object(r.useState)(!1),2),u=c[0],d=c[1],m=Object(l.keys)(t),p=m.length;return n.a.createElement(n.a.Fragment,null,p>0&&n.a.createElement("span",{className:"jvi-toggle",onClick:()=>d(!u)},n.a.createElement("i",{className:me()("fa",{"fa-caret-right":!u,"fa-caret-down":u})})),n.a.createElement("span",{className:"jvi-punctuation jvi-braces"},o),!u&&p>0&&n.a.createElement("span",{className:"jvi-punctuation jvi-ellipsis",onClick:()=>d(!0)},"…"),u&&n.a.createElement("span",{className:"jvi-block"},Object(l.map)(m,(e,a)=>{var r=0===a,o=a===p-1,i=o?null:n.a.createElement("span",{className:"jvi-punctuation jvi-comma"},",");return n.a.createElement("span",{key:"item-"+e,className:me()("jvi-item",{"jvi-nested-first":r,"jvi-nested-last":o})},s&&n.a.createElement("span",{className:"jvi-object-key"},n.a.createElement(vm,{value:e},n.a.createElement("span",{className:"jvi-punctuation"},": "))),n.a.createElement(vm,{value:t[e]},i))})),n.a.createElement("span",{className:"jvi-punctuation jvi-braces"},i),a,!u&&n.a.createElement("span",{className:"jvi-comment"}," // "+p+" "+(1===p?"item":"items")))}function vm(e){var t=e.value,a=e.children;return null===t||!1===t||!0===t||Object(l.isFinite)(t)?n.a.createElement("span",{className:"jvi-value jvi-primitive"},""+t,a):Object(l.isString)(t)?n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"jvi-punctuation jvi-string"},'"'),n.a.createElement("span",{className:"jvi-value jvi-string"},t),n.a.createElement("span",{className:"jvi-punctuation jvi-string"},'"'),a):Object(l.isArray)(t)?n.a.createElement(ym,{value:t,openingBrace:"[",closingBrace:"]"},a):Object(l.isObject)(t)?n.a.createElement(ym,{value:t,openingBrace:"{",closingBrace:"}",withKeys:!0},a):null}function wm(e){var t=e.value;return n.a.createElement("span",{className:"jvi-item jvi-root"},n.a.createElement(vm,{value:t}))}function Om(e){function t(t){var a=t[e.name];if(Object(l.isString)(a)&&a.length<=To.tableCellMaxJSONSize)try{return{text:a,value:JSON.parse(a)}}catch(e){}return{text:a,value:void 0}}function a(e){var a=t(e.row),r=a.text,o=a.value;return Object(l.isUndefined)(o)?n.a.createElement("div",{className:"json-cell-invalid"},""+r):n.a.createElement("div",{className:"json-cell-valid"},n.a.createElement(wm,{value:o}))}return a.prepareData=t,a}wm.defaultProps={value:void 0},Om.friendlyName="JSON";var Em={string:Jd,number:em,datetime:rm,boolean:im,link:um,image:bm,json:Om};function _m(e){switch(e){case"ascend":return"descend";case"descend":return null;default:return"ascend"}}function jm(e,t,a,r){e=Object(l.filter)(e,"visible"),e=Object(l.sortBy)(e,"order");var o=a.length>1,i=function(e){var t={};return Object(l.each)(e,(e,a)=>{var r=e.name,n=e.direction;t[r]={direction:n,index:a+1}}),t}(a),s=Object(l.map)(e,e=>{var t=i[e.name]&&"ascend"===i[e.name].direction,s=i[e.name]&&"descend"===i[e.name].direction,c=o&&i[e.name]?i[e.name].index:null,u={key:e.name,dataIndex:"record[".concat(JSON.stringify(e.name),"]"),align:e.alignContent,sorter:{multiple:1},sortOrder:Object(l.get)(i,[e.name,"direction"],null),title:n.a.createElement(n.a.Fragment,null,e.description&&n.a.createElement("span",{style:{paddingRight:5}},n.a.createElement(ge.a,{placement:"top",title:e.description},n.a.createElement("div",{className:"table-visualization-heading"},n.a.createElement("i",{className:"fa fa-info-circle","aria-hidden":"true"})))),n.a.createElement(ge.a,{placement:"top",title:e.title},n.a.createElement("div",{className:"table-visualization-heading","data-sort-column-index":c},e.title))),onHeaderCell:()=>({className:me()({"table-visualization-column-is-sorted":t||s}),onClick:t=>r(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(l.findIndex)(t,t=>t.name===e),n={name:e,direction:"ascend"};return r>=0&&(n.direction=_m(t[r].direction)),a?n.direction?(r>=0?t[r]=n:t.push(n),[...t]):Object(l.filter)(t,t=>t.name!==e):n.direction?[n]:[]}(e.name,a,t.shiftKey))})},d=(0,Em[e.displayAs])(e);return u.render=(t,a)=>({children:n.a.createElement(d,{row:a.record}),props:{className:"display-as-".concat(e.displayAs)}}),u});return s.push({key:"###Redash::Visualizations::Table::Spacer###",dataIndex:null,title:"",className:"table-visualization-spacer",render:()=>"",onHeaderCell:()=>({className:"table-visualization-spacer"})}),t&&(s=[{key:"table-search",title:t,onHeaderCell:()=>({className:"table-visualization-search"}),children:s}]),s}a(1259);function Sm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Cm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Cm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Pm(){return(Pm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xm(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Lm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:", ";return Object(l.reduce)(e,(e,a,r)=>(r>0&&e.push(t),e.push(a),e),[])}function km(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.limit,r=void 0===a?1/0:a,n=t.renderColumn,o=void 0===n?e=>e.title:n,i=Object(l.map)(e.slice(0,r),e=>o(e)),s=Object(l.map)(e.slice(r),e=>e.title);return s.length>0?[...Lm(i)," and ".concat(s.length," others")]:i.length>1?[...Lm(Object(l.initial)(i))," and ",Object(l.last)(i)]:i}function Nm(e){var t=e.searchColumns;return n.a.createElement(pn.a,{arrowPointAtCenter:!0,placement:"topRight",content:n.a.createElement("div",{className:"table-visualization-search-info-content"},window.W_L.search," ",km(t,{renderColumn:e=>n.a.createElement("code",{key:e.name},e.title)}))},n.a.createElement(Gd.a,{className:"table-visualization-search-info-icon"}))}function Am(e){var t=e.searchColumns,a=xm(e,["searchColumns"]);if(t.length<=0)return null;return n.a.createElement(ba.a.Search,Pm({},a,{placeholder:"".concat(window.W_L.search," ").concat(km(t,{limit:3}).join(""),"..."),suffix:t.length>3?n.a.createElement(Nm,{searchColumns:t}):null}))}function Tm(e){var t=e.options,a=e.data,o=Sm(Object(r.useState)(""),2),i=o[0],s=o[1],c=Sm(Object(r.useState)([]),2),u=c[0],d=c[1],m=Object(r.useMemo)(()=>Object(l.filter)(t.columns,"allowSearch"),[t.columns]),p=Object(r.useMemo)(()=>{var e=m.length>0?n.a.createElement(Am,{searchColumns:m,onChange:e=>s(e.target.value)}):null;return jm(t.columns,e,u,e=>{d(e),document.getSelection().removeAllRanges()})},[t.columns,m,u]),f=Object(r.useMemo)(()=>{return function(e,t){if(0===t.length||0===e.length)return e;var a={ascend:1,descend:-1};return[...e].sort((e,r)=>{for(var n,o,i=0;i<t.length;i+=1){if(n=e.record[t[i].name],o=r.record[t[i].name],Object(l.isNil)(n)||n<o)return-1*a[t[i].direction];if(n>o||Object(l.isNil)(o))return 1*a[t[i].direction]}return 0})}(function(e,t,a){if(""!==t&&a.length>0){t=t.toUpperCase();var r=Object(l.map)(a,e=>{var a=(0,Em[e.displayAs])(e).prepareData;return e=>{var r=a(e).text;return Object(l.toString)(r).toUpperCase().indexOf(t)>=0}});return Object(l.filter)(e,e=>Object(l.some)(r,t=>t(e.record)))}return e}((e=a.rows,Object(l.map)(e,(e,t)=>({key:"record".concat(t),record:e}))),i,m),u);var e},[a.rows,i,m,u]);return Object(r.useEffect)(()=>{d([])},[t.columns,a.columns]),0===a.rows.length?null:n.a.createElement("div",{className:"table-visualization-container"},n.a.createElement($l.a,{className:"table-fixed-header","data-percy":"show-scrollbars","data-test":"TableVisualization",columns:p,dataSource:f,pagination:{size:Object(l.get)(t,"paginationSize",""),position:"bottom",pageSize:t.itemsPerPage,hideOnSinglePage:!0,showSizeChanger:!1},showSorterTooltip:!1}))}Am.defaultProps={onChange:()=>{}},Tm.propTypes=Gr;var Wm=a(205),Im=a.n(Wm),qm=a(303),Dm=a.n(qm),Rm=a(415),Mm=a.n(Rm);function zm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Fm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Vm(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Um(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Vm(Object(a),!0).forEach((function(t){Bm(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Vm(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Bm(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Hm(e){var t=e.column,a=e.onChange;function r(e){a(Um(Um({},t),e))}var o=zm(Object(Ml.a)(r,200),1)[0],i=Em[t.displayAs].Editor||null;return n.a.createElement("div",{className:"table-visualization-editor-column"},n.a.createElement(Oo,null,n.a.createElement(ao.Row,{gutter:15,type:"flex",align:"middle"},n.a.createElement(ao.Col,{span:16},n.a.createElement(Ro,{"data-test":"Table.Column.".concat(t.name,".Title"),defaultValue:t.title,onChange:e=>o({title:e.target.value})})),n.a.createElement(ao.Col,{span:8},n.a.createElement(Fo,{"data-test":"Table.Column.".concat(t.name,".TextAlignment"),defaultValue:t.alignContent,onChange:e=>r({alignContent:e.target.value})})))),n.a.createElement(Oo,null,n.a.createElement(dn.a,{"data-test":"Table.Column.".concat(t.name,".UseForSearch"),defaultChecked:t.allowSearch,onChange:e=>r({allowSearch:e.target.checked})},"Use for search")),n.a.createElement(Oo,null,n.a.createElement(Ro,{label:"Description",defaultValue:t.description,onChange:e=>o({description:e.target.value})})),n.a.createElement(Oo,null,n.a.createElement(Do,{label:"Display as:","data-test":"Table.Column.".concat(t.name,".DisplayAs"),defaultValue:t.displayAs,onChange:e=>r({displayAs:e})},Object(l.map)(Em,(e,a)=>{var r=e.friendlyName;return n.a.createElement(Do.Option,{key:a,"data-test":"Table.Column.".concat(t.name,".DisplayAs.").concat(a)},r)}))),i&&n.a.createElement(i,{column:t,onChange:r}))}function Ym(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Qm(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ym(Object(a),!0).forEach((function(t){Km(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ym(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Km(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Hm.defaultProps={onChange:()=>{}};var $m=jn.a.Text,Gm=Object(Gl.b)(Im.a.Panel);function Jm(e){var t=e.options,a=e.onOptionsChange;function r(e,r){r&&r.stopPropagation();var n=Object(l.map)(t.columns,t=>t.name===e.name?e:t);a({columns:n})}return n.a.createElement(ls,{axis:"y",lockAxis:"y",useDragHandle:!0,helperClass:"table-editor-columns-dragged-item",helperContainer:e=>e.firstChild,onSortEnd:function(e){var r=e.oldIndex,n=e.newIndex,o=[...t.columns];o.splice(n,0,...o.splice(r,1)),a({columns:o})},containerProps:{className:"table-visualization-editor-columns"}},n.a.createElement(Im.a,{bordered:!1,defaultActiveKey:[],expandIconPosition:"right"},Object(l.map)(t.columns,(e,t)=>n.a.createElement(Gm,{key:e.name,index:t,header:n.a.createElement(n.a.Fragment,null,n.a.createElement(ns,null),n.a.createElement("span",{"data-test":"Table.Column.".concat(e.name,".Name")},e.name,""!==e.title&&e.title!==e.name&&n.a.createElement($m,{type:"secondary",style:{marginLeft:5}},n.a.createElement("i",null,"(",e.title,")")))),extra:n.a.createElement(ge.a,{title:window.W_L.toggle_visibility,mouseEnterDelay:0,mouseLeaveDelay:0},e.visible?n.a.createElement(Dm.a,{"data-test":"Table.Column.".concat(e.name,".Visibility"),onClick:t=>r(Qm(Qm({},e),{},{visible:!e.visible}),t)}):n.a.createElement(Mm.a,{"data-test":"Table.Column.".concat(e.name,".Visibility"),onClick:t=>r(Qm(Qm({},e),{},{visible:!e.visible}),t)}))},n.a.createElement(Hm,{column:e,onChange:r})))))}Jm.propTypes=Jr;var Xm=[5,10,15,20,25,50,100,150,200,250,500];function Zm(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(Oo,null,n.a.createElement(Do,{label:window.W_L.items_per_page,"data-test":"Table.ItemsPerPage",defaultValue:t.itemsPerPage,onChange:e=>a({itemsPerPage:e})},Object(l.map)(Xm,e=>n.a.createElement(Do.Option,{key:"ipp".concat(e),value:e,"data-test":"Table.ItemsPerPage.".concat(e)},e))))}Zm.propTypes=Jr;a(1263);var ep={type:"TABLE",name:"表格(Table)",getOptions:function(e,t){var a=t.columns;return(e=Ud(Ud({},Hd),e)).columns=s.a.map(Kd(a,e.columns),e=>{return Ud(Ud({},(a={integer:To.integerFormat||"0,0",float:To.floatFormat||"0,0.00"},{dateTimeFormat:{date:To.dateFormat||"DD/MM/YYYY",datetime:To.dateTimeFormat||"DD/MM/YYYY HH:mm"}[(t=e).type],numberFormat:a[t.type],booleanValues:To.booleanValues||["false","true"],imageUrlTemplate:"{{ @ }}",imageTitleTemplate:"{{ @ }}",imageWidth:"",imageHeight:"",linkUrlTemplate:"{{ @ }}",linkTextTemplate:"{{ @ }}",linkTitleTemplate:"{{ @ }}",linkOpenInNewTab:!0})),e);var t,a}),e},Renderer:Tm,Editor:go([{key:"Columns",title:window.W_L.columns,component:Jm},{key:"Grid",title:window.W_L.grid,component:Zm}]),autoHeight:!0,defaultRows:14,defaultColumns:3,minColumns:2},tp=a(673),ap=a.n(tp);a(1264);function rp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return np(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return np(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function np(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function op(e,t){var a=[];t.column&&(a=t.frequenciesColumn?function(e,t,a){var r={};return Object(l.each)(e,e=>{var n=parseFloat(e[a]);if(Number.isFinite(n)&&n>0){var o=Object(l.toString)(e[t]);r[o]=n}}),r}(e,t.column,t.frequenciesColumn):function(e,t){var a={};return Object(l.each)(e,e=>{var r=Object(l.toString)(e[t]).split(/\s/g);Object(l.each)(r,e=>{a[e]=(a[e]||0)+1})}),a}(e,t.column),a=Object(l.sortBy)(Object(l.map)(a,(e,t)=>({text:t,count:e})),[e=>-e.count,e=>-e.text.length]));var r,n,o,i,s=Object(l.map)(a,e=>e.count),c=Ur.a.scale.linear().domain([Object(l.min)(s),Object(l.max)(s)]).range([10,100]),u=Ur.a.scale.category20();return Object(l.each)(a,(e,t)=>{e.size=c(e.count),e.color=u(t),e.angle=t%2*90}),r=a,n={wordLength:t.wordLengthLimit,wordCount:t.wordCountLimit},o=n.wordLength,i=n.wordCount,o.min=Number.isFinite(o.min)?o.min:null,o.max=Number.isFinite(o.max)?o.max:null,i.min=Number.isFinite(i.min)?i.min:null,i.max=Number.isFinite(i.max)?i.max:null,Object(l.filter)(r,e=>{var t=e.text,a=e.count,r=(!o.min||t.length>=o.min)&&(!o.max||t.length<=o.max),n=(!i.min||a>=i.min)&&(!i.max||a<=i.max);return r&&n})}function ip(e,t){e.style.transform=null;var a=e.getBoundingClientRect(),r=a.width,n=a.height,o=t.getBoundingClientRect(),i=o.width/r,l=o.height/n;e.style.transform="scale(".concat(Math.min(i,l),")")}function lp(){var e=window.getComputedStyle(document.body).fontFamily;return ap()().size([5e3,5e3]).padding(3).font(e).rotate(e=>e.angle).fontSize(e=>e.size).random(()=>.5)}function sp(e){var t=e.data,a=e.options,o=rp(Object(r.useState)(null),2),i=o[0],l=o[1],s=rp(Object(r.useState)([]),2),c=s[0],u=s[1],d=Object(r.useMemo)(lp,[]);return Object(r.useEffect)(()=>(d.words(op(t.rows,a)).on("end",e=>u(e)).start(),()=>d.on("end",null).stop()),[d,t,a,u]),Object(r.useEffect)(()=>{i&&function(e,t){(e=Ur.a.select(e)).selectAll("*").remove();var a=e.append("svg"),r=a.append("g");r.selectAll("text").data(t).enter().append("text").style("font-size",e=>"".concat(e.size,"px")).style("font-family",e=>e.font).style("fill",e=>e.color).attr("text-anchor","middle").attr("transform",e=>"translate(".concat([e.x,e.y],") rotate(").concat(e.rotate,")")).text(e=>e.text);var n=a.node().getBoundingClientRect(),o=r.node().getBoundingClientRect();a.attr("width",Math.ceil(o.width)).attr("height",Math.ceil(o.height)),r.attr("transform","translate(".concat(n.left-o.left,",").concat(n.top-o.top,")")),ip(a.node(),e.node())}(i,c)},[i,c]),Object(r.useEffect)(()=>{if(i)return Yr(i,()=>{var e=i.querySelector("svg");e&&ip(e,i)})},[i]),n.a.createElement("div",{className:"word-cloud-visualization-container",ref:l})}function cp(e){var t=e.options,a=e.data,r=e.onOptionsChange,o=e=>{r(Object(l.merge)({},t,e))};return n.a.createElement(n.a.Fragment,null,n.a.createElement(Oo,null,n.a.createElement(Do,{label:"Words Column","data-test":"WordCloud.WordsColumn",value:t.column,onChange:e=>o({column:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Do.Option,{key:t,"data-test":"WordCloud.WordsColumn."+t},t)}))),n.a.createElement(Oo,null,n.a.createElement(Do,{label:"Frequencies Column","data-test":"WordCloud.FrequenciesColumn",value:t.frequenciesColumn,onChange:e=>o({frequenciesColumn:e})},n.a.createElement(Do.Option,{key:"none",value:""},n.a.createElement("i",null,"(count word frequencies automatically)")),Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Do.Option,{key:"column-"+t,value:t,"data-test":"WordCloud.FrequenciesColumn."+t},t)}))),n.a.createElement(Oo,null,n.a.createElement(so,{label:"Words Length Limit"},n.a.createElement(ao.Row,{gutter:15,type:"flex"},n.a.createElement(ao.Col,{span:12},n.a.createElement(Mo,{"data-test":"WordCloud.WordLengthLimit.Min",placeholder:"Min",min:0,value:t.wordLengthLimit.min,onChange:e=>o({wordLengthLimit:{min:e>0?e:null}})})),n.a.createElement(ao.Col,{span:12},n.a.createElement(Mo,{"data-test":"WordCloud.WordLengthLimit.Max",placeholder:"Max",min:0,value:t.wordLengthLimit.max,onChange:e=>o({wordLengthLimit:{max:e>0?e:null}})}))))),n.a.createElement(Oo,null,n.a.createElement(so,{label:"Frequencies Limit"},n.a.createElement(ao.Row,{gutter:15,type:"flex"},n.a.createElement(ao.Col,{span:12},n.a.createElement(Mo,{"data-test":"WordCloud.WordCountLimit.Min",placeholder:"Min",min:0,value:t.wordCountLimit.min,onChange:e=>o({wordCountLimit:{min:e>0?e:null}})})),n.a.createElement(ao.Col,{span:12},n.a.createElement(Mo,{"data-test":"WordCloud.WordCountLimit.Max",placeholder:"Max",min:0,value:t.wordCountLimit.max,onChange:e=>o({wordCountLimit:{max:e>0?e:null}})}))))))}sp.propTypes=Gr,cp.propTypes=Jr;var up={column:"",frequenciesColumn:"",wordLengthLimit:{min:null,max:null},wordCountLimit:{min:null,max:null}},dp={type:"WORD_CLOUD",name:"词云图(Word Cloud)",getOptions:e=>Object(l.merge)({},up,e),Renderer:sp,Editor:cp,defaultRows:8};function mp(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function pp(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?mp(Object(a),!0).forEach((function(t){fp(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mp(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function fp(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var bp=ae.a.shape({type:ae.a.string.isRequired,name:ae.a.string.isRequired,getOptions:ae.a.func.isRequired,isDefault:ae.a.bool,isDeprecated:ae.a.bool,Renderer:ae.a.func.isRequired,Editor:ae.a.func,autoHeight:ae.a.bool,defaultRows:ae.a.number,defaultColumns:ae.a.number,minRows:ae.a.number,maxRows:ae.a.number,minColumns:ae.a.number,maxColumns:ae.a.number}),hp={};Object(l.each)(Object(l.flatten)([Ko,Ns,hc,Vc,nu,hu,Pu,nd,wd,Nd,Fd,ep,dp]),(function(e){if(function(e){var t={config:bp},a={config:e};ae.a.checkPropTypes(t,a,"prop","registerVisualization")}(e),e=pp(pp({Editor:()=>null},e),{},{isDefault:e.isDefault&&!e.isDeprecated}),hp[e.type])throw new Error("Visualization ".concat(e.type," already registered."));hp[e.type]=e}));var gp=hp;function yp(){return Object(l.find)(hp,e=>e.isDefault)||Object(l.find)(hp,e=>!e.isDeprecated)}function vp(){return(vp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function wp(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Op(){return(Op=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ep(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var _p="textbox",jp="visualization",Sp="restricted";var Cp,Pp,xp,Lp={DashboardLevel:"dashboard-level",WidgetLevel:"widget-level",StaticValue:"static-value"};class kp{constructor(e){Object(l.extend)(this,e);var t=function(e){e.width=1;var t={autoHeight:!1,sizeX:Math.round(Ca/2),sizeY:Na,minSizeX:Aa,maxSizeX:Ta,minSizeY:Wa,maxSizeY:Ia},a=e.visualization?gp[e.visualization.type]:null;if(Object(l.isObject)(a)){Object.prototype.hasOwnProperty.call(a,"autoHeight")&&(t.autoHeight=a.autoHeight);var r=parseInt(a.minColumns,10);isFinite(r)&&r>=0&&(t.minSizeX=r);var n=parseInt(a.maxColumns,10);isFinite(n)&&n>=0&&(t.maxSizeX=Math.min(n,Ca));var o=parseInt(a.height,10);isFinite(o)&&(t.minSizeY=Math.ceil(o/Pa));var i=parseInt(a.minRows,10);isFinite(i)&&(t.minSizeY=i);var s=parseInt(a.maxRows,10);isFinite(s)&&s>=0&&(t.maxSizeY=s);var c=parseInt(a.defaultColumns,10);isFinite(c)&&c>0&&(t.sizeX=c);var u=parseInt(a.defaultRows,10);isFinite(u)&&u>0&&(t.sizeY=u)}return t}(this);this.options=this.options||{},this.options.position=Object(l.extend)({},t,Object(l.pick)(this.options.position,["col","row","sizeX","sizeY","autoHeight"])),this.options.position.sizeY<0&&(this.options.position.autoHeight=!0)}get type(){return this.visualization?jp:this.restricted?Sp:_p}getQuery(){return!this.query&&this.visualization&&(this.query=new pr(this.visualization.query)),this.query}getQueryResult(){return this.data}getName(){return this.visualization?"".concat(this.visualization.query.name," (").concat(this.visualization.name,")"):Object(l.truncate)(this.text,20)}load(e,t){if(!this.visualization)return Promise.resolve();if(e||void 0===this.queryResult){this.loading=!0,this.refreshStartedAt=Da()(),(void 0===t||e)&&(t=e?0:void 0);var a=this.getQuery().getQueryResult(t);this.queryResult=a,a.toPromise().then(e=>(this.queryResult===a&&(this.loading=!1,this.data=e),e)).catch(e=>(this.queryResult===a&&(this.loading=!1,this.data=e),e))}return this.queryResult.toPromise()}save(e,t){var a=Object(l.pick)(this,"options","text","id","width","dashboard_id","visualization_id");e&&t&&(a[e]=Object(l.merge)({},a[e],t));var r="api/widgets";return this.id&&(r="".concat(r,"/").concat(this.id)),B.post(r,a).then(e=>(Object(l.each)(e,(e,t)=>{this[t]=e}),this))}delete(){var e="api/widgets/".concat(this.id);return B.delete(e)}isStaticParam(e){return this.getParameterMappings()[e.name].type===kp.MappingType.StaticValue}getParametersDefs(){var e=this.getParameterMappings(),t=this.getQuery()?this.getQuery().getParametersDefs():[],a=A.search,r=[kp.MappingType.WidgetLevel,kp.MappingType.StaticValue],n=Object(l.map)(Object(l.filter)(t,t=>r.indexOf(e[t.name].type)>=0),t=>{var r=e[t.name],n=Fr(t);return n.title=r.title||t.title,n.locals=[t],n.urlPrefix="p_w".concat(this.id,"_"),r.type===kp.MappingType.StaticValue?n.setValue(r.value):n.fromUrlParams(a),n});return Object(l.sortBy)(n,e=>Object(l.includes)(this.options.paramOrder,e.name)?Object(l.indexOf)(this.options.paramOrder,e.name):Object(l.size)(this.options.paramOrder))}getParameterMappings(){Object(l.isObject)(this.options.parameterMappings)||(this.options.parameterMappings={});var e={},t=this.getQuery()?this.getQuery().getParametersDefs(!1):[];Object(l.each)(t,t=>{e[t.name]=!0,Object(l.isObject)(this.options.parameterMappings[t.name])||(this.options.parameterMappings[t.name]={name:t.name,type:t.global?kp.MappingType.DashboardLevel:kp.MappingType.WidgetLevel,mapTo:t.name,value:null,title:""})});var a=Object(l.difference)(Object(l.keys)(this.options.parameterMappings),Object(l.keys)(e));return Object(l.each)(a,e=>{delete this.options.parameterMappings[e]}),this.options.parameterMappings}getLocalParameters(){return Object(l.filter)(this.getParametersDefs(),e=>!this.isStaticParam(e))}}xp=Lp,(Pp="MappingType")in(Cp=kp)?Object.defineProperty(Cp,Pp,{value:xp,enumerable:!0,configurable:!0,writable:!0}):Cp[Pp]=xp;var Np=kp;function Ap(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Tp(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ap(Object(a),!0).forEach((function(t){Wp(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ap(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Wp(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ip(e,t,a){var r={};return s.a.each(t,t=>{var n=t&&t.getFilters?t.getFilters():[];s.a.each(n,t=>{var n=s.a.has(a,t.name);if(n||e.dashboard_filters_enabled){n&&(t.current=a[t.name]);var o=Tp({},t);s.a.has(r,t.name)?r[o.name].values=s.a.union(r[o.name].values,o.values):r[o.name]=o}})}),s.a.values(r)}function qp(e){var t=Math.max(s.a.chain(e).map(e=>e.options.position.sizeY).max().value(),20)+5;return s.a.chain(e).sortBy(e=>e.options.position.row).groupBy(e=>e.options.position.row).reduce((e,a)=>{var r=1;return s.a.each(a,a=>{r=Math.max(r,a.options.position.autoHeight?t:a.options.position.sizeY),a.options.position.row=e,a.options.position.sizeY<1&&(a.options.position.sizeY=t)}),e+r},0).value(),e=s.a.sortBy(e,e=>e.options.position.col),e=s.a.sortBy(e,e=>e.options.position.row)}function Dp(e,t){var a=s.a.extend({sizeX:ka},s.a.extend({},t.options).position).sizeX,r=s.a.chain(e).map(e=>{var t=s.a.extend({},e.options),a=s.a.extend({row:0,sizeY:0},t.position);return{left:a.col,top:a.row,right:a.col+a.sizeX,bottom:a.row+a.sizeY,width:a.sizeX,height:a.sizeY}}).reduce((e,t)=>{for(var a=Math.max(t.left,0),r=Math.min(t.right,e.length+1),n=a;n<r;n+=1)e[n]=Math.max(e[n],t.bottom);return e},s.a.map(new Array(Ca),s.a.constant(0))).value();return s.a.chain(s.a.range(0,Ca-a+1)).map(e=>({col:e,row:s.a.chain(r).slice(e,e+a).max().value()})).sortBy("row").first().value()}function Rp(e){s.a.extend(this,e),Object.defineProperty(this,"url",{get:function(){return t=(e=this).id,a=e.slug,"dashboards/".concat(t,"-").concat(a);var e,t,a}})}function Mp(e){return qp(s.a.map(e,e=>new Np(e)))}function zp(e){return(e=new Rp(e)).widgets&&(e.widgets=Mp(e.widgets)),e.publicAccessEnabled=void 0!==e.public_url,e}function Fp(e){return e=e.results?Tp(Tp({},e),{},{results:s.a.map(e.results,zp)}):zp(e)}var Vp={get:e=>{var t=e.id,a=e.slug,r={};return t||(r.legacy=null),B.get("api/dashboards/".concat(t||a),{params:r}).then(Fp)},getByToken:e=>{var t=e.token;return B.get("api/dashboards/public/".concat(t)).then(Fp)},save:e=>B.post((e=>e.id?"api/dashboards/".concat(e.id):"api/dashboards")(e),e).then(Fp),delete:e=>{var t=e.id;return B.delete("api/dashboards/".concat(t)).then(Fp)},query:e=>B.get("api/dashboards",{params:e}).then(Fp),recent:e=>B.get("api/dashboards/recent",{params:e}).then(Fp),myDashboards:e=>B.get("api/dashboards/my",{params:e}).then(Fp),favorites:e=>B.get("api/dashboards/favorites",{params:e}).then(Fp),favorite:e=>{var t=e.id;return B.post("api/dashboards/".concat(t,"/favorite"))},unfavorite:e=>{var t=e.id;return B.delete("api/dashboards/".concat(t,"/favorite"))}};function Up(){return(Up=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Bp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Hp(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Hp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hp(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Yp(e){var t=e.dialog,a=Bp(Object(r.useState)(""),2),o=a[0],i=a[1],s=Bp(Object(r.useState)(!1),2),c=s[0],u=s[1],d=Bp(Object(r.useState)(!1),2),m=d[0],p=d[1],f=Z.isCreateDashboardEnabled();function b(){""!==o&&(p(!0),Rp.save({name:o}).then(e=>{t.close(),Ea("".concat(e.url,"?edit"))}),Sa("create","dashboard"))}return n.a.createElement(R.a,Up({},t.props,f?{}:{footer:null},{title:window.W_L.new_dashboard,okText:window.W_L.save,cancelText:window.W_L.cancel,okButtonProps:{disabled:!c||m,loading:m,"data-test":"DashboardSaveButton"},cancelButtonProps:{disabled:m},onOk:b,closable:!m,maskClosable:!m,wrapProps:{"data-test":"CreateDashboardDialog"}}),n.a.createElement(se,{name:"CreateDashboardDialogExtra",disabled:!f},n.a.createElement(ba.a,{defaultValue:o,onChange:function(e){var t=Object(l.trim)(e.target.value);i(t),u(""!==t)},onPressEnter:b,placeholder:window.W_L.dashboard_name,"aria-label":window.W_L.dashboard_name,disabled:m,autoFocus:!0})))}s.a.extend(Rp,Vp),Rp.prepareDashboardWidgets=Mp,Rp.prepareWidgetsForDashboard=qp,Rp.prototype.canEdit=function(){return Z.canEdit(this)},Rp.prototype.getParametersDefs=function(){var e={},t=A.search;s.a.each(this.widgets,t=>{if(t.getQuery()){var a=t.getParameterMappings();t.getQuery().getParametersDefs(!1).forEach(t=>{var r=a[t.name];r.type===Np.MappingType.DashboardLevel&&(e[r.mapTo]||(e[r.mapTo]=Fr(t),e[r.mapTo].name=r.mapTo,e[r.mapTo].title=r.title||t.title,e[r.mapTo].locals=[]),e[r.mapTo].locals.push(t))})}});var a=s.a.values(s.a.each(e,e=>{e.setValue(e.value),e.fromUrlParams(t)}));return s.a.sortBy(a,e=>s.a.includes(this.options.globalParamOrder,e.name)?s.a.indexOf(this.options.globalParamOrder,e.name):s.a.size(this.options.globalParamOrder))},Rp.prototype.addWidget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={dashboard_id:this.id,options:Tp(Tp({},t),{},{isHidden:!1,position:{}}),text:"",visualization_id:null,visualization:null};s.a.isString(e)?a.text=e:s.a.isObject(e)&&(a.visualization_id=e.id,a.visualization=e);var r=new Np(a),n=Dp(this.widgets,r);return r.options.position.col=n.col,r.options.position.row=n.row,r.save().then(()=>(this.widgets=[...this.widgets,r],r))},Rp.prototype.favorite=function(){return Rp.favorite(this)},Rp.prototype.unfavorite=function(){return Rp.unfavorite(this)},Yp.propTypes={dialog:wa.isRequired};var Qp=Oa(Yp);a(1265);function Kp(){return(Kp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function $p(e){var t=e.show,a=e.completed,r=e.text,o=e.url,i=e.urlText,l=e.onClick;if(!t)return null;var s={children:i,onClick:l};return n.a.createElement("li",{className:me()({done:a})},o?n.a.createElement(g,Kp({href:o},s)):n.a.createElement(be,Kp({type:"link"},s))," ",r)}function Gp(e){e.helpTriggerType;return n.a.createElement(n.a.Fragment,null)}function Jp(e){var t=e.icon,a=e.header,o=e.description,i=e.illustration,s=e.helpMessage,c=e.closable,u=e.onClose,d=e.onboardingMode,m=e.showAlertStep,p=e.showDashboardStep,f=e.showDataSourceStep,b=e.showInviteStep,h=e.getStepsItems,g=e.illustrationPath,y={dataSource:f,query:!0,alert:m,dashboard:p,inviteUsers:b},v={dataSource:ee.objectCounters.data_sources>0,query:ee.objectCounters.queries>0,alert:ee.objectCounters.alerts>0,dashboard:ee.objectCounters.dashboards>0,inviteUsers:ee.objectCounters.users>1},w=Object(r.useCallback)(()=>{Qp.showModal()},[]);if(!(!d||Object(l.some)(Object(l.keys)(y),e=>y[e]&&!v[e])))return null;var O=[{key:"dataSources",node:H.isAdmin?n.a.createElement($p,{key:"dataSources",show:y.dataSource,completed:v.dataSource,url:"data_sources/new",urlText:window.W_L.connect_new_datasource}):n.a.createElement($p,{key:"dataSources",show:y.dataSource,completed:v.dataSource,text:window.W_L.ask_database_info})},{key:"queries",node:n.a.createElement($p,{key:"queries",show:y.query,completed:v.query,url:"queries/new",urlText:window.W_L.create_query})},{key:"alerts",node:n.a.createElement($p,{key:"alerts",show:y.alert,completed:v.alert,url:"alerts/new",urlText:window.W_L.create_alert})},{key:"dashboards",node:n.a.createElement($p,{key:"dashboards",show:y.dashboard,completed:v.dashboard,onClick:w,urlText:window.W_L.create_dashboard})},{key:"users",node:n.a.createElement($p,{key:"users",show:y.inviteUsers,completed:v.inviteUsers,url:"users/new",urlText:window.W_L.invite_new_user})}],E=h?h(O):O,_=g||"static/images/illustrations/"+i+".svg";return n.a.createElement("div",{className:"empty-state-wrapper"},n.a.createElement("div",{className:"empty-state bg-white tiled"},n.a.createElement("div",{className:"empty-state__summary"},a&&n.a.createElement("h4",null,a),n.a.createElement("h2",null,n.a.createElement("i",{className:t,"aria-hidden":"true"})),n.a.createElement("p",null,o),n.a.createElement("img",{src:_,alt:i+" Illustration",width:"75%"})),n.a.createElement("div",{className:"empty-state__steps"},n.a.createElement("h4",null,window.W_L.start),n.a.createElement("ol",null,E.map(e=>e.node)),s)),c&&n.a.createElement(be,{className:"close-button","aria-label":"Close",onClick:u},n.a.createElement(je.a,null)))}$p.propTypes={show:ae.a.bool.isRequired,completed:ae.a.bool.isRequired,text:ae.a.node,url:ae.a.string,urlTarget:ae.a.string,urlText:ae.a.node,onClick:ae.a.func},$p.defaultProps={url:null,urlTarget:null,urlText:null,text:null,onClick:null},Gp.propTypes={helpTriggerType:ae.a.string.isRequired},Jp.propTypes={icon:ae.a.string,header:ae.a.string,description:ae.a.string.isRequired,illustration:ae.a.string.isRequired,illustrationPath:ae.a.string,helpMessage:ae.a.node,closable:ae.a.bool,onClose:ae.a.func,onboardingMode:ae.a.bool,showAlertStep:ae.a.bool,showDashboardStep:ae.a.bool,showDataSourceStep:ae.a.bool,showInviteStep:ae.a.bool,getStepItems:ae.a.func},Jp.defaultProps={icon:null,header:null,helpMessage:null,closable:!1,onClose:()=>{},onboardingMode:!1,showAlertStep:!1,showDashboardStep:!1,showDataSourceStep:!0,showInviteStep:!1};var Xp=Jp,Zp=a(247),ef=a.n(Zp);function tf(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function af(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?tf(Object(a),!0).forEach((function(t){rf(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):tf(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function rf(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}ef.a.config({placement:"bottomRight",duration:3});var nf={};["success","error","info","warning","warn"].forEach(e=>{nf[e]=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return ef.a[e](af(af({},r),{},{message:t,description:a}))}});var of=af(af({},ef.a),nf),lf=()=>B.get("api/settings/organization"),sf=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.W_L.save_success;return B.post("api/settings/organization",e).then(e=>(of.success(t),e)).catch(()=>{of.error(window.W_L.save_failed)})};function cf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return uf(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return uf(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uf(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var df=jn.a.Text;var mf=function(){var e=cf(Object(r.useState)(!1),2),t=e[0],a=e[1];if(!Y.showBeaconConsentMessage||t)return null;var o=()=>{Y.showBeaconConsentMessage=!1,a(!0)},i=e=>{var t=window.W_L.thank_you;e||(t=window.W_L.setting_saved_success),sf({beacon_consent:e},t).finally(o)};return n.a.createElement(se,{name:"BeaconConsent"},n.a.createElement("div",{className:"m-t-10 tiled"},n.a.createElement(bn.a,{title:n.a.createElement(n.a.Fragment,null,window.W_L.share_info," ",n.a.createElement($e,{type:"USAGE_DATA_SHARING"})),bordered:!1},n.a.createElement(df,null,window.W_L.help_redash,"："),n.a.createElement("div",{className:"m-t-5"},n.a.createElement("ul",null,n.a.createElement("li",null," ",window.W_L.redash_about_1),n.a.createElement("li",null," ",window.W_L.redash_about_2))),n.a.createElement(df,null,window.W_L.redash_info),n.a.createElement("div",{className:"m-t-5"},n.a.createElement(m.a,{type:"primary",className:"m-r-5",onClick:()=>i(!0)},window.W_L.accept),n.a.createElement(m.a,{type:"default",onClick:()=>i(!1)},window.W_L.reject)),n.a.createElement("div",{className:"m-t-15"},n.a.createElement(df,{type:"secondary"},window.W_L.set_info_in," ",n.a.createElement(g,{href:"settings/general"},window.W_L.sys_setting)," ",window.W_L.sys_setting_add,"。")))))},pf=a(249),ff=a.n(pf);function bf(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function hf(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?bf(Object(a),!0).forEach((function(t){gf(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):bf(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function gf(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var yf=new class{constructor(){gf(this,"_items",[]),gf(this,"_sorted",!1)}get items(){return this._sorted||(this._items=Object(l.sortBy)(this._items,[e=>{return t=e.path,a=ff.a.parse(t),Object(l.filter)(a,l.isObject).length;var t,a},e=>-e.path.length,e=>e.path]),this._sorted=!0),this._items}register(e,t){var a=Object(l.isString)(e)?e:null;this.unregister(a),Object(l.isObject)(t)&&(this._items=[...this.items,hf(hf({},t),{},{id:a})],this._sorted=!1)}unregister(e){Object(l.isString)(e)&&(this._items=Object(l.filter)(this.items,t=>t.id!==e))}navigate(e,t){var a=this._items.find(t=>t.id===e);if(a){var r=a.path;for(var n in t)r=r.replace(":".concat(n),String(t[n]));window.location.href=r}else console.error("No route found with id: ".concat(e))}},vf=a(90),wf=a.n(vf);function Of(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ef(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ef(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ef(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _f(e){var t=e.title,a=e.resource,o=e.itemUrl,i=e.emptyState,s=Of(Object(r.useState)([]),2),c=s[0],u=s[1],d=Of(Object(r.useState)(!0),2),m=d[0],p=d[1];return Object(r.useEffect)(()=>{p(!0),a.favorites().then(e=>{var t=e.results;return u(t)}).finally(()=>p(!1))},[a]),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"d-flex align-items-center m-b-20"},n.a.createElement("p",{className:"flex-fill f-500 c-black m-0"},t),m&&n.a.createElement(wf.a,null)),!Object(l.isEmpty)(c)&&n.a.createElement("div",{role:"list",className:"list-group"},c.map(e=>n.a.createElement(g,{key:o(e),role:"listitem",className:"list-group-item",href:o(e)},n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),e.name,e.is_draft&&n.a.createElement("span",{className:"label label-default m-l-5"},window.W_L.unpublished)))),Object(l.isEmpty)(c)&&!m&&i)}function jf(){return n.a.createElement("div",{className:"tile"},n.a.createElement("div",{className:"t-body tb-padding"},n.a.createElement("div",{className:"row home-favorites-list"},n.a.createElement("div",{className:"col-sm-6 m-t-20"},n.a.createElement(_f,{title:window.W_L.my_favorite_dashboard,resource:Rp,itemUrl:e=>e.url,emptyState:n.a.createElement("p",null,n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),n.a.createElement(g,{href:"dashboards"},window.W_L.my_favorite_dashboard))})),n.a.createElement("div",{className:"col-sm-6 m-t-20"},n.a.createElement(_f,{title:window.W_L.my_favorite_query,resource:pr,itemUrl:e=>"queries/".concat(e.id),emptyState:n.a.createElement("p",null,n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),n.a.createElement(g,{href:"queries"},window.W_L.my_favorite_query))})))))}_f.propTypes={title:ae.a.string.isRequired,resource:ae.a.func.isRequired,itemUrl:ae.a.func.isRequired,emptyState:ae.a.node},_f.defaultProps={emptyState:null};a(1266);function Sf(){return n.a.createElement(u.a,{className:"m-b-15",type:"warning",message:n.a.createElement(n.a.Fragment,null,"你已设置参数 ",n.a.createElement("code",null,"ALLOW_PARAMETERS_IN_EMBEDS"),"，但该特征暂时不可用。"," ",n.a.createElement(g,{href:"https://discuss.redash.io/t/support-for-parameters-in-embedded-visualizations/3337",target:"_blank",rel:"noopener noreferrer"},"Read more"),".")})}function Cf(){return n.a.createElement(u.a,{className:"m-b-15",type:"warning",message:n.a.createElement(n.a.Fragment,null,window.W_L.email_send," ",n.a.createElement(be,{type:"link",onClick:()=>{B.post("verification_email/").then(e=>{of.success(e.message)})}},window.W_L.re_send_email),".")})}function Pf(){return Object(r.useEffect)(()=>{Sa("view","page","personal_homepage")},[]),n.a.createElement("div",{className:"home-page"},n.a.createElement("div",{className:"container"},Object(l.includes)(Q,"using-deprecated-embed-feature")&&n.a.createElement(Sf,null),Object(l.includes)(Q,"email-not-verified")&&n.a.createElement(Cf,null),n.a.createElement(se,{name:"Home.EmptyState"},n.a.createElement(Xp,{header:window.W_L.redash_welcome,description:window.W_L.redash_desc,illustration:"dashboard",helpMessage:n.a.createElement(Gp,{helpTriggerType:"GETTING_STARTED"}),showDashboardStep:!0,showInviteStep:!0,onboardingMode:!0})),n.a.createElement(se,{name:"HomeExtra"}),n.a.createElement(jf,null),n.a.createElement(mf,null)))}yf.register("Home",pa({path:"/home",title:"Holmes",render:e=>n.a.createElement(Pf,e)}));a(1267);function xf(e){var t=e.title,a=e.actions;return n.a.createElement("div",{className:"page-header-wrapper"},n.a.createElement("h3",null,t),a&&n.a.createElement("div",{className:"page-header-actions"},a))}xf.propTypes={title:ae.a.string,actions:ae.a.node},xf.defaultProps={title:"",actions:null};a(1268);function Lf(e){var t=e.activeTab,a=e.children;return n.a.createElement("div",{className:"admin-page-layout"},n.a.createElement("div",{className:"container"},n.a.createElement(xf,{title:"Admin"}),n.a.createElement("div",{className:"bg-white tiled"},n.a.createElement(ue.a,{selectedKeys:[t],selectable:!1,mode:"horizontal"},n.a.createElement(ue.a.Item,{key:"system_status"},n.a.createElement(g,{href:"admin/status"},window.W_L.sys_status)),n.a.createElement(ue.a.Item,{key:"jobs"},n.a.createElement(g,{href:"admin/queries/jobs"},window.W_L.task_queen_status)),n.a.createElement(ue.a.Item,{key:"outdated_queries"},n.a.createElement(g,{href:"admin/queries/outdated"},window.W_L.outdated_query))),a)))}Lf.propTypes={activeTab:ae.a.string,children:ae.a.node},Lf.defaultProps={activeTab:"system_status",children:null};var kf=a(201),Nf=a.n(kf),Af=a(156),Tf=a.n(Af),Wf=a(78),If=a.n(Wf);function qf(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Df extends n.a.Component{toggleItem(e,t,a){var r=t.is_favorite?t.unfavorite.bind(t):t.favorite.bind(t),n=t.is_favorite;r().then(()=>{t.is_favorite=!n,this.forceUpdate(),a()})}render(){var e=this.props,t=e.item,a=e.onChange,r=t.is_favorite?"fa fa-star":"fa fa-star-o",o=t.is_favorite?window.W_L.add_favorite:window.W_L.remove_favorite;return n.a.createElement(be,{title:o,"aria-label":o,className:"favorites-control btn-favorite",onClick:e=>this.toggleItem(e,t,a)},n.a.createElement("i",{className:r,"aria-hidden":"true"}))}}qf(Df,"propTypes",{item:ae.a.shape({is_favorite:ae.a.bool.isRequired}).isRequired,onChange:ae.a.func}),qf(Df,"defaultProps",{onChange:()=>{}});ae.a.shape({syntax:ae.a.string,options:ae.a.shape({doc:ae.a.string,doc_url:ae.a.string}),type_name:ae.a.string});var Rf=ae.a.shape({columns:ae.a.arrayOf(ae.a.string).isRequired}),Mf=(ae.a.arrayOf(Rf),ae.a.shape({interval:ae.a.number,time:ae.a.string,day_of_week:ae.a.string,until:ae.a.string})),zf={interval:null,time:null,day_of_week:null,until:null},Ff=ae.a.shape({id:ae.a.number.isRequired,name:ae.a.string.isRequired,email:ae.a.string.isRequired,profileImageUrl:ae.a.string,apiKey:ae.a.string,isDisabled:ae.a.bool}),Vf=ae.a.shape({id:ae.a.number.isRequired,name:ae.a.string.isRequired,icon:ae.a.string.isRequired,type:ae.a.string.isRequired}),Uf=ae.a.shape({id:ae.a.any.isRequired,name:ae.a.string.isRequired,description:ae.a.string,data_source_id:ae.a.any.isRequired,created_at:ae.a.string.isRequired,updated_at:ae.a.string,user:Ff,query:ae.a.string,queryHash:ae.a.string,is_safe:ae.a.bool.isRequired,is_draft:ae.a.bool.isRequired,is_archived:ae.a.bool.isRequired,api_key:ae.a.string.isRequired}),Bf=ae.a.shape({column:ae.a.string,op:ae.a.oneOf([">",">=","<","<=","==","!="]),value:ae.a.oneOfType([ae.a.string,ae.a.number]),custom_subject:ae.a.string,custom_body:ae.a.string}),Hf=ae.a.shape({id:ae.a.any,name:ae.a.string,created_at:ae.a.string,last_triggered_at:ae.a.string,updated_at:ae.a.string,rearm:ae.a.number,state:ae.a.oneOf(["ok","triggered","unknown"]),user:Ff,query:Uf,options:ae.a.shape({column:ae.a.string,op:ae.a.string,value:ae.a.oneOfType([ae.a.string,ae.a.number])}).isRequired});function Yf(e,t,a,r){var n=t[a],o=e&&null!=n&&Da.a.isMoment(n),i=!e&&(null==n||Da.a.isMoment(n));if(!o&&!i)return new Error("Prop `"+a+"` supplied to `"+r+"` should be a Moment.js instance.")}var Qf=Object(l.wrap)(!1,Yf);function Kf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $f(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return $f(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $f(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Gf(e){var t=e.date,a=e.placeholder,o=e.autoUpdate,i=e.variation,s=function(e){return(e=Object(l.isNil)(e)?null:Da()(e))&&e.isValid()?e:null}(t),c=Kf(Object(r.useState)(null),2),u=c[0],d=c[1],m=Object(r.useMemo)(()=>s?s.format(Y.dateTimeFormat):null,[s]);return Object(r.useEffect)(()=>{function e(){d(s?s.fromNow():a)}if(e(),o){var t=setInterval(e,3e4);return()=>clearInterval(t)}},[o,s,a]),"timeAgoInTooltip"===i?n.a.createElement(we,{title:u},n.a.createElement("span",{"data-test":"TimeAgo"},m)):n.a.createElement(we,{title:m},n.a.createElement("span",{"data-test":"TimeAgo"},u))}function Jf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Xf(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Xf(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xf(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}Qf.isRequired=Object(l.wrap)(!0,Yf),Gf.propTypes={date:ae.a.oneOfType([ae.a.string,ae.a.number,ae.a.instanceOf(Date),Qf]),placeholder:ae.a.string,autoUpdate:ae.a.bool,variation:ae.a.oneOf(["timeAgoInTooltip"])},Gf.defaultProps={date:null,placeholder:"",autoUpdate:!0};var Zf={NEVER:"不自动刷新",SECONDS:"秒",MINUTES:"分钟",HOURS:"小时",DAYS:"天",WEEKS:"周",MILLISECONDS:"毫秒"},eb={SECONDS:"s",MINUTES:"m",HOURS:"h",DAYS:"d",WEEKS:"w",MILLISECONDS:"ms"};function tb(e,t){if(!e)return"";var a=Da()(e);return a.isValid()?a.format(t):"-"}function ab(e){return tb(e,Y.dateTimeFormat)}function rb(e){return tb(e,Y.dateFormat)}function nb(e){var t=Jf(e.split(":"),2),a=t[0],r=t[1];return Da.a.utc().hour(a).minute(r).local().format("HH:mm")}function ob(e){var t="EN"===window.W_L.language_mode?eb:Zf;if(!e)return{interval:t.NEVER};var a=t.SECONDS;return e>=60&&(e/=60,a=t.MINUTES),e>=60&&(e/=60,a=t.HOURS),e>=24&&a===t.HOURS&&(e/=24,a=t.DAYS),e>=7&&!(e%7)&&a===t.DAYS&&(e/=7,a=t.WEEKS),{count:e,interval:a}}function ib(e,t){return e+""}function lb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"-";var a="",r=ob(e),n=r.interval,o=r.count,i=Math.round(o);return 1===i&&t.omitSingleValueNumber||(a="".concat(i," ")),a+=ib(n)}function sb(e){return e.replace(/_/g," ").replace(/(?:^|\s)\S/g,e=>e.toUpperCase())}function cb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return Math.round(e)!==e?e.toFixed(t):e.toString()}function ub(e,t){return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0;if(isNaN(parseFloat(e))||!isFinite(e))return{value:"",unit:"",divisor:1};for(var n=0,o=1;e>=t&&n<a.length-1;)e/=t,o*=t,n+=1;return{value:cb(e,r),unit:a[n],divisor:o}}(e,1024,["bytes","KB","MB","GB","TB","PB"],t)}function db(e){var t=ub(e),a=t.value,r=t.unit;return a?a+" "+r:"?"}function mb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Da.a.isMoment(e)?"date"===t?rb(e):ab(e):"boolean"==typeof e?e.toString():e}function pb(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function fb(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pb(Object(a),!0).forEach((function(t){bb(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pb(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function bb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function hb(){return(hb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function gb(){return Object(l.extend)(this(...arguments),{sorter:!0})}var yb={favorites:e=>Object(l.extend)({width:"1%",render:(e,t)=>n.a.createElement(Df,{item:t})},e),avatar:(e,t)=>(t=Object(l.isFunction)(t)?t:l.identity,Object(l.extend)({width:"1%",render:(e,a)=>n.a.createElement("img",{src:a.user.profile_image_url,className:"profile__image_thumb",alt:t(e.name,a),title:t(e.name,a)})},e)),date:e=>Object(l.extend)({render:e=>rb(e)},e),dateTime:e=>Object(l.extend)({render:e=>ab(e)},e),duration:e=>Object(l.extend)({width:"1%",className:"text-nowrap",render:e=>lb(e)},e),timeAgo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return Object(l.extend)({render:e=>n.a.createElement(Gf,hb({date:e},t))},e)},custom:(e,t)=>Object(l.extend)({render:e},t)};yb.date.sortable=gb,yb.dateTime.sortable=gb,yb.duration.sortable=gb,yb.timeAgo.sortable=gb,yb.custom.sortable=gb;class vb extends n.a.Component{constructor(){super(...arguments),bb(this,"getRowKey",e=>{var t=this.props.rowKey;return t?Object(l.isFunction)(t)?t(e.item):e.item[t]:e.key})}prepareColumns(){var e=this.props,t=e.orderByField,a=e.orderByReverse,r=e.toggleSorting,n=a?"descend":"ascend";return Object(l.map)(Object(l.map)(Object(l.filter)(this.props.columns,e=>!Object(l.isFunction)(e.isAvailable)||e.isAvailable()),e=>Object(l.extend)(e,{orderByField:e.orderByField||e.field})),(e,a)=>{var o=e.sorter?()=>({onClick:()=>r(e.orderByField)}):null,i=Object(l.isFunction)(e.render)?(t,a)=>e.render(t,a.item):l.identity;return Object(l.extend)(Object(l.omit)(e,["field","orderByField","render"]),{key:"column"+a,dataIndex:["item",e.field],defaultSortOrder:e.orderByField===t?n:null,onHeaderCell:o,render:i})})}render(){var e={columns:this.prepareColumns(),dataSource:Object(l.map)(this.props.items,(e,t)=>({key:"row"+t,item:e}))},t=Object(l.isFunction)(this.props.onRowClick)?e=>({onClick:t=>{this.props.onRowClick(t,e.item)}}):null,a=this.props.showHeader;return this.props.loading&&(Object(l.isEmpty)(e.dataSource)?(e.columns=e.columns.map(e=>fb(fb({},e),{},{sorter:!1,render:()=>n.a.createElement(If.a,{active:!0,paragraph:!1})})),e.dataSource=Object(l.range)(10).map(e=>({key:"".concat(e)}))):e.loading={indicator:null}),n.a.createElement($l.a,hb({className:me()("table-data",{"ant-table-headerless":!a}),showHeader:a,rowKey:this.getRowKey,pagination:!1,onRow:t,"data-test":this.props["data-test"]},e))}}function wb(e){var t=e.title,a=e.value,r=e.loading;return n.a.createElement(Tf.a,{spinning:r},n.a.createElement(bn.a,null,t,n.a.createElement("div",{className:"f-20"},a)))}bb(vb,"propTypes",{loading:ae.a.bool,items:ae.a.arrayOf(ae.a.object),columns:ae.a.arrayOf(ae.a.shape({field:ae.a.string,orderByField:ae.a.string,render:ae.a.func,isAvailable:ae.a.func})),showHeader:ae.a.bool,onRowClick:ae.a.func,orderByField:ae.a.string,orderByReverse:ae.a.bool,toggleSorting:ae.a.func,"data-test":ae.a.string,rowKey:ae.a.oneOfType([ae.a.string,ae.a.func])}),bb(vb,"defaultProps",{loading:!1,items:[],columns:[],showHeader:!0,onRowClick:null,orderByField:null,orderByReverse:!1,toggleSorting:()=>{}}),wb.propTypes={title:ae.a.string.isRequired,value:ae.a.oneOfType([ae.a.number,ae.a.string]),loading:ae.a.bool.isRequired},wb.defaultProps={value:""};var Ob=[{title:window.W_L.queue,dataIndex:"origin"},{title:window.W_L.query_id,dataIndex:["meta","query_id"]},{title:window.W_L.org_id,dataIndex:["meta","org_id"]},{title:window.W_L.data_source_id,dataIndex:["meta","data_source_id"]},{title:window.W_L.user_id,dataIndex:["meta","user_id"]},yb.custom(e=>e.toString(),{title:window.W_L.scheduled,dataIndex:["meta","scheduled"]}),yb.timeAgo({title:window.W_L.start_time,dataIndex:"started_at"}),yb.timeAgo({title:window.W_L.queue_time,dataIndex:"enqueued_at"})],Eb=[{title:window.W_L.queue,dataIndex:"origin"},{title:window.W_L.job_name,dataIndex:"name"},yb.timeAgo({title:window.W_L.start_time,dataIndex:"started_at"}),yb.timeAgo({title:window.W_L.queue_time,dataIndex:"enqueued_at"})],_b=[yb.custom(e=>n.a.createElement("span",null,n.a.createElement(Nf.a,{status:{busy:"processing",idle:"default",started:"success",suspended:"warning"}[e]})," ",e),{title:"State",dataIndex:"state"})].concat(Object(l.map)(["Hostname","PID","Name","Queues","Current Job","Successful Jobs","Failed Jobs"],e=>({title:e,dataIndex:e.toLowerCase().replace(/\s/g,"_")}))).concat([yb.dateTime({title:window.W_L.birth_date,dataIndex:"birth_date"}),yb.duration({title:window.W_L.total_work_time,dataIndex:"total_working_time"})]),jb=Object(l.map)(["Name","Started","Queued"],e=>({title:e,dataIndex:e.toLowerCase()})),Sb={loading:ae.a.bool.isRequired,items:ae.a.arrayOf(ae.a.object).isRequired};function Cb(e){var t=e.loading,a=e.items;return n.a.createElement($l.a,{loading:t,columns:_b,rowKey:"name",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function Pb(e){var t=e.loading,a=e.items;return n.a.createElement($l.a,{loading:t,columns:jb,rowKey:"name",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function xb(e){var t=e.loading,a=e.items;return n.a.createElement($l.a,{loading:t,columns:Ob,rowKey:"id",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function Lb(e){var t=e.loading,a=e.items;return n.a.createElement($l.a,{loading:t,columns:Eb,rowKey:"id",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function kb(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Nb(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Nb(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nb(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ab(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Tb(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ab(Object(a),!0).forEach((function(t){Ib(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ab(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Wb(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Ib(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Cb.propTypes=Sb,Pb.propTypes=Sb,xb.propTypes=Sb,Lb.propTypes=Sb;class qb extends n.a.Component{constructor(){super(...arguments),Ib(this,"state",{activeTab:A.hash,isLoading:!0,error:null,queueCounters:[],overallCounters:{started:0,queued:0},startedJobs:[],workers:[]}),Ib(this,"_refreshTimer",null),Ib(this,"refresh",()=>{B.get("/api/admin/queries/rq_status").then(e=>this.processQueues(e)).catch(e=>this.handleError(e)),this._refreshTimer=setTimeout(this.refresh,6e4)}),Ib(this,"processQueues",e=>{var t=e.queues,a=e.workers,r=Object(l.values)(t).map(e=>{var t=e.started,a=Wb(e,["started"]);return Tb({started:t.length},a)}),n=r.reduce((e,t)=>({started:e.started+t.started,queued:e.queued+t.queued}),{started:0,queued:0}),o=Object(l.flatMap)(Object(l.values)(t),e=>e.started.map(e=>Tb(Tb({},e),{},{enqueued_at:Da.a.utc(e.enqueued_at),started_at:Da.a.utc(e.started_at)})));this.setState({isLoading:!1,queueCounters:r,startedJobs:o,overallCounters:n,workers:a})}),Ib(this,"handleError",e=>{this.setState({isLoading:!1,error:e})})}componentDidMount(){Sa("view","page","admin/rq_status"),this.refresh()}componentWillUnmount(){clearTimeout(this._refreshTimer),this.processQueues=()=>{},this.handleError=()=>{}}render(){var e=this.state,t=e.isLoading,a=e.error,r=e.queueCounters,o=e.startedJobs,i=e.overallCounters,s=e.workers,c=e.activeTab,d=kb(Object(l.partition)(o,["name","redash.tasks.queries.execution.execute_query"]),2),m=d[0],p=d[1];return n.a.createElement(Lf,{activeTab:"jobs"},n.a.createElement("div",{className:"p-15"},a&&n.a.createElement(u.a,{type:"error",message:window.W_L.loading_failed}),!a&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ao.Row,{gutter:15,className:"m-b-15"},n.a.createElement(ao.Col,{span:8},n.a.createElement(wb,{title:window.W_L.started_job,value:i.started,loading:t})),n.a.createElement(ao.Col,{span:8},n.a.createElement(wb,{title:window.W_L.queen_job,value:i.queued,loading:t}))),n.a.createElement(mo.a,{activeKey:c||"queues",onTabClick:e=>{A.setHash(e),this.setState({activeTab:e})},animated:!1},n.a.createElement(mo.a.TabPane,{key:"queues",tab:"Queues"},n.a.createElement(Pb,{loading:t,items:r})),n.a.createElement(mo.a.TabPane,{key:"workers",tab:"Workers"},n.a.createElement(Cb,{loading:t,items:s})),n.a.createElement(mo.a.TabPane,{key:"queries",tab:"Queries"},n.a.createElement(xb,{loading:t,items:m})),n.a.createElement(mo.a.TabPane,{key:"other",tab:"Other Jobs"},n.a.createElement(Lb,{loading:t,items:p}))))))}}yf.register("Admin.Jobs",pa({path:"/admin/queries/jobs",title:window.W_L.queen_status,render:e=>n.a.createElement(qb,e)}));function Db(e){var t=e.page,a=e.showPageSizeSelect,r=e.pageSize,o=e.onPageSizeChange,i=e.totalCount,l=e.onChange;return i<=(a?5:r)?null:n.a.createElement("div",{className:"paginator-container"},n.a.createElement(su.a,{showSizeChanger:a,pageSizeOptions:["5","10","20","50","100"],onShowSizeChange:(e,t)=>o(t),defaultCurrent:t,pageSize:r,total:i,onChange:l}))}function Rb(){return(Rb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Mb(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return zb(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return zb(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zb(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Fb(e){var t=e.dialog,a=e.tags,o=e.getAvailableTags,i=Mb(Object(r.useState)([]),2),s=i[0],c=i[1],u=Mb(Object(r.useState)(!0),2),d=u[0],m=u[1],p=Mb(Object(r.useState)(()=>Object(l.uniq)(Object(l.map)(a,l.trim))),2),f=p[0],b=p[1],h=Mb(Object(r.useState)(null),2),g=h[0],y=h[1];return Object(r.useEffect)(()=>{g&&!d&&g.focus()},[g,d]),Object(r.useEffect)(()=>{var e=!1;return o().then(t=>{e||(c(Object(l.uniq)(Object(l.compact)(Object(l.map)(t,l.trim)))),m(!1))}),()=>{e=!0}},[o]),n.a.createElement(R.a,Rb({},t.props,{onOk:()=>t.close(f),title:window.W_L.add_edit_tag,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,className:"shortModal",wrapProps:{"data-test":"EditTagsDialog"}}),n.a.createElement(ln.a,{ref:y,mode:"tags",className:"w-100",placeholder:window.W_L.add_more_tag,defaultValue:f,onChange:e=>b(Object(l.compact)(Object(l.map)(e,l.trim))),disabled:d,loading:d},Object(l.map)(s,e=>n.a.createElement(ln.a.Option,{key:e},e))))}Db.propTypes={page:ae.a.number.isRequired,showPageSizeSelect:ae.a.bool,pageSize:ae.a.number.isRequired,totalCount:ae.a.number.isRequired,onPageSizeChange:ae.a.func,onChange:ae.a.func},Db.defaultProps={showPageSizeSelect:!1,onChange:()=>{},onPageSizeChange:()=>{}},Fb.propTypes={dialog:wa.isRequired,tags:ae.a.arrayOf(ae.a.string),getAvailableTags:ae.a.func.isRequired},Fb.defaultProps={tags:[]};var Vb=Oa(Fb);function Ub(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Bb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Hb extends n.a.Component{constructor(){super(...arguments),Bb(this,"editTags",(e,t)=>{Vb.showModal({tags:e,getAvailableTags:t}).onClose(this.props.onEdit)})}renderEditButton(){var e=Object(l.map)(this.props.tags,l.trim);return n.a.createElement(be,{className:"label label-tag hidden-xs",onClick:()=>this.editTags(e,this.props.getAvailableTags),"data-test":"EditTagsButton"},0===e.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"zmdi zmdi-plus m-r-5","aria-hidden":"true"}),window.W_L.add_tag),e.length>0&&n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"zmdi zmdi-edit","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Edit")))}render(){var e=this.props,t=e.tags,a=e.tagSeparator;return n.a.createElement("div",{className:"tags-control "+this.props.className,"data-test":"TagsControl"},this.props.children,Object(l.map)(t,(e,t)=>n.a.createElement(n.a.Fragment,{key:e},a&&t>0&&n.a.createElement("span",{className:"tag-separator"},a),n.a.createElement("span",{className:"label label-tag",key:e,title:e,"data-test":"TagLabel"},e))),this.props.canEdit&&this.renderEditButton(),this.props.tagsExtra)}}function Yb(e){var t=e.archivedTooltip;function a(e){var a=e.isDraft,r=e.isArchived,o=Ub(e,["isDraft","isArchived"]);return n.a.createElement(Hb,o,!r&&a&&n.a.createElement("span",{className:"label label-tag-unpublished"},window.W_L.draft),r&&n.a.createElement(we,{placement:"right",title:t},n.a.createElement("span",{className:"label label-tag-archived"},window.W_L.archived)))}return a.propTypes={isDraft:ae.a.bool,isArchived:ae.a.bool},a.defaultProps={isDraft:!1,isArchived:!1},a}Bb(Hb,"propTypes",{tags:ae.a.arrayOf(ae.a.string),canEdit:ae.a.bool,getAvailableTags:ae.a.func,onEdit:ae.a.func,className:ae.a.string,tagsExtra:ae.a.node,tagSeparator:ae.a.node,children:ae.a.node}),Bb(Hb,"defaultProps",{tags:[],canEdit:!1,getAvailableTags:()=>Promise.resolve([]),onEdit:()=>{},className:"",tagsExtra:null,tagSeparator:null,children:null});var Qb=Yb({archivedTooltip:window.W_L.archived_info}),Kb=Yb({archivedTooltip:window.W_L.archived_info});a(586);function $b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Gb(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Gb(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gb(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Jb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Xb extends n.a.Component{get content(){var e=(this.props.schedule||Xb.defaultProps.schedule).interval;if(!e)return[window.W_L.flush_never];var t=lb(e,{omitSingleValueNumber:!0}),a=window.W_L.every+"".concat(t),r=window.W_L.every+"".concat(t)+window.W_L.auto_flush,n=this.props.schedule,o=n.time,i=n.day_of_week;return o&&(r+=window.W_L.at+"  ".concat(nb(o))),i&&(r+=window.W_L.on+"  ".concat(i)),[a,r]}render(){if(this.props.isNew)return window.W_L.flush_never;var e=$b(this.content,2),t=e[0],a=e[1],r=a?n.a.createElement(we,{title:a},t):t;return this.props.isLink?n.a.createElement(be,{type:"link",className:"schedule-phrase",onClick:this.props.onClick,"data-test":"EditSchedule"},r):r}}function Zb(){return(Zb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function eh(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function th(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ah(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?th(Object(a),!0).forEach((function(t){rh(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):th(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function rh(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Jb(Xb,"propTypes",{schedule:Mf,isNew:ae.a.bool.isRequired,isLink:ae.a.bool,onClick:ae.a.func}),Jb(Xb,"defaultProps",{schedule:zf,isLink:!1,onClick:()=>{}});var nh=ae.a.shape({params:ae.a.object.isRequired,isLoaded:ae.a.bool.isRequired,isEmpty:ae.a.bool.isRequired,searchTerm:ae.a.string,updateSearch:ae.a.func.isRequired,selectedTags:ae.a.array.isRequired,updateSelectedTags:ae.a.func.isRequired,orderByField:ae.a.string,orderByReverse:ae.a.bool.isRequired,toggleSorting:ae.a.func.isRequired,page:ae.a.number.isRequired,itemsPerPage:ae.a.number.isRequired,totalItemsCount:ae.a.number.isRequired,pageSizeOptions:ae.a.arrayOf(ae.a.number).isRequired,pageItems:ae.a.array.isRequired,updatePagination:ae.a.func.isRequired,handleError:ae.a.func.isRequired});function oh(e,t,a){class r extends n.a.Component{constructor(e){super(e),rh(this,"_itemsSource",void 0);var r=a(),n=t();this._itemsSource=n,n.setState(ah(ah({},r.getState()),{},{validate:!1})),n.getCallbackContext=()=>this.state,n.onBeforeUpdate=()=>{var e=n.getState();r.setState(e),this.setState(this.getState(ah(ah({},e),{},{isLoaded:!1})))},n.onAfterUpdate=()=>{var e=n.getState();this.setState(this.getState(ah(ah({},e),{},{isLoaded:!0})))},n.onError=e=>this.props.onError(e);var o=this.getState(ah(ah({},n.getState()),{},{isLoaded:!1})),i=n.updatePagination,s=n.toggleSorting,c=n.updateSearch,u=n.updateSelectedTags,d=n.update,m=n.handleError;this.state=ah(ah({},o),{},{toggleSorting:s,updateSearch:Object(l.debounce)(c,200),updateSelectedTags:u,updatePagination:i,update:d,handleError:m})}componentDidMount(){this.state.update()}componentWillUnmount(){this._itemsSource.onBeforeUpdate=()=>{},this._itemsSource.onAfterUpdate=()=>{},this._itemsSource.onError=()=>{}}getState(e){var t=e.isLoaded,a=e.totalCount,r=e.pageItems,n=e.params;return ah(ah({},eh(e,["isLoaded","totalCount","pageItems","params"])),{},{params:ah(ah({},n),Object(l.omit)(this.props,["onError","children"])),isLoaded:t,isEmpty:!t||0===a,totalItemsCount:a||0,pageSizeOptions:Y.pageSizeOptions,pageItems:r||[]})}render(){var t=this.props,a=t.children,r=(t.onError,eh(t,["children","onError"]));return n.a.createElement(e,Zb({},r,{controller:this.state}),a)}}return rh(r,"propTypes",{onError:ae.a.func,children:ae.a.node}),rh(r,"defaultProps",{onError:e=>{setTimeout(()=>{throw e})},children:null}),to()(r,e),r}function ih(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class lh{get totalPages(){return Math.ceil(this.totalCount/this.itemsPerPage)}setPage(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(l.isUndefined)(e)||(e=parseInt(e,10)||1,this.page=t?e>=1&&e<=this.totalPages?e:1:e>=1?e:1)}setItemsPerPage(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(l.isUndefined)(e)||(e=parseInt(e,10)||20,this.itemsPerPage=e>=1?e:1,t&&this.setPage(this.page,t))}setTotalCount(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(l.isUndefined)(e)||(e=parseInt(e,10)||0,this.totalCount=e,t&&this.setPage(this.page,t))}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.page,a=e.itemsPerPage,r=e.totalCount,n=e.validate,o=void 0===n||n;ih(this,"page",1),ih(this,"itemsPerPage",20),ih(this,"totalCount",0),this.setItemsPerPage(a,o),this.setTotalCount(r,o),this.setPage(t,o)}getItemsForPage(e){var t=this.itemsPerPage*(this.page-1),a=t+this.itemsPerPage;return e.slice(t,a)}}function sh(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ch(e,t){return e?t?"-"+e:e:null}function uh(e){var t=(e=Object(l.isString)(e)?e:"").startsWith("-");return t&&(e=e.substring(1)),{field:""!==e?e:null,reverse:t}}class dh{get compiled(){return ch(this.field,this.reverse)}set compiled(e){var t=uh(e),a=t.field,r=t.reverse;this.field=a,this.reverse=r}setField(e){this.field=Object(l.isString)(e)&&""!==e?e:null}setReverse(e){this.reverse=!!e}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.orderByField,a=e.orderByReverse,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;sh(this,"field",null),sh(this,"reverse",!1),sh(this,"sortByIteratees",null),this.setField(t),this.setReverse(a),this.sortByIteratees=r}toggleField(e){Object(l.isString)(e)&&""!==e&&(e===this.field?this.reverse=!this.reverse:(this.field=e,this.reverse=!1))}sort(e){if(this.field){var t=this.sortByIteratees&&this.sortByIteratees[this.field];return e=Object(l.sortBy)(e,t?[t]:this.field),this.reverse&&e.reverse(),e}}}class mh{_getRequest(e,t){return this._originalGetRequest({},t)}_processResults(e,t,a){var r=e.results,n=e.count;return{results:this._originalProcessResults(r,a),count:n}}constructor(e){var t=e.getRequest,a=e.doRequest,r=e.processResults;this._originalGetRequest=Object(l.isFunction)(t)?t:l.identity,this._originalDoRequest=a,this._originalProcessResults=Object(l.isFunction)(r)?r:l.identity}fetch(e,t,a){var r=this._getRequest(t,a);return this._originalDoRequest(r,a).then(e=>this._processResults(e,t,a))}}class ph extends mh{constructor(){super(...arguments),function(e,t,a){t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}(this,"_allItems",[])}_getRequest(e,t){var a=e.searchTerm,r=e.selectedTags;return this._originalGetRequest({q:Object(l.isString)(a)&&""!==a?a:void 0,tags:r},t)}_processResults(e,t,a){var r=t.paginator,n=t.sorter;return this._allItems=this._originalProcessResults(e,a),this._allItems=n.sort(this._allItems),{results:r.getItemsForPage(this._allItems),count:this._allItems.length,allResults:this._allItems}}fetch(e,t,a){if(Object(l.isNil)(e)||e.tags||e.sorting)return super.fetch(e,t,a);var r=t.paginator,n=t.sorter;return e.sorting&&(this._allItems=n.sort(this._allItems)),Promise.resolve({results:r.getItemsForPage(this._allItems),count:this._allItems.length,allResults:this._allItems})}}class fh extends mh{_getRequest(e,t){var a=e.paginator,r=e.sorter,n=e.searchTerm,o=e.selectedTags;return this._originalGetRequest({page:a.page,page_size:a.itemsPerPage,order:r.compiled,q:Object(l.isString)(n)&&""!==n?n:void 0,tags:o},t)}}function bh(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function hh(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function gh(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?hh(Object(a),!0).forEach((function(t){yh(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):hh(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function yh(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class vh{_beforeUpdate(){return Object(l.isFunction)(this.onBeforeUpdate)?Promise.resolve(this.onBeforeUpdate(this.getState(),this.getCallbackContext())):Promise.resolve()}_afterUpdate(){return Object(l.isFunction)(this.onAfterUpdate)?Promise.resolve(this.onAfterUpdate(this.getState(),this.getCallbackContext())):Promise.resolve()}_changed(e){var t={paginator:this._paginator,sorter:this._sorter,searchTerm:this._searchTerm,selectedTags:this._selectedTags},a={},r=gh(gh({},this.getCallbackContext()),{},{setCustomParams:e=>{Object(l.extend)(a,e)}});return this._beforeUpdate().then(()=>{var n=Math.random().toString(36).substr(2);return this._currentFetchToken=n,this._fetcher.fetch(e,t,r).then(e=>{var t=e.results,r=e.count,o=e.allResults;if(this._currentFetchToken===n)return this._pageItems=t,this._allItems=o||null,this._paginator.setTotalCount(r),this._params=gh(gh({},this._params),a),this._afterUpdate()}).catch(e=>this.handleError(e))})}constructor(e){var t=e.getRequest,a=e.doRequest,r=e.processResults,n=e.isPlainList,o=void 0!==n&&n,i=e.sortByIteratees,s=void 0===i?void 0:i,c=bh(e,["getRequest","doRequest","processResults","isPlainList","sortByIteratees"]);yh(this,"onBeforeUpdate",null),yh(this,"onAfterUpdate",null),yh(this,"onError",null),yh(this,"sortByIteratees",void 0),yh(this,"getCallbackContext",()=>null),yh(this,"updatePagination",e=>{var t=e.page,a=e.itemsPerPage,r=this._paginator,n=r.page,o=r.itemsPerPage;this._paginator.setItemsPerPage(a),this._paginator.setPage(t),this._changed({pagination:{page:n!==this._paginator.page,itemsPerPage:o!==this._paginator.itemsPerPage}})}),yh(this,"toggleSorting",e=>{this._sorter.toggleField(e),this._savedOrderByField=this._sorter.field,this._changed({sorting:!0})}),yh(this,"updateSearch",e=>{this._searchTerm=e,""===e?this._sorter.setField(this._savedOrderByField):this._sorter.setField(null),this._paginator.setPage(1),this._changed({search:!0,pagination:{page:!0}})}),yh(this,"updateSelectedTags",e=>{this._selectedTags=e,this._paginator.setPage(1),this._changed({tags:!0,pagination:{page:!0}})}),yh(this,"update",()=>this._changed()),yh(this,"handleError",e=>{Object(l.isFunction)(this.onError)&&this.onError(e)}),Object(l.isFunction)(t)||(t=l.identity),this._fetcher=o?new ph({getRequest:t,doRequest:a,processResults:r}):new fh({getRequest:t,doRequest:a,processResults:r}),this.sortByIteratees=s,this.setState(c),this._pageItems=[],this._params={}}getState(){return{page:this._paginator.page,itemsPerPage:this._paginator.itemsPerPage,orderByField:this._sorter.field,orderByReverse:this._sorter.reverse,searchTerm:this._searchTerm,selectedTags:this._selectedTags,totalCount:this._paginator.totalCount,pageItems:this._pageItems,allItems:this._allItems,params:this._params}}setState(e){this._paginator=new lh(e),this._sorter=new dh(e,this.sortByIteratees),this._searchTerm=e.searchTerm||"",this._selectedTags=e.selectedTags||[],this._savedOrderByField=this._sorter.field}}class wh extends vh{constructor(e){var t=e.getResource,a=e.getItemProcessor,r=bh(e,["getResource","getItemProcessor"]);a=Object(l.isFunction)(a)?a:()=>null,super(gh(gh({},r),{},{doRequest:(e,a)=>t(a)(e),processResults:(e,t)=>{var r=a(t);return r=Object(l.isFunction)(r)?r:l.identity,Object(l.map)(e,e=>r(e,t))}}))}}function Oh(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Eh(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class _h{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._state=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Oh(Object(a),!0).forEach((function(t){Eh(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Oh(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)}getState(){return Object(l.defaults)(this._state,{page:1,itemsPerPage:Y.pageSize,orderByField:"created_at",orderByReverse:!1,searchTerm:"",tags:[]})}setState(){}}class jh extends _h{getState(){var e=super.getState(),t=A.search,a=t.q||"",r=""!==a?"":ch(e.orderByField,e.orderByReverse),n=uh(t.order||r),o=n.field,i=n.reverse;return{page:parseInt(t.page,10)||e.page,itemsPerPage:parseInt(t.page_size,10)||e.itemsPerPage,orderByField:o,orderByReverse:i,searchTerm:a}}setState(e){var t=e.page,a=e.itemsPerPage,r=e.orderByField,n=e.orderByReverse,o=e.searchTerm;A.setSearch({page:t,page_size:a,order:ch(r,n),q:""!==o?o:null},!0)}}function Sh(){return(Sh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ch(e){return n.a.createElement("div",{className:"text-center"},n.a.createElement(Pe,Sh({icon:"fa-spinner fa-2x fa-pulse",message:window.W_L.loading},e)))}function Ph(){return(Ph=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xh(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Lh extends n.a.Component{constructor(){var e;super(...arguments),e=this,xh(this,"listColumns",[{title:"ID",field:"id",width:"1%",align:"right",sorter:!0},yb.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g,{className:"table-main-title",href:"queries/"+t.id},t.name),n.a.createElement(Qb,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:window.W_L.name,field:"name",width:null}),yb.avatar({field:"user",className:"p-l-0 p-r-0"},e=>window.W_L.create_user+" ".concat(e)),yb.dateTime.sortable({title:window.W_L.create_time,field:"created_at"}),yb.duration.sortable({title:window.W_L.run_time,field:"runtime"}),yb.dateTime.sortable({title:window.W_L.last_exec_datetime,field:"retrieved_at",orderByField:"executed_at"}),yb.custom.sortable((e,t)=>n.a.createElement(Xb,{schedule:t.schedule,isNew:t.isNew()}),{title:window.W_L.update_schedule,field:"schedule"})]),xh(this,"state",{autoUpdate:!0}),xh(this,"_updateTimer",null),xh(this,"autoUpdateSwitchId",Object(l.uniqueId)("auto-update-switch")),xh(this,"update",(function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!t&&e.state.autoUpdate&&e.props.controller.update(),e._updateTimer=setTimeout(e.update,6e4)}))}componentDidMount(){Sa("view","page","admin/queries/outdated"),this.update(!0)}componentWillUnmount(){clearTimeout(this._updateTimer)}render(){var e=this.props.controller;return n.a.createElement(Lf,{activeTab:e.params.currentPage},n.a.createElement("div",{className:"m-15"},n.a.createElement("div",null,n.a.createElement("label",{htmlFor:this.autoUpdateSwitchId,className:"m-0"},window.W_L.auto_update),n.a.createElement(_o.a,{id:this.autoUpdateSwitchId,className:"m-l-10",checked:this.state.autoUpdate,onChange:e=>this.setState({autoUpdate:e})})),e.params.lastUpdatedAt&&n.a.createElement("div",{className:"m-t-5"},window.W_L.last_update_time,"：",n.a.createElement(Gf,{date:1e3*e.params.lastUpdatedAt}))),!e.isLoaded&&n.a.createElement(Ch,null),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center p-15"},"There are no outdated queries."),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(vb,{items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Db,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}xh(Lh,"propTypes",{controller:nh.isRequired});var kh=oh(Lh,()=>new vh({doRequest:(e,t)=>B.get("/api/admin/queries/outdated").then(e=>{var a=e.queries,r=e.updated_at;return t.setCustomParams({lastUpdatedAt:parseFloat(r)}),a}),processResults:e=>Object(l.map)(e,e=>new pr(e)),isPlainList:!0}),()=>new _h({orderByField:"created_at",orderByReverse:!0}));yf.register("Admin.OutdatedQueries",pa({path:"/admin/queries/outdated",title:window.W_L.out_date_query,render:e=>n.a.createElement(kh,Ph({},e,{currentPage:"outdated_queries"}))}));var Nh=a(66),Ah=a.n(Nh);function Th(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wh(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Wh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wh(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ih(e){var t=e.info;return t=Object(l.toPairs)(t),n.a.createElement(bn.a,{title:window.W_L.general,size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},window.W_L.no_data),t.length>0&&n.a.createElement(Ah.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Th(e,2),a=t[0],r=t[1];return n.a.createElement(Ah.a.Item,{extra:n.a.createElement("span",{className:"badge"},r)},sb(a))}}))}function qh(e){var t=e.info;return n.a.createElement(bn.a,{title:window.W_L.database,size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},window.W_L.no_data),t.length>0&&n.a.createElement(Ah.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Th(e,2),a=t[0],r=t[1];return n.a.createElement(Ah.a.Item,{extra:n.a.createElement("span",{className:"badge"},db(r))},a)}}))}function Dh(e){var t=e.info;return t=Object(l.toPairs)(t),n.a.createElement(bn.a,{title:window.W_L.queue,size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},window.W_L.no_data),t.length>0&&n.a.createElement(Ah.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Th(e,2),a=t[0],r=t[1];return n.a.createElement(Ah.a.Item,{extra:n.a.createElement("span",{className:"badge"},r.size)},a)}}))}function Rh(e){var t=e.info,a=t?[n.a.createElement(Ah.a.Item,{extra:n.a.createElement("span",{className:"badge"},n.a.createElement(Gf,{date:t.lastRefreshAt,placeholder:"n/a"}))},window.W_L.last_fresh),n.a.createElement(Ah.a.Item,{extra:n.a.createElement("span",{className:"badge"},n.a.createElement(Gf,{date:t.startedAt,placeholder:"n/a"}))},window.W_L.started),n.a.createElement(Ah.a.Item,{extra:n.a.createElement("span",{className:"badge"},t.outdatedQueriesCount)},window.W_L.outdated_query_count)]:[];return n.a.createElement(bn.a,{title:window.W_L.manage,size:"small"},!t&&n.a.createElement("div",{className:"text-muted text-center"},window.W_L.no_data),t&&n.a.createElement(Ah.a,{size:"small",itemLayout:"vertical",dataSource:a,renderItem:e=>e}))}a(1278);function Mh(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class zh extends n.a.Component{constructor(){super(...arguments),Mh(this,"state",{queues:[],manager:null,databaseMetrics:{},status:{}}),Mh(this,"_refreshTimer",null),Mh(this,"refresh",()=>{B.get("/status.json").then(e=>{this.setState({queues:e.manager.queues,manager:{startedAt:1e3*e.manager.started_at,lastRefreshAt:1e3*e.manager.last_refresh_at,outdatedQueriesCount:e.manager.outdated_queries_count},databaseMetrics:e.database_metrics.metrics||[],status:Object(l.omit)(e,["workers","manager","database_metrics"])})}).catch(e=>this.props.onError(e)),this._refreshTimer=setTimeout(this.refresh,6e4)})}componentDidMount(){Sa("view","page","admin/status"),this.refresh()}componentWillUnmount(){clearTimeout(this._refreshTimer)}render(){return n.a.createElement(Lf,{activeTab:"system_status"},n.a.createElement("div",{className:"system-status-page"},n.a.createElement("div",{className:"system-status-page-blocks"},n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Ih,{info:this.state.status})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Rh,{info:this.state.manager})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Dh,{info:this.state.queues})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(qh,{info:this.state.databaseMetrics})))))}}function Fh(){return(Fh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}Mh(zh,"propTypes",{onError:ae.a.func}),Mh(zh,"defaultProps",{onError:()=>{}}),yf.register("Admin.SystemStatus",pa({path:"/admin/status",title:window.W_L.out_date_query,render:e=>n.a.createElement(zh,e)}));var Vh={"greater than":">","less than":"<",equals:"="},Uh=e=>Object(l.merge)({},e,{options:{op:Vh[e.options.op]||e.options.op}}),Bh={query:()=>B.get("api/alerts"),get:e=>{var t=e.id;return B.get("api/alerts/".concat(t)).then(Uh)},save:e=>B.post((e=>e.id?"api/alerts/".concat(e.id):"api/alerts")(e),(e=>{var t=Fh({},e);return void 0===t.query_id&&(t.query_id=t.query.id,t.destination_id=t.destinations,delete t.query,delete t.destinations),t})(e)),delete:e=>B.delete("api/alerts/".concat(e.id)),mute:e=>B.post("api/alerts/".concat(e.id,"/mute")),unmute:e=>B.delete("api/alerts/".concat(e.id,"/mute"))};function Hh(){return(Hh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Yh(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Qh={unknown:"label-warning",ok:"label-success",triggered:"label-danger"};class Kh extends n.a.Component{constructor(){super(...arguments),Yh(this,"listColumns",[yb.custom.sortable((e,t)=>n.a.createElement("span",{title:t.options.muted?"Muted":"Active"},n.a.createElement("i",{className:"fa fa-bell-".concat(t.options.muted?"slash":"o"," p-r-0"),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},t.options.muted?"Muted":"Active")),{title:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-bell p-r-0","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Sort by notification status.")),field:"muted",width:"1%"}),yb.custom.sortable((e,t)=>n.a.createElement("div",null,n.a.createElement(g,{className:"table-main-title",href:"alerts/"+t.id},t.name)),{title:window.W_L.name,field:"name"}),yb.custom((e,t)=>t.user.name,{title:window.W_L.create_user,width:"1%"}),yb.custom.sortable((e,t)=>n.a.createElement("div",null,n.a.createElement("span",{className:"label ".concat(Qh[t.state])},Object(l.toUpper)(t.state))),{title:window.W_L.status,field:"state",width:"1%",className:"text-nowrap"}),yb.timeAgo.sortable({title:window.W_L.last_update_time,field:"updated_at",width:"1%"}),yb.dateTime.sortable({title:window.W_L.create_time,field:"created_at",width:"1%"})])}render(){var e=this.props.controller;return n.a.createElement("div",{className:"page-alerts-list"},n.a.createElement("div",{className:"container"},n.a.createElement(xf,{title:e.params.pageTitle,actions:H.hasPermission("list_alerts")?n.a.createElement(g.Button,{block:!0,type:"primary",href:"alerts/new"},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.new_alert):null}),n.a.createElement("div",null,e.isLoaded&&e.isEmpty?n.a.createElement(se,{name:"AlertsList.EmptyState"},n.a.createElement(Xp,{icon:"fa fa-bell-o",illustration:"alert",description:window.W_L.get_notice_event,helpMessage:n.a.createElement(Gp,{helpTriggerType:"ALERTS"}),showAlertStep:!0})):n.a.createElement("div",{className:"table-responsive bg-white tiled"},n.a.createElement(vb,{loading:!e.isLoaded,items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Db,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}Yh(Kh,"propTypes",{controller:nh.isRequired});var $h=oh(Kh,()=>new wh({isPlainList:!0,getRequest:()=>({}),getResource:()=>Bh.query.bind(Bh)}),()=>new _h({orderByField:"created_at",orderByReverse:!0,itemsPerPage:20}));yf.register("Alerts.List",pa({path:"/alerts",title:window.W_L.alerts,render:e=>n.a.createElement($h,Hh({},e,{currentPage:"alerts"}))}));var Gh=a(126),Jh=a.n(Gh);function Xh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Zh(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Zh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zh(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function eg(e){var t=e.doDelete,a=e.canEdit,o=e.mute,i=e.unmute,l=e.muted,s=Xh(Object(r.useState)(!1),2),c=s[0],u=s[1],d=Object(r.useCallback)(e=>{u(!0),e().finally(()=>{u(!1)})},[]),p=Object(r.useCallback)(()=>{R.a.confirm({title:window.W_L.delete_alert,content:window.W_L.delete_alert_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>{u(!0),t().catch(()=>{u(!1)})},maskClosable:!0,autoFocusButton:null})},[t]);return n.a.createElement(aa.a,{className:me()("m-l-5",{disabled:!a}),trigger:[a?"click":void 0],placement:"bottomRight",overlay:n.a.createElement(ue.a,null,n.a.createElement(ue.a.Item,null,l?n.a.createElement(be,{onClick:()=>d(i)},window.W_L.alert_unmute):n.a.createElement(be,{onClick:()=>d(o)},window.W_L.alert_mute)),n.a.createElement(ue.a.Item,null,n.a.createElement(be,{onClick:p},window.W_L.delete)))},n.a.createElement(m.a,{"aria-label":"More actions"},c?n.a.createElement(wf.a,null):n.a.createElement(Jh.a,{rotate:90,"aria-hidden":"true"})))}eg.propTypes={doDelete:ae.a.func.isRequired,canEdit:ae.a.bool.isRequired,mute:ae.a.func.isRequired,unmute:ae.a.func.isRequired,muted:ae.a.bool},eg.defaultProps={muted:!1};var tg=a(24),ag=a.n(tg);a(1279);function rg(e){var t=e.alert,a=e.editMode,r=e.name,o=e.onChange,i=e.children,l=by(t);return n.a.createElement("div",{className:"alert-header"},n.a.createElement("div",{className:"alert-title"},n.a.createElement("h3",null,a&&t.query?n.a.createElement(ba.a,{className:"f-inherit",placeholder:l,value:r,"aria-label":"Alert title",onChange:e=>o(e.target.value)}):r||l)),n.a.createElement("div",{className:"alert-actions"},i))}rg.propTypes={alert:Hf.isRequired,name:ae.a.string,children:ae.a.node,onChange:ae.a.func,editMode:ae.a.bool},rg.defaultProps={name:null,children:null,onChange:null,editMode:!1};var ng=a(202),og=a.n(ng),ig=a(131),lg=a.n(ig),sg=(a(1280),{">":">",">=":"≥","<":"<","<=":"≤","==":"=","!=":"≠"}),cg=["==","!="];function ug(e){var t=e.children,a=e.minWidth;return n.a.createElement("div",{className:"criteria-disabled-input",style:{minWidth:a}},t)}function dg(e){var t=e.columnNames,a=e.resultValues,r=e.alertOptions,o=e.onChange,i=e.editMode,s=Object(l.isEmpty)(a)?null:Object(l.head)(a)[r.column],c=Object(l.includes)(cg,r.op)?null:isNaN(r.value)?window.W_L.type_not_match_value:isNaN(s)?window.W_L.type_not_match_condition:null,u=n.a.createElement("small",{className:"alert-criteria-hint"},window.W_L.top_value," ",n.a.createElement("code",{className:"p-0"},Object(l.toString)(s)||"unknown"));return n.a.createElement("div",{"data-test":"Criteria"},n.a.createElement("div",{className:"input-title"},n.a.createElement("span",{className:"input-label"},window.W_L.column_value),i?n.a.createElement(ln.a,{value:r.column,onChange:e=>o({column:e}),dropdownMatchSelectWidth:!1,style:{minWidth:100}},t.map(e=>n.a.createElement(ln.a.Option,{key:e},e))):n.a.createElement(ug,{minWidth:70},r.column)),n.a.createElement("div",{className:"input-title"},n.a.createElement("span",{className:"input-label"},window.W_L.condition),i?n.a.createElement(ln.a,{value:r.op,onChange:e=>o({op:e}),optionLabelProp:"label",dropdownMatchSelectWidth:!1,style:{width:55}},n.a.createElement(ln.a.Option,{value:">",label:sg[">"]},sg[">"]," ",window.W_L.great_then),n.a.createElement(ln.a.Option,{value:">=",label:sg[">="]},sg[">="]," ",window.W_L.great_and_equals),n.a.createElement(ln.a.Option,{disabled:!0,key:"dv1"},n.a.createElement(lg.a,{className:"select-option-divider m-t-10 m-b-5"})),n.a.createElement(ln.a.Option,{value:"<",label:sg["<"]},sg["<"]," ",window.W_L.less_then),n.a.createElement(ln.a.Option,{value:"<=",label:sg["<="]},sg["<="]," ",window.W_L.less_and_equals),n.a.createElement(ln.a.Option,{disabled:!0,key:"dv2"},n.a.createElement(lg.a,{className:"select-option-divider m-t-10 m-b-5"})),n.a.createElement(ln.a.Option,{value:"==",label:sg["=="]},sg["=="],"  ",window.W_L.equals),n.a.createElement(ln.a.Option,{value:"!=",label:sg["!="]},sg["!="],"  ",window.W_L.not_equals)):n.a.createElement(ug,{minWidth:50},sg[r.op])),n.a.createElement("div",{className:"input-title"},n.a.createElement("label",{className:"input-label",htmlFor:"threshold-criterion"},window.W_L.threshold),i?n.a.createElement(ba.a,{id:"threshold-criterion",style:{width:90},value:r.value,onChange:e=>o({value:e.target.value})}):n.a.createElement(ug,{minWidth:50},r.value)),n.a.createElement("div",{className:"ant-form-item-explain"},u,n.a.createElement("br",null),c&&n.a.createElement("small",null,n.a.createElement(og.a,{className:"warning-icon-danger"})," ",c)))}ug.propTypes={children:ae.a.node.isRequired,minWidth:ae.a.number.isRequired},dg.propTypes={columnNames:ae.a.arrayOf(ae.a.string).isRequired,resultValues:ae.a.arrayOf(ae.a.object).isRequired,alertOptions:Bf.isRequired,onChange:ae.a.func,editMode:ae.a.bool},dg.defaultProps={onChange:()=>{},editMode:!1};a(1283);function mg(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function pg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fg(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fg(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var bg=[[window.W_L.second,1],[window.W_L.minute,60],[window.W_L.hour,3600],[window.W_L.day,86400],[window.W_L.week,604800]];function hg(e){var t=e.value,a=e.onChange,o=e.editMode,i=pg(Object(r.useState)(),2),s=i[0],c=i[1],u=pg(Object(r.useState)(),2),d=u[0],m=u[1];if(Object(r.useEffect)(()=>{for(var e=bg.length-1;e>=0;e-=1){var a=pg(bg[e],2)[1];if(t%a==0){c(e),m(t/a);break}}},[t]),!Object(l.isNumber)(d)||!Object(l.isNumber)(s))return null;var p=1!==d?"s":"";if(o)return n.a.createElement(n.a.Fragment,null,n.a.createElement(cn.a,{value:d,onChange:e=>{m(e),a(e*bg[s][1])},min:1,precision:0}),n.a.createElement(ln.a,{value:s,onChange:e=>{c(e),a(d*bg[e][1])}},bg.map((e,t)=>{var a=pg(e,1)[0];return n.a.createElement(ln.a.Option,{value:t,key:a},a,p)})));var f=pg(bg[s],1)[0];return d+" "+Object(l.toLower)(f)+p}function gg(e){var t=e.value,a=e.onChange,o=pg(Object(r.useState)(t<2?t:2),2),i=o[0],l=o[1];return n.a.createElement("div",{className:"alert-rearm"},n.a.createElement(ln.a,{optionLabelProp:"label",defaultValue:i||0,dropdownMatchSelectWidth:!1,onChange:e=>{l(e),a(e<2?e:3600)}},n.a.createElement(ln.a.Option,{value:0,label:window.W_L.alert_one_time},window.W_L.alert_one_time_tip),n.a.createElement(ln.a.Option,{value:1,label:window.W_L.alert_every_time},window.W_L.alert_every_time_tip),n.a.createElement(ln.a.Option,{value:2,label:window.W_L.alert_most_once},window.W_L.alert_most_once_tip)),2===i&&t&&n.a.createElement(hg,{value:t,onChange:a,editMode:!0}))}function yg(e){var t=e.value,a="";switch(t){case 0:a=window.W_L.alert_one_time_tip;break;case 1:a=window.W_L.alert_every_time_tip;break;default:a=n.a.createElement(n.a.Fragment,null,window.W_L.alert_most_once_tip," ",n.a.createElement(hg,{value:t,editMode:!1}))}return n.a.createElement("span",null,window.W_L.notice_will_send," ",a,".")}function vg(e){var t=e.editMode,a=mg(e,["editMode"]);return t?n.a.createElement(gg,a):n.a.createElement(yg,a)}function wg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Og(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Og(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Og(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Eg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.initialResults,n=void 0===a?null:a,o=t.debounceTimeout,i=void 0===o?200:o,l=Object(r.useState)(n),s=wg(l,2),c=s[0],u=s[1],d=Object(r.useState)(!1),m=wg(d,2),p=m[0],f=m[1],b=Object(r.useRef)(null),h=Object(r.useRef)(!1),g=Object(Ml.a)(t=>{f(!0),b.current=t,e(t).catch(()=>n).then(e=>{t!==b.current||h.current||(u(e),f(!1))})},i),y=wg(g,1),v=y[0];return Object(r.useEffect)(()=>()=>{h.current=!0},[]),[v,c,p]}function _g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return jg(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return jg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jg(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}hg.propTypes={onChange:ae.a.func,value:ae.a.number.isRequired,editMode:ae.a.bool.isRequired},hg.defaultProps={onChange:()=>{}},gg.propTypes={onChange:ae.a.func.isRequired,value:ae.a.number.isRequired},yg.propTypes={value:ae.a.number.isRequired},vg.propTypes={onChange:ae.a.func,value:ae.a.number.isRequired,editMode:ae.a.bool},vg.defaultProps={onChange:null,editMode:!1};var Sg=ln.a.Option;function Cg(e){return null===e?Promise.resolve(null):e?pr.query({q:e}).then(e=>e.results):pr.recent().then(e=>e.filter(e=>!e.is_draft))}function Pg(e){var t=_g(Object(r.useState)(""),2),a=t[0],o=t[1],i=_g(Object(r.useState)(),2),s=i[0],c=i[1],u=_g(Eg(Cg,{initialResults:[]}),3),d=u[0],m=u[1],p=u[2],f=window.W_L.search_by_name,b=n.a.createElement("i",{className:"fa fa-times hide-in-percy",role:"button",tabIndex:0,"aria-label":"Clear",onClick:()=>g(null)}),h=n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:me()("fa fa-spinner fa-pulse hide-in-percy",{hidden:!p}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Searching..."));function g(t){var a=null;t&&((a=Object(l.find)(m,{id:t}))||of.error("Something went wrong...","Couldn't select query")),o(a?null:""),c(a),e.onChange(a)}if(Object(r.useEffect)(()=>{d(a)},[d,a]),Object(r.useEffect)(()=>{e.selectedQuery&&c(e.selectedQuery)},[e.selectedQuery]),e.disabled)return n.a.createElement(ba.a,{value:s&&s.name,"aria-label":"Tied query",placeholder:f,disabled:!0});if("select"===e.type){var y=s?b:null,v=s?s.name:a;return n.a.createElement(ln.a,{showSearch:!0,dropdownMatchSelectWidth:!1,placeholder:f,value:v||void 0,onSearch:o,onChange:g,suffixIcon:p?h:y,notFoundContent:null,filterOption:!1,defaultActiveFirstOption:!1,className:e.className,"data-test":"QuerySelector"},m&&m.map(e=>{var t=e.is_draft;return n.a.createElement(Sg,{value:e.id,key:e.id,disabled:t,className:"query-selector-result","data-test":"QueryId".concat(e.id)},e.name," ",n.a.createElement(Qb,{isDraft:e.is_draft,tags:e.tags,className:me()("inline-tags-control",{disabled:t})}))}))}return n.a.createElement("span",{"data-test":"QuerySelector"},s?n.a.createElement(ba.a,{value:s.name,"aria-label":"Tied query",suffix:b,readOnly:!0}):n.a.createElement(ba.a,{placeholder:f,value:a,"aria-label":"Tied query",onChange:e=>o(e.target.value),suffix:h}),n.a.createElement("div",{className:"scrollbox",style:{maxHeight:"50vh",marginTop:15}},m&&(m.length?n.a.createElement("ul",{className:"list-group"},m.map(e=>n.a.createElement(be,{className:me()("query-selector-result","list-group-item",{inactive:e.is_draft}),key:e.id,role:"listitem",onClick:()=>g(e.id),"data-test":"QueryId".concat(e.id)},e.name," ",n.a.createElement(Qb,{isDraft:e.is_draft,tags:e.tags,className:"inline-tags-control"})))):n.a.createElement("div",{className:"text-muted"},window.W_L.find_nothing))))}Pg.propTypes={onChange:ae.a.func.isRequired,selectedQuery:ae.a.object,type:ae.a.oneOf(["select","default"]),className:ae.a.string,disabled:ae.a.bool},Pg.defaultProps={selectedQuery:null,type:"default",className:null,disabled:!1};var xg=a(674),Lg=a.n(xg);a(1284);function kg(e){var t=e.query,a=e.queryResult,r=e.onChange,o=e.editMode,i=t&&t.schedule?n.a.createElement("small",null,"Scheduled to refresh"," ",n.a.createElement("i",{className:"alert-query-schedule"},n.a.createElement(Xb,{schedule:t.schedule,isNew:!1}))):n.a.createElement("small",null,n.a.createElement(og.a,{className:"warning-icon-danger"})," ",window.W_L.query_not_setting," ",n.a.createElement("i",null,window.W_L.auto_flush),"."," ",n.a.createElement(we,{title:window.W_L.query_setting_tip},n.a.createElement("a",{role:"presentation"},window.W_L.recommend," ",n.a.createElement(Lg.a,null))));return n.a.createElement(n.a.Fragment,null,o?n.a.createElement(Pg,{onChange:r,selectedQuery:t,className:"alert-query-selector",type:"select"}):n.a.createElement(we,{title:window.W_L.open_query_in_new_tab},n.a.createElement(g,{href:"queries/".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:"alert-query-link"},t.name," ",n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))),n.a.createElement("div",{className:"ant-form-item-explain"},t&&i),t&&!a&&n.a.createElement("div",{className:"m-t-30"},n.a.createElement(wf.a,{className:"m-r-5"})," ",window.W_L.load_query_result))}kg.propTypes={query:Uf,queryResult:ae.a.object,onChange:ae.a.func,editMode:ae.a.bool},kg.defaultProps={query:null,queryResult:null,onChange:()=>{},editMode:!1};a(1287);function Ng(){return(Ng=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ag(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Tg(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Tg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tg(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Wg(e){var t=e.items,a=e.renderItem,o=e.onItemClick,i=Object(r.useCallback)(e=>{var t=a(e),r=t.content,i=t.className,l=t.isDisabled;return n.a.createElement(Ah.a.Item,{className:me()("select-items-list","w-100","p-l-10","p-r-10",{disabled:l},i),onClick:l?null:()=>o(e)},r)},[a,o]);return n.a.createElement(Ah.a,{size:"small",dataSource:t,renderItem:i})}function Ig(e){var t=e.dialog,a=e.dialogTitle,o=e.inputPlaceholder,i=e.itemKey,s=e.renderItem,c=e.renderStagedItem,u=e.searchItems,d=e.selectedItemsTitle,p=e.width,f=e.showCount,b=e.extraFooterContent,h=Ag(Object(r.useState)([]),2),g=h[0],y=h[1],v=Ag(Eg(u,{initialResults:[]}),3),w=v[0],O=v[1],E=v[2],_=O.length>0;Object(r.useEffect)(()=>{w()},[w]);var j=Object(r.useCallback)(e=>{var t=i(e);return!!Object(l.find)(g,e=>i(e)===t)},[g,i]),S=Object(r.useCallback)(e=>{if(j(e)){var t=i(e);y(Object(l.filter)(g,e=>i(e)!==t))}else y([...g,e])},[g,i,j]),C=Object(r.useCallback)(()=>{t.close(g).catch(e=>{e&&of.error(window.W_L.save_failed)})},[t,g]);return n.a.createElement(R.a,Ng({},t.props,{className:"select-items-dialog",width:p,title:a,footer:n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("span",{className:"flex-fill m-r-5",style:{textAlign:"left",color:"rgba(0, 0, 0, 0.5)"}},b),n.a.createElement(m.a,Ng({},t.props.cancelButtonProps,{onClick:t.dismiss}),window.W_L.cancel),n.a.createElement(m.a,Ng({},t.props.okButtonProps,{onClick:C,disabled:0===g.length||t.props.okButtonProps.disabled,type:"primary"}),window.W_L.save,f&&!Object(l.isEmpty)(g)?" (".concat(Object(l.size)(g),")"):null))}),n.a.createElement("div",{className:"d-flex align-items-center m-b-10"},n.a.createElement("div",{className:"flex-fill"},n.a.createElement(ba.a.Search,{onChange:e=>w(e.target.value),placeholder:o,"aria-label":o,autoFocus:!0})),c&&n.a.createElement("div",{className:"w-50 m-l-20"},n.a.createElement("h5",{className:"m-0"},d))),n.a.createElement("div",{className:"d-flex align-items-stretch",style:{minHeight:"30vh",maxHeight:"50vh"}},n.a.createElement("div",{className:"flex-fill scrollbox"},E&&n.a.createElement(Ch,{className:""}),!E&&!_&&n.a.createElement(Pe,{icon:"fa-search",message:window.W_L.find_nothing,className:""}),!E&&_&&n.a.createElement(Wg,{items:O,renderItem:e=>s(e,{isSelected:j(e)}),onItemClick:S})),c&&n.a.createElement("div",{className:"w-50 m-l-20 scrollbox"},g.length>0&&n.a.createElement(Wg,{items:g,renderItem:e=>c(e,{isSelected:!0}),onItemClick:S}))))}Wg.propTypes={items:ae.a.array,renderItem:ae.a.func,onItemClick:ae.a.func},Wg.defaultProps={items:[],renderItem:()=>{},onItemClick:()=>{}},Ig.propTypes={dialog:wa.isRequired,dialogTitle:ae.a.string,inputPlaceholder:ae.a.string,selectedItemsTitle:ae.a.string,searchItems:ae.a.func.isRequired,itemKey:ae.a.func,renderItem:ae.a.func,renderStagedItem:ae.a.func,width:ae.a.oneOfType([ae.a.string,ae.a.number]),extraFooterContent:ae.a.node,showCount:ae.a.bool},Ig.defaultProps={dialogTitle:window.W_L.add,inputPlaceholder:window.W_L.search,selectedItemsTitle:window.W_L.selected,itemKey:e=>e.id,renderItem:()=>"",renderStagedItem:null,width:"80%",extraFooterContent:null,showCount:!1};var qg=Oa(Ig),Dg="static/images/destinations",Rg={query:()=>B.get("api/destinations"),get:e=>{var t=e.id;return B.get("api/destinations/".concat(t))},types:()=>B.get("api/destinations/types"),create:e=>B.post("api/destinations",e),save:e=>B.post("api/destinations/".concat(e.id),e),delete:e=>{var t=e.id;return B.delete("api/destinations/".concat(t))}},Mg={query:e=>{var t=e.alertId;return B.get("api/alerts/".concat(t,"/subscriptions"))},create:e=>B.post("api/alerts/".concat(e.alert_id,"/subscriptions"),e),delete:e=>B.delete("api/alerts/".concat(e.alert_id,"/subscriptions/").concat(e.id))};function zg(e){var t=e.isSelected,a=e.isStaged,r=e.alreadyInGroup,o=e.deselectedIcon;return a?n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-remove","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Remove")):r?n.a.createElement(we,{title:window.W_L.selected_ready},n.a.createElement("span",{tabIndex:0},n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},window.W_L.selected_ready))):t?n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Selected")):n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa ".concat(o),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Select"))}function Fg(e){var t=e.featureName,a=e.className,r=e.mode,o=e.adminOnly,i=Se("sr-mail-description");if(!Y.mailSettingsMissing)return null;if(o&&!H.isAdmin)return null;var l=n.a.createElement("span",{id:i},window.W_L.email_need_set,"，“",t," ” ",window.W_L.email_will_work," ",n.a.createElement($e,{type:"MAIL_CONFIG",className:"f-inherit"}));return"icon"===r?n.a.createElement(we,{title:l,placement:"topRight",arrowPointAtCenter:!0},n.a.createElement("span",{className:a,"aria-label":"Mail alert","aria-describedby":i,tabIndex:0},n.a.createElement("i",{className:"fa fa-exclamation-triangle","aria-hidden":"true"}))):n.a.createElement(u.a,{message:l,type:"error",className:a})}zg.propTypes={isSelected:ae.a.bool,isStaged:ae.a.bool,alreadyInGroup:ae.a.bool,deselectedIcon:ae.a.string},zg.defaultProps={isSelected:!1,isStaged:!1,alreadyInGroup:!1,deselectedIcon:"fa-angle-double-right"},Fg.propTypes={featureName:ae.a.string.isRequired,className:ae.a.string,mode:ae.a.oneOf(["alert","icon"]),adminOnly:ae.a.bool},Fg.defaultProps={className:null,mode:"alert",adminOnly:!1};a(1288);function Vg(){return(Vg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ug(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Bg(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Bg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bg(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Hg(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Yg(e){return e.destination||(e.destination={id:-1,name:e.user.email,icon:"DEPRECATED",type:"email"}),e}function Qg(e){var t=e.destination,a=t.name,r=t.type,o=e.user,i=e.unsubscribe,l=H.isAdmin||H.id===o.id;return n.a.createElement("li",{className:"destination-wrapper"},n.a.createElement("img",{src:"".concat(Dg,"/").concat(r,".png"),className:"destination-icon",alt:a}),n.a.createElement("span",{className:"flex-fill"},a),"email"===r&&n.a.createElement(Fg,{className:"destination-warning",featureName:"alert emails",mode:"icon"}),l&&n.a.createElement(we,{title:window.W_L.delete,mouseEnterDelay:.5},n.a.createElement(be,{className:"remove-button",onClick:i},n.a.createElement(je.a,null))))}Qg.propTypes={destination:Vf.isRequired,user:Ff.isRequired,unsubscribe:ae.a.func.isRequired};class Kg extends n.a.Component{constructor(){super(...arguments),Hg(this,"state",{dests:[],subs:null}),Hg(this,"showAddAlertSubDialog",()=>{var e=this.state,t=e.dests,a=e.subs;qg.showModal({width:570,showCount:!0,extraFooterContent:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-info-circle","aria-hidden":"true"})," Create new destinations in"," ",n.a.createElement(we,{title:window.W_L.open_new_window},n.a.createElement(g,{href:"destinations/new",target:"_blank"},window.W_L.alert_setting))),dialogTitle:window.W_L.add_alert_setting,inputPlaceholder:window.W_L.search,searchItems:e=>(e=Object(l.toLower)(e),Promise.resolve(t.filter(t=>Object(l.includes)(Object(l.toLower)(t.name),e)))),renderItem:(e,t)=>{var r=t.isSelected,o=!!Object(l.find)(a,t=>t.destination.id===e.id);return{content:n.a.createElement("div",{className:"destination-wrapper"},n.a.createElement("img",{src:"".concat(Dg,"/").concat(e.type,".png"),className:"destination-icon",alt:e.name}),n.a.createElement("span",{className:"flex-fill"},e.name),n.a.createElement(zg,{isSelected:r,alreadyInGroup:o,deselectedIcon:"fa-plus"})),isDisabled:o,className:r||o?"selected":""}}}).onClose(e=>{var t=Object(l.map)(e,e=>this.subscribe(e));return Promise.all(t).then(()=>{of.success(window.W_L.subscribed)}).catch(()=>(of.error(window.W_L.subscribe_failed),Promise.reject(null)))})}),Hg(this,"onUserEmailToggle",e=>{e?this.unsubscribe(e):this.subscribe()}),Hg(this,"subscribe",e=>{var t={alert_id:this.props.alertId};return e&&(t.destination_id=e.id),Mg.create(t).then(e=>{var t=this.state.subs;this.setState({subs:[...t,Yg(e)]})})}),Hg(this,"unsubscribe",e=>{Mg.delete(e).then(()=>{var t=this.state.subs;this.setState({subs:Object(l.without)(t,e)})}).catch(()=>{of.error(window.W_L.subscribe_failed)})})}componentDidMount(){var e=this.props.alertId;Promise.all([Rg.query(),Mg.query({alertId:e})]).then(e=>{var t=Ug(e,2),a=t[0],r=t[1];r=r.map(Yg),this.setState({dests:a,subs:r})})}render(){if(!this.props.alertId)return null;var e=this.state.subs,t=Object(l.find)(e,{destination:{id:-1},user:{id:H.id}}),a=Object(l.without)(e,t),r=Y.mailSettingsMissing;return n.a.createElement("div",{className:"alert-destinations","data-test":"AlertDestinations"},n.a.createElement(we,{title:window.W_L.add_alert_setting,mouseEnterDelay:.5},n.a.createElement(m.a,{"data-test":"ShowAddAlertSubDialog",type:"primary",size:"small",className:"add-button",onClick:this.showAddAlertSubDialog},n.a.createElement("i",{className:"fa fa-plus f-12 m-r-5","aria-hidden":"true"})," ",window.W_L.add)),n.a.createElement("ul",null,n.a.createElement("li",{className:"destination-wrapper"},n.a.createElement("i",{className:"destination-icon fa fa-envelope","aria-hidden":"true"}),n.a.createElement("span",{className:"flex-fill"},H.email),n.a.createElement(Fg,{className:"destination-warning",featureName:"alert emails",mode:"icon"}),!r&&n.a.createElement(_o.a,{size:"small",className:"toggle-button",checked:!!t,loading:!e,onChange:()=>this.onUserEmailToggle(t),"data-test":"UserEmailToggle"})),a.map(e=>n.a.createElement(Qg,Vg({key:e.id,unsubscribe:()=>this.unsubscribe(e)},e)))))}}function $g(){return($g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Gg(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Jg(e){var t=e.children,a=e.label,r=e.className,o=Gg(e,["children","label","className"]),i={span:16};return a||(i.offset=4),r=me()("alert-form-item",r),n.a.createElement(ag.a.Item,$g({labelCol:{span:4},wrapperCol:i,label:a,className:r},o),t)}function Xg(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Zg(e){var t=e.state,a=e.lastTriggered;return n.a.createElement("div",{className:"alert-state"},n.a.createElement("span",{className:"alert-state-indicator label ".concat(Qh[t])},window.W_L.status,": ",t),"unknown"===t&&n.a.createElement("div",{className:"ant-form-item-explain"},window.W_L.alert_setting_sure),a&&n.a.createElement("div",{className:"ant-form-item-explain"},window.W_L.last_trigger_time," "," ",n.a.createElement("span",{className:"alert-last-triggered"},n.a.createElement(Gf,{date:a}))))}Hg(Kg,"propTypes",{alertId:ae.a.any.isRequired}),Jg.propTypes={children:ae.a.node,label:ae.a.string,className:ae.a.string},Jg.defaultProps={children:null,label:null,className:null},Zg.propTypes={state:ae.a.string.isRequired,lastTriggered:ae.a.string},Zg.defaultProps={lastTriggered:null};class ey extends n.a.Component{constructor(){super(...arguments),Xg(this,"state",{unmuting:!1}),Xg(this,"unmute",()=>{this.setState({unmuting:!0}),this.props.unmute().finally(()=>{this.setState({unmuting:!1})})})}render(){var e=this.props,t=e.alert,a=e.queryResult,r=e.canEdit,o=e.onEdit,i=e.menuButton,l=t.query,s=t.name,c=t.options,d=t.rearm;return n.a.createElement(n.a.Fragment,null,n.a.createElement(rg,{name:s,alert:t},n.a.createElement(se,{name:"AlertView.HeaderExtra",alert:t}),n.a.createElement(we,{title:r?"":window.W_L.no_permission_edit_alert},n.a.createElement(m.a,{type:"default",onClick:r?o:null,className:me()({disabled:!r})},n.a.createElement("i",{className:"fa fa-edit m-r-5","aria-hidden":"true"}),window.W_L.edit),i)),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement(ao.Row,{type:"flex",gutter:16},n.a.createElement(ao.Col,{xs:24,md:16,className:"d-flex"},n.a.createElement(ag.a,{className:"flex-fill"},n.a.createElement(Jg,null,n.a.createElement(Zg,{state:t.state,lastTriggered:t.last_triggered_at})),n.a.createElement(Jg,{label:window.W_L.query},n.a.createElement(kg,{query:l,queryResult:a})),a&&c&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Jg,{label:window.W_L.trigger_condition,className:"alert-criteria"},n.a.createElement(dg,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:c})),n.a.createElement(Jg,{label:window.W_L.notice,className:"form-item-line-height-normal"},n.a.createElement(vg,{value:d||0}),n.a.createElement("br",null),window.W_L.set," ",c.custom_subject||c.custom_body?window.W_L.custom:window.W_L.default," ",window.W_L.notice_template)))),n.a.createElement(ao.Col,{xs:24,md:8},c.muted&&n.a.createElement(u.a,{className:"m-b-20",message:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-bell-slash-o","aria-hidden":"true"})," ",window.W_L.set_mute),description:n.a.createElement(n.a.Fragment,null,window.W_L.alert_not_sent_info,n.a.createElement("br",null),r&&n.a.createElement(n.a.Fragment,null,window.W_L.reset_alert_sent_info,n.a.createElement(m.a,{size:"small",type:"primary",onClick:this.unmute,loading:this.state.unmuting,className:"m-t-5 m-l-5"},window.W_L.set_unmute))),type:"warning"}),n.a.createElement("h4",null,window.W_L.destination," ",n.a.createElement(we,{title:window.W_L.set_alert_open_tab},n.a.createElement(g,{href:"destinations",target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link f-13","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")))),n.a.createElement(Kg,{alertId:t.id})))))}}ey.propTypes={alert:Hf.isRequired,queryResult:ae.a.object,canEdit:ae.a.bool.isRequired,onEdit:ae.a.func.isRequired,menuButton:ae.a.node.isRequired,unmute:ae.a.func},ey.defaultProps={queryResult:null,unmute:null};a(1300);function ty(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ay(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ay(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ay(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ry(e){var t=e.alert,a=e.query,o=e.columnNames,i=e.resultValues,s=e.subject,c=e.setSubject,u=e.body,d=e.setBody,m=!(!s&&!u),p=ty(Object(r.useState)(m?1:0),2),f=p[0],b=p[1],h=ty(Object(r.useState)(!1),2),g=h[0],y=h[1],v=function(e,t,a,r){var n=Object(l.isEmpty)(r)?null:Object(l.head)(r)[e.options.column];return{ALERT_STATUS:"TRIGGERED",ALERT_CONDITION:e.options.op,ALERT_THRESHOLD:e.options.value,ALERT_NAME:e.name,ALERT_URL:"".concat(window.location.origin,"/alerts/").concat(e.id),QUERY_NAME:t.name,QUERY_URL:"".concat(window.location.origin,"/queries/").concat(t.id),QUERY_RESULT_VALUE:Object(l.isNull)(n)||Object(l.isUndefined)(n)?"UNKNOWN":n,QUERY_RESULT_ROWS:r,QUERY_RESULT_COLS:a}}(t,a,o,i),w=e=>Ua.a.render(e||"",v);return n.a.createElement("div",{className:"alert-template"},n.a.createElement(ln.a,{value:f,onChange:e=>{e||!m?(b(e),y(!1)):R.a.confirm({title:window.W_L.are_you_sure,content:window.W_L.switch_warning,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,onOk:()=>{c(null),d(null),b(e),y(!1)},maskClosable:!0,autoFocusButton:null})},optionLabelProp:"label",dropdownMatchSelectWidth:!1,style:{width:"fit-content"}},n.a.createElement(ln.a.Option,{value:0,label:window.W_L.use_default_template},window.W_L.default_template),n.a.createElement(ln.a.Option,{value:1,label:window.W_L.use_custom_template},window.W_L.custom_template)),!!f&&n.a.createElement("div",{className:"alert-custom-template","data-test":"AlertCustomTemplate"},n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("h5",{className:"flex-fill"},window.W_L.subject," / ",window.W_L.content),window.W_L.preview," ",n.a.createElement(_o.a,{size:"small",className:"alert-template-preview",value:g,onChange:y})),n.a.createElement(ba.a,{value:g?w(s):s,"aria-label":"Subject",onChange:e=>c(e.target.value),disabled:g,"data-test":"CustomSubject"}),n.a.createElement(ba.a.TextArea,{value:g?w(u):u,"aria-label":"Body",autoSize:{minRows:9},onChange:e=>d(e.target.value),disabled:g,"data-test":"CustomBody"}),n.a.createElement($e,{type:"ALERT_NOTIF_TEMPLATE_GUIDE",className:"f-13"},n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"})," ",window.W_L.guide_format," ",n.a.createElement("span",{className:"sr-only"},"(",window.W_L.help,")"))))}ry.propTypes={alert:Hf.isRequired,query:Uf.isRequired,columnNames:ae.a.arrayOf(ae.a.string).isRequired,resultValues:ae.a.arrayOf(ae.a.any).isRequired,subject:ae.a.string,setSubject:ae.a.func.isRequired,body:ae.a.string,setBody:ae.a.func.isRequired},ry.defaultProps={subject:"",body:""};var ny=ry;function oy(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class iy extends n.a.Component{constructor(){super(...arguments),oy(this,"_isMounted",!1),oy(this,"state",{saving:!1}),oy(this,"save",()=>{this.setState({saving:!0}),this.props.save().catch(()=>{this._isMounted&&this.setState({saving:!1})})}),oy(this,"cancel",()=>{this.props.cancel()})}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}render(){var e=this.props,t=e.alert,a=e.queryResult,r=e.pendingRearm,o=e.onNotificationTemplateChange,i=e.menuButton,l=this.props,s=l.onQuerySelected,c=l.onNameChange,u=l.onRearmChange,d=l.onCriteriaChange,p=t.query,f=t.name,b=t.options,h=this.state.saving;return n.a.createElement(n.a.Fragment,null,n.a.createElement(rg,{name:f,alert:t,onChange:c,editMode:!0},n.a.createElement(se,{name:"AlertEdit.HeaderExtra",alert:t}),n.a.createElement(m.a,{className:"m-r-5",onClick:()=>this.cancel()},n.a.createElement("i",{className:"fa fa-times m-r-5","aria-hidden":"true"}),window.W_L.cancel),n.a.createElement(m.a,{type:"primary",onClick:()=>this.save()},h?n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},window.W_L.saving)):n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-check m-r-5","aria-hidden":"true"})),window.W_L.save),i),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement("div",{className:"d-flex"},n.a.createElement(ag.a,{className:"flex-fill"},n.a.createElement(Jg,{label:"{window.W_L.query}"},n.a.createElement(kg,{query:p,queryResult:a,onChange:s,editMode:!0})),a&&b&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Jg,{label:window.W_L.trigger_condition,className:"alert-criteria"},n.a.createElement(dg,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:b,onChange:d,editMode:!0})),n.a.createElement(Jg,{label:window.W_L.trigger_send_notice},n.a.createElement(vg,{value:r||0,onChange:u,editMode:!0})),n.a.createElement(Jg,{label:window.W_L.template},n.a.createElement(ny,{alert:t,query:p,columnNames:a.getColumnNames(),resultValues:a.getData(),subject:b.custom_subject,setSubject:e=>o({custom_subject:e}),body:b.custom_body,setBody:e=>o({custom_body:e})})))),n.a.createElement("div",null,n.a.createElement($e,{className:"f-13",type:"ALERT_SETUP"},window.W_L.setup_tip," ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"( ",window.W_L.help," )"))))))}}function ly(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}iy.propTypes={alert:Hf.isRequired,queryResult:ae.a.object,pendingRearm:ae.a.number,menuButton:ae.a.node.isRequired,save:ae.a.func.isRequired,cancel:ae.a.func.isRequired,onQuerySelected:ae.a.func.isRequired,onNameChange:ae.a.func.isRequired,onCriteriaChange:ae.a.func.isRequired,onRearmChange:ae.a.func.isRequired,onNotificationTemplateChange:ae.a.func.isRequired},iy.defaultProps={queryResult:null,pendingRearm:null};class sy extends n.a.Component{constructor(){super(...arguments),ly(this,"state",{saving:!1}),ly(this,"save",()=>{this.setState({saving:!0}),this.props.save().catch(()=>{this.setState({saving:!1})})})}render(){var e=this.props,t=e.alert,a=e.queryResult,r=e.pendingRearm,o=e.onNotificationTemplateChange,i=this.props,l=i.onQuerySelected,s=i.onNameChange,c=i.onRearmChange,u=i.onCriteriaChange,d=t.query,p=t.name,f=t.options,b=this.state.saving;return n.a.createElement(n.a.Fragment,null,n.a.createElement(rg,{alert:t,name:p,onChange:s,editMode:!0}),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement("div",{className:"d-flex"},n.a.createElement(ag.a,{className:"flex-fill"},n.a.createElement("div",{className:"m-b-30"},window.W_L.selector_query_tip),n.a.createElement(Jg,{label:window.W_L.query},n.a.createElement(kg,{query:d,queryResult:a,onChange:l,editMode:!0})),a&&f&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Jg,{label:window.W_L.trigger_condition,className:"alert-criteria"},n.a.createElement(dg,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:f,onChange:u,editMode:!0})),n.a.createElement(Jg,{label:window.W_L.trigger_send_notice},n.a.createElement(vg,{value:r||0,onChange:c,editMode:!0})),n.a.createElement(Jg,{label:window.W_L.template},n.a.createElement(ny,{alert:t,query:d,columnNames:a.getColumnNames(),resultValues:a.getData(),subject:f.custom_subject,setSubject:e=>o({custom_subject:e}),body:f.custom_body,setBody:e=>o({custom_body:e})}))),n.a.createElement(Jg,null,n.a.createElement(m.a,{type:"primary",onClick:this.save,disabled:!d,className:"btn-create-alert"},b&&n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"}," ",window.W_L.saving," ")),window.W_L.create_alert))),n.a.createElement($e,{className:"f-13",type:"ALERT_SETUP"},window.W_L.setup_tip,"  ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"( ",window.W_L.help," )")))))}}function cy(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function uy(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?cy(Object(a),!0).forEach((function(t){my(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):cy(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function dy(){return(dy=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function my(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}sy.propTypes={alert:Hf.isRequired,queryResult:ae.a.object,pendingRearm:ae.a.number,onQuerySelected:ae.a.func.isRequired,save:ae.a.func.isRequired,onNameChange:ae.a.func.isRequired,onRearmChange:ae.a.func.isRequired,onCriteriaChange:ae.a.func.isRequired,onNotificationTemplateChange:ae.a.func.isRequired},sy.defaultProps={queryResult:null,pendingRearm:null};var py={NEW:0,VIEW:1,EDIT:2},fy=Object(l.template)("<%= query.name %>: <%= options.column %> <%= options.op %> <%= options.value %>");function by(e){return e.query?fy(e):window.W_L.new_alert_tip}class hy extends n.a.Component{constructor(){super(...arguments),my(this,"_isMounted",!1),my(this,"state",{alert:null,queryResult:null,pendingRearm:null,canEdit:!1,mode:null}),my(this,"save",()=>{var e=this.state,t=e.alert,a=e.pendingRearm;return t.name=Object(l.trim)(t.name)||by(t),t.rearm=a||null,Bh.save(t).then(e=>{of.success(window.W_L.save_success),Ea("alerts/".concat(e.id),!0),this.setState({alert:e,mode:py.VIEW})}).catch(()=>{of.error(window.W_L.save_failed)})}),my(this,"onQuerySelected",e=>{this.setState(t=>({alert:dy(t.alert,{query:e}),queryResult:null})),e&&new pr(e).getQueryResultPromise().then(e=>{if(this._isMounted){this.setState({queryResult:e});var t=this.state.alert.options.column,a=e.getColumnNames();t&&Object(l.includes)(a,t)||(t=Object(l.head)(e.getColumnNames())),this.setAlertOptions({column:t})}})}),my(this,"onNameChange",e=>{var t=this.state.alert;this.setState({alert:dy(t,{name:e})})}),my(this,"onRearmChange",e=>{this.setState({pendingRearm:e})}),my(this,"setAlertOptions",e=>{var t=this.state.alert,a=uy(uy({},t.options),e);this.setState({alert:dy(t,{options:a})})}),my(this,"delete",()=>{var e=this.state.alert;return Bh.delete(e).then(()=>{of.success(window.W_L.alert_delete_success),Ea("alerts")}).catch(()=>{of.error(window.W_L.alert_delete_failed)})}),my(this,"mute",()=>{var e=this.state.alert;return Bh.mute(e).then(()=>{this.setAlertOptions({muted:!0}),of.warn(window.W_L.set_mute_success)}).catch(()=>{of.error(window.W_L.set_mute_failed)})}),my(this,"unmute",()=>{var e=this.state.alert;return Bh.unmute(e).then(()=>{this.setAlertOptions({muted:!1}),of.success(window.W_L.set_unmute_success)}).catch(()=>{of.error(window.W_L.set_unmute_failed)})}),my(this,"edit",()=>{var e=this.state.alert.id;Ea("alerts/".concat(e,"/edit"),!0),this.setState({mode:py.EDIT})}),my(this,"cancel",()=>{var e=this.state.alert.id;Ea("alerts/".concat(e),!0),this.setState({mode:py.VIEW})})}componentDidMount(){this._isMounted=!0;var e=this.props.mode;if(this.setState({mode:e}),e===py.NEW)this.setState({alert:{options:{op:">",value:1,muted:!1}},pendingRearm:0,canEdit:!0});else{var t=this.props.alertId;Bh.get({id:t}).then(e=>{if(this._isMounted){var t=H.canEdit(e);t||(this.setState({mode:py.VIEW}),of.warn(window.W_L.can_not_edit_alert,window.W_L.no_permission_readonly,{duration:0})),this.setState({alert:e,canEdit:t,pendingRearm:e.rearm}),this.onQuerySelected(e.query)}}).catch(e=>{this._isMounted&&this.props.onError(e)})}}componentWillUnmount(){this._isMounted=!1}render(){var e=this.state.alert;if(!e)return n.a.createElement(Ch,{className:"m-t-30"});var t=!!e.options.muted,a=this.state,r=a.queryResult,o=a.mode,i=a.canEdit,l=a.pendingRearm,s=n.a.createElement(eg,{doDelete:this.delete,muted:t,mute:this.mute,unmute:this.unmute,canEdit:i}),c={alert:e,queryResult:r,pendingRearm:l,save:this.save,menuButton:s,onQuerySelected:this.onQuerySelected,onRearmChange:this.onRearmChange,onNameChange:this.onNameChange,onCriteriaChange:this.setAlertOptions,onNotificationTemplateChange:this.setAlertOptions};return n.a.createElement("div",{className:"alert-page"},n.a.createElement("div",{className:"container"},o===py.NEW&&n.a.createElement(sy,c),o===py.VIEW&&n.a.createElement(ey,dy({canEdit:i,onEdit:this.edit,muted:t,unmute:this.unmute},c)),o===py.EDIT&&n.a.createElement(iy,dy({cancel:this.cancel},c))))}}my(hy,"propTypes",{mode:ae.a.oneOf(Object(l.values)(py)),alertId:ae.a.string,onError:ae.a.func}),my(hy,"defaultProps",{mode:null,alertId:null,onError:()=>{}}),yf.register("Alerts.New",pa({path:"/alerts/new",title:window.W_L.new_alert,render:e=>n.a.createElement(hy,dy({},e,{mode:py.NEW}))})),yf.register("Alerts.View",pa({path:"/alerts/:alertId",title:window.W_L.alert,render:e=>n.a.createElement(hy,dy({},e,{mode:py.VIEW}))})),yf.register("Alerts.Edit",pa({path:"/alerts/:alertId/edit",title:window.W_L.alert,render:e=>n.a.createElement(hy,dy({},e,{mode:py.EDIT}))}));var gy=a(428),yy=a(429),vy=a.n(yy),wy=(a(1308),/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"Cmd":"Ctrl"),Oy=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"Option":"Alt";var Ey={};function _y(e,t){e.preventDefault(),e.retunValue=!1,Object(l.each)(Ey[t],e=>e())}var jy={modKey:wy,altKey:Oy,bind:e=>{Object(l.each)(e,(e,t)=>{var a=t.toLowerCase().split(",").map(l.trim);Object(l.each)(a,t=>{Ey[t]=[...Object(l.without)(Ey[t],e),e],vy.a.bindGlobal(t,_y)})})},unbind:e=>{Object(l.each)(e,(e,t)=>{var a=t.toLowerCase().split(",").map(l.trim);Object(l.each)(a,t=>{Ey[t]=Object(l.without)(Ey[t],e),0===Ey[t].length&&(Ey[t]=void 0,vy.a.unbind(t))})})}};function Sy(e){var t=e.paramCount,a=e.onClick,r=t?n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}):n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading..."));return n.a.createElement("div",{className:"parameter-apply-button","data-show":!!t,"data-test":"ParameterApplyButton"},n.a.createElement(Nf.a,{count:t},n.a.createElement(we,{title:t?"".concat(jy.modKey," + Enter"):null},n.a.createElement("span",null,n.a.createElement(m.a,{onClick:a},r," ",window.W_L.apply_change)))))}Sy.propTypes={onClick:ae.a.func.isRequired,paramCount:ae.a.number.isRequired};var Cy=Sy,Py=document.createElement("canvas");function xy(){return(xy=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ly(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}Py.style.display="none",document.body.appendChild(Py);var ky=function(e){var t=e.options,a=Ly(e,["options"]),o=Object(r.useMemo)(()=>{if(t&&t.length>400){var e=Object(l.maxBy)(t,"label.length");if(e){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,a=Py.getContext("2d");if(a){var r=window.getComputedStyle(t);a.font="".concat(r.fontSize," ").concat(r.fontFamily);var n=a.measureText(e),o=n.width;return"actualBoundingBoxLeft"in n&&(o=Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight)),o}return null}(e.label);if(a)return a+40}return!0}return!1},[t]);return n.a.createElement(ln.a,xy({dropdownMatchSelectWidth:o,options:t,allowClear:!0,optionFilterProp:"label"},a))},Ny=a(113),Ay=a.n(Ny);function Ty(){return(Ty=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Wy(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Iy=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.onSelect,i=e.className,l=Wy(e,["defaultValue","value","onSelect","className"]),s=Y.dateFormat||"YYYY-MM-DD",c={};return a&&a.isValid()&&(c.defaultValue=a),(null===r||r&&r.isValid())&&(c.value=r),n.a.createElement(Ay.a,Ty({ref:t,className:i},c,{format:s,placeholder:window.W_L.date_select,onChange:o},l))});Iy.propTypes={defaultValue:Qf,value:Qf,onSelect:ae.a.func,className:ae.a.string},Iy.defaultProps={defaultValue:null,value:void 0,onSelect:()=>{},className:""};var qy=Iy;function Dy(){return(Dy=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ry(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var My=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.withSeconds,i=e.onSelect,l=e.className,s=Ry(e,["defaultValue","value","withSeconds","onSelect","className"]),c=(Y.dateFormat||"YYYY-MM-DD")+(o?" HH:mm:ss":" HH:mm"),u={};return a&&a.isValid()&&(u.defaultValue=a),(null===r||r&&r.isValid())&&(u.value=r),n.a.createElement(Ay.a,Dy({ref:t,className:l,showTime:!0},u,{format:c,placeholder:window.W_L.datetime_select,onChange:i},s))});My.propTypes={defaultValue:Qf,value:Qf,withSeconds:ae.a.bool,onSelect:ae.a.func,className:ae.a.string},My.defaultProps={defaultValue:null,value:void 0,withSeconds:!1,onSelect:()=>{},className:""};var zy=My,Fy=a(316),Vy=a.n(Fy),Uy=a(675),By=a.n(Uy),Hy=a(676),Yy=a.n(Hy),Qy=(a(1322),jn.a.Text);function Ky(e){var t=e.options,a=e.selectedDynamicValue,o=e.onSelect,i=e.enabled,s=e.staticValueLabel,c=n.a.createElement(ue.a,{className:"dynamic-menu",onClick:e=>{var a=e.key;return o(Object(l.get)(t,a,"static"))},selectedKeys:["".concat(Object(l.findIndex)(t,{value:a}))],"data-test":"DynamicButtonMenu"},t.map((e,t)=>n.a.createElement(ue.a.Item,{key:t},e.name," ",e.label&&n.a.createElement("em",null,Object(l.isFunction)(e.label)?e.label():e.label))),i&&n.a.createElement(ue.a.Divider,null),i&&n.a.createElement(ue.a.Item,null,n.a.createElement(Vy.a,null),n.a.createElement(Qy,{type:"secondary"},s))),u=Object(r.useRef)(null);return n.a.createElement("div",{ref:u},n.a.createElement("div",{role:"presentation",onClick:e=>e.stopPropagation()},n.a.createElement(aa.a.Button,{overlay:c,className:"dynamic-button",placement:"bottomRight",trigger:["click"],icon:i?n.a.createElement(By.a,{className:"dynamic-icon"}):n.a.createElement(Yy.a,{className:"dynamic-icon"}),getPopupContainer:()=>u.current,"data-test":"DynamicButton"})))}Ky.propTypes={options:ae.a.arrayOf(ae.a.object),selectedDynamicValue:ae.a.oneOfType([Er,Ar]),onSelect:ae.a.func,enabled:ae.a.bool,staticValueLabel:ae.a.string},Ky.defaultProps={options:[],selectedDynamicValue:null,onSelect:()=>{},enabled:!1,staticValueLabel:"Back to Static Value"};var $y=Ky;a(596);function Gy(){return(Gy=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Jy(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Xy extends n.a.Component{constructor(e){super(e),Jy(this,"onDynamicValueSelect",e=>{var t=this.props,a=t.onSelect,r=t.parameter;if("static"===e){var n=r.getExecutionValue();a(n?Da()(n):null)}else a(e.value);this.dateComponentRef.current.focus()}),this.dateComponentRef=n.a.createRef()}render(){var e=this.props,t=e.type,a=e.value,r=e.className,o=e.dateOptions,i=e.dynamicButtonOptions,s=e.onSelect,c=jr(a),u=Object(l.includes)(t,"datetime"),d={},m=qy;if(u&&(m=zy,Object(l.includes)(t,"with-seconds")&&(d.withSeconds=!0)),(Da.a.isMoment(a)||null===a)&&(d.value=a),c){var p=a;d.placeholder=p&&p.name,d.value=null}return n.a.createElement("div",{className:me()("date-parameter",r)},n.a.createElement(m,Gy({},o,{ref:this.dateComponentRef,className:me()("redash-datepicker",t,{"dynamic-value":c}),onSelect:s,suffixIcon:null},d)),n.a.createElement($y,{options:i.options,staticValueLabel:i.staticValueLabel,selectedDynamicValue:c?a:null,enabled:c,onSelect:this.onDynamicValueSelect}))}}Jy(Xy,"propTypes",{type:ae.a.string,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func,dynamicButtonOptions:ae.a.shape({staticValueLabel:ae.a.string,options:ae.a.arrayOf(ae.a.shape({name:ae.a.string,value:ae.a.object,label:ae.a.oneOfType([ae.a.string,ae.a.func])}))}),dateOptions:ae.a.any}),Jy(Xy,"defaultProps",{type:"",className:"",value:null,parameter:null,dynamicButtonOptions:{options:[]},onSelect:()=>{}});var Zy=Xy;function ev(){return(ev=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var tv=[{name:"Today/Now",value:Sr("d_now"),label:()=>Sr("d_now").value().format("MMM D")},{name:"Yesterday",value:Sr("d_yesterday"),label:()=>Sr("d_yesterday").value().format("MMM D")}];function av(e){return n.a.createElement(Zy,ev({dynamicButtonOptions:{options:tv}},e,{dateOptions:{"aria-label":"Parameter date value"}}))}av.propTypes={type:ae.a.string,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func},av.defaultProps={type:"",className:"",value:null,parameter:null,onSelect:()=>{}};var rv=av;function nv(){return(nv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ov(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var iv=Ay.a.RangePicker,lv=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.onSelect,i=e.className,s=ov(e,["defaultValue","value","onSelect","className"]),c=Y.dateFormat||"YYYY-MM-DD",u={};return Object(l.isArray)(a)&&a[0].isValid()&&a[1].isValid()&&(u.defaultValue=a),(null===r||Object(l.isArray)(r)&&r[0].isValid()&&r[1].isValid())&&(u.value=r),n.a.createElement(iv,nv({ref:t,className:i},u,{format:c,onChange:o},s))});lv.propTypes={defaultValue:ae.a.arrayOf(Qf),value:ae.a.arrayOf(Qf),onSelect:ae.a.func,className:ae.a.string},lv.defaultProps={defaultValue:null,value:void 0,onSelect:()=>{},className:""};var sv=lv;function cv(){return(cv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function uv(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var dv=Ay.a.RangePicker,mv=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.withSeconds,i=e.onSelect,s=e.className,c=uv(e,["defaultValue","value","withSeconds","onSelect","className"]),u=(Y.dateFormat||"YYYY-MM-DD")+(o?" HH:mm:ss":" HH:mm"),d={};return Object(l.isArray)(a)&&a[0].isValid()&&a[1].isValid()&&(d.defaultValue=a),(null===r||Object(l.isArray)(r)&&r[0].isValid()&&r[1].isValid())&&(d.value=r),n.a.createElement(dv,cv({ref:t,className:s,showTime:!0},d,{format:u,onChange:i},c))});mv.propTypes={defaultValue:ae.a.arrayOf(Qf),value:ae.a.arrayOf(Qf),withSeconds:ae.a.bool,onSelect:ae.a.func,className:ae.a.string},mv.defaultProps={defaultValue:null,value:void 0,withSeconds:!1,onSelect:()=>{},className:""};var pv=mv;function fv(){return(fv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function bv(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function hv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class gv extends n.a.Component{constructor(e){super(e),hv(this,"onDynamicValueSelect",e=>{var t=this.props,a=t.onSelect,r=t.parameter;if("static"===e){var n=r.getExecutionValue();Object(l.isObject)(n)&&n.start&&n.end?a([Da()(n.start),Da()(n.end)]):a(null)}else a(e.value);this.dateRangeComponentRef.current.focus()}),this.dateRangeComponentRef=n.a.createRef()}render(){var e=this.props,t=e.type,a=e.value,r=e.onSelect,o=e.className,i=e.dynamicButtonOptions,s=e.dateRangeOptions,c=(e.parameter,bv(e,["type","value","onSelect","className","dynamicButtonOptions","dateRangeOptions","parameter"])),u=Object(l.includes)(t,"datetime-range"),d=Wr(a),m={},p=sv;return u&&(p=pv,Object(l.includes)(t,"with-seconds")&&(m.withSeconds=!0)),(function(e){return Object(l.isArray)(e)&&2===e.length&&Da.a.isMoment(e[0])&&Da.a.isMoment(e[1])}(a)||null===a)&&(m.value=a),d&&(m.placeholder=[a&&a.name],m.value=null),n.a.createElement("div",fv({},c,{className:me()("date-range-parameter",o)}),n.a.createElement(p,fv({},s,{ref:this.dateRangeComponentRef,className:me()("redash-datepicker date-range-input",t,{"dynamic-value":d}),onSelect:r,suffixIcon:null},m)),n.a.createElement($y,{options:i.options,staticValueLabel:i.staticValueLabel,selectedDynamicValue:d?a:null,enabled:d,onSelect:this.onDynamicValueSelect}))}}hv(gv,"propTypes",{type:ae.a.oneOf(["date-range","datetime-range","datetime-range-with-seconds"]).isRequired,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func,dynamicButtonOptions:ae.a.shape({staticValueLabel:ae.a.string,options:ae.a.arrayOf(ae.a.shape({name:ae.a.string,value:ae.a.object,label:ae.a.oneOfType([ae.a.string,ae.a.func])}))}),dateRangeOptions:ae.a.any}),hv(gv,"defaultProps",{type:"date-range",className:"",value:null,parameter:null,dynamicButtonOptions:{options:[]},onSelect:()=>{}});var yv=gv;function vv(){return(vv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var wv=[{name:"This week",title:window.W_L.this_week,value:Ir("d_this_week"),label:()=>Ir("d_this_week").value()[0].format("MMM D")+" - "+Ir("d_this_week").value()[1].format("MMM D")},{name:"This month",title:window.W_L.this_month,value:Ir("d_this_month"),label:()=>Ir("d_this_month").value()[0].format("MMMM")},{name:"This year",title:window.W_L.this_year,value:Ir("d_this_year"),label:()=>Ir("d_this_year").value()[0].format("YYYY")},{name:"Last week",title:window.W_L.last_week,value:Ir("d_last_week"),label:()=>Ir("d_last_week").value()[0].format("MMM D")+" - "+Ir("d_last_week").value()[1].format("MMM D")},{name:"Last month",title:window.W_L.last_month,value:Ir("d_last_month"),label:()=>Ir("d_last_month").value()[0].format("MMMM")},{name:"Last year",title:window.W_L.last_year,value:Ir("d_last_year"),label:()=>Ir("d_last_year").value()[0].format("YYYY")},{name:"Last 7 days",title:window.W_L.last_7_days,value:Ir("d_last_7_days"),label:()=>Ir("d_last_7_days").value()[0].format("MMM D")+" - Today"},{name:"Last 14 days",title:"window.W_L.last_14_days",value:Ir("d_last_14_days"),label:()=>Ir("d_last_14_days").value()[0].format("MMM D")+" - Today"},{name:"Last 30 days",title:window.W_L.last_30_days,value:Ir("d_last_30_days"),label:()=>Ir("d_last_30_days").value()[0].format("MMM D")+" - Today"},{name:"Last 60 days",title:window.W_L.last_60_days,value:Ir("d_last_60_days"),label:()=>Ir("d_last_60_days").value()[0].format("MMM D")+" - Today"},{name:"Last 90 days",title:window.W_L.last_90_days,value:Ir("d_last_90_days"),label:()=>Ir("d_last_90_days").value()[0].format("MMM D")+" - Today"},{name:"Last 12 months",title:window.W_L.last_12_months,value:Ir("d_last_12_months"),label:null}],Ov=[{name:"Today",value:Ir("d_today"),label:()=>Ir("d_today").value()[0].format("MMM D")},{name:"Yesterday",value:Ir("d_yesterday"),label:()=>Ir("d_yesterday").value()[0].format("MMM D")},...wv];function Ev(e){var t=Object(l.includes)(e.type,"datetime-range")?Ov:wv;return n.a.createElement(yv,vv({},e,{dynamicButtonOptions:{options:t}}))}Ev.propTypes={type:ae.a.string,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func},Ev.defaultProps={type:"",className:"",value:null,parameter:null,onSelect:()=>{}};var _v=Ev;function jv(){return(jv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Sv(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Cv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Pv extends n.a.Component{constructor(e){super(e),this.state={options:[],value:null,loading:!1}}componentDidMount(){this._loadOptions(this.props.queryId)}componentDidUpdate(e){this.props.queryId!==e.queryId&&this._loadOptions(this.props.queryId),this.props.value!==e.value&&this.setValue(this.props.value)}setValue(e){var t=this.state.options;if("multiple"===this.props.mode){e=Object(l.isArray)(e)?e:[e];var a=Object(l.map)(t,e=>e.value),r=Object(l.intersection)(e,a);return this.setState({value:r}),r}return e=void 0!==Object(l.find)(t,e=>e.value===this.props.value)?e:Object(l.get)(Object(l.first)(t),"value"),this.setState({value:e}),e}_loadOptions(e){var t,a=this;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e||e===a.state.queryId){r.next=6;break}return a.setState({loading:!0}),r.next=4,regeneratorRuntime.awrap(a.props.parameter.loadDropdownValues());case 4:t=r.sent,a.props.queryId===e&&a.setState({options:t,loading:!1},()=>{var e=a.setValue(a.props.value);Object(l.isEqual)(e,a.props.value)||a.props.onSelect(e)});case 6:case"end":return r.stop()}}),null,null,null,Promise)}render(){var e=this.props,t=e.className,a=e.mode,r=e.onSelect,o=(e.queryId,e.value,Sv(e,["className","mode","onSelect","queryId","value"])),i=this.state,s=i.loading,c=i.options;return n.a.createElement("span",null,n.a.createElement(ky,jv({className:t,disabled:s,loading:s,mode:a,value:this.state.value,onChange:r,options:Object(l.map)(c,e=>{var t=e.value,a=e.name;return{label:String(a),value:t}}),showSearch:!0,showArrow:!0,notFoundContent:Object(l.isEmpty)(c)?window.W_L.no_option:null},o)))}}Cv(Pv,"propTypes",{parameter:ae.a.any,value:ae.a.any,mode:ae.a.oneOf(["default","multiple"]),queryId:ae.a.number,onSelect:ae.a.func,className:ae.a.string}),Cv(Pv,"defaultProps",{value:null,mode:"default",parameter:null,queryId:null,onSelect:()=>{},className:""});a(1329);function xv(){return(xv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Lv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var kv={maxTagCount:3,maxTagTextLength:10,maxTagPlaceholder:e=>"+".concat(e.length," more")};class Nv extends n.a.Component{constructor(e){super(e),Lv(this,"componentDidUpdate",e=>{var t=this.props,a=t.value,r=t.parameter;e.value===a&&e.parameter===r||this.setState({value:r.hasPendingValue?r.pendingValue:a,isDirty:r.hasPendingValue})}),Lv(this,"onSelect",e=>{var t=!Object(l.isEqual)(e,this.props.value);this.setState({value:e,isDirty:t}),this.props.onSelect(e,t)}),this.state={value:e.parameter.hasPendingValue?e.parameter.pendingValue:e.value,isDirty:e.parameter.hasPendingValue}}renderDateParameter(){var e=this.props,t=e.type,a=e.parameter,r=this.state.value;return n.a.createElement(rv,{type:t,className:this.props.className,value:r,parameter:a,onSelect:this.onSelect})}renderDateRangeParameter(){var e=this.props,t=e.type,a=e.parameter,r=this.state.value;return n.a.createElement(_v,{type:t,className:this.props.className,value:r,parameter:a,onSelect:this.onSelect})}renderEnumInput(){var e,t=this.props,a=t.enumOptions,r=t.parameter,o=this.state.value,i=a.split("\n").filter(e=>""!==e);return n.a.createElement(ky,xv({className:this.props.className,mode:r.multiValuesOptions?"multiple":"default",value:(e=o,r.multiValuesOptions&&null===e?[]:e),onChange:this.onSelect,options:Object(l.map)(i,e=>({label:String(e),value:e})),showSearch:!0,showArrow:!0,notFoundContent:Object(l.isEmpty)(i)?window.W_L.no_option:null},kv))}renderQueryBasedInput(){var e=this.props,t=e.queryId,a=e.parameter,r=this.state.value;return n.a.createElement(Pv,xv({className:this.props.className,mode:a.multiValuesOptions?"multiple":"default",parameter:a,value:r,queryId:t,onSelect:this.onSelect,style:{minWidth:60}},kv))}renderNumberInput(){var e=this.props.className,t=this.state.value,a=e=>isNaN(e)?void 0:e;return n.a.createElement(cn.a,{className:e,value:a(t),"aria-label":"Parameter number value",onChange:e=>this.onSelect(a(e))})}renderTextInput(){var e=this.props.className,t=this.state.value;return n.a.createElement(ba.a,{className:e,value:t,"aria-label":"Parameter text value","data-test":"TextParamInput",onChange:e=>this.onSelect(e.target.value)})}renderInput(){switch(this.props.type){case"datetime-with-seconds":case"datetime-local":case"date":return this.renderDateParameter();case"datetime-range-with-seconds":case"datetime-range":case"date-range":return this.renderDateRangeParameter();case"enum":return this.renderEnumInput();case"query":return this.renderQueryBasedInput();case"number":return this.renderNumberInput();default:return this.renderTextInput()}}render(){var e=this.state.isDirty;return n.a.createElement("div",{className:"parameter-input","data-dirty":e||null,"data-test":"ParameterValueInput"},this.renderInput())}}Lv(Nv,"propTypes",{type:ae.a.string,value:ae.a.any,enumOptions:ae.a.string,queryId:ae.a.number,parameter:ae.a.any,onSelect:ae.a.func,className:ae.a.string}),Lv(Nv,"defaultProps",{type:"text",value:null,enumOptions:"",queryId:null,parameter:null,onSelect:()=>{},className:""});var Av=Nv;function Tv(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Wv(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Tv(Object(a),!0).forEach((function(t){Iv(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Tv(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Iv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function qv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Dv(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Dv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dv(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Rv(){return(Rv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var Mv=ln.a.Option,zv={labelCol:{span:6},wrapperCol:{span:16}};function Fv(e){return Object(l.capitalize)(Object(l.words)(e).join(" "))}function Vv(e){var t=e.name,a=e.type,r=e.onChange,o=e.existingNames,i=e.setValidation,s="",c="";return t?Object(l.includes)(o,t)?(s=window.W_L.params_ready_exist,i(!1),c="error"):(function(e){return/-range/.test(e)}(a)&&(s=n.a.createElement(n.a.Fragment,null,window.W_L.query_show_as," ",n.a.createElement("code",{style:{display:"inline-block",color:"inherit"}},"{{".concat(t,".start}} {{").concat(t,".end}}")))),i(!0)):(s=window.W_L.params_name,i(!1)),n.a.createElement(ag.a.Item,Rv({required:!0,label:window.W_L.name,help:s,validateStatus:c},zv),n.a.createElement(ba.a,{onChange:e=>r(e.target.value),autoFocus:!0}))}function Uv(e){var t=qv(Object(r.useState)(Object(l.clone)(e.parameter)),2),a=t[0],o=t[1],i=qv(Object(r.useState)(!0),2),s=i[0],c=i[1],u=qv(Object(r.useState)(),2),d=u[0],p=u[1],f=!e.parameter.name;Object(r.useEffect)(()=>{var t=e.parameter.queryId;t&&pr.get({id:t}).then(p)},[e.parameter.queryId]);var b,h,g,y=Se("paramForm");return n.a.createElement(R.a,Rv({},e.dialog.props,{title:f?window.W_L.new_params:a.name,width:600,footer:[n.a.createElement(m.a,{key:"cancel",onClick:e.dialog.dismiss},window.W_L.cancel),n.a.createElement(m.a,{key:"submit",htmlType:"submit",disabled:!!(!s||""===a.title||"query"===a.type&&!a.queryId),type:"primary",form:y,"data-test":"SaveParameterSettings"},f?window.W_L.new_params:window.W_L.ok_text)]}),n.a.createElement(ag.a,{layout:"horizontal",onFinish:function(){a.title||(a.title=Fv(a.name),o(a)),e.dialog.close(a)},id:y},f&&n.a.createElement(Vv,{name:a.name,onChange:e=>o(Wv(Wv({},a),{},{name:e})),setValidation:c,existingNames:e.existingParams,type:a.type}),n.a.createElement(ag.a.Item,Rv({required:!0,label:window.W_L.title},zv),n.a.createElement(ba.a,{value:Object(l.isNull)(a.title)?Fv(a.name):a.title,onChange:e=>o(Wv(Wv({},a),{},{title:e.target.value})),"data-test":"ParameterTitleInput"})),n.a.createElement(ag.a.Item,Rv({label:window.W_L.type},zv),n.a.createElement(ln.a,{value:a.type,onChange:e=>o(Wv(Wv({},a),{},{type:e})),"data-test":"ParameterTypeSelect"},n.a.createElement(Mv,{value:"text","data-test":"TextParameterTypeOption"},window.W_L.text),n.a.createElement(Mv,{value:"number","data-test":"NumberParameterTypeOption"},window.W_L.number),n.a.createElement(Mv,{value:"enum"},window.W_L.select),n.a.createElement(Mv,{value:"query"},window.W_L.query_result),n.a.createElement(Mv,{disabled:!0,key:"dv1"},n.a.createElement(lg.a,{className:"select-option-divider"})),n.a.createElement(Mv,{value:"date","data-test":"DateParameterTypeOption"},window.W_L.date_day),n.a.createElement(Mv,{value:"datetime-local","data-test":"DateTimeParameterTypeOption"},window.W_L.date_datetime),n.a.createElement(Mv,{value:"datetime-with-seconds"},window.W_L.date_time_second),n.a.createElement(Mv,{disabled:!0,key:"dv2"},n.a.createElement(lg.a,{className:"select-option-divider"})),n.a.createElement(Mv,{value:"date-range","data-test":"DateRangeParameterTypeOption"},window.W_L.date_range_day),n.a.createElement(Mv,{value:"datetime-range"}," ",window.W_L.date_range_datetime),n.a.createElement(Mv,{value:"datetime-range-with-seconds"},window.W_L.date_range_time_second))),"enum"===a.type&&n.a.createElement(ag.a.Item,Rv({label:window.W_L.value,help:window.W_L.list_select_help},zv),n.a.createElement(ba.a.TextArea,{rows:3,value:a.enumOptions,onChange:e=>o(Wv(Wv({},a),{},{enumOptions:e.target.value}))})),"query"===a.type&&n.a.createElement(ag.a.Item,Rv({label:window.W_L.query_result,help:window.W_L.wait_query},zv),n.a.createElement(Pg,{selectedQuery:d,onChange:e=>o(Wv(Wv({},a),{},{queryId:e&&e.id})),type:"select"})),("enum"===a.type||"query"===a.type)&&n.a.createElement(ag.a.Item,Rv({className:"m-b-0",label:" ",colon:!1},zv),n.a.createElement(dn.a,{defaultChecked:!!a.multiValuesOptions,onChange:e=>o(Wv(Wv({},a),{},{multiValuesOptions:e.target.checked?{prefix:"",suffix:"",separator:","}:null})),"data-test":"AllowMultipleValuesCheckbox"},window.W_L.allow_multi)),("enum"===a.type||"query"===a.type)&&a.multiValuesOptions&&n.a.createElement(ag.a.Item,Rv({label:window.W_L.quotation,help:n.a.createElement(n.a.Fragment,null,window.W_L.replace_query_info,": ",n.a.createElement("code",null,(b=a.multiValuesOptions,h=b.prefix,g=b.suffix,[window.W_L.value+"1",window.W_L.value+"2",window.W_L.value+"3"].map(e=>"".concat(h).concat(e).concat(g)).join(","))))},zv),n.a.createElement(ln.a,{value:a.multiValuesOptions.prefix,onChange:e=>o(Wv(Wv({},a),{},{multiValuesOptions:Wv(Wv({},a.multiValuesOptions),{},{prefix:e,suffix:e})})),"data-test":"QuotationSelect"},n.a.createElement(Mv,{value:""},window.W_L.no_quotation,"(",window.W_L.default,")"),n.a.createElement(Mv,{value:"'"},window.W_L.single_quotation),n.a.createElement(Mv,{value:'"',"data-test":"DoubleQuotationMarkOption"},window.W_L.double_quotation)))))}Vv.propTypes={name:ae.a.string.isRequired,onChange:ae.a.func.isRequired,existingNames:ae.a.arrayOf(ae.a.string).isRequired,setValidation:ae.a.func.isRequired,type:ae.a.string.isRequired},Uv.propTypes={parameter:ae.a.object.isRequired,dialog:wa.isRequired,existingParams:ae.a.arrayOf(ae.a.string)},Uv.defaultProps={existingParams:[]};var Bv=Oa(Uv);a(1330);function Hv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Yv(e){var t=Object(l.extend)({},A.search);e.forEach(e=>{Object(l.extend)(t,e.toUrlParams())}),A.setSearch(t,!0)}class Qv extends n.a.Component{constructor(e){super(e),Hv(this,"componentDidUpdate",e=>{var t=this.props,a=t.parameters,r=t.disableUrlUpdate,n=e.parameters!==a,o=e.disableUrlUpdate!==r;n&&this.setState({parameters:a}),!n&&!o||r||Yv(a)}),Hv(this,"handleKeyDown",e=>{13===e.keyCode&&(e.ctrlKey||e.metaKey||e.altKey)&&(e.stopPropagation(),this.applyChanges())}),Hv(this,"setPendingValue",(e,t,a)=>{var r=this.props.onPendingValuesChange;this.setState(n=>{var o=n.parameters;return a?e.setPendingValue(t):e.clearPendingValue(),r(),{parameters:o}})}),Hv(this,"moveParameter",e=>{var t=e.oldIndex,a=e.newIndex,r=this.props.onParametersEdit;t!==a&&this.setState(e=>{var n=e.parameters;return n.splice(a,0,n.splice(t,1)[0]),r(n),{parameters:n}})}),Hv(this,"applyChanges",()=>{var e=this.props,t=e.onValuesChange,a=e.disableUrlUpdate;this.setState(e=>{var r=e.parameters,n=r.filter(e=>e.hasPendingValue);return Object(l.forEach)(r,e=>e.applyPendingValue()),a||Yv(r),t(n),{parameters:r}})}),Hv(this,"showParameterSettings",(e,t)=>{var a=this.props.onParametersEdit;Bv.showModal({parameter:e}).onClose(r=>{this.setState(n=>{var o=n.parameters,i=Object(l.extend)(e,r);return o[t]=zr(i,i.parentQueryId),a(o),{parameters:o}})})});var t=e.parameters;this.state={parameters:t},e.disableUrlUpdate||Yv(t)}renderParameter(e,t){var a=this.props.editable;return n.a.createElement("div",{key:e.name,className:"di-block","data-test":"ParameterName-".concat(e.name)},n.a.createElement("div",{className:"parameter-heading"},n.a.createElement("label",null,e.title||sb(e.name)),a&&n.a.createElement(be,{className:"btn btn-default btn-xs m-l-5","aria-label":"Edit",onClick:()=>this.showParameterSettings(e,t),"data-test":"ParameterSettings-".concat(e.name),type:"button"},n.a.createElement("i",{className:"fa fa-cog","aria-hidden":"true"}))),n.a.createElement(Av,{type:e.type,value:e.normalizedValue,parameter:e,enumOptions:e.enumOptions,queryId:e.queryId,onSelect:(t,a)=>this.setPendingValue(e,t,a)}))}render(){var e=this.state.parameters,t=this.props,a=t.sortable,r=t.appendSortableToParent,o=Object(l.size)(Object(l.filter)(e,"hasPendingValue"));return n.a.createElement(ls,{disabled:!a,axis:"xy",useDragHandle:!0,lockToContainerEdges:!0,helperClass:"parameter-dragged",helperContainer:e=>r?e:document.body,updateBeforeSortStart:this.onBeforeSortStart,onSortEnd:this.moveParameter,containerProps:{className:"parameter-container",onKeyDown:o?this.handleKeyDown:null}},e.map((e,t)=>n.a.createElement(is,{key:e.name,index:t},n.a.createElement("div",{className:"parameter-block","data-editable":a||null,"data-test":"ParameterBlock-".concat(e.name)},a&&n.a.createElement(ns,{"data-test":"DragHandle-".concat(e.name)}),this.renderParameter(e,t)))),n.a.createElement(Cy,{onClick:this.applyChanges,paramCount:o}))}}function Kv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $v(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return $v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $v(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Gv(e){var t=e.from,a=Object(r.useMemo)(()=>Da()(t).valueOf(),[t]),o=Kv(Object(r.useState)(null),2),i=o[0],l=o[1];return Object(r.useEffect)(()=>{function e(){var e=Da.a.now()-a,t=e>36e5?"HH:mm:ss":"mm:ss";l(Da.a.utc(e).format(t))}e();var t=setInterval(e,1e3);return()=>clearInterval(t)},[a]),n.a.createElement("span",{className:"rd-timer"},i)}Hv(Qv,"propTypes",{parameters:ae.a.arrayOf(ae.a.instanceOf(Ra)),editable:ae.a.bool,sortable:ae.a.bool,disableUrlUpdate:ae.a.bool,onValuesChange:ae.a.func,onPendingValuesChange:ae.a.func,onParametersEdit:ae.a.func,appendSortableToParent:ae.a.bool}),Hv(Qv,"defaultProps",{parameters:[],editable:!1,sortable:!1,disableUrlUpdate:!1,onValuesChange:()=>{},onPendingValuesChange:()=>{},onParametersEdit:()=>{},appendSortableToParent:!0}),Gv.propTypes={from:ae.a.oneOfType([ae.a.string,ae.a.number,ae.a.instanceOf(Date),Qf])},Gv.defaultProps={from:null};a(1331);function Jv(e){var t=e.visualization,a=gp[t.type];return n.a.createElement("span",{className:"visualization-name"},a&&t.name!==a.name?t.name:null)}Jv.propTypes={visualization:$r.isRequired};var Xv=Jv;a(1332);function Zv(){return(Zv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ew(e){var t=e.query,a=e.visualization,r=e.readOnly;return n.a.createElement(e=>{return r?n.a.createElement("span",e):n.a.createElement(g,Zv({href:(o=null,a&&(o="TABLE"===a.type?"table":a.id),t.getUrl(!1,o))},e));var o},{className:"query-link"},n.a.createElement(Xv,{visualization:a})," ",n.a.createElement("span",null,t.name))}ew.propTypes={query:ae.a.object.isRequired,visualization:$r,readOnly:ae.a.bool},ew.defaultProps={visualization:null,readOnly:!1};var tw=ew;function aw(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function rw(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?aw(Object(a),!0).forEach((function(t){nw(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):aw(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function nw(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ow="###Redash::Filters::SelectAll###",iw=ae.a.shape({name:ae.a.string.isRequired,friendlyName:ae.a.string.isRequired,multiple:ae.a.bool,current:ae.a.oneOfType([ae.a.any,ae.a.arrayOf(ae.a.any)]),values:ae.a.arrayOf(ae.a.any).isRequired}),lw=ae.a.arrayOf(iw);function sw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!Object(l.isArray)(e))return[];var a=e;return Object(l.isArray)(t)&&t.length>0&&(a=a.filter(e=>Object(l.every)(t,t=>{var a=e[t.name],r=Object(l.isArray)(t.current)?t.current:[t.current];return Object(l.some)(r,e=>Da.a.isMoment(a)?a.isSame(e):e===a||String(a)===e)}))),a}function cw(e){var t=e.filters,a=e.onChange;return 0===t.length?null:(a=function(e,t){return(a,r)=>{if(Object(l.isArray)(r))r=Object(l.map)(r,e=>a.values[Object(l.toNumber)(e.key)]||e.key);else{var n=a.values[Object(l.toNumber)(r.key)];r=void 0!==n?n:r.key}a.multiple&&Object(l.includes)(r,ow)&&(r=[...a.values]),a.multiple&&Object(l.includes)(r,"###Redash::Filters::Clear###")&&(r=[]),e=Object(l.map)(e,e=>e.name===a.name?rw(rw({},a),{},{current:r}):e),t(e)}}(t,a),n.a.createElement("div",{className:"filters-wrapper","data-test":"Filters"},n.a.createElement("div",{className:"container bg-white"},n.a.createElement("div",{className:"row"},Object(l.map)(t,e=>{var t=Object(l.map)(e.values,(t,a)=>n.a.createElement(ln.a.Option,{key:a},mb(t,Object(l.get)(e,"column.type"))));return n.a.createElement("div",{key:e.name,className:"col-sm-6 p-l-0 filter-container","data-test":"FilterName-".concat(e.name)},n.a.createElement("label",null,e.friendlyName),0===t.length&&n.a.createElement(ln.a,{className:"w-100",disabled:!0,value:"No values"}),t.length>0&&n.a.createElement(ln.a,{labelInValue:!0,className:"w-100",mode:e.multiple?"multiple":"default",value:Object(l.isArray)(e.current)?Object(l.map)(e.current,t=>({key:"".concat(Object(l.indexOf)(e.values,t)),label:mb(t)})):{key:"".concat(Object(l.indexOf)(e.values,e.current)),label:mb(e.current)},allowClear:e.multiple,optionFilterProp:"children",showSearch:!0,maxTagCount:3,maxTagTextLength:10,maxTagPlaceholder:e=>"+".concat(e.length," more"),onChange:t=>a(e,t)},!e.multiple&&t,e.multiple&&[n.a.createElement(ln.a.Option,{key:"###Redash::Filters::Clear###","data-test":"ClearOption"},n.a.createElement("i",{className:"fa fa-square-o m-r-5","aria-hidden":"true"}),window.W_L.clear),n.a.createElement(ln.a.Option,{key:ow,"data-test":"SelectAllOption"},n.a.createElement("i",{className:"fa fa-check-square-o m-r-5","aria-hidden":"true"}),window.W_L.select_all),n.a.createElement(ln.a.OptGroup,{key:"Values",label:window.W_L.value},t)]))})))))}cw.propTypes={filters:lw.isRequired,onChange:ae.a.func},cw.defaultProps={onChange:()=>{}};var uw=cw;function dw(e){var t=Object(l.invoke)(e,"getStatus");return Object(r.useMemo)(()=>function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{status:t||Object(l.invoke)(e,"getStatus")||null,columns:Object(l.invoke)(e,"getColumns")||[],rows:Object(l.invoke)(e,"getData")||[],filters:Object(l.invoke)(e,"getFilters")||[],updatedAt:Object(l.invoke)(e,"getUpdatedAt")||null,retrievedAt:Object(l.get)(e,"query_result.retrieved_at",null),truncated:Object(l.invoke)(e,"getTruncated")||null,log:Object(l.invoke)(e,"getLog")||[],error:Object(l.invoke)(e,"getError")||null,runtime:Object(l.invoke)(e,"getRuntime")||null,metadata:Object(l.get)(e,"query_result.data.metadata",{})}}(e,t),[e,t])}function mw(e){var t=Object(r.useRef)();return t.current=Object(l.isFunction)(e)?e:l.noop,Object(r.useCallback)((function(){return t.current(...arguments)}),[])}var pw=a(677),fw=a.n(pw),bw=a(678),hw=a.n(bw),gw=a(679),yw=a.n(gw);function vw(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ww(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ow(e){return function(t){var a;return a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?vw(Object(a),!0).forEach((function(t){ww(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):vw(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({HelpTriggerComponent:$e,LinkComponent:g,choroplethAvailableMaps:{countries:{name:window.W_L.country,url:fw.a,fieldNames:{name:window.W_L.short_name,name_long:window.W_L.full_name,abbrev:window.W_L.abbreviated_name,iso_a2:"ISO code(2 letters)",iso_a3:"ISO code(3 letters)",iso_n3:"ISO code(3 digits)"}},usa:{name:"USA",url:hw.a,fieldNames:{name:"Name",ns_code:"USA ANSI Code(8 character)",geoid:"Geographic ID",usps_abbrev:"USPS Abbreviation",fips_code:"FIPS Code (2-character)"}},subdiv_japan:{name:"Japan/Prefectures",url:yw.a,fieldNames:{name:"Name",name_alt:"Name (alternative)",name_local:"Name (local)",iso_3166_2:"ISO-3166-2",postal:"Postal Code",type:"Type",type_en:"Type (EN)",region:"Region",region_code:"Region Code"}}}},Object(l.pick)(Y,["dateFormat","dateTimeFormat","integerFormat","floatFormat","booleanValues","tableCellMaxJSONSize","allowCustomJSVisualizations","hidePlotlyModeBar"])),Object(l.extend)(To,a),n.a.createElement(e,t)}}var Ew=Ow((function(e){var t=e.type,a=e.data,o=e.options,i=e.visualizationName,s=e.addonBefore,c=e.addonAfter,u=wp(e,["type","data","options","visualizationName","addonBefore","addonAfter"]),d=Object(r.useRef)(),m=Object(r.useRef)(),p=gp[t],f=p.Renderer,b=(0,p.getOptions)(o,a);return Object(l.isEqual)(d.current,b)&&(b=d.current),d.current=b,Object(r.useEffect)(()=>{m.current&&m.current.reset()},[o,a]),n.a.createElement("div",{className:"visualization-renderer"},s,n.a.createElement(j,{ref:m,renderError:()=>n.a.createElement(_,null,window.W_L.Error_while_rendering_visualization)},n.a.createElement("div",{className:"visualization-renderer-wrapper"},n.a.createElement(f,vp({options:b,data:a,visualizationName:i},u)))),c)})),_w=Ow((function(e){var t=e.type,a=e.options,o=e.data,i=Ep(e,["type","options","data"]),l=gp[t],s=l.Editor,c=l.getOptions,u=Object(r.useMemo)(()=>c(a,o),[a,o]);return n.a.createElement(s,Op({options:u,data:o},i))}));function jw(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Sw(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Sw(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Sw(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Cw(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Pw(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Cw(Object(a),!0).forEach((function(t){xw(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Cw(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function xw(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Lw(e,t){return 0===e.length||0===t.length?e:Object(l.map)(e,e=>{var a=Object(l.find)(t,t=>t.name===e.name);return a?Pw(Pw({},e),{},{current:a.current}):e})}function kw(e){var t=dw(e.queryResult),a=jw(Object(r.useState)(()=>Lw(t.filters,e.filters)),2),o=a[0],i=a[1],s=Object(r.useRef)();s.current=o;var c=mw(t=>{var a,r;r=o,(a=t).length===r.length&&(a=Object(l.fromPairs)(Object(l.map)(a,e=>[e.name,e])),r=Object(l.fromPairs)(Object(l.map)(r,e=>[e.name,e])),Object(l.isEqual)(a,r))||(i(t),e.onFiltersChange(t))});Object(r.useEffect)(()=>{c(Lw(t.filters,e.filters))},[t.filters,e.filters,c]),Object(r.useEffect)(()=>{c(Lw(s.current,e.filters))},[e.filters,c]);var u=Object(r.useMemo)(()=>({columns:t.columns,rows:sw(t.rows,o)}),[t,o]),d=e.showFilters,m=e.visualization,p=Pw({},m.options);return"TABLE"===m.type&&(p.paginationSize="widget"===e.context?"small":"default"),n.a.createElement(Ew,{key:"visualization".concat(m.id),type:m.type,options:p,data:u,visualizationName:m.name,addonBefore:d&&n.a.createElement(uw,{filters:o,onChange:c})})}function Nw(){return(Nw=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Aw(e){var t=e.dialog,a=e.widget,r=e.filters;return n.a.createElement(R.a,Nw({},t.props,{title:n.a.createElement(n.a.Fragment,null,n.a.createElement(Xv,{visualization:a.visualization})," ",n.a.createElement("span",null,a.getQuery().name)),width:"95%",footer:n.a.createElement(m.a,{onClick:t.dismiss},window.W_L.close)}),n.a.createElement(kw,{visualization:a.visualization,queryResult:a.getQueryResult(),filters:r,context:"widget"}))}kw.propTypes={visualization:$r.isRequired,queryResult:ae.a.object.isRequired,showFilters:ae.a.bool,filters:lw,onFiltersChange:ae.a.func,context:ae.a.oneOf(["query","widget"]).isRequired},kw.defaultProps={showFilters:!0,filters:[],onFiltersChange:()=>{}},Aw.propTypes={dialog:wa.isRequired,widget:ae.a.object.isRequired,filters:lw},Aw.defaultProps={filters:[]};var Tw=Oa(Aw),Ww=a(102),Iw=a.n(Ww),qw=a(312),Dw=a.n(qw);a(1333);function Rw(){return(Rw=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Mw(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return zw(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return zw(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zw(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Fw(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Vw="dashboard-add-new",Uw="dashboard-map-to-existing",Bw="widget-level",Hw="static-value";function Yw(e){return Object(l.fromPairs)(Object(l.map)(e,e=>{var t=Object(l.extend)({},e);switch(e.type){case Vw:case Uw:t.type=Lp.DashboardLevel,t.value=null;break;case Hw:t.type=Lp.StaticValue,t.param=Fr(e.param),t.param.setValue(t.value),t.value=t.param.value;break;case Bw:t.type=Lp.WidgetLevel,t.value=null}return delete t.param,[t.name,t]}))}function Qw(e,t){var a=[];return Object(l.each)(e,e=>{e.type===Lp.DashboardLevel&&Object(l.each)(t,t=>{var r=t.options.parameterMappings;Object(l.each)(r,r=>{r.type===Lp.DashboardLevel&&r.mapTo===e.mapTo&&r.title!==e.title&&(r.title=e.title,a.push(t))})})}),a}class Kw extends n.a.Component{constructor(){super(...arguments),Fw(this,"formItemProps",{labelCol:{span:5},wrapperCol:{span:16},className:"form-item"}),Fw(this,"updateSourceType",e=>{var t=this.props.mapping.mapTo,a=this.props.existingParamNames;e!==Uw||Object(l.includes)(a,t)||(t=a[0]),this.updateParamMapping({type:e,mapTo:t})}),Fw(this,"updateParamMapping",e=>{var t=this.props,a=t.onChange,r=t.mapping,n=Object(l.extend)({},r,e);n.value!==r.value&&(n.param=Fr(n.param),n.param.setValue(n.value)),Object(l.has)(e,"type")&&(e.type===Hw?n.value=n.param.value:n.value=null),a(n)})}renderMappingTypeSelector(){var e=Object(l.isEmpty)(this.props.existingParamNames);return n.a.createElement(Bn.a.Group,{value:this.props.mapping.type,onChange:e=>this.updateSourceType(e.target.value)},n.a.createElement(Bn.a,{className:"radio",value:Vw,"data-test":"NewDashboardParameterOption"},window.W_L.new_dashboard_parm),n.a.createElement(Bn.a,{className:"radio",value:Uw,disabled:e},window.W_L.exist_dashboard_parm," ",e?n.a.createElement(we,{title:window.W_L.dashboard_param_error},n.a.createElement(No.a,null)):null),n.a.createElement(Bn.a,{className:"radio",value:Bw,"data-test":"WidgetParameterOption"},window.W_L.widget_parm),n.a.createElement(Bn.a,{className:"radio",value:Hw,"data-test":"StaticValueOption"},window.W_L.static_value))}renderDashboardAddNew(){var e=this.props.mapping.mapTo;return n.a.createElement(ba.a,{value:e,"aria-label":"Parameter name (key)",onChange:e=>this.updateParamMapping({mapTo:e.target.value})})}renderDashboardMapToExisting(){var e=this.props,t=e.mapping,a=e.existingParamNames,r=Object(l.map)(a,e=>({label:e,value:e}));return n.a.createElement(ln.a,{value:t.mapTo,onChange:e=>this.updateParamMapping({mapTo:e}),options:r})}renderStaticValue(){var e=this.props.mapping;return n.a.createElement(Av,{type:e.param.type,value:e.param.normalizedValue,enumOptions:e.param.enumOptions,queryId:e.param.queryId,parameter:e.param,onSelect:e=>this.updateParamMapping({value:e})})}renderInputBlock(){switch(this.props.mapping.type){case Vw:return["Key",window.W_L.enter_parm_name,this.renderDashboardAddNew()];case Uw:return["Key",window.W_L.select_parm,this.renderDashboardMapToExisting()];case Hw:return["Value",null,this.renderStaticValue()];default:return[]}}render(){var e=this.props.inputError,t=Mw(this.renderInputBlock(),3),a=t[0],r=t[1],o=t[2];return n.a.createElement(ag.a,{layout:"horizontal"},n.a.createElement(ag.a.Item,Rw({label:window.W_L.source},this.formItemProps),this.renderMappingTypeSelector()),n.a.createElement(ag.a.Item,Rw({style:{height:60,visibility:o?"visible":"hidden"},label:a},this.formItemProps,{validateStatus:e?"error":"",help:e||r}),o))}}Fw(Kw,"propTypes",{mapping:ae.a.object,existingParamNames:ae.a.arrayOf(ae.a.string),onChange:ae.a.func,inputError:ae.a.string}),Fw(Kw,"defaultProps",{mapping:{},existingParamNames:[],onChange:()=>{},inputError:null});class $w extends n.a.Component{constructor(e){super(e),Fw(this,"onVisibleChange",e=>{e?this.show():this.hide()}),Fw(this,"onChange",e=>{var t=null;e.type===Vw&&(Object(l.isEmpty)(e.mapTo)?t=window.W_L.code_mast_have_value:Object(l.includes)(this.props.existingParamNames,e.mapTo)&&(t=window.W_L.exist_save_parm)),this.setState({mapping:e,inputError:t})}),Fw(this,"save",()=>{this.props.onChange(this.props.mapping,this.state.mapping),this.hide()}),Fw(this,"show",()=>{this.setState({visible:!0,mapping:Object(l.clone)(this.props.mapping)})}),Fw(this,"hide",()=>{this.setState({visible:!1})}),this.state={visible:!1,mapping:Object(l.clone)(this.props.mapping),inputError:null}}renderContent(){var e=this.state,t=e.mapping,a=e.inputError;return n.a.createElement("div",{className:"parameter-mapping-editor","data-test":"EditParamMappingPopover"},n.a.createElement("header",null,window.W_L.edit_source_value," ",n.a.createElement($e,{type:"VALUE_SOURCE_OPTIONS"})),n.a.createElement(Kw,{mapping:t,existingParamNames:this.props.existingParamNames,onChange:this.onChange,inputError:a}),n.a.createElement("footer",null,n.a.createElement(m.a,{onClick:this.hide},window.W_L.cancel),n.a.createElement(m.a,{onClick:this.save,disabled:!!a,type:"primary"},window.W_L.ok_text)))}render(){var e=this.state,t=e.visible,a=e.mapping;return n.a.createElement(pn.a,{placement:"left",trigger:"click",content:this.renderContent(),visible:t,onVisibleChange:this.onVisibleChange},n.a.createElement(m.a,{size:"small",type:"dashed","data-test":"EditParamMappingButton-".concat(a.param.name)},n.a.createElement(Dw.a,null)))}}Fw($w,"propTypes",{mapping:ae.a.object.isRequired,existingParamNames:ae.a.arrayOf(ae.a.string).isRequired,onChange:ae.a.func.isRequired});class Gw extends n.a.Component{constructor(){super(...arguments),Fw(this,"state",{showPopup:!1,title:""}),Fw(this,"onPopupVisibleChange",e=>{this.setState({showPopup:e,title:e?this.getMappingTitle():""})}),Fw(this,"onEditingTitleChange",e=>{this.setState({title:e.target.value})}),Fw(this,"save",()=>{var e=Object(l.extend)({},this.props.mapping,{title:this.state.title});this.props.onChange(e),this.hide()}),Fw(this,"hide",()=>{this.setState({showPopup:!1})})}getMappingTitle(){var e=this.props.mapping;if(Object(l.isString)(e.title)&&""!==e.title)return e.title;if(e.type===Uw){var t=Object(l.find)(this.props.existingParams,{name:e.mapTo});t&&(e=t)}return e.title||e.param.title}renderPopover(){var e=this.props.mapping.param.title;return n.a.createElement("div",{className:"parameter-mapping-title-editor"},n.a.createElement(ba.a,{size:"small",value:this.state.title,placeholder:e,"aria-label":"Edit parameter title",onChange:this.onEditingTitleChange,onPressEnter:this.save,maxLength:100,autoFocus:!0}),n.a.createElement(m.a,{size:"small",type:"dashed",onClick:this.hide},n.a.createElement(je.a,null)),n.a.createElement(m.a,{size:"small",type:"dashed",onClick:this.save},n.a.createElement(wn.a,null)))}renderEditButton(){return this.props.mapping.type===Hw?n.a.createElement(we,{placement:"right",title:window.W_L.title_set_hidden_in_widget},n.a.createElement("span",{tabIndex:0},n.a.createElement("i",{className:"fa fa-eye-slash","aria-hidden":"true"}))):n.a.createElement(pn.a,{placement:"right",trigger:"click",content:this.renderPopover(),visible:this.state.showPopup,onVisibleChange:this.onPopupVisibleChange},n.a.createElement(m.a,{size:"small",type:"dashed"},n.a.createElement(Dw.a,null)))}render(){var e=this.props.mapping.type===Hw;return n.a.createElement("div",{className:me()("parameter-mapping-title",{disabled:e})},n.a.createElement("span",{className:"text"},this.getMappingTitle()),this.renderEditButton())}}Fw(Gw,"propTypes",{existingParams:ae.a.arrayOf(ae.a.object),mapping:ae.a.object.isRequired,onChange:ae.a.func.isRequired}),Fw(Gw,"defaultProps",{existingParams:[]});class Jw extends n.a.Component{static getStringValue(e){return e?e instanceof Object&&"start"in e&&"end"in e?"".concat(e.start," ~ ").concat(e.end):"object"==typeof e?Object(l.map)(e,e=>this.getStringValue(e)).join(", "):e.toString():""}static getDefaultValue(e,t){var a=e.type,r=e.mapTo,n=e.name,o=e.param;if(a===Uw&&r!==n){var i=Object(l.find)(t,{name:r});i&&(o=i)}else a===Hw&&(o=Fr(o).setValue(e.value));var s=Ra.getExecutionValue(o);return o.hasDynamicValue&&(s=o.normalizedValue.name),this.getStringValue(s)}static getSourceTypeLabel(e){var t=e.type,a=e.mapTo;switch(t){case Vw:case Uw:return n.a.createElement(r.Fragment,null,window.W_L.dashboard_parm," ",n.a.createElement(Iw.a,{className:"tag"},a));case Bw:return window.W_L.widget_parm;case Hw:return window.W_L.static_value;default:return""}}updateParamMapping(e,t){var a=[...this.props.mappings],r=Object(l.findIndex)(a,e);r>=0?a[r]=t:a.push(t),this.props.onChange(a)}render(){var e=this.props.existingParams,t=this.props.mappings.map(e=>({mapping:e}));return n.a.createElement("div",{className:"parameters-mapping-list"},n.a.createElement($l.a,{dataSource:t,size:"middle",pagination:!1,rowKey:(e,t)=>"row".concat(t)},n.a.createElement($l.a.Column,{title:window.W_L.name,dataIndex:"mapping",key:"title",render:t=>n.a.createElement(Gw,{existingParams:e,mapping:t,onChange:e=>this.updateParamMapping(t,e)})}),n.a.createElement($l.a.Column,{title:window.W_L.code,dataIndex:"mapping",key:"keyword",className:"keyword",render:e=>n.a.createElement("code",null,"{{ ".concat(e.name," }}"))}),n.a.createElement($l.a.Column,{title:window.W_L.default_value,dataIndex:"mapping",key:"value",render:e=>this.constructor.getDefaultValue(e,this.props.existingParams)}),n.a.createElement($l.a.Column,{title:window.W_L.source,dataIndex:"mapping",key:"source",render:t=>{var a=e.filter(e=>e.type===t.param.type).map(e=>e.name);return n.a.createElement(r.Fragment,null,this.constructor.getSourceTypeLabel(t)," ",n.a.createElement($w,{mapping:t,existingParamNames:a,onChange:(e,t)=>this.updateParamMapping(e,t)}))}})))}}function Xw(){return(Xw=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Zw(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function eO(e,t){return Object(l.map)(Object(l.sortBy)(e,e=>e.name),e=>{var a;switch(e.type){case Hw:return[e.name,e.value];case Bw:return[e.name,e.param.value];case Vw:case Uw:return a=Object(l.find)(t,t=>t.name===e.mapTo),[e.name,a?a.value:null]}})}Fw(Jw,"propTypes",{mappings:ae.a.arrayOf(ae.a.object),existingParams:ae.a.arrayOf(ae.a.object),onChange:ae.a.func}),Fw(Jw,"defaultProps",{mappings:[],existingParams:[],onChange:()=>{}});class tO extends n.a.Component{constructor(e){super(e),Zw(this,"originalParamValuesSnapshot",null);var t=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Object(l.map)(e,e=>{var r=Object(l.extend)({},e),n=Object(l.includes)(a,e.mapTo);switch(r.param=Object(l.find)(t,t=>t.name===e.name),e.type){case Lp.DashboardLevel:r.type=n?Uw:Vw,r.value=null;break;case Lp.StaticValue:r.type=Hw,r.param=Fr(r.param),r.param.setValue(r.value);break;case Lp.WidgetLevel:r.type=Bw,r.value=null}return r})}(e.widget.options.parameterMappings,e.widget.query.getParametersDefs(),Object(l.map)(this.props.dashboard.getParametersDefs(),e=>e.name));this.originalParamValuesSnapshot=eO(t,this.props.dashboard.getParametersDefs()),this.state={saveInProgress:!1,parameterMappings:t}}saveWidget(){var e=this.props.widget;this.setState({saveInProgress:!0});var t=Yw(this.state.parameterMappings);e.options.parameterMappings=t;var a=!Object(l.isMatch)(this.originalParamValuesSnapshot,eO(this.state.parameterMappings,this.props.dashboard.getParametersDefs())),r=[e,...Qw(e.options.parameterMappings,this.props.dashboard.widgets)];Promise.all(Object(l.map)(r,e=>e.save())).then(()=>{this.props.dialog.close(a)}).catch(()=>{of.error("Widget cannot be updated")}).finally(()=>{this.setState({saveInProgress:!1})})}updateParamMappings(e){this.setState({parameterMappings:e})}render(){var e=this.props.dialog;return n.a.createElement(R.a,Xw({},e.props,{title:window.W_L.params,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,onOk:()=>this.saveWidget(),okButtonProps:{loading:this.state.saveInProgress},width:700}),this.state.parameterMappings.length>0&&n.a.createElement(Jw,{mappings:this.state.parameterMappings,existingParams:this.props.dashboard.getParametersDefs(),onChange:e=>this.updateParamMappings(e)}))}}Zw(tO,"propTypes",{dashboard:ae.a.object.isRequired,widget:ae.a.object.isRequired,dialog:wa.isRequired});var aO=Oa(tO);a(1334);function rO(){return(rO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function nO(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function oO(e){var t=e.extraOptions,a=e.showDeleteOption,r=e.onDelete,o=n.a.createElement(ue.a,{"data-test":"WidgetDropdownButtonMenu"},t,a&&t&&n.a.createElement(ue.a.Divider,null),a&&n.a.createElement(ue.a.Item,{onClick:r},window.W_L.delete));return n.a.createElement("div",{className:"widget-menu-regular"},n.a.createElement(aa.a,{overlay:o,placement:"bottomRight",trigger:["click"]},n.a.createElement(be,{className:"action p-l-15 p-r-15","data-test":"WidgetDropdownButton","aria-label":"More options"},n.a.createElement("i",{className:"zmdi zmdi-more-vert","aria-hidden":"true"}))))}function iO(e){var t=e.onClick;return n.a.createElement("div",{className:"widget-menu-remove"},n.a.createElement(be,{className:"action",title:"{window.W_L.delete}",onClick:t,"data-test":"WidgetDeleteButton","aria-label":"Close"},n.a.createElement("i",{className:"zmdi zmdi-close","aria-hidden":"true"})))}oO.propTypes={extraOptions:ae.a.node,showDeleteOption:ae.a.bool,onDelete:ae.a.func},oO.defaultProps={extraOptions:null,showDeleteOption:!1,onDelete:()=>{}},iO.propTypes={onClick:ae.a.func},iO.defaultProps={onClick:()=>{}};class lO extends n.a.Component{constructor(){super(...arguments),nO(this,"deleteWidget",()=>{var e=this.props,t=e.widget,a=e.onDelete;R.a.confirm({title:window.W_L.delete_widget,content:window.W_L.delete_widget_confirm,cancelText:window.W_L.cancel,okText:window.W_L.ok_text,okType:"danger",onOk:()=>t.delete().then(a),maskClosable:!0,autoFocusButton:null})})}componentDidMount(){Sa("view","widget",this.props.widget.id)}render(){var e=this.props,t=e.className,a=e.children,r=e.header,o=e.footer,i=e.canEdit,s=e.isPublic,c=e.menuOptions,u=e.tileProps,d=!s&&(i||!Object(l.isEmpty)(c));return n.a.createElement("div",{className:"widget-wrapper"},n.a.createElement("div",rO({className:me()("tile body-container",t)},u),n.a.createElement("div",{className:"widget-actions"},d&&n.a.createElement(oO,{extraOptions:c,showDeleteOption:i,onDelete:this.deleteWidget}),i&&n.a.createElement(iO,{onClick:this.deleteWidget})),n.a.createElement("div",{className:"body-row widget-header"},r),a,o&&n.a.createElement("div",{className:"body-row tile__bottom-control"},o)))}}nO(lO,"propTypes",{widget:ae.a.object.isRequired,className:ae.a.string,children:ae.a.node,header:ae.a.node,footer:ae.a.node,canEdit:ae.a.bool,isPublic:ae.a.bool,refreshStartedAt:Qf,menuOptions:ae.a.node,tileProps:ae.a.object,onDelete:ae.a.func}),nO(lO,"defaultProps",{className:"",children:null,header:null,footer:null,canEdit:!1,isPublic:!1,refreshStartedAt:null,menuOptions:null,tileProps:{},onDelete:()=>{}});var sO=lO;function cO(){return(cO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function uO(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function dO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return mO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return mO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function pO(e){var t=e.widget,a=e.canEditDashboard,r=e.onParametersEdit,o=(e.isShowReport,H.hasPermission("view_query")),i=a&&!Object(l.isEmpty)(Object(l.invoke)(t,"query.getParametersDefs")),s=t.getQueryResult(),c=!s||!s.isEmpty||s.isEmpty(),u=e=>s.getLink(t.getQuery().id,e),d=e=>s.getName(t.getQuery().name,e);return Object(l.compact)([n.a.createElement(ue.a.Item,{key:"download_csv",disabled:c},c?window.W_L.save_as_csv:n.a.createElement(g,{href:u("csv"),download:d("csv"),target:"_self"},window.W_L.save_as_csv)),n.a.createElement(ue.a.Item,{key:"download_tsv",disabled:c},c?window.W_L.save_as_tsv:n.a.createElement(g,{href:u("tsv"),download:d("tsv"),target:"_self"},window.W_L.save_as_tsv)),n.a.createElement(ue.a.Item,{key:"download_excel",disabled:c},c?window.W_L.save_as_excel:n.a.createElement(g,{href:u("xlsx"),download:d("xlsx"),target:"_self"},window.W_L.save_as_excel)),(o||i)&&n.a.createElement(ue.a.Divider,{key:"divider"}),o&&n.a.createElement(ue.a.Item,{key:"view_query"},n.a.createElement(g,{href:t.getQuery().getUrl(!0,t.visualization.id)},window.W_L.edit_query)),i&&n.a.createElement(ue.a.Item,{key:"edit_parameters",onClick:r},window.W_L.edit_param)])}function fO(e){var t=e.refreshStartedAt;return n.a.createElement("div",{className:"refresh-indicator"},n.a.createElement("div",{className:"refresh-icon"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Refreshing...")),n.a.createElement(Gv,{from:t}))}function bO(e){var t=e.widget,a=e.refreshStartedAt,r=e.parameters,o=e.isEditing,i=e.onParametersUpdate,s=e.onParametersEdit,c=H.hasPermission("view_query");return n.a.createElement(n.a.Fragment,null,n.a.createElement(fO,{refreshStartedAt:a}),n.a.createElement("div",{className:"t-header widget clearfix"},n.a.createElement("div",{className:"th-title"},n.a.createElement("p",null,n.a.createElement(tw,{query:t.getQuery(),visualization:t.visualization,readOnly:!c})),!Object(l.isEmpty)(t.getQuery().description)&&n.a.createElement(We,{className:"text-muted markdown query--description"},Ie.markdown.toHTML(t.getQuery().description||"")))),!Object(l.isEmpty)(r)&&n.a.createElement("div",{className:"m-b-10"},n.a.createElement(Qv,{parameters:r,sortable:o,appendSortableToParent:!1,onValuesChange:i,onParametersEdit:s})))}function hO(e){var t=e.widget,a=e.isPublic,o=e.onRefresh,i=e.onExpand,s=t.getQueryResult(),c=Object(l.invoke)(s,"getUpdatedAt"),u=dO(Object(r.useState)(),2),d=u[0],m=u[1],p=e=>{d||(m(e),o().finally(()=>m(null)))};return s?n.a.createElement(n.a.Fragment,null,n.a.createElement("span",null,!a&&!!s&&n.a.createElement(be,{className:"refresh-button hidden-print btn btn-sm btn-default btn-transparent",onClick:()=>p(1),"data-test":"RefreshButton"},n.a.createElement("i",{className:me()("zmdi zmdi-refresh",{"zmdi-hc-spin":1===d}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},1===d?"Refreshing, please wait. ":"Press to refresh. ")," ",n.a.createElement(Gf,{date:c})),n.a.createElement("span",{className:"visible-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",ab(c)),a&&n.a.createElement("span",{className:"small hidden-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",n.a.createElement(Gf,{date:c}))),n.a.createElement("span",null,!a&&n.a.createElement(be,{className:"btn btn-sm btn-default hidden-print btn-transparent btn__refresh",onClick:()=>p(2)},n.a.createElement("i",{className:me()("zmdi zmdi-refresh",{"zmdi-hc-spin":2===d}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},2===d?"Refreshing, please wait.":"Press to refresh.")),n.a.createElement(be,{className:"btn btn-sm btn-default hidden-print btn-transparent btn__refresh",onClick:i},n.a.createElement("i",{className:"zmdi zmdi-fullscreen","aria-hidden":"true"})))):null}fO.propTypes={refreshStartedAt:Qf},fO.defaultProps={refreshStartedAt:null},bO.propTypes={widget:ae.a.object.isRequired,refreshStartedAt:Qf,parameters:ae.a.arrayOf(ae.a.object),isEditing:ae.a.bool,onParametersUpdate:ae.a.func,onParametersEdit:ae.a.func},bO.defaultProps={refreshStartedAt:null,onParametersUpdate:()=>{},onParametersEdit:()=>{},isEditing:!1,parameters:[]},hO.propTypes={widget:ae.a.object.isRequired,isPublic:ae.a.bool,onRefresh:ae.a.func.isRequired,onExpand:ae.a.func.isRequired},hO.defaultProps={isPublic:!1};class gO extends n.a.Component{constructor(e){super(e),uO(this,"onLocalFiltersChange",e=>{this.setState({localFilters:e})}),uO(this,"expandWidget",()=>{Tw.showModal({widget:this.props.widget,filters:this.state.localFilters})}),uO(this,"editParameterMappings",()=>{var e=this.props,t=e.widget,a=e.dashboard,r=e.onRefresh,n=e.onParameterMappingsChange;aO.showModal({dashboard:a,widget:t}).onClose(e=>{e&&r(),n(),this.setState({localParameters:t.getLocalParameters()})})}),this.state={localParameters:e.widget.getLocalParameters(),localFilters:e.filters}}componentDidMount(){var e=this.props,t=e.widget,a=e.onLoad;Sa("view","query",t.visualization.query.id,{dashboard:!0}),Sa("view","visualization",t.visualization.id,{dashboard:!0}),a()}renderVisualization(){var e=this.props,t=e.widget,a=e.filters,r=t.getQueryResult();switch(r&&r.getStatus()){case"failed":return n.a.createElement("div",{className:"body-row-auto scrollbox"},r.getError()&&n.a.createElement("div",{className:"alert alert-danger m-5"},window.W_L.query_error,"： ",n.a.createElement("strong",null,r.getError())));case"done":return n.a.createElement("div",{className:"body-row-auto scrollbox"},n.a.createElement(kw,{visualization:t.visualization,queryResult:r,filters:a,onFiltersChange:this.onLocalFiltersChange,context:"widget"}));default:return n.a.createElement("div",{className:"body-row-auto spinner-container",role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("div",{className:"spinner"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin zmdi-hc-5x","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading...")))}}render(){var e=this.props,t=e.widget,a=e.isLoading,r=e.isPublic,o=e.canEdit,i=e.isEditing,s=e.onRefresh,c=e.isShowReport,u=this.state.localParameters,d=t.getQueryResult(),m=a&&!(!d||!d.getStatus());return n.a.createElement(sO,cO({},this.props,{className:"widget-visualization",menuOptions:pO({widget:t,canEditDashboard:o,onParametersEdit:this.editParameterMappings,isShowReport:c}),header:n.a.createElement(bO,{widget:t,refreshStartedAt:m?t.refreshStartedAt:null,parameters:u,isEditing:i,onParametersUpdate:s,onParametersEdit:e=>{var a=Object(l.map)(e,"name");t.options.paramOrder=a,t.save("options",{paramOrder:a})}}),footer:n.a.createElement(hO,{widget:t,isPublic:r,onRefresh:s,onExpand:this.expandWidget}),tileProps:{"data-refreshing":m}}),this.renderVisualization())}}uO(gO,"propTypes",{widget:ae.a.object.isRequired,dashboard:ae.a.object.isRequired,filters:lw,isPublic:ae.a.bool,isLoading:ae.a.bool,canEdit:ae.a.bool,isEditing:ae.a.bool,onLoad:ae.a.func,onRefresh:ae.a.func,onDelete:ae.a.func,onParameterMappingsChange:ae.a.func,isShowReport:ae.a.bool}),uO(gO,"defaultProps",{filters:[],isPublic:!1,isLoading:!1,canEdit:!1,isEditing:!1,onLoad:()=>{},onRefresh:()=>{},onDelete:()=>{},onParameterMappingsChange:()=>{},isShowReport:!0});var yO=gO;a(1335);function vO(){return(vO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function wO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return OO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return OO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function OO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function EO(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function _O(e){var t=e.dialog,a=e.isNew,o=EO(e,["dialog","isNew"]),i=wO(Object(r.useState)(Object(l.toString)(o.text)),2),s=i[0],c=i[1],u=wO(Object(r.useState)(null),2),d=u[0],m=u[1];Object(r.useEffect)(()=>{c(o.text),m(Ie.markdown.toHTML(o.text))},[o.text]);var p=wO(Object(Ml.a)(()=>{m(Ie.markdown.toHTML(s))},200),1)[0],f=Object(r.useCallback)(e=>{c(e.target.value),p()},[p]),b=Object(r.useCallback)(()=>{t.close(s).catch(()=>{of.error(a?window.W_L.widget_will_not_add:window.W_L.widget_will_not_save)})},[t,a,s]),h=Object(r.useCallback)(()=>{var e=o.text;s!==e?R.a.confirm({title:window.W_L.quit_edit,content:window.W_L.quit_edit_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>t.dismiss(),maskClosable:!0,autoFocusButton:null,style:{top:170}}):t.dismiss()},[t,s,o.text]);return n.a.createElement(R.a,vO({},t.props,{title:a?window.W_L.add_text:window.W_L.edit_text,onOk:b,okText:a?window.W_L.add_to_dashboard:window.W_L.save,cancelText:window.W_L.save,onCancel:h,width:500,wrapProps:{"data-test":"TextboxDialog"}}),n.a.createElement("div",{className:"textbox-dialog"},n.a.createElement(ba.a.TextArea,{className:"resize-vertical",rows:"5",value:s,"aria-label":"Textbox widget content",onChange:f,autoFocus:!0,placeholder:window.W_L.input_text}),n.a.createElement("small",null,window.W_L.support_basic," ",n.a.createElement(g,{target:"_blank",rel:"noopener noreferrer",href:"https://www.markdownguide.org/cheat-sheet/#basic-syntax"},n.a.createElement(we,{title:window.W_L.open_markdown},"Markdown")),"；",n.a.createElement(g,{target:"_blank",rel:"noopener noreferrer",href:"https://www.runoob.com/markdown/md-tutorial.html"},n.a.createElement(we,{title:window.W_L.open_markdown_teach},window.W_L.open_markdown_teach," ")),"。"),s&&n.a.createElement(n.a.Fragment,null,n.a.createElement(lg.a,{dashed:!0}),n.a.createElement("strong",{className:"preview-title"},window.W_L.preview,"："),n.a.createElement(We,{className:"preview markdown"},d))))}_O.propTypes={dialog:wa.isRequired,isNew:ae.a.bool,text:ae.a.string},_O.defaultProps={isNew:!1,text:""};var jO=Oa(_O);function SO(){return(SO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function CO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return PO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return PO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function PO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function xO(e){var t=e.widget,a=e.canEdit,o=CO(Object(r.useState)(t.text),2),i=o[0],l=o[1],s=[n.a.createElement(ue.a.Item,{key:"edit",onClick:()=>{jO.showModal({text:t.text}).onClose(e=>(t.text=e,l(e),t.save()))}},window.W_L.edit)];return t.width?n.a.createElement(sO,SO({},e,{menuOptions:a?s:null,className:"widget-text"}),n.a.createElement(We,{className:"body-row-auto scrollbox t-body p-15 markdown"},Ie.markdown.toHTML(i||""))):null}xO.propTypes={widget:ae.a.object.isRequired,canEdit:ae.a.bool},xO.defaultProps={canEdit:!1};var LO=xO;function kO(){return(kO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var NO=function(e){return n.a.createElement(sO,kO({},e,{className:"d-flex justify-content-center align-items-center widget-restricted"}),n.a.createElement("div",{className:"t-body scrollbox"},n.a.createElement("div",{className:"text-center"},n.a.createElement("h1",null,n.a.createElement("span",{className:"zmdi zmdi-lock"})),n.a.createElement("p",{className:"text-muted"},window.W_L.widget_have_no_access))))};function AO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return TO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return TO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function TO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function WO(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var IO=[".widget-header",".visualization-renderer",".scrollbox .alert",".spinner-container",".tile__bottom-control"].join(",");class qO{constructor(e){WO(this,"widgets",{}),WO(this,"interval",null),WO(this,"onHeightChange",null),WO(this,"add",e=>{this.isEmpty()&&this.start();var t='[data-widgetid="{0}"]'.replace("{0}",e);this.widgets[e]=[function(){var e=document.querySelector(t);if(e){var a=e.querySelectorAll(IO);return Object(l.reduce)(a,(e,t)=>e+(t?t.getBoundingClientRect().height:0),0)}}]}),WO(this,"remove",e=>{this.exists(e)&&(this.widgets[e.toString()]=!1,this.isEmpty()&&this.stop())}),WO(this,"exists",e=>!!this.widgets[e.toString()]),WO(this,"isEmpty",()=>!Object(l.some)(this.widgets)),WO(this,"checkHeightChanges",()=>{Object.keys(this.widgets).filter(this.exists).forEach(e=>{var t=AO(this.widgets[e],2),a=t[0],r=t[1],n=a();n&&n!==r&&(this.widgets[e][1]=n,this.onHeightChange(e,n))})}),WO(this,"start",()=>{this.stop(),this.interval=setInterval(this.checkHeightChanges,200)}),WO(this,"stop",()=>{clearInterval(this.interval)}),WO(this,"resume",()=>{this.isEmpty()||this.start()}),WO(this,"destroy",()=>{this.stop(),this.widgets=null}),this.onHeightChange=e}update(e){var t=e.filter(e=>e.options.position.autoHeight).map(e=>e.id.toString());t.filter(e=>!Object(l.includes)(Object.keys(this.widgets),e)).forEach(this.add),Object.keys(this.widgets).filter(e=>!Object(l.includes)(t,e)).forEach(this.remove)}}a(1336),a(1337);function DO(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var RO=Object(gy.WidthProvider)(gy.Responsive),MO=ae.a.shape({id:ae.a.number.isRequired,options:ae.a.shape({position:ae.a.shape({col:ae.a.number.isRequired,row:ae.a.number.isRequired,sizeY:ae.a.number.isRequired,minSizeY:ae.a.number.isRequired,maxSizeY:ae.a.number.isRequired,sizeX:ae.a.number.isRequired,minSizeX:ae.a.number.isRequired,maxSizeX:ae.a.number.isRequired}).isRequired}).isRequired}),zO="single-column",FO="multi-column",VO=n.a.memo((function(e){var t=e.widget,a=e.dashboard,r=e.onLoadWidget,o=e.onRefreshWidget,i=e.onRemoveWidget,l=e.onParameterMappingsChange,s=e.isEditing,c=e.canEdit,u=e.isPublic,d=e.isLoading,m=e.filters,p=e.isShowReport,f=t.type,b=()=>i(t.id);return f===jp?n.a.createElement(yO,{isShowReport:p,widget:t,dashboard:a,filters:m,isEditing:s,canEdit:c,isPublic:u,isLoading:d,onLoad:()=>r(t),onRefresh:()=>o(t),onDelete:b,onParameterMappingsChange:l}):f===_p?n.a.createElement(LO,{widget:t,canEdit:c,isPublic:u,onDelete:b}):n.a.createElement(NO,{widget:t})}),(e,t)=>e.widget===t.widget&&e.canEdit===t.canEdit&&e.isPublic===t.isPublic&&e.isLoading===t.isLoading&&e.filters===t.filters&&e.isEditing===t.isEditing);class UO extends n.a.Component{static normalizeFrom(e){var t=e.id,a=e.options.position;return{i:t.toString(),x:a.col,y:a.row,w:a.sizeX,h:a.sizeY,minW:a.minSizeX,maxW:a.maxSizeX,minH:a.minSizeY,maxH:a.maxSizeY}}constructor(e){super(e),DO(this,"mode",null),DO(this,"autoHeightCtrl",null),DO(this,"onLayoutChange",(e,t)=>{if(t[FO]&&this.setState({layouts:t}),this.mode=document.body.offsetWidth<=La?zO:FO,this.mode!==zO){var a=Object(l.chain)(t[FO]).keyBy("i").mapValues(this.normalizeTo).value();this.props.onLayoutChange(a)}}),DO(this,"onBreakpointChange",e=>{this.mode=e,this.props.onBreakpointChange(e===zO)}),DO(this,"onWidgetHeightUpdated",(e,t)=>{this.setState(a=>{var r=a.layouts,n=Object(l.cloneDeep)(r[FO]),o=Object(l.find)(n,{i:e.toString()});return o&&(o.h=Math.ceil((t+xa)/Pa)),{layouts:{[FO]:n}}})}),DO(this,"onWidgetResize",(e,t,a)=>{t.h!==a.h&&this.autoHeightCtrl.remove(Number(a.i)),this.autoHeightCtrl.resume()}),DO(this,"normalizeTo",e=>({col:e.x,row:e.y,sizeX:e.w,sizeY:e.h,autoHeight:this.autoHeightCtrl.exists(e.i)})),this.state={layouts:{},disableAnimations:!0},this.autoHeightCtrl=new qO(this.onWidgetHeightUpdated),this.autoHeightCtrl.update(this.props.widgets)}componentDidMount(){this.onBreakpointChange(document.body.offsetWidth<=La?zO:FO),setTimeout(()=>{this.setState({disableAnimations:!1})},50)}componentDidUpdate(){this.autoHeightCtrl.update(this.props.widgets)}componentWillUnmount(){this.autoHeightCtrl.destroy()}render(){var e=this.props,t=e.onLoadWidget,a=e.onRefreshWidget,r=e.onRemoveWidget,o=e.onParameterMappingsChange,i=e.filters,l=e.dashboard,s=e.isPublic,c=e.isEditing,u=e.widgets,d=e.isShowReport,m=me()("dashboard-wrapper",c?"editing-mode":"preview-mode");return n.a.createElement("div",{className:m},n.a.createElement(RO,{draggableCancel:"input,.sortable-container",className:me()("layout",{"disable-animations":this.state.disableAnimations}),cols:{[FO]:Ca,[zO]:1},rowHeight:Pa-xa,margin:[xa,xa],isDraggable:c,isResizable:c,onResizeStart:this.autoHeightCtrl.stop,onResizeStop:this.onWidgetResize,layouts:this.state.layouts,onLayoutChange:this.onLayoutChange,onBreakpointChange:this.onBreakpointChange,breakpoints:{[FO]:La,[zO]:0}},u.map(e=>n.a.createElement("div",{key:e.id,"data-grid":UO.normalizeFrom(e),"data-widgetid":e.id,"data-test":"WidgetId".concat(e.id),className:me()("dashboard-widget-wrapper",{"widget-auto-height-enabled":this.autoHeightCtrl.exists(e.id)})},n.a.createElement(VO,{dashboard:l,widget:e,filters:i,isPublic:s,isLoading:e.loading,isEditing:c,canEdit:l.canEdit(),onLoadWidget:t,onRefreshWidget:a,isShowReport:d,onRemoveWidget:r,onParameterMappingsChange:o})))))}}DO(UO,"propTypes",{isEditing:ae.a.bool.isRequired,isPublic:ae.a.bool,dashboard:ae.a.object.isRequired,widgets:ae.a.arrayOf(MO).isRequired,filters:lw,onBreakpointChange:ae.a.func,onLoadWidget:ae.a.func,onRefreshWidget:ae.a.func,onRemoveWidget:ae.a.func,onLayoutChange:ae.a.func,onParameterMappingsChange:ae.a.func,isShowReport:ae.a.bool}),DO(UO,"defaultProps",{isPublic:!1,filters:[],onLoadWidget:()=>{},onRefreshWidget:()=>{},onRemoveWidget:()=>{},onLayoutChange:()=>{},onBreakpointChange:()=>{},onParameterMappingsChange:()=>{},isShowReport:!0});var BO=UO;function HO(){return(HO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function YO(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function QO(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?YO(Object(a),!0).forEach((function(t){KO(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):YO(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function KO(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function $O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return GO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return GO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function GO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function JO(e){var t=e.query,a=e.visualization,o=e.onChange,i=Object(r.useMemo)(()=>t?Object(l.groupBy)(t.visualizations,"type"):{},[t]),s=Se("visualization-select"),c=Object(r.useCallback)(e=>{var a=t?Object(l.find)(t.visualizations,{id:e}):null;o(a||null)},[t,o]);if(!t)return null;var u={BOXPLOT:window.W_L.BOXPLOT,CHART:window.W_L.CHART,CHOROPLETH:window.W_L.CHOROPLETH,COHORT:window.W_L.COHORT,COUNTER:window.W_L.COUNTER,DETAILS:window.W_L.DETAILS,FUNNEL:window.W_L.FUNNEL,MAP:window.W_L.MAP,PIVOT:window.W_L.PIVOT,SANKEY:window.W_L.SANKEY,SUNBURST_SEQUENCE:window.W_L.SUNBURST_SEQUENCE,TABLE:window.W_L.TABLE,WORD_CLOUD:window.W_L.WORD_CLOUD};return n.a.createElement("div",null,n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:s},window.W_L.select_view),n.a.createElement(ln.a,{id:s,className:"w-100",value:a?a.id:void 0,onChange:c},Object(l.map)(i,(e,t)=>n.a.createElement(ln.a.OptGroup,{key:t,label:u[t]},Object(l.map)(e,e=>n.a.createElement(ln.a.Option,{key:"".concat(e.id),value:e.id},e.name)))))))}function XO(e){var t=e.dialog,a=e.dashboard,o=$O(Object(r.useState)(null),2),i=o[0],s=o[1],c=$O(Object(r.useState)(null),2),u=c[0],d=c[1],m=$O(Object(r.useState)([]),2),p=m[0],f=m[1],b=Object(r.useCallback)(e=>{s(null),d(null),f([]),e&&pr.get({id:e}).then(e=>{if(e){var t=Object(l.map)(a.getParametersDefs(),e=>e.name);s(e),f(Object(l.map)(e.getParametersDefs(),e=>({name:e.name,type:Object(l.includes)(t,e.name)?Uw:Vw,mapTo:e.name,value:e.normalizedValue,title:"",param:e}))),e.visualizations.length>0&&d(Object(l.first)(e.visualizations))}})},[a]),h=Object(r.useCallback)(()=>{t.close({visualization:u,parameterMappings:p}).catch(()=>{of.error(window.W_L.widget_not_add)})},[t,u,p]),g=a.getParametersDefs(),y=Se("parameter-mappings");return n.a.createElement(R.a,HO({},t.props,{title:window.W_L.add_widget,onOk:h,okButtonProps:QO(QO({},t.props.okButtonProps),{},{disabled:!i||t.props.okButtonProps.disabled}),okText:window.W_L.add_widget_to_dashboard,cancelText:window.W_L.cancel,width:700}),n.a.createElement("div",{"data-test":"AddWidgetDialog"},n.a.createElement(Pg,{onChange:e=>b(e?e.id:null)}),i&&n.a.createElement(JO,{query:i,visualization:u,onChange:d}),p.length>0&&[n.a.createElement("label",{key:"parameters-title",htmlFor:y},window.W_L.params),n.a.createElement(Jw,{key:"parameters-list",id:y,mappings:p,existingParams:g,onChange:f})]))}JO.propTypes={query:ae.a.object,visualization:ae.a.object,onChange:ae.a.func},JO.defaultProps={query:null,visualization:null,onChange:()=>{}},XO.propTypes={dialog:wa.isRequired,dashboard:ae.a.object.isRequired};var ZO=Oa(XO);function eE(){return(eE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function tE(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function aE(e){var t=e.imageUrl,a=e.roundedImage,r=e.title,o=e.body,i=e.children,l=e.className,s=tE(e,["imageUrl","roundedImage","title","body","children","className"]);return n.a.createElement("div",eE({},s,{className:l+" w-100 d-flex align-items-center"}),n.a.createElement("img",{src:"/"+t,"data-pr":"",width:"32",data:t,height:"32",className:me()({"profile__image--settings":a},"m-r-5"),alt:window.W_L.icon}),n.a.createElement("div",{className:"flex-fill"},n.a.createElement("div",null,r),o&&n.a.createElement("div",{className:"text-muted"},o)),i)}function rE(e){var t=e.user,a=e.withLink,r=e.children,o=tE(e,["user","withLink","children"]),i=a?n.a.createElement(g,{href:"users/"+t.id},t.name):t.name;return n.a.createElement(aE,eE({},o,{imageUrl:t.profile_image_url,title:i,body:t.email}),r)}function nE(e){var t=e.dataSource,a=e.withLink,r=e.children,o=tE(e,["dataSource","withLink","children"]),i="/static/images/db-logos/".concat(t.type,".png"),l=a?n.a.createElement(g,{href:"data_sources/"+t.id},t.name):t.name;return n.a.createElement(aE,eE({},o,{imageUrl:i,title:l}),r)}function oE(e){return Object(l.find)([Object(l.get)(e,"response.data.message"),Object(l.get)(e,"response.statusText"),"Unknown error"],l.isString)}function iE(e){return"api/users/".concat(e.id,"/disable")}aE.propTypes={imageUrl:ae.a.string.isRequired,title:ae.a.node.isRequired,body:ae.a.node,roundedImage:ae.a.bool,className:ae.a.string,children:ae.a.node},aE.defaultProps={body:null,roundedImage:!0,className:"",children:null},rE.propTypes={user:ae.a.shape({profile_image_url:ae.a.string.isRequired,name:ae.a.string.isRequired,email:ae.a.string.isRequired}).isRequired,withLink:ae.a.bool,children:ae.a.node},rE.defaultProps={withLink:!1,children:null},nE.propTypes={dataSource:ae.a.shape({name:ae.a.string.isRequired,type:ae.a.string.isRequired}).isRequired,withLink:ae.a.bool,children:ae.a.node},nE.defaultProps={withLink:!1,children:null};var lE={query:e=>B.get("api/users",{params:e}),get:e=>{var t=e.id;return B.get("api/users/".concat(t))},create:e=>B.post("api/users",e),save:e=>B.post("api/users/".concat(e.id),e),enableUser:function(e){var t=ke(e.name);return B.delete(iE(e)).then(a=>(of.success(window.W_L.account+t+window.W_L.activated+"！"),e.is_disabled=!1,e.profile_image_url=a.profile_image_url,a)).catch(e=>{of.error(window.W_L.Cannot_enable_user,oE(e))})},disableUser:function(e){var t=ke(e.name);return B.post(iE(e)).then(a=>(of.warning(window.W_L.account+t+window.W_L.terminated+"。"),e.is_disabled=!0,e.profile_image_url=a.profile_image_url,a)).catch(e=>{of.error(window.W_L.Cannot_deactivate_user,oE(e))})},deleteUser:function(e){var t=ke(e.name);return B.delete("api/users/".concat(e.id)).then(e=>(of.warning(window.W_L.account+t+window.W_L.has_been_deleted+"!"),e)).catch(e=>{of.error(window.W_L.Cannot_delete_user,oE(e))})},convertUserInfo:function(e){return{id:e.id,name:e.name,email:e.email,profileImageUrl:e.profile_image_url,apiKey:e.api_key,groupIds:e.groups,isDisabled:e.is_disabled,isInvitationPending:e.is_invitation_pending}},regenerateApiKey:function(e){return B.post("api/users/".concat(e.id,"/regenerate_api_key")).then(e=>(of.success(window.W_L.api_Key_has_been_regenerated),e.api_key)).catch(e=>{of.error(window.W_L.failed_to_regenerate_api_key,oE(e))})},sendPasswordReset:function(e){return B.post("api/users/".concat(e.id,"/reset_password")).then(e=>{if(Y.mailSettingsMissing)return of.warning(window.W_L.the_email_server_is_not_configured),e.reset_link;of.success(window.W_L.password_reset_email_has_been_sent)}).catch(e=>{of.error(window.W_L.the_password_reset_email_was_not_sent_successfully,oE(e))})},resendInvitation:function(e){return B.post("api/users/".concat(e.id,"/invite")).then(e=>{if(Y.mailSettingsMissing)return of.warning(window.W_L.the_email_server_is_not_configured),e.invite_link;of.success(window.W_L.user_invitation_email_has_been_sent)}).catch(e=>{of.error(window.W_L.the_user_invitation_email_failed_to_be_sent,oE(e))})}};a(1338);function sE(){return(sE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function cE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return uE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return uE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var dE=ln.a.Option;function mE(e){e.context;return n.a.createElement(n.a.Fragment,null,window.W_L.mange_permissions,n.a.createElement("div",{className:"modal-header-desc"},window.W_L.can_not_manage_permissions,n.a.createElement($e,{type:"MANAGE_PERMISSIONS"})))}function pE(e){var t=e.onSelect,a=e.shouldShowUser,o=cE(Object(r.useState)(!0),2),i=o[0],s=o[1],c=cE(Object(r.useState)([]),2),u=c[0],d=c[1],m=cE(Object(r.useState)(""),2),p=m[0],f=m[1],b=Object(r.useCallback)(Object(l.debounce)(e=>(e=>lE.query({q:e}).then(e=>e.results).catch(()=>[]))(e).then(d).finally(()=>s(!1)),200),[]);return Object(r.useEffect)(()=>{s(!0),b(p)},[b,p]),n.a.createElement(ln.a,{className:"w-100 m-b-10",placeholder:window.W_L.add_user,showSearch:!0,onSearch:f,suffixIcon:i?n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading...")):n.a.createElement("i",{className:"fa fa-search","aria-hidden":"true"}),filterOption:!1,notFoundContent:null,value:void 0,getPopupContainer:e=>e.parentNode,onSelect:t},u.filter(a).map(e=>n.a.createElement(dE,{key:e.id,value:e.id},n.a.createElement(rE,{user:e}))))}function fE(e){var t,a=e.dialog,o=e.author,i=e.context,s=e.aclUrl,c=cE(Object(r.useState)(!0),2),u=c[0],d=c[1],p=cE(Object(r.useState)([]),2),f=p[0],b=p[1],h=(t=s,{loadGrantees:Object(r.useCallback)(()=>B.get(t).then(e=>{var t=[];return Object(l.each)(e,(e,a)=>{e.forEach(e=>{e.accessType=sb(a),t.push(e)})}),t}),[t]),addPermission:Object(r.useCallback)((function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modify";return B.post(t,{access_type:a,user_id:e}).catch(()=>of.error(window.W_L.unauthorized))}),[t]),removePermission:Object(r.useCallback)((function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modify";return B.delete(t,{data:{access_type:a,user_id:e}}).catch(()=>of.error(window.W_L.can_not_delete_user))}),[t])}),g=h.loadGrantees,y=h.addPermission,v=h.removePermission,w=Object(r.useCallback)(()=>{d(!0),g().then(b).catch(()=>of.error(window.W_L.fail_load_list)).finally(()=>d(!1))},[g]),O=Object(r.useCallback)(e=>e.id===o.id||!!Object(l.get)(Object(l.find)(f,{id:e.id}),"accessType"),[o.id,f]);return Object(r.useEffect)(()=>{w()},[s,w]),n.a.createElement(R.a,sE({},a.props,{className:"permissions-editor-dialog",title:n.a.createElement(mE,{context:i}),footer:n.a.createElement(m.a,{onClick:a.dismiss},window.W_L.close)}),n.a.createElement(pE,{onSelect:e=>y(e).then(w),shouldShowUser:e=>!O(e)}),n.a.createElement("div",{className:"d-flex align-items-center m-t-5"},n.a.createElement("h5",{className:"flex-fill"},window.W_L.user_permissions),u&&n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},window.W_L.loading))),n.a.createElement("div",{className:"scrollbox p-5",style:{maxHeight:"40vh"}},n.a.createElement(Ah.a,{size:"small",dataSource:[o,...f],renderItem:e=>n.a.createElement(Ah.a.Item,null,n.a.createElement(rE,{key:e.id,user:e},e.id===o.id?n.a.createElement(Iw.a,{className:"m-0"},window.W_L.author):n.a.createElement(we,{title:"{window.W_L.remove_user_permission}"},n.a.createElement(be,{"aria-label":"{window.W_L.remove_user_permission}",onClick:()=>v(e.id).then(w)},n.a.createElement("i",{className:"fa fa-remove clickable","aria-hidden":"true"})))))})))}mE.propTypes={context:ae.a.oneOf([window.W_L.queries,window.W_L.dashboards])},mE.defaultProps={context:window.W_L.queries},pE.propTypes={onSelect:ae.a.func,shouldShowUser:ae.a.func},pE.defaultProps={onSelect:()=>{},shouldShowUser:()=>!0},fE.propTypes={dialog:wa.isRequired,author:ae.a.object.isRequired,context:ae.a.oneOf([window.W_L.query,window.W_L.dashboards]),aclUrl:ae.a.string.isRequired},fE.defaultProps={context:window.W_L.query};var bE=Oa(fE),hE=a(244),gE=a.n(hE);function yE(){return(yE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}class vE extends n.a.Component{constructor(e){super(e),function(e,t,a){t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}(this,"copy",()=>{this.ref.current.select();try{if(!document.execCommand("copy"))throw new Error;this.setState({copied:window.W_L.copy_success})}catch(e){this.setState({copied:window.W_L.copy_failed})}this.resetCopyState=setTimeout(()=>this.setState({copied:null}),2e3)}),this.state={copied:null},this.ref=n.a.createRef(),this.copyFeatureSupported=document.queryCommandSupported("copy"),this.resetCopyState=null}componentWillUnmount(){this.resetCopyState&&clearTimeout(this.resetCopyState)}render(){var e=n.a.createElement(we,{title:this.state.copied||window.W_L.copy},n.a.createElement(be,{onClick:this.copy},n.a.createElement(gE.a,null)));return n.a.createElement(ba.a,yE({},this.props,{ref:this.ref,addonAfter:this.copyFeatureSupported&&e}))}}function wE(){return(wE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function OE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class EE extends n.a.Component{constructor(e){super(e),OE(this,"formItemProps",{labelCol:{span:8},wrapperCol:{span:16},style:{marginBottom:7}}),OE(this,"enableAccess",()=>{var e=this.props.dashboard;this.setState({saving:!0}),B.post(this.apiUrl).then(t=>{e.publicAccessEnabled=!0,e.public_url=t.public_url}).catch(()=>{of.error(window.W_L.open_share_dashboard_failed)}).finally(()=>{this.setState({saving:!1})})}),OE(this,"disableAccess",()=>{var e=this.props.dashboard;this.setState({saving:!0}),B.delete(this.apiUrl).then(()=>{e.publicAccessEnabled=!1,delete e.public_url}).catch(()=>{of.error(window.W_L.close_share_dashboard_failed)}).finally(()=>{this.setState({saving:!1})})}),OE(this,"onChange",e=>{e?this.enableAccess():this.disableAccess()});var t=this.props.dashboard;this.state={saving:!1},this.apiUrl=Object(l.replace)("api/dashboards/{id}/share","{id}",t.id),this.enabled=this.props.hasOnlySafeQueries||t.publicAccessEnabled}static get headerContent(){return n.a.createElement(n.a.Fragment,null,window.W_L.share_dashboard,n.a.createElement("div",{className:"modal-header-desc"},window.W_L.share_dashboard_tip,n.a.createElement($e,{type:"SHARE_DASHBOARD"})))}render(){var e=this.props,t=e.dialog,a=e.dashboard;return n.a.createElement(R.a,wE({},t.props,{title:this.constructor.headerContent,footer:null}),n.a.createElement(ag.a,{layout:"horizontal"},!this.props.hasOnlySafeQueries&&n.a.createElement(ag.a.Item,null,n.a.createElement(u.a,{message:window.W_L.secret_address_tip,type:"error"})),n.a.createElement(ag.a.Item,wE({label:window.W_L.allow_public},this.formItemProps),n.a.createElement(_o.a,{checked:a.publicAccessEnabled,onChange:this.onChange,loading:this.state.saving,disabled:!this.enabled,"data-test":"PublicAccessEnabled"})),a.public_url&&n.a.createElement(ag.a.Item,wE({label:window.W_L.secret_address},this.formItemProps),n.a.createElement(vE,{value:a.public_url,"data-test":"SecretAddress"}))))}}OE(EE,"propTypes",{dashboard:ae.a.object.isRequired,hasOnlySafeQueries:ae.a.bool.isRequired,dialog:wa.isRequired});var _E=Oa(EE);function jE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return SE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return SE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function SE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function CE(){var e=jE(Object(r.useState)(Object(l.has)(A.search,"fullscreen")),2),t=e[0],a=e[1];Object(r.useEffect)(()=>{document.body.classList.toggle("headless",t),A.setSearch({fullscreen:!!t||null},!0)},[t]);return[t,()=>a(!t)]}function PE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function LE(e){var t=Z.getDashboardRefreshIntervals();return Object(l.max)([30,Object(l.min)(t),e])}function kE(e){var t=PE(Object(r.useState)(function(){var e=parseFloat(A.search.refresh);return Object(l.isNaN)(e)?null:LE(e)}()),2),a=t[0],n=t[1],o=mw(e);return Object(r.useEffect)(()=>{if(A.setSearch({refresh:a||null},!0),a){var e=setInterval(o,1e3*a);return()=>clearInterval(e)}},[a,o]),Object(r.useMemo)(()=>[a,e=>n(LE(e)),()=>n(null)],[a])}function NE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return AE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return AE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var TE="saved",WE="saving",IE="saving_failed";function qE(e,t){var a=NE(Object(r.useState)(e&&Object(l.has)(A.search,"edit")),2),n=a[0],o=a[1],i=NE(Object(r.useState)(TE),2),s=i[0],c=i[1],u=NE(Object(r.useState)([]),2),d=u[0],m=u[1],p=NE(Object(r.useState)(!1),2),f=p[0],b=p[1];Object(r.useEffect)(()=>{A.setSearch({edit:!!n||null},!0)},[n]),Object(r.useEffect)(()=>{f&&s===TE&&(b(!1),o(!1))},[f,s]);var h=Object(r.useCallback)(a=>{if(e){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(l.pickBy)(t,(t,a)=>{var r=Object(l.find)(e,{id:Number(a)}).options.position;return!Object(l.isMatch)(r,t)})}(t,a);c(WE),m(a);var n=Object(l.map)(r,(e,a)=>{var r=Object(l.find)(t,{id:Number(a)});return r?r.save("options",{position:e}):Promise.resolve()});return Promise.all(n).then(()=>c(TE)).catch(()=>{c(IE),of.error("Error saving changes.")})}c(TE)},[e,t]),g=Object(r.useCallback)((function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return c(WE),Object(l.debounce)(()=>h(...t),2e3)()}),[h]),y=Object(r.useCallback)(()=>h(d),[d,h]),v=Object(r.useCallback)(t=>{t||s===TE?o(e&&t):b(!0)},[s,e]);return{editingLayout:e&&n,setEditingLayout:v,saveDashboardLayout:n?g:h,retrySaveDashboardLayout:y,doneBtnClickedWhileSaving:f,dashboardStatus:s}}function DE(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function RE(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?DE(Object(a),!0).forEach((function(t){ME(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):DE(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ME(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function zE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return FE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return FE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function FE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function VE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(l.isEmpty)(t)?e:e.filter(e=>Object.values(e.getParameterMappings()).filter(e=>"dashboard-level"===e.type).some(e=>{var a=e.mapTo;return Object(l.includes)(t.map(e=>e.name),a)}))}var UE=function(e){var t=zE(Object(r.useState)(e),2),a=t[0],n=t[1],o=zE(Object(r.useState)([]),2),i=o[0],s=o[1],c=zE(Object(r.useState)(!1),2),u=c[0],d=c[1],m=zE(Object(r.useState)(!1),2),p=m[0],f=m[1],b=Object(r.useMemo)(()=>a.getParametersDefs(),[a]),h=!a.is_archived&&Z.canEdit(a),g=Object(r.useMemo)(()=>!a.is_archived&&Object(l.has)(a,"user.id")&&(H.id===a.user.id||H.isAdmin),[a]),y=Object(r.useMemo)(()=>Object(l.every)(a.widgets,e=>!e.getQuery()||e.getQuery().is_safe),[a]),v=Object(r.useCallback)(()=>{var e="api/dashboards/".concat(a.id,"/acl");bE.showModal({aclUrl:e,context:"dashboard",author:a.user})},[a]),w=Object(r.useCallback)((function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return n(t=>Object(l.extend)({},t,e)),e=RE(RE({},e),{},{id:a.id}),t&&(e=RE(RE({},e),{},{version:a.version})),Rp.save(e).then(t=>{n(a=>Object(l.extend)({},a,Object(l.pick)(t,Object(l.keys)(e)))),Object(l.has)(e,"name")&&A.setPath(Ze.parse(t.url).pathname,!0)}).catch(e=>{var t=Object(l.get)(e,"response.status");403===t?of.error("Dashboard update failed","Permission Denied."):409===t&&of.error(window.W_F.dashboard_has_changed,window.W_F.dashboard_has_changed_tip,{duration:null})})}),[a]),O=Object(r.useCallback)(()=>{Sa("toggle_published","dashboard",a.id),w({is_draft:!a.is_draft},!1)},[a,w]),E=Object(r.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.getParametersDefs(),n(e=>Object(l.extend)({},e)),e.load(t).catch(e=>{if(!(e instanceof br))return Promise.reject(e)}).finally(()=>n(e=>Object(l.extend)({},e)))}),[]),_=Object(r.useCallback)(e=>E(e,!0),[E]),j=Object(r.useCallback)(e=>{n(t=>Object(l.extend)({},t,{widgets:t.widgets.filter(t=>void 0!==t.id&&t.id!==e)}))},[]),S=Object(r.useRef)();S.current=a;var C=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=VE(S.current.widgets,t),r=Object(l.compact)(a.map(t=>E(t,e).catch(e=>e)));return Promise.all(r).then(()=>{var e=Object(l.compact)(Object(l.map)(S.current.widgets,e=>e.getQueryResult())),t=Ip(S.current,e,A.search);s(t)})}),[E]),P=Object(r.useCallback)(e=>{u||(d(!0),C(!0,e).finally(()=>d(!1)))},[u,C]),x=Object(r.useCallback)(()=>{Sa("archive","dashboard",a.id),Rp.delete(a).then(e=>n(t=>Object(l.extend)({},t,Object(l.pick)(e,["is_archived"]))))},[a]),L=Object(r.useCallback)(()=>{var e=()=>n(e=>Object(l.extend)({},e));_E.showModal({dashboard:a,hasOnlySafeQueries:y}).onClose(e).onDismiss(e)},[a,y]),k=Object(r.useCallback)(()=>{jO.showModal({isNew:!0}).onClose(e=>a.addWidget(e).then(()=>n(e=>Object(l.extend)({},e))))},[a]),N=Object(r.useCallback)(()=>{ZO.showModal({dashboard:a}).onClose(e=>{var t=e.visualization,r=e.parameterMappings;return a.addWidget(t,{parameterMappings:Yw(r)}).then(e=>{var t=[e,...Qw(e.options.parameterMappings,a.widgets)];return Promise.all(t.map(e=>e.save())).then(()=>n(e=>Object(l.extend)({},e)))})})},[a]),T=zE(kE(P),3),W=T[0],I=T[1],q=T[2],D=zE(CE(),2),R=D[0],M=D[1],z=qE(!p&&h,a.widgets);return Object(r.useEffect)(()=>{n(e),C()},[e]),Object(r.useEffect)(()=>{document.title=a.name},[a.name]),Object(r.useEffect)(()=>{C()},[a.dashboard_filters_enabled]),RE(RE({dashboard:a,globalParameters:b,refreshing:u,filters:i,setFilters:s,loadDashboard:C,refreshDashboard:P,updateDashboard:w,togglePublished:O,archiveDashboard:x,loadWidget:E,refreshWidget:_,removeWidget:j,canEditDashboard:h,isDashboardOwnerOrAdmin:g,refreshRate:W,setRefreshRate:I,disableRefreshRate:q},z),{},{gridDisabled:p,setGridDisabled:f,fullscreen:R,toggleFullscreen:M,showShareDashboardDialog:L,showAddTextboxDialog:k,showAddWidgetDialog:N,managePermissions:v})};function BE(){return(BE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function HE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class YE extends n.a.Component{constructor(e){super(e),HE(this,"startEditing",()=>{this.props.isEditable&&this.setState({editing:!0})}),HE(this,"stopEditing",e=>{var t=Object(l.trim)(e);this.props.ignoreBlanks&&""===t||t===this.props.value||this.props.onDone(t),this.setState({editing:!1})}),HE(this,"handleKeyDown",e=>{13!==e.keyCode||e.shiftKey?27===e.keyCode&&this.setState({editing:!1}):(e.preventDefault(),this.stopEditing(e.target.value))}),HE(this,"renderNormal",()=>this.props.value?n.a.createElement("span",{role:"presentation",onFocus:this.startEditing,onClick:this.startEditing,className:this.props.isEditable?"editable":""},this.props.value):n.a.createElement("a",{className:"clickable",onClick:this.startEditing},this.props.placeholder)),HE(this,"renderEdit",()=>{var e=this.props,t=e.multiline,a=e.value,r=e.editorProps,o=t?ba.a.TextArea:ba.a;return n.a.createElement(o,BE({defaultValue:a,"aria-label":"Editing",onBlur:e=>this.stopEditing(e.target.value),onKeyDown:this.handleKeyDown,autoFocus:!0},r))}),this.state={editing:e.defaultEditing}}componentDidUpdate(e,t){!this.state.editing&&t.editing&&this.props.onStopEditing()}render(){return n.a.createElement("span",{className:me()("edit-in-place",{active:this.state.editing},this.props.className)},this.state.editing?this.renderEdit():this.renderNormal())}}function QE(e){return e.tags||[]}function KE(e){return B.get(e).then(QE)}HE(YE,"propTypes",{ignoreBlanks:ae.a.bool,isEditable:ae.a.bool,placeholder:ae.a.string,value:ae.a.string,onDone:ae.a.func.isRequired,onStopEditing:ae.a.func,multiline:ae.a.bool,editorProps:ae.a.object,defaultEditing:ae.a.bool}),HE(YE,"defaultProps",{ignoreBlanks:!1,isEditable:!0,placeholder:"",value:"",onStopEditing:()=>{},multiline:!1,editorProps:{},defaultEditing:!1});a(1339);function $E(){return KE("api/dashboards/tags").then(e=>Object(l.map)(e,e=>e.name))}function GE(e){return e?"primary":"default"}function JE(e){var t=e.dashboardConfiguration,a=t.dashboard,r=t.canEditDashboard,o=t.updateDashboard,i=t.editingLayout;return n.a.createElement("div",{className:"title-with-tags"},n.a.createElement("div",{className:"page-title"},n.a.createElement(Df,{item:a}),n.a.createElement("h3",null,n.a.createElement(YE,{isEditable:i,onDone:e=>o({name:e}),value:a.name,ignoreBlanks:!0})),n.a.createElement(we,{title:a.user.name,placement:"bottom"},n.a.createElement("img",{src:a.user.profile_image_url,className:"profile-image",alt:a.user.name}))),n.a.createElement(Kb,{tags:a.tags,isDraft:a.is_draft,isArchived:a.is_archived,canEdit:r,getAvailableTags:$E,onEdit:e=>o({tags:e})}))}function XE(e){var t=e.dashboardConfiguration,a=t.refreshRate,r=t.setRefreshRate,o=t.disableRefreshRate,i=t.refreshing,s=t.refreshDashboard,c=Z.getDashboardRefreshIntervals(),u=Y.dashboardRefreshIntervals;return n.a.createElement(m.a.Group,null,n.a.createElement(we,{title:a?window.W_L.auto_flush_hz+" ".concat(lb(a)):null},n.a.createElement(m.a,{type:GE(a),onClick:()=>s()},n.a.createElement("i",{className:me()("zmdi zmdi-refresh m-r-5",{"zmdi-hc-spin":i}),"aria-hidden":"true"}),a?lb(a):window.W_L.flush)),n.a.createElement(aa.a,{trigger:["click"],placement:"bottomRight",overlay:n.a.createElement(ue.a,{onClick:e=>{var t=e.key,a=parseFloat(t);a?(r(a),s()):o()},selectedKeys:["".concat(a)]},u.map(e=>n.a.createElement(ue.a.Item,{key:"".concat(e),disabled:!Object(l.includes)(c,e)},lb(e))),a&&n.a.createElement(ue.a.Item,{key:null},window.W_L.stop_auto_flush))},n.a.createElement(m.a,{className:"icon-button hidden-xs",type:GE(a)},n.a.createElement("i",{className:"fa fa-angle-down","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Split button!"))))}function ZE(e){var t=e.dashboardConfiguration,a=t.dashboard,r=t.setEditingLayout,o=t.togglePublished,i=t.archiveDashboard,l=t.managePermissions,s=t.gridDisabled,c=t.isDashboardOwnerOrAdmin;return n.a.createElement(aa.a,{trigger:["click"],placement:"bottomRight",overlay:n.a.createElement(ue.a,{"data-test":"DashboardMoreButtonMenu"},n.a.createElement(ue.a.Item,{className:me()({hidden:s})},n.a.createElement(be,{onClick:()=>r(!0)},window.W_L.edit)),Y.showPermissionsControl&&c&&n.a.createElement(ue.a.Item,null,n.a.createElement(be,{onClick:l},window.W_L.mange_permissions)),!Y.disablePublish&&!a.is_draft&&n.a.createElement(ue.a.Item,null,n.a.createElement(be,{onClick:o},window.W_L.draft)),n.a.createElement(ue.a.Item,null,n.a.createElement(be,{onClick:()=>{R.a.confirm({title:window.W_L.dashboard_archived,content:window.W_L.are_you_sure+' "'.concat(a.name,'" ')+window.W_L.dashboard_archived,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:i,maskClosable:!0,autoFocusButton:null})}},window.W_L.archived)))},n.a.createElement(m.a,{className:"icon-button m-l-5","data-test":"DashboardMoreButton","aria-label":"More actions"},n.a.createElement(Jh.a,{rotate:90,"aria-hidden":"true"})))}function e_(e){var t=e.dashboardConfiguration,a=e.headerExtra,r=t.dashboard,o=t.togglePublished,i=t.canEditDashboard,l=t.fullscreen,s=t.toggleFullscreen,c=t.showShareDashboardDialog,u=t.updateDashboard,d=r.is_draft,p=!r.is_draft,f=i&&!r.is_draft,b=!Y.disablePublicUrls&&(r.publicAccessEnabled||f),h=i;return n.a.createElement("div",{className:"dashboard-control"},r.can_edit&&r.is_archived&&n.a.createElement(m.a,{onClick:()=>{Sa("unarchive","dashboard",r.id),u({is_archived:!1},!1)}},"Unarchive"),!r.is_archived&&n.a.createElement("span",{className:"hidden-print"},d&&n.a.createElement(m.a,{className:"m-r-5 hidden-xs",onClick:o},n.a.createElement("span",{className:"fa fa-paper-plane m-r-5"})," ",window.W_L.publish),n.a.createElement(XE,{dashboardConfiguration:t}),p&&n.a.createElement(we,{className:"hidden-xs",title:window.W_L.dis_en_able_fullscreen},n.a.createElement(m.a,{type:GE(l),className:"icon-button m-l-5",onClick:s,"aria-label":"Toggle fullscreen display"},n.a.createElement("i",{className:"zmdi zmdi-fullscreen","aria-hidden":"true"}))),a,b&&n.a.createElement(we,{title:window.W_L.share_dashboard_setting},n.a.createElement(m.a,{className:"icon-button m-l-5",type:GE(r.publicAccessEnabled),onClick:c,"data-test":"OpenShareForm","aria-label":"Share"},n.a.createElement("i",{className:"zmdi zmdi-share","aria-hidden":"true"}))),h&&n.a.createElement(ZE,{dashboardConfiguration:t})))}function t_(e){var t,a=e.dashboardConfiguration,r=e.headerExtra,o=a.setEditingLayout,i=a.doneBtnClickedWhileSaving,l=a.dashboardStatus,s=a.retrySaveDashboardLayout;return t=l===TE?n.a.createElement("span",{className:"save-status"},window.W_L.saved):l===WE?n.a.createElement("span",{className:"save-status","data-saving":!0},window.W_L.saving):n.a.createElement("span",{className:"save-status","data-error":!0},window.W_L.save_failed),n.a.createElement("div",{className:"dashboard-control"},t,l===IE?n.a.createElement(m.a,{type:"primary",onClick:s},window.W_L.retry):n.a.createElement(m.a,{loading:i,type:"primary",onClick:()=>o(!1)},!i&&n.a.createElement("i",{className:"fa fa-check m-r-5","aria-hidden":"true"})," ",window.W_L.save),r)}function a_(e){var t=e.dashboardConfiguration,a=e.headerExtra,r=t.editingLayout?t_:e_;return n.a.createElement("div",{className:"dashboard-header"},n.a.createElement(JE,{dashboardConfiguration:t}),n.a.createElement(r,{dashboardConfiguration:t,headerExtra:a}))}JE.propTypes={dashboardConfiguration:ae.a.object.isRequired},XE.propTypes={dashboardConfiguration:ae.a.object.isRequired},ZE.propTypes={dashboardConfiguration:ae.a.object.isRequired},e_.propTypes={dashboardConfiguration:ae.a.object.isRequired,headerExtra:ae.a.node},t_.propTypes={dashboardConfiguration:ae.a.object.isRequired,headerExtra:ae.a.node},a_.propTypes={dashboardConfiguration:ae.a.object.isRequired,headerExtra:ae.a.node};a(1340);function r_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return n_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function o_(){return(o_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function i_(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function l_(e){var t=e.dashboardConfiguration,a=t.dashboard,r=t.updateDashboard;return n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(dn.a,{checked:!!a.dashboard_filters_enabled,onChange:e=>{var t=e.target;return r({dashboard_filters_enabled:t.checked})},"data-test":"DashboardFiltersCheckbox"},window.W_L.dashboard_filter))}function s_(e){var t=e.dashboardConfiguration,a=e.className,r=i_(e,["dashboardConfiguration","className"]),o=t.showAddTextboxDialog,i=t.showAddWidgetDialog;return n.a.createElement("div",o_({className:me()("add-widget-container",a)},r),n.a.createElement("h2",null,n.a.createElement("i",{className:"zmdi zmdi-widgets","aria-hidden":"true"}),n.a.createElement("span",{className:"hidden-xs hidden-sm"},window.W_L.dashboard_widget_info)),n.a.createElement("div",null,n.a.createElement(m.a,{className:"m-r-15",onClick:o,"data-test":"AddTextboxButton"},window.W_L.add_text),n.a.createElement(m.a,{type:"primary",onClick:i,"data-test":"AddWidgetButton"},window.W_L.add_widget)))}function c_(e){var t=UE(e.dashboard),a=t.dashboard,o=t.filters,i=t.setFilters,s=t.loadDashboard,c=t.loadWidget,u=t.removeWidget,d=t.saveDashboardLayout,m=t.globalParameters,p=t.updateDashboard,f=t.refreshDashboard,b=t.refreshWidget,h=t.editingLayout,g=t.setGridDisabled,y=e.isShowReport,v=r_(Object(r.useState)(null),2),w=v[0],O=v[1],E=r_(Object(r.useState)({}),2),_=E[0],j=E[1];return Object(r.useEffect)(()=>{if(w)return Yr(w,()=>{if(h){var e=window.getComputedStyle(w,null),t=w.getBoundingClientRect(),a=parseFloat(e.paddingLeft)||0,r=parseFloat(e.paddingRight)||0;j({left:Math.round(t.left)+r,width:w.clientWidth-a-r})}window.dispatchEvent(new Event("resize"))})},[w,h]),n.a.createElement("div",{className:"container",ref:O,"data-test":"DashboardId".concat(a.id,"Container")},y&&n.a.createElement(a_,{dashboardConfiguration:t,headerExtra:n.a.createElement(se,{name:"Dashboard.HeaderExtra",dashboard:a,dashboardConfiguration:t})}),y&&!Object(l.isEmpty)(m)&&n.a.createElement("div",{className:"dashboard-parameters m-b-10 p-15 bg-white tiled","data-test":"DashboardParameters"},n.a.createElement(Qv,{parameters:m,onValuesChange:f,sortable:h,onParametersEdit:e=>{var t=Object(l.map)(e,"name");p({options:{globalParamOrder:t}})}})),y&&!Object(l.isEmpty)(o)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled","data-test":"DashboardFilters"},n.a.createElement(uw,{filters:o,onChange:i})),y&&h&&n.a.createElement(l_,{dashboardConfiguration:t}),n.a.createElement("div",{id:"dashboard-container"},n.a.createElement(BO,{isShowReport:y,dashboard:a,widgets:a.widgets,filters:o,isEditing:h,onLayoutChange:h?d:()=>{},onBreakpointChange:g,onLoadWidget:c,onRefreshWidget:b,onRemoveWidget:u,onParameterMappingsChange:s})),y&&h&&n.a.createElement(s_,{dashboardConfiguration:t,style:_}))}function u_(e){var t=e.dashboardSlug,a=e.dashboardId,o=e.onError,i=e.isShowReport,l=r_(Object(r.useState)(null),2),s=l[0],c=l[1],u=mw(o);return Object(r.useEffect)(()=>{Rp.get({id:a,slug:t}).then(e=>{Sa("view","dashboard",e.id),c(e),a||A.setPath(Ze.parse(e.url).pathname,!0);var t=null;t&&clearTimeout(t),t=setTimeout(()=>{var e=document.querySelector(".dashbord_page");if(e){var t=e.scrollHeight,a=e.clientHeight;e.scrollTo({top:t-a,behavior:"smooth"})}},80)}).catch(u)},[a,t,u]),n.a.createElement("div",{className:"dashboard-page"},s&&n.a.createElement(c_,{isShowReport:i,dashboard:s}))}l_.propTypes={dashboardConfiguration:ae.a.object.isRequired},s_.propTypes={dashboardConfiguration:ae.a.object.isRequired,className:ae.a.string},c_.propTypes={dashboard:ae.a.object.isRequired},u_.propTypes={dashboardSlug:ae.a.string,dashboardId:ae.a.string,onError:ae.a.func,isShowReport:ae.a.bool},u_.defaultProps={dashboardSlug:null,dashboardId:null,onError:ae.a.func,isShowReport:!0};var d_=u_;function m_(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function p_(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m_(Object(a),!0).forEach((function(t){f_(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function f_(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function b_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return h_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}yf.register("Dashboards.LegacyViewOrEdit",pa({path:"/dashboard/:dashboardSlug",render:e=>n.a.createElement(u_,e)})),yf.register("Dashboards.ViewOrEdit",pa({path:"/dashboards/:dashboardId([^-]+)(-.*)?",render:e=>n.a.createElement(u_,e)}));function g_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return y_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return y_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var v_=()=>{var e=e=>{sessionStorage.setItem("HoImes_Dialogue",JSON.stringify(e))},t=()=>JSON.parse(sessionStorage.getItem("HoImes_Dialogue")),a=e=>{sessionStorage.setItem("HoImes_Dashboard",JSON.stringify(e))},r=()=>JSON.parse(sessionStorage.getItem("HoImes_Dashboard")),n=e=>{var t=o();t.length>=10&&t.splice(0,1);var a=t.findIndex(t=>t.uuid===e[0].uuid);a>=0?t[a].messages=e[0].messages:t.push(e[0]),localStorage.setItem("HoImes_All",JSON.stringify(t))},o=()=>JSON.parse(localStorage.getItem("HoImes_All"))||[];return{getAutopilotStorage:()=>JSON.parse(sessionStorage.getItem("HoImes_Dialogue_Autopilot")),addAutopilotStorage:e=>{sessionStorage.setItem("HoImes_Dialogue_Autopilot",JSON.stringify(e))},addDashboard:a,getDashboard:r,addDialogueStorage:e,getDialogueStorage:t,addChatList:(o,i)=>{if(!(o.length<=0)){var l=[];(l="chat"===i?t():r())&&l.length>0&&(l[l.length-1].messages=o),"chat"===i?e(l):a(l),"chat"===i&&l&&l.length>0&&l[l.length-1].messages.length>=2&&n(l)}},getAllStorage:o,setDialogueStorageDashboardId:e=>{var t=r();t&&t.length>0&&(t[0].dashboardId=e),a(t)}}},w_=(a(1341),e=>{var t=e.HolmestableItem,a=e.chat_type,r=e.Holmestable,o=e.loadingMask;return n.a.createElement(n.a.Fragment,null,r&&t&&t.label&&n.a.createElement("div",{className:"dialogue-top"},n.a.createElement("div",{className:"dialogue-top-flex"},n.a.createElement("div",null,"chat"===a?window.W_L.data_analysis:"report"===a?window.W_L.query_builder:"autopilot"===a?window.W_L.auto_pilot:"")),n.a.createElement("div",{className:"dialogue-top-flex"},n.a.createElement("div",null,window.W_L.data_source,":"),n.a.createElement("span",null,t.label)),"viewConversation"!==a&&n.a.createElement(m.a,{disabled:o,type:"primary",size:"small",onClick:()=>{return t=()=>{e.closeDialogue()},void("autopilot"!==a?R.a.confirm({title:window.W_L.reset_dialogue,content:window.W_L.reset_dialogue_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:t,onCancel:null,maskClosable:!0,autoFocusButton:null}):t());var t},style:{borderRadius:"20px",fontSize:"13px",paddingLeft:"15px",paddingRight:"15px"},ghost:!0},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"autopilot"===a?window.W_L.auto_pilot:window.W_L.new_dialogue)))}),O_=(a(1342),e=>{var t=e.loadingMask;return n.a.createElement("div",{className:"overlay"},n.a.createElement(m.a,{className:"overlay-btn",onClick:()=>{e.onUse()},loading:t},t?window.W_L.init_config:window.W_L.start_use))}),E_=a(680),__=a.n(E_),j_=a(420),S_=a.n(j_),C_=a(418),P_=a.n(C_),x_=a(419),L_=a.n(x_),k_=a(245),N_=a.n(k_),A_=a(681),T_=a.n(A_),W_=a(171),I_=a.n(W_),q_=a(239),D_=a.n(q_);a(597);function R_(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function M_(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function z_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return F_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return F_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var V_=Object(r.forwardRef)((e,t)=>{var a=e.SelectLoading,o=e.editData,i=e.closeEditData,l=e.submit,s=e.source_item,c=z_(Object(r.useState)([]),2),u=c[0],d=c[1],m=z_(Object(r.useState)({}),2),p=m[0],f=m[1],b=z_(Object(r.useState)(!1),2),h=b[0],g=b[1],y=[{title:window.W_L.field_name,dataIndex:"name",key:"name"},{title:window.W_L.description,dataIndex:"comment",key:"comment",render:(e,t)=>n.a.createElement(ba.a,{type:"text",placeholder:window.W_L.field_description,value:e,style:{border:"none !important"},onChange:e=>v(e,t)})},{title:window.W_L.detection,dataIndex:"is_pass",key:"is_pass",render:(e,t)=>n.a.createElement("div",null,1===e?n.a.createElement("span",{style:{color:"#52c41a"}},window.W_L.pass):n.a.createElement("span",{style:{color:"#f5222d"}},window.W_L.fail))}];Object(r.useEffect)(()=>{g(a)},[a]),Object(r.useEffect)(()=>{o&&o.length>0&&(d(o),w(o[0]))},[o]);var v=(e,t)=>{var a=e.target.value,r=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R_(Object(a),!0).forEach((function(t){M_(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},p).field_desc.map(e=>(e.name===t.name&&(e.comment=a),e)),n=u.map(e=>(e.table_name===p.table_name&&(e.field_desc=r),e));d(n)},w=e=>{var t=e;t.field_desc=e.field_desc.filter(e=>0===e.is_pass),f(t)},O=p.field_desc&&p.field_desc.length>0,E=u&&u.length>0;return n.a.createElement("div",null,n.a.createElement("p",{className:"edit-back",onClick:()=>{i()}},n.a.createElement(Vy.a,{style:{fontSize:"18px"}})),n.a.createElement("div",{className:"select-content-item"},n.a.createElement("div",{style:{position:"absolute",bottom:"-30px",fontSize:"12px"}},n.a.createElement(we,{title:window.W_L.source_tooltip},n.a.createElement(D_.a,{style:{marginRight:"5px"}})),window.W_L.source_second_tooltip),n.a.createElement("div",{style:{display:"flex",alignItems:"baseline"}},n.a.createElement("div",{className:"select-main",style:{margin:"0"}},n.a.createElement("ul",{className:E?"":"flex-center",style:{height:"288px"}},E&&u.map((e,t)=>n.a.createElement("li",{key:t},n.a.createElement("span",{onClick:()=>w(e),style:{color:e.table_name===p.table_name?"#2196F3":"#333",textAlign:"center",display:"block"}},"csv"===s.type?e.table_comment:e.table_name)))))),n.a.createElement("div",{className:"table-columns"},O&&n.a.createElement("div",{className:"table-columns-item"},n.a.createElement("span",null,"csv"===s.type?p.table_comment:p.table_name),n.a.createElement(ba.a,{placeholder:window.W_L.sheet_description,style:{padding:"2px",maxWidth:"60%"},type:"text",disabled:"csv"===s.type,value:"csv"===s.type?p.table_name:p.table_comment,onChange:e=>{var t=e.target.value,a=u.map(e=>(e.table_name===p.table_name&&(e.table_comment=t),e));d(a)}})),n.a.createElement("div",{className:O?"":"flex-center",style:{width:"400px",overflowY:"scroll",height:O?"235px":"276px"}},O&&n.a.createElement($l.a,{dataSource:p.field_desc,columns:y,size:"small",rowKey:e=>e.name,pagination:!1}))),n.a.createElement("button",{onClick:()=>{l(u)},disabled:h,className:"submit-btn"},window.W_L.submit)))});function U_(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function B_(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?U_(Object(a),!0).forEach((function(t){H_(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):U_(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function H_(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Y_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Q_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Q_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var K_=Object(r.forwardRef)((e,t)=>{var a=e.confirmLoading,o=e.Holmestable,i=e.chat_type,l=e.onChange,s=e.onSuccess,c=e.percent,u=Y_(Object(r.useState)([]),2),d=u[0],m=u[1],p=Y_(Object(r.useState)({type:"mysql"}),2),f=p[0],b=p[1],h=Y_(Object(r.useState)(),2),y=h[0],v=h[1],w=Y_(Object(r.useState)([]),2),O=w[0],E=w[1],_=Y_(Object(r.useState)([]),2),j=_[0],S=_[1],C=Y_(Object(r.useState)({}),2),P=C[0],x=C[1],L=Y_(Object(r.useState)([]),2),k=L[0],N=L[1],A=Y_(Object(r.useState)([]),2),T=A[0],W=A[1],I=Y_(Object(r.useState)([]),2),q=I[0],D=I[1],R=Y_(Object(r.useState)(!1),2),M=R[0],z=R[1],F=Y_(Object(r.useState)(!1),2),V=F[0],U=F[1],H=Y_(Object(r.useState)(!1),2),Y=H[0],Q=H[1],K=Y_(Object(r.useState)(!0),2),$=K[0],G=K[1],J=Y_(Object(r.useState)([]),2),X=J[0],Z=J[1],ee=Y_(Object(r.useState)(!1),2),te=ee[0],ae=ee[1],re=[{title:window.W_L.field_name,dataIndex:"name",key:"name"},{title:window.W_L.description,dataIndex:"comment",key:"comment",render:(e,t)=>n.a.createElement(ba.a,{type:"text",value:e,style:{border:"none !important"},placeholder:window.W_L.field_description,onChange:e=>se(e,t)})}];Object(r.useEffect)(()=>{var e,t;regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,regeneratorRuntime.awrap(B.get("/api/data_sources"));case 3:e=a.sent,t=e.map(e=>B_(B_({},e),{},{value:e.id,label:e.name,type:e.type})),"report"!==i&&t.unshift({label:window.W_L.excel_upload,value:0,type:"csv",id:0}),m(t),a.next=12;break;case 9:a.prev=9,a.t0=a.catch(0),console.error("error",a.t0);case 12:case"end":return a.stop()}}),null,null,[[0,9]],Promise)},[i]),Object(r.useEffect)(()=>{G(a),a||ae(!1)},[a]);var ne=e=>{Z(e)},oe=()=>{b({type:""}),v(""),E([]),S([]),x({}),N([]),W([]),D([]),U(!1),Q(!1)},ie=(e,t)=>{var a,r,n,o,i;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:if(l.prev=0,r=(e,t)=>e.map((e,a)=>B_(B_({},e),{},{label:"csv"===t?e.source_name:e.name,value:a,name:"csv"===t?e.file_name:e.name,checked:!1})),"mysql"!==t&&"pg"!==t){l.next=9;break}return l.next=5,regeneratorRuntime.awrap(B.get("/api/data_sources/".concat(e,"/schema")));case 5:n=l.sent,a=r(n.schema,t),l.next=14;break;case 9:return l.next=11,regeneratorRuntime.awrap(B.get("api/upload"));case 11:o=l.sent,i=o.data,a=r(i,t);case 14:E(a),l.next=20;break;case 17:l.prev=17,l.t0=l.catch(0),console.error("error",l.t0);case 20:case"end":return l.stop()}}),null,null,[[0,17]],Promise)},le=function(e){var t,a,r,n,o,i,l=arguments;return regeneratorRuntime.async((function(s){for(;;)switch(s.prev=s.next){case 0:return t=l.length>1&&void 0!==l[1]?l[1]:null,z(!0),a={table_name:"",table_comment:"",field_desc:[]},s.next=5,regeneratorRuntime.awrap(B.get("/api/data_table/columns/".concat(y,"/").concat("csv"===f.type?e.file_name:e.name)));case 5:r=s.sent,0!==Object.keys(r).length?(a.table_name=r.table_name,a.table_comment=r.table_desc||"",a.field_desc=r.table_columns_info.field_desc):(a.table_name="csv"===f.type?e.file_name:e.name,a.table_comment="csv"===f.type?e.source_name:"","csv"!==f.type&&e.columns.forEach((t,r)=>{var n={name:"pg"===f.type?t.name:t,comment:e.comment[r]||"",in_use:1};a.field_desc.push(n)})),(n=j.find(e=>e.table_name===a.table_name))||S(e=>[...e,a]),t||x(n||a),(o=q.find(e=>e.table_name===a.table_name))?W(o.selectedRowKeys):(i=a.field_desc.map(e=>e.name),t||W(i),D(e=>[...e,{table_name:a.table_name,selectedRowKeys:i}])),z(!1);case 13:case"end":return s.stop()}}),null,null,null,Promise)},se=(e,t)=>{var a=e.target.value,r=B_({},P);r.field_desc=r.field_desc.map(e=>(e.name===t.name&&(e.comment=a),e)),x(r);var n=j.map(e=>(e.table_name===r.table_name&&(e.field_desc=r.field_desc),e));S(n)},ce={selectedRowKeys:T,onChange:(e,t)=>{W(e);var a=B_({},P);a.field_desc=a.field_desc.map(t=>(t.in_use=e.includes(t.name)?1:0,t)),x(a);var r=j.map(e=>(e.table_name===a.table_name&&(e.field_desc=a.field_desc),e));S(r);var n=q.find(e=>e.table_name===a.table_name);D(n?q.map(t=>(t.table_name===a.table_name&&(t.selectedRowKeys=e),t)):t=>[...t,{table_name:a.table_name,selectedRowKeys:e}])}},ue=function(){var e,t,a,r,n,o,i=arguments;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:if(e=i.length>0&&void 0!==i[0]?i[0]:[],ae(!0),t=[],a=[],r={},!(e.length>0)){l.next=14;break}return t=e.map(e=>({name:e.table_name})),n=t.map(t=>{var r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,regeneratorRuntime.awrap(B.get("/api/data_table/columns/".concat(y,"/").concat(t.name)));case 2:(r=o.sent)&&(n={table_name:r.table_name,table_comment:r.table_desc||"",field_desc:r.table_columns_info.field_desc},e.forEach(e=>{e.table_name===r.table_name&&(n.table_comment=e.table_comment,n.field_desc.forEach((t,a)=>{e.field_desc.forEach(e=>{t.name===e.name&&(n.field_desc[a].comment=e.comment)})}))}),a.push(n));case 4:case"end":return o.stop()}}),null,null,null,Promise)}),l.next=10,regeneratorRuntime.awrap(Promise.all(n));case 10:s(200,a,f,r={tableName:t},""),l.next=19;break;case 14:o=k.filter(e=>e.checked),t=o.map(e=>({name:e.name})),r={tableName:t},a=j.filter(e=>o.some(t=>t.name===e.table_name)),s(200,a,f,r,"firstTableData");case 19:case"end":return l.stop()}}),null,null,null,Promise)},de=d.map(e=>{var t=e.type,a=e.value,r=e.label,o=null;return"csv"===t?o=N_.a:"mysql"===t?o=L_.a:"pg"===t&&(o=P_.a),n.a.createElement(ln.a.Option,{key:a,value:a},n.a.createElement(__.a,null,n.a.createElement("div",{"aria-label":r,style:{display:"flex",alignItems:"center"}},n.a.createElement("span",{role:"img",style:{marginRight:"5px"}},n.a.createElement("img",{src:o,alt:o,style:{width:"30px",height:"30px"}})),r)))}),me=()=>n.a.createElement("div",{style:{textAlign:"center",display:"flex",flexDirection:"column",color:"#8f8f8f"}},n.a.createElement(T_.a,{style:{fontSize:"30px"}}),window.W_L.no_data);Object(r.useImperativeHandle)(t,()=>({editTableData:ne}));var pe=O&&O.length>0,fe=P&&P.table_name&&P.field_desc.length>0;return!o&&n.a.createElement("div",{className:"flex-column"},n.a.createElement("div",{className:"dislogue-caption"},n.a.createElement("h1",null,"Hi !"),n.a.createElement("span",null,"chat"===i?window.W_L.chat_start:"autopilot"===i?window.W_L.AutoPilot_start:window.W_L.report_start,n.a.createElement(g,{href:"/data_sources"},window.W_L.add_datasource))),n.a.createElement("div",{className:"select-content"},n.a.createElement(Tf.a,{spinning:$,className:te?"dislogue-spin":""},X&&X.length>0?n.a.createElement(V_,{SelectLoading:$,editData:X,closeEditData:()=>{Z([])},submit:ue,source_item:f}):n.a.createElement("div",{className:"select-content-item"},n.a.createElement("div",{style:{position:"absolute",bottom:"-30px",fontSize:"12px"}},n.a.createElement(we,{title:window.W_L.source_tooltip},n.a.createElement(I_.a,{style:{marginRight:"3px"}})),window.W_L.source_first_tooltip),n.a.createElement("div",{style:{display:"flex",alignItems:"baseline"}},n.a.createElement("span",{className:"select-content-item-span"},window.W_L.data_source,n.a.createElement(we,{title:window.W_L.source_tooltip,placement:"bottom"},n.a.createElement(Lt.a,{style:{marginLeft:"5px"}}))),n.a.createElement("div",null,n.a.createElement(ln.a,{style:{width:240},showSearch:!0,defaultValue:y,className:"dialogue-content-select",placeholder:window.W_L.select_data_source,optionFilterProp:"children",onChange:e=>{oe();var t=d.find(t=>t.value===e),a=t?t.type:null;l(a,e,t),b(t),v(e),ie(e,a)},optionSelectedBg:"#eff0f4",disabled:$,filterOption:(e,t)=>{var a;return(null!==(a=null==t?void 0:t.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())}},de),n.a.createElement("div",{className:"select-main"},n.a.createElement("ul",{className:pe?"":"flex-center"},pe&&n.a.createElement("div",{className:"flex-end"},n.a.createElement("span",null,window.W_L.select_all),n.a.createElement(dn.a,{indeterminate:V,checked:Y,onChange:e=>function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){G(!0),U(!1),Q(e.target.checked);var a=[],r=[];O.forEach(t=>{a.push(B_(B_({},t),{},{checked:e.target.checked})),!t.checked&&e.target.checked&&r.push(le(t,"all"))}),E(a),N(e.target.checked?a:[]),e.target.checked?Promise.all(r).then(e=>{G(!1)}):(N([]),x({}),S([]),W([]),D([]),G(!1))}}(e,"all")})),pe?O.map((e,t)=>n.a.createElement("li",{key:t},n.a.createElement("span",{onClick:()=>(e=>{if(!M){var t=j.find(t=>t.table_name===e.name);t?(x(t),W(t.field_desc.filter(e=>1===e.in_use).map(e=>e.name))):le(e)}})(e),style:{color:e.label===P.table_name?"#2196F3":"#333"}},e.label),n.a.createElement(dn.a,{checked:e.checked,onChange:t=>((e,t)=>{E([...O.map(a=>a.name===t.name?B_(B_({},a),{},{checked:e.target.checked}):a)]),e.target.checked?(N([...k,B_(B_({},t),{},{checked:!0})]),le(t)):(N(k.filter(e=>e.name!==t.name)),S(j.filter(e=>e.table_name!==t.name)),D(q.filter(e=>e.table_name!==t.name)),k.length<1&&x({})),N(e=>(e.length===O.length?(U(!1),Q(!0)):e.length>0?(U(!0),Q(!1)):(U(!1),Q(!1)),e))})(t,e)}))):n.a.createElement(me,null))))),n.a.createElement("div",{className:"table-columns"},fe&&n.a.createElement("div",{className:"table-columns-item"},n.a.createElement("span",null,"csv"===f.type?P.table_comment:P.table_name),n.a.createElement(ba.a,{placeholder:window.W_L.sheet_description,style:{padding:"2px",maxWidth:"60%"},type:"text",disabled:"csv"===f.type,value:"csv"===f.type?P.table_name:P.table_comment,onChange:e=>{var t=e.target.value;x(e=>B_(B_({},e),{},{table_comment:t}));var a=B_({},P);a.table_comment=t;var r=j.map(e=>(e.table_name===a.table_name&&(e.table_comment=a.table_comment),e));S(r)}})),n.a.createElement("div",{className:fe?"":"flex-center",style:{width:"400px",overflowY:"scroll",height:fe?"235px":"276px"}},fe?n.a.createElement($l.a,{rowSelection:B_({type:"checkbox"},ce),dataSource:P.field_desc,columns:re,size:"small",rowKey:e=>e.name,pagination:!1}):n.a.createElement(me,null))),k&&k.length>0&&n.a.createElement("button",{onClick:ue,disabled:$,className:"submit-btn"},window.W_L.submit," ",k.length))),$&&te&&n.a.createElement("div",{className:"dislogue-progress"},n.a.createElement(S_.a,{width:80,type:"circle",percent:c}),n.a.createElement("p",null,window.W_L.ai_understanding_data))))}),$_=a(320);function G_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return J_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return J_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var X_=Object(r.memo)(e=>{var t=e.content,a=Object(r.useRef)(null),o=G_(Object(r.useState)({}),2),i=o[0],l=o[1];Object(r.useEffect)(()=>{var e=JSON.parse(t);l(e)},[t]),Object(r.useEffect)(()=>{var e=null;if(a.current){if(e=$_.b(a.current),"color"in i&&delete i.color,"series"in i)for(var t=0;t<i.series.length;++t)"lineStyle"in i.series[t]&&delete i.series[t].lineStyle;e.setOption(i)}return window.addEventListener("resize",s),()=>{e&&e.dispose(),window.removeEventListener("resize",s)}},[i]);var s=()=>{if(a.current){var e=$_.a(a.current);e&&e.resize()}};return n.a.createElement("div",{ref:a,className:"w-full h-500"})}),Z_=(a(1353),a(304)),ej=a.n(Z_),tj=a(421);function aj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return rj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return rj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}a(1354);var nj=Object(r.memo)(e=>{var t=e.title,a=e.content,o=Object(r.useRef)(null);Object(r.useEffect)(()=>{if(a){var e=a,t=document.createElement("div");t.innerHTML=e,o.current.append(t);try{t.querySelectorAll("script").forEach(e=>{window.eval(e.innerText)})}catch(e){}}},[a]);var i=(()=>{var e=aj(Object(r.useState)(!1),2),t=e[0],a=e[1];return{loading:t,exportPDF:(e,t)=>{var r,n,o;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:t&&(a(!0),r=t.offsetWidth/4,n=t.offsetHeight/4,14400,n>14400&&(o=14400/n,n=14400,r*=o),ej()(t,{scale:2,useCORS:!0,allowTaint:!1,ignoreElements:e=>"ignoreBtnElement"===e.id}).then(t=>{var o,i=t.getContext("2d");i&&(i.mozImageSmoothingEnabled=!1,i.webkitImageSmoothingEnabled=!1,i.msImageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1);var l=t.toDataURL("image/webp",.7),s=new Image;s.src=l,s.onload=function(){var t;s.width/=2,s.height/=2,s.style.transform="scale(0.5)",o=r>n?"l":"p",(t=new tj.default(o,"mm",[r,n])).addImage(l,"jpeg",0,0,r,n),t.save("".concat(e,".pdf")),a(!1)}}));case 1:case"end":return i.stop()}}),null,null,null,Promise)}}})(),l=i.loading,s=i.exportPDF;return n.a.createElement("div",{className:"auto_pilot"},n.a.createElement("div",{className:"auto_pilot_icon",onClick:()=>{s(t,o.current)}},n.a.createElement("svg",{t:"1701955188289",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3387",width:"2rem",height:"2rem"},n.a.createElement("path",{d:"M704 0H192c-35.328 0-64 28.672-64 64v320h576c35.328 0 64 28.672 64 64v415.744c0 35.328-28.672 64-64 64H128v31.744c0 35.328 28.672 64 64 64h768c35.328 0 64-28.672 64-64v-640L704 0z",fill:"#EAEAEA","p-id":"3388"}),n.a.createElement("path",{d:"M704 0v256c0 35.328 28.672 64 64 64h256L704 0z",fill:"#434854","p-id":"3389"}),n.a.createElement("path",{d:"M768 320l256 256V320z",opacity:".1","p-id":"3390"}),n.a.createElement("path",{d:"M704 832c0 17.92-14.336 31.744-31.744 31.744H31.744C13.824 863.744 0 849.408 0 832V480.256c0-17.92 14.336-31.744 31.744-31.744h640c17.92 0 31.744 14.336 31.744 31.744V832z",fill:"#CD4050","p-id":"3391"}),n.a.createElement("path",{d:"M192 544.256h-48.128c-8.704 0-15.872 7.168-15.872 15.872v192c0 8.704 7.168 15.872 15.872 15.872s15.872-7.168 15.872-15.872v-79.872h31.744c35.328 0 64-28.672 64-64s-28.16-64-63.488-64z m158.72 0c34.816 0 62.976 27.648 64 62.464v97.792c0 34.816-27.648 62.976-62.464 64h-49.664c-8.704 0-15.36-6.656-15.872-14.848V560.64c0-8.704 6.656-15.36 14.848-15.872h49.152z m227.328 0c8.704 0 15.872 7.168 15.872 15.872S586.752 576 578.048 576h-80.384v64h48.128c8.704 0 15.872 7.168 15.872 15.872s-7.168 15.872-15.872 15.872h-48.128v79.872c0 8.704-7.168 15.872-15.872 15.872s-15.872-7.168-15.872-15.872v-192c0-8.704 7.168-15.872 15.872-15.872h96.256zM350.72 576h-31.744v159.744h31.744c17.408 0 31.232-13.824 31.744-30.72v-97.28C382.976 590.336 368.64 576 350.72 576zM192 576c17.92 0 31.744 14.336 31.744 31.744S209.92 640 192 640h-31.744v-64H192z",fill:"#FFFFFF","p-id":"3392"})),n.a.createElement("p",null,window.W_L.download),l&&n.a.createElement(wf.a,null)),n.a.createElement("div",{ref:o}))}),oj=(a(1355),(e,t)=>n.a.createElement("div",{className:"content_loading"},n.a.createElement("div",{className:"point1"}),n.a.createElement("div",{className:"point2"}),n.a.createElement("div",{className:"point3"})));a(1356);function ij(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var sj=e=>{var t=e.logData,a=e.Cardloading,r=ij(n.a.useState([]),2),o=r[0],i=r[1],l=ij(n.a.useState("Show work"),2),s=l[0],c=l[1],u=n.a.useRef(null);n.a.useEffect(()=>{if(t&&t.length>0){var e=t.slice(o.length),a=u.current,r=/\n/g;if(e.some(e=>r.test(e))){var n=e.map(e=>e.replace(/\n\n/g,"<br />"));i(e=>[...e,...n])}else i(t=>[...t,...e]);setTimeout(()=>{a.scrollTop=a.scrollHeight},0)}},[t,o.length]);return n.a.createElement("div",{className:"log_terminal"},n.a.createElement("div",{className:"log_terminal_header"},a?n.a.createElement(oj,null):n.a.createElement("div",null),n.a.createElement("div",{className:"log_terminal_header_title",onClick:()=>{t&&0===t.length||("Show work"===s?(c("Hide work"),u.current.style.height="170px"):(c("Show work"),u.current.style.height="0px"))}},s)),n.a.createElement("div",{className:"log_terminal_content",ref:u},o&&o.length>0&&o.map((e,t)=>n.a.createElement("div",{key:t,className:"log-item",dangerouslySetInnerHTML:{__html:e}}))))},cj=a(422),uj=a.n(cj),dj=(a(1357),e=>{var t=e.sender,a=e.source;return n.a.createElement("div",{className:"copy".concat(t)},n.a.createElement("div",{className:"copt-item",onClick:()=>{var e=document.createElement("input");e.setAttribute("readonly","readonly"),e.setAttribute("value",a),document.body.appendChild(e),e.select(),e.setSelectionRange(0,9999),document.execCommand("copy")&&document.execCommand("copy"),document.body.removeChild(e)}},n.a.createElement("img",{src:uj.a,alt:""}),n.a.createElement("div",{className:"copy-text"},window.W_L.copy)))});a(1358);function mj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var fj=ba.a.TextArea,bj=()=>{var e=mj(Object(r.useState)(!1),2),t=e[0],a=e[1],o=mj(Object(r.useState)(""),2),i=o[0],l=o[1],s=mj(Object(r.useState)(""),2),c=s[0],u=s[1],d=mj(Object(r.useState)(!0),2),p=d[0],f=d[1],b=()=>{if(i&&c){var e=h();if(e&&e.length>0&&e[0].table_name&&e[0].table_name.tableName&&e[0].table_name.tableName.length>0){a(!0);var t=[],r=e[0].table_name.tableName.map(a=>{var r;return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(B.get("/api/data_table/columns/".concat(e[0].Holmestable_id,"/").concat(a.name)));case 2:r=n.sent,t.push({table_name:r.table_name,table_comment:r.table_desc,field_desc:r.table_columns_info.field_desc});case 4:case"end":return n.stop()}}),null,null,null,Promise)});Promise.all(r).then(()=>{var r,n,o;r=e[0].Holmestable_id,n={databases_desc:"",table_desc:t},regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return o={databases_id:r,report_name:i,report_desc:c,db_comment:n},e.next=3,regeneratorRuntime.awrap(B.post("/api/auto_pilot",o).then(e=>{a(!1),200===e.code?(f(!1),of.success(window.W_L.submit_success,window.W_L.submit_success_tip),yf.navigate("Dialogue.List.autopilot_list")):of.error(e.data)}).catch(e=>{a(!1),of.error(window.W_L.submit_fail)}));case 3:case"end":return e.stop()}}),null,null,null,Promise)}).catch(e=>{console.log(e,"first_error"),a(!1)})}}},h=v_().getAutopilotStorage;return n.a.createElement("div",{style:{width:"100%"}},n.a.createElement(iu.a,{size:"small",column:1,bordered:!0,className:"my-custom-label"},n.a.createElement(iu.a.Item,{label:window.W_L.report_name},n.a.createElement(ba.a,{bordered:!1,placeholder:window.W_L.report_name_tip,value:i,onChange:e=>l(e.target.value)})),n.a.createElement(iu.a.Item,{label:window.W_L.report_desc},n.a.createElement(fj,{style:{resize:"none"},rows:10,placeholder:window.W_L.report_desc_tip,bordered:!1,value:c,onChange:e=>u(e.target.value)}))),n.a.createElement("div",{className:"gpt-descriptions-btn"},n.a.createElement("div",{style:{fontSize:"14px"}},n.a.createElement(ge.a,{title:window.W_L.report_name_and_report_desc_tip},n.a.createElement(I_.a,{style:{marginRight:"3px"}})),window.W_L.please_complete_report_name_and_report_desc),p&&n.a.createElement(m.a,{style:{width:"100px"},block:!0,type:"primary",disabled:t,onClick:()=>b()},n.a.createElement("i",{className:"fa fa-check m-r-5","aria-hidden":"true"}),window.W_L.submit)))};a(598);function hj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return gj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return gj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var yj=e=>{var t=e.chat_type,a=e.autopilot,o=e.chart,i=e.source,l=e.logData,s=e.index,c=e.Cardloading,u=e.sender,d=e.time,m=e.ChangeScrollTop,p=e.retry,f=Object(r.useRef)(),b=hj(Object(r.useState)(""),2),h=b[0],g=b[1],y=hj(Object(r.useState)(!1),2),v=y[0],w=y[1];Object(r.useEffect)(()=>{if(/\n/g.test(i)){var e=i.replace(/\n/g,"<br />");g(e)}else g(i);setTimeout(()=>{m()},0)},[i,m]);var O=Object(r.useMemo)(()=>0===s?null:n.a.createElement(sj,{Cardloading:c,logData:l}),[s,c,l]),E=Object(r.useMemo)(()=>o?n.a.createElement(X_,{content:o}):null,[o]),_=Object(r.useMemo)(()=>n.a.createElement("div",{style:{wordBreak:"break-all"},ref:f,dangerouslySetInnerHTML:{__html:h}}),[h]),j=Object(r.useMemo)(()=>"autopilot"===t?n.a.createElement(bj,null):n.a.createElement("div",{className:"Chat ".concat(u)},i),[t,u,i]);Object(r.useMemo)(()=>a?n.a.createElement(nj,{content:a}):null,[a]);return n.a.createElement("div",{className:"message ".concat(t),onMouseLeave:()=>w(!1)},n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"info".concat(u,"-time")},"autopilot"===t?"":d),n.a.createElement("div",{className:"chat".concat(u),onMouseEnter:()=>w(!0)},"autopilot"!==t&&n.a.createElement("img",{src:"user"===u?H.profile_image_url:vt.a,alt:""}),"user"===u?j:n.a.createElement("div",{className:"Chat ".concat(u)},O,E,_)),v&&!c&&"autopilot"!==t&&n.a.createElement(dj,{index:s,source:i,sender:u,retry:p})))};yj.propTypes={title:te.PropTypes.string,source:te.PropTypes.string},yj.defaultProps={title:"",source:""};var vj=yj,wj=a(683),Oj=a.n(wj),Ej=a(682),_j=a.n(Ej);function jj(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Sj(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?jj(Object(a),!0).forEach((function(t){Cj(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):jj(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Cj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Pj=ba.a.TextArea,xj=Object(r.forwardRef)((e,t)=>{var a=e.Holmestable,o=e.confirmLoading,i=e.onChange,l=e.sendTableDate,s=e.loadingMask,c=e.onUse,u=e.messages,d=e.ChangeScrollTop,m=e.loadingState,p=e.stopSend,f=e.inputMessage,b=(e.newInputMessage,e.setState),h=e.handleSendMessage,g=e.chat_type,y=e.retry,v=e.onOpenKeyClick,w=e.onSuccess,O=e.percent,E=Object(r.useRef)(null),_=e=>{E.current.editTableData(e)};return Object(r.useImperativeHandle)(t,()=>({sourceEdit:_})),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"dialogue-content-all"},n.a.createElement("div",{className:"dialogue-content-message"},n.a.createElement("div",{className:"dialogue-content-message-auto"},n.a.createElement(K_,{ref:E,onSuccess:w,chat_type:g,Holmestable:a,confirmLoading:o,onChange:i,percent:O}),1!==l&&u.length<=0&&a?n.a.createElement(O_,{loadingMask:s,Holmestable:a,onUse:c}):null,u.map((e,t)=>n.a.createElement("div",{key:t,className:"chat-content",style:{margin:"report"===g?"0 30px":"",marginTop:0===t?"30px":""}},n.a.createElement(vj,{chat_type:g,autopilot:e.autopilot,chart:e.chart,logData:e.logData,sender:e.sender,time:e.time,Cardloading:e.Cardloading,source:e.content,index:t,ChangeScrollTop:d,retry:y})))))),"viewConversation"!==g&&n.a.createElement("div",{className:"main-all",style:{width:"report"===g?"90%":"80%"}},m&&u.length>0&&n.a.createElement("div",{className:"gpt-section-btn-list"},n.a.createElement("button",{className:"gpt-btn-item",onClick:p},n.a.createElement(_j.a,{className:"gpt-btn-item-img"}),n.a.createElement("div",{className:"gpt-btn-item-txt"},window.W_L.stop_generation))),"autopilot"===g?"":n.a.createElement("div",{className:"dialogue-content-bottom"},n.a.createElement("div",{className:"open-key",style:{display:"none"},onClick:v}),n.a.createElement(Pj,{bordered:!1,style:{resize:"none",maxHeight:"100px !important",fontSize:"15px",border:"none !important"},value:f,className:"gpt-input",onChange:e=>{if(e&&e.target){var t=e.target.value;b(e=>Sj(Sj({},e),{},{inputMessage:t,newInputMessage:t}))}},placeholder:window.W_L.send_me_instructions,autoSize:{minRows:1,maxRows:4},onPressEnter:e=>{e.preventDefault(),h()}}),n.a.createElement("div",{className:"gpt-input-middle"},n.a.createElement(Oj.a,{onClick:h,style:{color:f?"":"#ccc",fontSize:"20px",marginRight:"15px"}})))))}),Lj=(a(1363),e=>n.a.createElement("div",{className:"menumask"}));a(1364);function kj(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Nj(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?kj(Object(a),!0).forEach((function(t){Aj(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kj(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Aj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Tj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Wj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var Ij=e=>{var t=e.chat_type,a=e.sendUrl,o=e.uuid,i=Object(r.useRef)(),l=Object(r.useRef)(),s=Object(r.useRef)([]),c=Object(r.useRef)(),u=Object(r.useRef)(null),d=Object(r.useRef)({}),m=Object(r.useRef)(null),p=Object(r.useRef)(null),f=Tj(Object(r.useState)(null),2),b=f[0],h=f[1],g=Tj(Object(r.useState)(null),2),y=g[0],v=g[1],w=Tj(Object(r.useState)(!1),2),O=w[0],E=w[1],_=Tj(Object(r.useState)(!1),2),j=_[0],S=_[1],C=Tj(Object(r.useState)(0),2),P=C[0],x=C[1],L=Tj(Object(r.useState)(!1),2),k=L[0],N=L[1],A=Tj(Object(r.useState)([]),2),T=A[0],W=A[1],I=Tj(Object(r.useState)({}),2),q=I[0],D=I[1],R=Object(r.useRef)(),M=Object(r.useRef)(),z=Tj(Object(r.useState)(!1),2),F=z[0],V=z[1],U=Object(r.useRef)("mysql"),H=Tj(Object(r.useState)(0),2),Y=H[0],Q=H[1],K=null,$=Tj(Object(r.useState)({messages:[],inputMessage:"",lockReconnect:!1,data_type:null,newInputMessage:"",logData:[]}),2),G=$[0],J=$[1];Object(r.useEffect)(()=>{},[t]),Object(r.useEffect)(()=>{G.logData&&(s.current=G.logData)},[G.logData]),Object(r.useEffect)(()=>{Z(),oe()},[]),Object(r.useEffect)(()=>{o&&Z()},[o]),Object(r.useEffect)(()=>{R.current=q},[q]),Object(r.useEffect)(()=>{M.current=T},[T]),Object(r.useEffect)(()=>{p.current=y},[y]);var X=Object(r.useCallback)((function(e,a,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i={state:e,database:U.current,sender:a,chat_type:t,data:{data_type:r,databases_id:u.current||0,language_mode:window.W_L.language_mode,content:n},id:o};Wt.send(JSON.stringify(i))}),[G]),Z=function(){if("chat"===t||"report"===t||"autopilot"===t){var e=[];switch(t){case"chat":e=Ie();break;case"report":e=Te()}e&&e.length>0?(v(e[0].table_name),se("",e[0].Holmestable_id),U.current=e[0].type,d.current={label:e[0].label,id:e[0].id,type:e[0].type},e[0].dashboardId?(a(e[0].dashboardId),se("dashboard_id",e[0].dashboardId)):("report"===t&&a("new_report"),se("dashboard_id",null)),e[0].messages&&e[0].messages.length>0?(J(t=>Nj(Nj({},t),{},{messages:e[0].messages})),N(!1),S(!0),ve("edit"),x(0)):pe()):("report"===t&&a(""),v(null),se(null,null),J(e=>Nj(Nj({},e),{},{messages:[]})),N(!1),x(0),S(!1),d.current={})}else if("viewConversation"===t){var r=De();if(r&&r.length>0&&o){var n=r.filter(e=>e.uuid===o);v(n[0].table_name),se("",n[0].Holmestable_id),d.current={label:n[0].label,id:n[0].id,type:n[0].type},n[0].messages&&n[0].messages.length>0&&(J(e=>Nj(Nj({},e),{},{messages:n[0].messages})),N(!1),x(1),S(!0))}}},ee=()=>{var e,a;v(M.current),e=[],(a=Nj({table_name:M.current,Holmestable_id:u.current},d.current)).title=window.W_L.new_dialogue+String(De().length+1),a.uuid=Date.now(),a.messages=[],e.push(a),"report"===t?Ae(e):"chat"===t?We(e):"autopilot"===t&&Re(e)},te=Object(r.useCallback)((e,t,a,r,n)=>{if(!qt)return of.warning(window.W_L.connection_seems_lost),V(!1),void oe();u.current=a.id,d.current={label:a.label,id:a.id,type:a.type},U.current=a.type,V(!0),J(e=>Nj(Nj({},e),{},{data_type:"mysql_comment"})),n&&W(r),D({table_desc:t});var o=t.map(e=>{var t=e.field_desc.filter(e=>1===e.in_use);return{table_name:e.table_name,table_comment:e.table_comment,field_desc:t}});X(e,"bi","mysql_comment",{databases_desc:"",table_desc:o})},[J,X]),ae=(e,t)=>{var a=JSON.parse(JSON.stringify(e));return t.table_desc.forEach((e,t)=>{var r=a.table_desc.findIndex((t,a)=>e.table_name===t.table_name);-1!==r?(a.table_desc[r].table_comment=e.table_comment,e.field_desc.forEach((e,t)=>{var n=a.table_desc[r].field_desc.findIndex((t,a)=>e.name===t.name);-1!==n?(a.table_desc[r].field_desc[n].comment=e.comment,a.table_desc[r].field_desc[n].in_use=e.in_use,a.table_desc[r].field_desc[n].is_pass=e.is_pass):a.table_desc[r].field_desc.push(e)})):a.table_desc.push(e)}),a},re=function(e,t){var a,r,n,o=arguments;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:a=o.length>2&&void 0!==o[2]?o[2]:null;try{r=ae(R.current,t),n=r.table_desc.map(t=>{var a;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return a={table_name:t.table_name,table_inuse:!0,table_desc:t.table_comment,table_columns_info:{field_desc:t.field_desc}},r.next=3,regeneratorRuntime.awrap(B.post("/api/data_table/columns/".concat(e,"/").concat(t.table_name),a));case 3:case"end":return r.stop()}}),null,null,null,Promise)}),Promise.all(n).then(()=>{a&&pe()})}catch(e){V(!1)}case 2:case"end":return i.stop()}}),null,null,null,Promise)},ne=Object(r.useCallback)(()=>{qt?(Wt.onclose=e=>{J(e=>Nj(Nj({},e),{},{messages:e.messages.map((t,a)=>a===e.messages.length-1&&"bot"===t.sender&&t.Cardloading?Nj(Nj({},t),{},{content:window.W_L.connection_seems_lost,Cardloading:!1}):t)})),N(!1),x(0),qt=!1,me()},Wt.onmessage=e=>{var r,n,o;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,"user"===(r=JSON.parse(e.data)).receiver&&(J(e=>Nj(Nj({},e),{},{messages:e.messages.map((t,a)=>a===e.messages.length-1&&"bot"===t.sender?Nj(Nj({},t),{},{content:r.data.content,Cardloading:!1,time:Da()().format("YYYY-MM-DD HH:mm")}):t)})),E(!1),ge()),500!==r.state){i.next=11;break}if("bi"===r.receiver&&"mysql_comment_first"===r.data.data_type&&(x(0),N(!1),E(!1)),V(!1),"log"!==r.receiver){i.next=9;break}return of.warning(r.data.content),i.abrupt("return");case 9:return me(),i.abrupt("return");case 11:if("bi"!==r.receiver){i.next=46;break}if("mysql_code"!==r.data.data_type){i.next=17;break}fe("mysql_code"),Se(r.data.content,r.data.name,r.id),i.next=44;break;case 17:if("ask_data"!==r.data.data_type){i.next=22;break}fe("ask_data"),xe("","ask_data",r.id),i.next=44;break;case 22:if("chart_code"!==r.data.data_type){i.next=27;break}fe("chart_code");try{m.current?Pe(JSON.parse(r.data.content),"edit",r.id):Pe(JSON.parse(r.data.content),null,r.id)}catch(e){X(500,"bi","chart_code",e,r.id)}i.next=44;break;case 27:if("mysql_comment"!==r.data.data_type){i.next=43;break}return fe("mysql_comment"),i.prev=29,n=JSON.parse(JSON.stringify(r.data.content.table_desc)),i.next=33,regeneratorRuntime.awrap(he(n));case 33:(o=i.sent).length>0?(of.info(window.W_L.please_fill_in_the_description),V(!1),l.current.sourceEdit(o),re(u.current,r.data.content)):(ee(),V(!1),"report"===t&&a("new_report"),re(u.current,r.data.content,"success")),Q(0),i.next=41;break;case 38:i.prev=38,i.t0=i.catch(29),me();case 41:i.next=44;break;case 43:"mysql_comment_first"===r.data.data_type?(J("autopilot"===t?{messages:[{content:r.data.content,sender:"bot",Cardloading:!1,time:Da()().format("YYYY-MM-DD HH:mm")},{content:"",sender:"user",time:Da()().format("YYYY-MM-DD HH:mm")}]}:{messages:[{content:r.data.content,sender:"bot",Cardloading:!1,time:Da()().format("YYYY-MM-DD HH:mm")}],data_type:"mysql_comment_first"}),N(!1),x(1),S(!0),E(!1),of.success(window.W_L.configuration_completed,"autopilot"===t?"":window.W_L.start_the_dialogue)):"mysql_comment_second"===r.data.data_type?(J(e=>Nj({},e)),N(!1),x(1),X(200,"user","question",G.newInputMessage)):"delete_chart"===r.data.data_type?(fe("delete_chart"),xe(r.data.content,"delete",r.id)):"table_code"===r.data.data_type&&(fe("table_code"),m.current?Le("edit",r.id):Le(null,r.id));case 44:i.next=56;break;case 46:if("log"!==r.receiver){i.next=55;break}if(r.data.content){i.next=49;break}return i.abrupt("return");case 49:if("data_check"!==r.data.data_type){i.next=52;break}return Q(r.data.content),i.abrupt("return");case 52:J(e=>({messages:e.messages.map((t,a)=>a===e.messages.length-1&&"bot"===t.sender?Nj(Nj({},t),{},{logData:[...t.logData||[],r.data.content]}):t)})),i.next=56;break;case 55:"python"===r.receiver&&"echart_code"===r.data.data_type&&(J(e=>({messages:e.messages.map((t,a)=>a===e.messages.length-1&&"bot"===t.sender?Nj(Nj({},t),{},{chart:r.data.content}):t)})),ge());case 56:i.next=61;break;case 58:i.prev=58,i.t1=i.catch(0),console.log(i.t1,"socket_error");case 61:case"end":return i.stop()}}),null,null,[[0,58],[29,38]],Promise)}):Ft()},[G,J,e]),oe=Object(r.useCallback)(()=>{Ft(),ne()},[]),ie=()=>{if("chat"===t||"report"===t){var e=c.current,a=c.current[c.current.length-1];a&&"bot"===a.sender&&a.Cardloading&&e.pop(),qe(e,t)}};Object(r.useEffect)(()=>{c.current=G.messages},[G.messages]),Object(r.useEffect)(()=>()=>{ie()},[]);var le=Object(r.useCallback)((function(e){oe()}),[J,ne,oe]),se=Object(r.useCallback)((e,t)=>{if("dashboard_id"===e)return m.current=t,void h(t);u.current=t},[]),ce=Object(r.useCallback)(e=>{if(ne(),!qt)return of.warning(window.W_L.connection_failed,window.W_L.connection_failed_tip),x(0),E(!1),void oe();if(p.current&&p.current.tableName.length>0&&0===P){J(t=>Nj(Nj({},t),{},{data_type:e})),N(!0),E(!0);var t=[],a=p.current.tableName.map(e=>{var a;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(B.get("/api/data_table/columns/".concat(u.current,"/").concat(e.name)));case 2:a=r.sent,t.push({table_name:a.table_name,table_comment:a.table_desc,field_desc:(n=a.table_columns_info,n.field_desc.filter(e=>1===e.in_use))});case 4:case"end":return r.stop()}var n}),null,null,null,Promise)});Promise.all(a).then(()=>{X(200,"bi",e,{databases_desc:"",table_desc:t})}).catch(e=>{console.log(e,"first_error"),N(!1),E(!1),x(0)})}},[G,J,ne,oe,X]),ue=Object(r.useCallback)(()=>{var e,t;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(ne(),e=G.inputMessage,t=G.messages,""!==e.trim()){a.next=4;break}return a.abrupt("return");case 4:if(J(a=>Nj(Nj({},a),{},{newInputMessage:e,messages:[...t,{content:e,sender:"user",time:Da()().format("YYYY-MM-DD HH:mm")},{content:"",sender:"bot",Cardloading:!0}],inputMessage:"",data_type:"question"})),E(!0),ge(),!(0===P&&t.length>=1)){a.next=10;break}return ce("mysql_comment_second"),a.abrupt("return");case 10:X(200,"user","question",e);case 11:case"end":return a.stop()}}),null,null,null,Promise)},[G,J,ne,ge,X,ce]),de=Object(r.useCallback)(()=>{G.inputMessage,G.messages;if(!Rt&&!O)return qt?void(j&&p.current&&p.current.tableName.length>0&&ue()):(of.warning(window.W_L.connection_failed,window.W_L.connection_failed_tip),x(0),E(!1),void oe())},[G,J,oe,ue]),me=Object(r.useCallback)(()=>{Rt||(of.warning(window.W_L.connection_failed),E(!1))},[J]),pe=Object(r.useCallback)(()=>{ce("mysql_comment_first")},[ce]),fe=Object(r.useCallback)(e=>{J(t=>Nj(Nj({},t),{},{data_type:e}))},[J]),be=Object(r.useCallback)(()=>{Rt||of.success(window.W_L.report_generation_completed)},[]);var he=Object(r.useCallback)(e=>e.filter(e=>e.field_desc.some(e=>1!==e.is_pass)),[]),ge=Object(r.useCallback)(()=>{"viewConversation"!==t&&(K&&clearTimeout(K),K=setTimeout(()=>{var e=document.querySelector(".dialogue-content-all");if(e){var t=e.scrollHeight,a=e.clientHeight;e.scrollTo({top:t-a,behavior:"smooth"})}},50))},[]),ye=Object(r.useCallback)(()=>{setTimeout(()=>{ge()},100)},[]),ve=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Wt&&Wt.close(),x("edit"===e?1:0),E(!1),Ht(!0),ge(),oe()}),[J,oe]),we=Object(r.useCallback)(e=>{a(e),Ne(e)},[]),Oe=Object(r.useCallback)(e=>{},[J,X]),Ee=Object(r.useCallback)(()=>{},[J,i]),_e=((e,t,a)=>{var n=b_(Object(r.useState)({SelectValue:null,sqlId:null}),2),o=n[0],i=n[1],l=Object(r.useRef)(null),s=Object(r.useRef)(null);Object(r.useEffect)(()=>{o.sqlId&&(l.current=o.sqlId)},[o.sqlId]),Object(r.useEffect)(()=>{e&&(s.current=e)},[e]);var c=Object(r.useCallback)((e,a,r,n)=>{var o;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,regeneratorRuntime.awrap(B.get("/api/query_results/".concat(e.job.query_result_id)));case 3:if(0!==(o=i.sent).query_result.data.rows.length){i.next=7;break}return t(500,"bi","mysql_code","sql没有查询到数据",n),i.abrupt("return");case 7:if("test"!==a){i.next=12;break}return i.next=10,regeneratorRuntime.awrap(m(o.query_result.query,r,n));case 10:i.next=13;break;case 12:t(200,"bi","mysql_code",o.query_result.data,n);case 13:i.next=17;break;case 15:i.prev=15,i.t0=i.catch(0);case 17:case"end":return i.stop()}}),null,null,[[0,15]],Promise)},[t,m]),u=Object(r.useCallback)((function(e,r,n,o){var i,l,s,u,d=arguments;return regeneratorRuntime.async((function(m){for(;;)switch(m.prev=m.next){case 0:i=d.length>4&&void 0!==d[4]?d[4]:50,l=0,s=!1,u=setInterval(()=>{var d;return regeneratorRuntime.async((function(m){for(;;)switch(m.prev=m.next){case 0:if(!(++l>i)){m.next=5;break}return clearInterval(u),a(),m.abrupt("return");case 5:return m.prev=5,m.next=8,regeneratorRuntime.awrap(B.get("/api/jobs/".concat(e.job.id)));case 8:if(!(d=m.sent).job.query_result_id||s){m.next=16;break}return s=!0,clearInterval(u),m.next=14,regeneratorRuntime.awrap(c(d,r,n,o));case 14:m.next=20;break;case 16:if(!d.job.error){m.next=20;break}return clearInterval(u),t(500,"bi","mysql_code",d.job.error,o),m.abrupt("return");case 20:m.next=24;break;case 22:m.prev=22,m.t0=m.catch(5);case 24:case"end":return m.stop()}}),null,null,[[5,22]],Promise)},200);case 4:case"end":return m.stop()}}),null,null,null,Promise)}),[a,t,c]),d=Object(r.useCallback)((e,a)=>{var r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return r={id:e.id,parameters:{},apply_auto_limit:!0,max_age:0},o.prev=1,o.next=4,regeneratorRuntime.awrap(B.post("/api/queries/".concat(e.id,"/results"),r));case 4:return n=o.sent,o.next=7,regeneratorRuntime.awrap(u(n,"execute",null,a));case 7:o.next=12;break;case 9:o.prev=9,o.t0=o.catch(1),t(500,"bi","mysql_code","",a);case 12:case"end":return o.stop()}}),null,null,[[1,9]],Promise)},[u,t]),m=Object(r.useCallback)((e,t,a)=>{var r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return r={data_source_id:s.current,latest_query_data_id:null,name:t,options:{apply_auto_limit:!0,parameters:[]},query:e,schedule:null,tags:[]},o.prev=1,o.next=4,regeneratorRuntime.awrap(B.post("/api/queries",r));case 4:return n=o.sent,i(e=>p_(p_({},e),{},{sqlId:n.id})),o.next=8,regeneratorRuntime.awrap(d(n,a));case 8:o.next=12;break;case 10:o.prev=10,o.t0=o.catch(1);case 12:case"end":return o.stop()}}),null,null,[[1,10]],Promise)},[d]),p=Object(r.useCallback)((e,t,a)=>{var r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return r={apply_auto_limit:!0,data_source_id:s.current,max_age:0,parameters:{},query:e},o.prev=1,o.next=4,regeneratorRuntime.awrap(B.post("/api/query_results",r));case 4:return n=o.sent,o.next=7,regeneratorRuntime.awrap(u(n,"test",t,a));case 7:o.next=11;break;case 9:o.prev=9,o.t0=o.catch(1);case 11:case"end":return o.stop()}}),null,null,[[1,9]],Promise)},[u]);return{state:o,saveSql:m,executeSql:d,testAndVerifySql:p,findJob:u,findQueryResult:c,new_sql:l}})(u.current,X,me),je=_e.new_sql,Se=_e.testAndVerifySql,Ce=((e,t,a,n,o,i,l,s)=>{var c=g_(Object(r.useState)({dashboard_id:null}),2),u=c[0],d=c[1],m=Object(r.useRef)(null);Object(r.useEffect)(()=>{l&&(m.current=l)},[l]);var p=Object(r.useCallback)((function(t){var a,r,n,o,l,s=arguments;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:null,r=s.length>2?s[2]:void 0,n=i.current,o={description:"",name:window.W_L.CHART,query_id:n,type:"CHART",options:{alignYAxesAtZero:!1,globalSeriesType:t[0].globalSeriesType,coefficient:1,columnMapping:t[0].columnMapping,dateTimeFormat:"DD/MM/YY HH:mm",direction:{type:"counterclockwise"},error_y:{type:"data",visible:!0},legend:{enabled:!0,placement:"auto",traceorder:"normal"},missingValuesAsZero:!0,numberFormat:"0,0[.]00000",percentFormat:"0[.]00%",series:{stacking:null,error_y:{type:"data",visible:!0}},seriesOptions:{},showDataLabels:!0,sizemode:"diameter",sortX:!1,textFormat:"",valuesOptions:{},xAxis:{type:"category",labels:{enabled:!0}},yAxis:[{type:"linear"},{type:"linear",opposite:!0}]}},c.prev=4,c.next=7,regeneratorRuntime.awrap(B.post("/api/visualizations",o));case 7:if(l=c.sent,"edit"!==a){c.next=13;break}return c.next=11,regeneratorRuntime.awrap(g(l,a,r));case 11:c.next=15;break;case 13:return c.next=15,regeneratorRuntime.awrap(f(null,r));case 15:c.next=20;break;case 17:c.prev=17,c.t0=c.catch(4),e(500,"bi","chart_code",c.t0,r);case 20:case"end":return c.stop()}}),null,null,[[4,17]],Promise)}),[u,g,f]),f=Object(r.useCallback)((function(){var t,a,r,n,o,l,s=arguments;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:null,a=s.length>1?s[1]:void 0,r=i.current,n=n,o={id:r,is_draft:!0,version:1},c.prev=5,c.next=8,regeneratorRuntime.awrap(B.post("/api/queries/".concat(r),o));case 8:if(l=c.sent,!n||!n.dashboard_id){c.next=14;break}return c.next=12,regeneratorRuntime.awrap(g(l,t,a));case 12:c.next=16;break;case 14:return c.next=16,regeneratorRuntime.awrap(h(t,a));case 16:c.next=21;break;case 18:c.prev=18,c.t0=c.catch(5),e(500,"bi","chart_code",c.t0,a);case 21:case"end":return c.stop()}}),null,null,[[5,18]],Promise)}),[u,o,g,h,e]),b=e=>{var t;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,regeneratorRuntime.awrap(B.get("/api/dashboards?order&page=1&page_size=20&q=".concat(e)));case 2:(t=a.sent).results.length>0&&t.results.forEach((t,a)=>regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(t.name!==e){a.next=4;break}return a.next=3,regeneratorRuntime.awrap(B.delete("/api/dashboards/".concat(t.id)));case 3:a.sent;case 4:case"end":return a.stop()}}),null,null,null,Promise));case 4:case"end":return a.stop()}}),null,null,null,Promise)},h=Object(r.useCallback)((function(){var e,a,r,n,o=arguments;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:return e=o.length>0&&void 0!==o[0]?o[0]:null,a=o.length>1?o[1]:void 0,r={name:window.W_L.temporary_dashboard},i.prev=3,i.next=6,regeneratorRuntime.awrap(b(window.W_L.temporary_dashboard));case 6:return i.next=8,regeneratorRuntime.awrap(B.post("/api/dashboards",r));case 8:return n=i.sent,t("dashboard_id",n.id),i.next=12,regeneratorRuntime.awrap(g(n,e,a));case 12:i.next=16;break;case 14:i.prev=14,i.t0=i.catch(3);case 16:case"end":return i.stop()}}),null,null,[[3,14]],Promise)}),[d,t,g]),g=Object(r.useCallback)((function(t){var a,r,o,i,l=arguments;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:null,r=l.length>2?l[2]:void 0,o=m.current?m.current:t.id,c.prev=3,c.next=6,regeneratorRuntime.awrap(B.get("/api/dashboards/".concat(o)));case 6:if(i=c.sent,"delete"!==a){c.next=10;break}return E(t,i,r),c.abrupt("return");case 10:if("ask_data"!==a){c.next=13;break}return O(i,a,r),c.abrupt("return");case 13:if("getPath"!==a&&"delGetPath"!==a){c.next=18;break}return e(200,"bi","getPath"===a?"chart_code":"delete_chart",i,r),s(o),n(),c.abrupt("return");case 18:return c.next=20,regeneratorRuntime.awrap(y(i,a,r));case 20:c.next=24;break;case 22:c.prev=22,c.t0=c.catch(3);case 24:case"end":return c.stop()}}),null,null,[[3,22]],Promise)}),[u,d,e,E,O,a,n,y,t,s,m]),y=Object(r.useCallback)((e,t,a)=>{var r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return r=i.current,o.prev=1,o.next=4,regeneratorRuntime.awrap(B.get("/api/queries/".concat(r)));case 4:return n=o.sent,o.next=7,regeneratorRuntime.awrap(v(n,e,t,a));case 7:o.next=11;break;case 9:o.prev=9,o.t0=o.catch(1);case 11:case"end":return o.stop()}}),null,null,[[1,9]],Promise)},[u,v]),v=Object(r.useCallback)((e,t,a,r)=>{var n,o,i;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:return n=m.current,o={created_at:new Date,dashboard_id:n,options:{isHidden:!1,parameterMappings:{},position:{autoHeight:!1,col:0,maxSizeX:6,maxSizeY:1e3,minSizeX:1,minSizeY:5,row:0,sizeX:6,sizeY:12}},text:"",visualization_id:e.visualizations[e.visualizations.length-1].id,width:1},l.prev=2,l.next=5,regeneratorRuntime.awrap(B.post("/api/widgets",o));case 5:return i=l.sent,l.next=8,regeneratorRuntime.awrap(w(i,t,a,r));case 8:l.next=12;break;case 10:l.prev=10,l.t0=l.catch(2);case 12:case"end":return l.stop()}}),null,null,[[2,10]],Promise)},[u,w]),w=Object(r.useCallback)((e,t,a,r)=>{var n,o,i;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:return(n=e.options).position.row=12*t.widgets.length,o={dashboard_id:e.dashboard_id,id:e.id,options:n,text:"",visualization_id:e.visualization.id,width:1},l.prev=3,l.next=6,regeneratorRuntime.awrap(B.post("/api/widgets/".concat(e.id),o));case 6:return i=l.sent,l.next=9,regeneratorRuntime.awrap(O(i,a,r));case 9:l.next=14;break;case 11:l.prev=11,l.t0=l.catch(3),console.log(l.t0,"saveReport_error");case 14:case"end":return l.stop()}}),null,null,[[3,11]],Promise)},[O]),O=Object(r.useCallback)((t,a,r)=>{var o,l,c,u,d;return regeneratorRuntime.async((function(p){for(;;)switch(p.prev=p.next){case 0:if(o=m.current,l=i.current,p.prev=2,"ask_data"!==a){p.next=8;break}return c=[],u=t.widgets.map((e,t)=>{var a;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(B.get("/api/queries/".concat(e.visualization.query.id,"/results/").concat(e.visualization.query.latest_query_data_id,".json")));case 2:a=t.sent,c.push({data:a.query_result.data,table_name:e.visualization.query.name});case 4:case"end":return t.stop()}}),null,null,null,Promise)}),Promise.all(u).then(t=>{e(200,"bi","ask_data",c,r)}),p.abrupt("return");case 8:return p.next=10,regeneratorRuntime.awrap(B.get("/api/queries/".concat(l,"/results/").concat(t.visualization.query.latest_query_data_id,".json")));case 10:d=p.sent,"edit"!==a?(s(o),e(200,"bi","chart_code",d,r),n()):g(d,"getPath",r),p.next=16;break;case 14:p.prev=14,p.t0=p.catch(2);case 16:case"end":return p.stop()}}),null,null,[[2,14]],Promise)},[u,e,i,g]),E=Object(r.useCallback)((e,t,a)=>{var r;return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:try{r=t.widgets.map((t,a)=>regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(!e.includes(t.visualization.query.name)){a.next=3;break}return a.next=3,regeneratorRuntime.awrap(B.delete("/api/widgets/".concat(t.id)));case 3:case"end":return a.stop()}}),null,null,null,Promise)),Promise.all(r).then(e=>{g(e,"delGetPath",a)})}catch(e){}case 1:case"end":return n.stop()}}),null,null,null,Promise)},[g]);return{DashId:m,saveChart:p,dashboardsId:g}})(X,se,e,be,p.current,je,b,we),Pe=Ce.saveChart,xe=Ce.dashboardsId,Le=Ce.publishQuery,ke=v_(),Ne=ke.setDialogueStorageDashboardId,Ae=ke.addDashboard,Te=ke.getDashboard,We=ke.addDialogueStorage,Ie=ke.getDialogueStorage,qe=ke.addChatList,De=ke.getAllStorage,Re=ke.addAutopilotStorage,Me=G.messages,ze=G.inputMessage,Fe=G.newInputMessage;return n.a.createElement("div",{className:"dialogue-content"},n.a.createElement(w_,{loadingMask:k,Holmestable:y,HolmestableItem:d.current,closeDialogue:()=>{ie(),"report"===t?Ae([]):"chat"===t?We([]):"autopilot"===t&&Re([]),l.current.sourceEdit([]),Z("report")},chat_type:t}),O&&n.a.createElement(Lj,null),n.a.createElement(xj,{ref:l,Holmestable:y,onUse:pe,sendTableDate:P,onChange:le,confirmLoading:F,loadingMask:k,messages:Me,ChangeScrollTop:ye,loadingState:O,stopSend:ve,inputMessage:ze,newInputMessage:Fe,setState:J,handleSendMessage:de,chat_type:t,retry:Oe,onOpenKeyClick:Ee,onSuccess:te,percent:Y}))},qj=(a(1365),a(684)),Dj=a.n(qj);function Rj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Mj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Mj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Mj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var zj=e=>{var t=Rj(Object(r.useState)([]),2),a=t[0],o=t[1],i=Rj(Object(r.useState)(""),2),l=i[0],s=i[1];Object(r.useEffect)(()=>{o(JSON.parse(localStorage.getItem("HoImes_All"))||[])},[]);var c=t=>()=>{s(t.uuid),e.switchMode(t)};return n.a.createElement(n.a.Fragment,null,a&&a.length>0&&n.a.createElement("div",{className:"dia-main"},n.a.createElement(()=>n.a.createElement("div",{className:"dia-top"},n.a.createElement("img",{src:vt.a,alt:""}),n.a.createElement("span",null,"HoImes")),null),n.a.createElement(()=>n.a.createElement("div",{className:"dia-content"},a.map((e,t)=>n.a.createElement("div",{className:"flex-d dia-info",key:t},n.a.createElement("div",{className:"dia-chats"},n.a.createElement("div",{className:"dia-chat",onClick:c(e)},n.a.createElement(Dj.a,{style:{color:l===e.uuid?"#4974d1":"#fff",fontSize:"21px"}}),n.a.createElement("div",{className:"dia-chat-name"},e.messages[1].content||e.title)))))),null)))};var Fj=function(e){var t=e.chatType;return n.a.createElement("div",{style:{flex:"1 1 0%",overflow:"auto",display:"flex",flexDirection:"column",justifyContent:"center"}},n.a.createElement("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNDEiIHZpZXdCb3g9IjAgMCA2NCA0MSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCiAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAxKSIgZmlsbD0ibm9uZSIgZmlsbFJ1bGU9ImV2ZW5vZGQiPg0KICAgIDxlbGxpcHNlIGZpbGw9IiNkZGQiIGN4PSIzMiIgY3k9IjMzIiByeD0iMzIiIHJ5PSI3IiAvPg0KICAgIDxnIGZpbGxSdWxlPSJub256ZXJvIiBzdHJva2U9IiM5OTkiPg0KICAgICAgPHBhdGgNCiAgICAgICAgZD0iTTU1IDEyLjc2TDQ0Ljg1NCAxLjI1OEM0NC4zNjcuNDc0IDQzLjY1NiAwIDQyLjkwNyAwSDIxLjA5M2MtLjc0OSAwLTEuNDYuNDc0LTEuOTQ3IDEuMjU3TDkgMTIuNzYxVjIyaDQ2di05LjI0eiIgLz4NCiAgICAgIDxwYXRoDQogICAgICAgIGQ9Ik00MS42MTMgMTUuOTMxYzAtMS42MDUuOTk0LTIuOTMgMi4yMjctMi45MzFINTV2MTguMTM3QzU1IDMzLjI2IDUzLjY4IDM1IDUyLjA1IDM1aC00MC4xQzEwLjMyIDM1IDkgMzMuMjU5IDkgMzEuMTM3VjEzaDExLjE2YzEuMjMzIDAgMi4yMjcgMS4zMjMgMi4yMjcgMi45Mjh2LjAyMmMwIDEuNjA1IDEuMDA1IDIuOTAxIDIuMjM3IDIuOTAxaDE0Ljc1MmMxLjIzMiAwIDIuMjM3LTEuMzA4IDIuMjM3LTIuOTEzdi0uMDA3eiINCiAgICAgICAgZmlsbD0iI2UxZTFlMSIgLz4NCiAgICA8L2c+DQogIDwvZz4NCjwvc3ZnPg==",alt:"Holmes",style:{width:"120px",height:"120px",margin:"0 auto"}}),n.a.createElement("p",{style:{textAlign:"center",marginTop:"20px",fontSize:"14px",fontWeight:"bold"}},"report"===t?window.W_L.start_your_dialogue:window.W_L.no_dialogue))};a(599);function Vj(){return(Vj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Uj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Bj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Bj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Hj(e){var t=e.chatType,a=Uj(n.a.useState(""),2),r=a[0],o=a[1],i=Uj(n.a.useState(0),2),l=i[0],s=i[1],c=Uj(n.a.useState(""),2),u=c[0],d=c[1],m=Uj(n.a.useState(!1),2),p=m[0],f=m[1];return n.a.createElement("div",{className:"page-alerts-list"},"viewConversation"===t&&n.a.createElement(zj,{chat_type:t,switchMode:e=>{d(e.uuid)}}),n.a.createElement("div",{style:{display:"flex",flexDirection:"column",flex:1,position:"relative",background:"rgb(250, 250, 250)",overflow:"auto"}},"viewConversation"!==t||u?n.a.createElement(Ij,{chat_type:t,sendUrl:e=>{if("new_report"===e)return f(!0),o(""),void s(e=>e+1);f(!1),o(e),s(e=>e+1)},key:t,uuid:u}):n.a.createElement(Fj,{chatType:t})),"report"===t&&r?n.a.createElement("div",{style:{flex:"1",overflow:"auto"},className:"dashbord_page"},n.a.createElement(d_,{key:l,isShowReport:!1,dashboardId:r,dashboardSlug:"-",onError:()=>{}})):null,"report"===t&&p&&n.a.createElement(Fj,{chatType:t}))}function Yj(){return(Yj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Qj(e){return n.a.createElement("div",{className:"text-center"},n.a.createElement(Pe,Yj({icon:"fa-search",message:window.W_L.find_nothing},e)))}yf.register("Dialogue.List.autopilot",pa({path:"/autopilot",title:"autopilot",render:e=>n.a.createElement(Hj,Vj({},e,{chatType:"autopilot"}))})),yf.register("Dialogue.List.Dialogue",pa({path:"/dialogue-list",title:"Dialogue",render:e=>n.a.createElement(Hj,Vj({},e,{chatType:"viewConversation"}))})),yf.register("Dialogue.List.Report",pa({path:"/report-route",title:"Report",render:e=>n.a.createElement(Hj,Vj({},e,{chatType:"report"}))})),yf.register("Dialogue.List",pa({path:"/",title:window.W_L.dialogue,render:e=>n.a.createElement(Hj,Vj({},e,{currentPage:"testdialogue",chatType:"chat"}))}));a(1368);function Kj(){return(Kj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function $j(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Gj={className:ae.a.string,children:ae.a.node},Jj={className:null,children:null};function Xj(e){var t=e.className,a=e.children,r=$j(e,["className","children"]);return n.a.createElement("div",Kj({className:me()("layout-sidebar",t)},r),n.a.createElement("div",null,a))}function Zj(e){var t=e.className,a=e.children,r=$j(e,["className","children"]);return n.a.createElement("div",Kj({className:me()("layout-content",t)},r),n.a.createElement("div",null,a))}function eS(e){var t=e.children,a=e.className,r=void 0===a?void 0:a,o=$j(e,["children","className"]);return n.a.createElement("div",Kj({className:me()("layout-with-sidebar",r)},o),t)}Xj.propTypes=Gj,Xj.defaultProps=Jj,Zj.propTypes=Gj,Zj.defaultProps=Jj,eS.propTypes=Gj,eS.defaultProps=Jj,eS.Sidebar=Xj,eS.Content=Zj;var tS=a(423),aS=a.n(tS);function rS(){return(rS=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function nS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return oS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return oS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function iS(){var e=nS(Object(r.useState)([]),2),t=e[0],a=e[1],o=nS(Object(r.useState)(!0),2),i=o[0],l=o[1],s=[{title:window.W_L.name,dataIndex:"report_name",width:null,align:"center",render:(e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g,{className:"table-main-title",href:"autopilot/"+t.id},t.report_name))},{title:window.W_L.create_time,dataIndex:"created_at",align:"center"},{title:window.W_L.task_status,dataIndex:"is_generate",align:"center",render:(e,t)=>n.a.createElement(n.a.Fragment,null,0===t.is_generate&&n.a.createElement(Iw.a,{color:"gold"},window.W_L.waiting),1===t.is_generate&&n.a.createElement(Iw.a,{color:"blue"},window.W_L.generating),2===t.is_generate&&n.a.createElement(Iw.a,{color:"green"},window.W_L.success),-1===t.is_generate&&n.a.createElement(Iw.a,{color:"red"},window.W_L.fail))},{title:"",dataIndex:"actions",width:50,align:"center",render:(e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(aS.a,{style:{color:"#f08282",fontSize:"15px"},onClick:()=>c(t.id)}))}],c=e=>regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:R.a.confirm({title:window.W_L.confirm_delete,content:window.W_L.confirm_delete_tip,onOk:()=>regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(B.delete("/api/auto_pilot/delete/".concat(e)));case 3:t.sent,u(),t.next=9;break;case 7:t.prev=7,t.t0=t.catch(0);case 9:case"end":return t.stop()}}),null,null,[[0,7]],Promise),onCancel(){}});case 1:case"end":return t.stop()}}),null,null,null,Promise),u=()=>{var e;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return l(!0),t.next=3,regeneratorRuntime.awrap(B.get("/api/auto_pilot"));case 3:200===(e=t.sent).code&&a(e.data),l(!1);case 6:case"end":return t.stop()}}),null,null,null,Promise)};return Object(r.useEffect)(()=>{u()},[]),n.a.createElement("div",{className:"page-queries-list"},n.a.createElement("div",{className:"container"},n.a.createElement(xf,{title:window.W_L.all_autopilot,actions:n.a.createElement(g.Button,{block:!0,type:"primary",href:"autopilot"},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.data_analysis)}),n.a.createElement(eS,null,n.a.createElement(eS.Content,null,n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement($l.a,{className:"table-data",rowKey:"id",size:"middle",columns:s,dataSource:t,pagination:!1,loading:i,locale:{emptyText:n.a.createElement(Qj,{className:""})}})))))))}function lS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return sS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return sS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function cS(e){var t=lS(Object(r.useState)({}),2),a=t[0],o=t[1],i=lS(Object(r.useState)(!0),2),l=i[0],s=i[1];return Object(r.useEffect)(()=>{var t,a;t=e.autopilotId,regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(B.get("/api/auto_pilot/".concat(t)));case 2:200===(a=e.sent).code?o(a.data):o({}),s(!1);case 5:case"end":return e.stop()}}),null,null,null,Promise)},[]),n.a.createElement("div",{className:"auto-pilot-list"},n.a.createElement(If.a,{loading:l,active:!0,paragraph:{rows:10}},n.a.createElement("div",{className:"message"},n.a.createElement("div",{className:"auto-pilot"},n.a.createElement("div",{className:"chat user autopilot-item"},n.a.createElement("p",null,window.W_L.report_name,":",a.report_name),n.a.createElement("p",null,window.W_L.report_desc,":",a.report_desc),n.a.createElement(sj,{Cardloading:!1,logData:a.chat_log}),a.html_code?n.a.createElement(nj,{title:a.report_name,content:a.html_code}):n.a.createElement("div",{style:{textAlign:"center",marginTop:"50px"}},n.a.createElement("svg",{t:"1701954689007",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1988",width:"200",height:"200"},n.a.createElement("path",{d:"M777 806.7c0 38.7-31.1 70.3-69.7 70.3H225.9c-38.7 0-69.9-31.6-69.9-70.3V174.4c0-38.7 31.2-70.4 69.9-70.4h481.4c38.7 0 69.7 31.7 69.7 70.4v632.3z",fill:"#FFFFFF","p-id":"1989"}),n.a.createElement("path",{d:"M707.3 886H225.9c-43.5 0-78.9-35.8-78.9-79.3V174.4c0-43.5 35.4-79.4 78.9-79.4h481.4c43.5 0 79.7 35.9 79.7 79.4v632.3c0 43.5-36.2 79.3-79.7 79.3zM225.9 113c-33.7 0-59.9 27.7-59.9 61.4v632.3c0 33.7 26.2 61.3 59.9 61.3h481.4c33.7 0 60.7-27.6 60.7-61.3V174.4c0-33.7-27-61.4-60.7-61.4H225.9z",fill:"#282828","p-id":"1990"}),n.a.createElement("path",{d:"M732 763.1c0 33.3-26.1 60.9-59.4 60.9H251.7c-33.3 0-59.7-27.6-59.7-60.9V226.9c0-33.3 26.4-60.9 59.7-60.9h420.9c33.3 0 59.4 27.5 59.4 60.9v536.2z",fill:"#50BCFF","p-id":"1991"}),n.a.createElement("path",{d:"M361.8 251.9H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9h153.1c4.9 0 8.9 4 8.9 8.9s-3.9 8.9-8.8 8.9zM549.2 313H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9h340.5c4.9 0 8.9 4 8.9 8.9s-3.9 8.9-8.8 8.9zM652 448.4H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9H652c4.9 0 8.9 4 8.9 8.9s-4 8.9-8.9 8.9zM588.4 515.8H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9h379.7c4.9 0 8.9 4 8.9 8.9 0.1 4.9-3.9 8.9-8.8 8.9z",fill:"#282828","p-id":"1992"}),n.a.createElement("path",{d:"M673.3 113.3c0 19.6-15.9 35.5-35.5 35.5h-346c-19.6 0-35.5-15.9-35.5-35.5v-6.7c0-19.6 15.9-35.5 35.5-35.5h346c19.6 0 35.5 15.9 35.5 35.5v6.7z",fill:"#1A6DFF","p-id":"1993"}),n.a.createElement("path",{d:"M637.8 157.6h-346c-24.5 0-44.4-19.9-44.4-44.4v-6.7c0-24.5 19.9-44.4 44.4-44.4h346c24.5 0 44.4 19.9 44.4 44.4v6.7c0 24.5-19.9 44.4-44.4 44.4zM291.9 80c-14.7 0-26.6 11.9-26.6 26.6v6.7c0 14.7 11.9 26.6 26.6 26.6h346c14.7 0 26.6-11.9 26.6-26.6v-6.7c0-14.7-11.9-26.6-26.6-26.6h-346z",fill:"#282828","p-id":"1994"}),n.a.createElement("path",{d:"M849.7 758.4c0 106.3-86.2 192.4-192.4 192.4-106.3 0-192.4-86.2-192.4-192.4C464.8 652.1 551 566 657.3 566c106.2 0 192.4 86.1 192.4 192.4z",fill:"#FFFFFF","p-id":"1995"}),n.a.createElement("path",{d:"M657.3 959.7c-111 0-201.3-90.3-201.3-201.3s90.3-201.3 201.3-201.3 201.3 90.3 201.3 201.3-90.3 201.3-201.3 201.3z m0-384.8c-101.2 0-183.5 82.3-183.5 183.5S556.1 942 657.3 942s183.6-82.3 183.6-183.6c-0.1-101.2-82.4-183.5-183.6-183.5z",fill:"#282828","p-id":"1996"}),n.a.createElement("path",{d:"M657.3 553.6v204.9h203.6c-0.2-112.7-91.2-204-203.6-204.9z",fill:"#1A6DFF","p-id":"1997"}),n.a.createElement("path",{d:"M860.9 767.3H657.3c-4.9 0-8.9-4-8.9-8.9V553.6c0-2.4 0.9-4.6 2.6-6.3 1.7-1.7 3.6-2.4 6.3-2.6 116.9 0.9 212.2 96.8 212.4 213.7 0 2.4-0.9 4.6-2.6 6.3-1.6 1.7-3.9 2.6-6.2 2.6z m-194.8-17.8h185.6C847 649.3 766.2 568 666.1 562.7v186.8z",fill:"#282828","p-id":"1998"}),n.a.createElement("path",{d:"M794.1 903.7c-2.3 0-4.6-0.9-6.3-2.6L652.1 764.7c-3.5-3.5-3.4-9.1 0-12.6 3.5-3.5 9.1-3.4 12.6 0l135.7 136.5c3.5 3.5 3.4 9.1 0 12.6-1.8 1.7-4 2.5-6.3 2.5z",fill:"#282828","p-id":"1999"})),n.a.createElement("p",{style:{marginTop:"20px"}},window.W_L.task_processing)))))))}yf.register("Dialogue.List.autopilot_list",pa({path:"/autopilot_list",title:"autopilot_list",render:e=>n.a.createElement(iS,rS({},e,{chatType:"autopilot"}))})),yf.register("Dialogue.List.autopilot_view",pa({path:"/autopilot/:autopilotId",render:e=>n.a.createElement(cS,e)}));a(1371);function uS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return dS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var mS=function(e){var t=e.tagsUrl,a=e.showUnselectAll,o=void 0!==a&&a,i=e.onUpdate,s=uS(Object(r.useState)([]),2),c=s[0],u=s[1],d=uS(Object(r.useState)([]),2),m=d[0],p=d[1];Object(r.useEffect)(()=>{var e=!1;return KE(t).then(t=>{e||u(t)}),()=>{e=!0}},[t]);var f=Object(r.useCallback)((e,t)=>{var a;a=e.shiftKey?Object(l.includes)(m,t)?Object(l.difference)(m,[t]):[...m,t]:Object(l.includes)(m,t)&&1===m.length?[]:[t],p(a),i&&i([...a])},[m,i]),b=Object(r.useCallback)(()=>{p([]),i&&i([])},[i]);return 0===c.length?null:n.a.createElement("div",{className:"tags-list"},n.a.createElement("div",{className:"tags-list-title"},n.a.createElement("span",{className:"tags-list-label"},window.W_L.tag),o&&m.length>0&&n.a.createElement(be,{type:"link",onClick:b},n.a.createElement(je.a,null),"clear selection")),n.a.createElement("div",{className:"tiled"},n.a.createElement(ue.a,{className:"invert-stripe-position",mode:"inline",selectedKeys:m},Object(l.map)(c,e=>n.a.createElement(ue.a.Item,{key:e.name,className:"m-0"},n.a.createElement(be,{className:"d-flex align-items-center justify-content-between",onClick:t=>f(t,e.name)},n.a.createElement("span",{className:"max-character col-xs-11"},e.name),n.a.createElement(Nf.a,{count:e.count})))))))};function pS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function bS(e){var t=e.placeholder,a=e.value,o=e.showIcon,i=e.onChange,l=e.label,s=pS(Object(r.useState)(a),2),c=s[0],u=s[1];Object(r.useEffect)(()=>{u(a)},[a]);var d=Object(r.useCallback)(e=>{var t=e.target.value;u(t),i(t)},[i]),m=o?ba.a.Search:ba.a;return n.a.createElement("div",{className:"m-b-10"},n.a.createElement(m,{className:"form-control",placeholder:t,value:c,"aria-label":l,onChange:d}))}function hS(e){var t=e.items,a=e.selected;return 0===(t=Object(l.filter)(t,e=>!Object(l.isFunction)(e.isAvailable)||e.isAvailable())).length?null:n.a.createElement("div",{className:"m-b-10 tags-list tiled"},n.a.createElement(ue.a,{className:"invert-stripe-position",mode:"inline",selectable:!1,selectedKeys:[a]},Object(l.map)(t,e=>n.a.createElement(ue.a.Item,{key:e.key,className:"m-0"},n.a.createElement(g,{href:e.href},Object(l.isString)(e.icon)&&""!==e.icon&&n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:e.icon,"aria-hidden":"true"})),Object(l.isFunction)(e.icon)&&(e.icon(e)||null),e.title)))))}function gS(e){var t=e.icon;return n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:t,"aria-hidden":"true"}))}function yS(e){var t=e.user;return Object(l.isString)(t.profile_image_url)&&""!==t.profile_image_url?n.a.createElement("img",{src:t.profile_image_url,className:"profile__image--sidebar m-r-5",width:"13",alt:t.name}):null}function vS(e){var t=e.url,a=e.onChange,r=e.showUnselectAll;return""===t?null:n.a.createElement("div",{className:"m-b-10"},n.a.createElement(mS,{tagsUrl:t,onUpdate:a,showUnselectAll:r}))}function wS(){return(wS=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function OS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ES(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ES(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ES(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _S(e,t,a){var o=OS(Object(r.useState)({isAvailable:!1}),2),i=o[0],s=o[1],c=OS(Object(r.useState)([]),2),u=c[0],d=c[1];Object(r.useEffect)(()=>{d([])},[e.pageItems,i.isAvailable]);var m=Object(r.useMemo)(()=>{var t=e.pageItems;return 0!==t.length&&0!==u.length&&Object(l.intersection)(u,t).length===t.length},[u,e.pageItems]),p=Object(r.useCallback)(()=>{d(m?[]:e.pageItems)},[m,e.pageItems]),f=Object(r.useCallback)(e=>{Object(l.includes)(u,e)?d(Object(l.filter)(u,t=>t!==e)):d([...u,e])},[u]),b=Object(r.useMemo)(()=>yb.custom((e,t)=>n.a.createElement(dn.a,{checked:Object(l.includes)(u,t),onChange:()=>f(t)}),{title:()=>n.a.createElement(dn.a,{checked:m,onChange:p}),field:"id",width:"1%"}),[u,m,p,f]),h=Object(r.useCallback)((function(e){return a?n.a.createElement(a,wS({onStateChange:s},e)):null}),[a]);return Object(r.useMemo)(()=>({areExtraActionsAvailable:i.isAvailable,listColumns:i.isAvailable?[b,...t]:t,Component:h,selectedItems:u,setSelectedItems:d}),[i,t,b,u,h])}function jS(e){var t=e.objectType,a=e.tags;return n.a.createElement(Pe,{icon:"fa-tags"},"No ",t," found tagged with ",n.a.createElement(Hb,{className:"inline-tags-control",tags:Array.from(a),tagSeparator:"+"}),".")}function SS(e){var t=e.page,a=e.searchTerm,n=e.selectedTags;if(""!==a)return r.createElement(Pe,{message:window.W_L.find_nothing,icon:"fa-search"});if(n.length>0)return r.createElement(jS,{objectType:"dashboards",tags:n});switch(t){case"favorites":return r.createElement(Pe,{message:window.W_L.show_my_favorite_dashboard,icon:"fa-star"});case"my":var o=H.hasPermission("create_dashboard")?r.createElement("span",null,r.createElement(m.a,{type:"primary",size:"small",onClick:()=>Qp.showModal()},window.W_L.create_first_dashboard)," ",r.createElement($e,{className:"f-14",type:"DASHBOARDS",showTooltip:!1},window.W_L.need_help,"?")):r.createElement("span",null,window.W_L.no_data);return r.createElement(Pe,{icon:"fa-search"},o);default:return r.createElement(se,{name:"DashboardList.EmptyState"},r.createElement(Xp,{icon:"zmdi zmdi-view-quilt",description:window.W_L.see_big_picture,illustration:"dashboard",helpMessage:r.createElement(Gp,{helpTriggerType:"DASHBOARDS"}),showDashboardStep:!0}))}}bS.propTypes={value:ae.a.string.isRequired,placeholder:ae.a.string,showIcon:ae.a.bool,onChange:ae.a.func.isRequired,label:ae.a.string},bS.defaultProps={placeholder:window.W_L.search,showIcon:!1,label:"Search"},hS.propTypes={items:ae.a.arrayOf(ae.a.shape({key:ae.a.string.isRequired,href:ae.a.string.isRequired,title:ae.a.string.isRequired,icon:ae.a.func,isAvailable:ae.a.func})),selected:ae.a.string},hS.defaultProps={items:[],selected:null},gS.propTypes={icon:ae.a.string.isRequired},yS.propTypes={user:ae.a.shape({profile_image_url:ae.a.string,name:ae.a.string}).isRequired},vS.propTypes={url:ae.a.string.isRequired,onChange:ae.a.func.isRequired,showUnselectAll:ae.a.bool,unselectAllButtonTitle:ae.a.string},jS.propTypes={objectType:ae.a.string.isRequired,tags:ae.a.oneOfType([ae.a.array,ae.a.objectOf(Set)]).isRequired},SS.propTypes={page:te.string.isRequired,searchTerm:te.string.isRequired,selectedTags:te.array.isRequired};a(1372);function CS(){return(CS=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var PS=[{key:"all",href:"dashboards",title:window.W_L.all_dashboard,icon:()=>n.a.createElement(gS,{icon:"zmdi zmdi-view-quilt"})},{key:"my",href:"dashboards/my",title:window.W_L.my_dashboard,icon:()=>n.a.createElement(yS,{user:H})},{key:"favorites",href:"dashboards/favorites",title:window.W_L.my_favorite_dashboard,icon:()=>n.a.createElement(gS,{icon:"fa fa-star"})}],xS=[yb.favorites({className:"p-r-0"}),yb.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g,{className:"table-main-title",href:t.url,"data-test":"DashboardId".concat(t.id)},t.name),n.a.createElement(Kb,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:window.W_L.name,field:"name",width:null}),yb.custom((e,t)=>t.user.name,{title:window.W_L.create_user,width:"1%"}),yb.dateTime.sortable({title:window.W_L.create_time,field:"created_at",width:"1%"})];function LS(e){return n.a.createElement(se,CS({name:"DashboardList.Actions"},e))}function kS(e){var t=e.controller,a=_S(t,xS,LS),r=a.areExtraActionsAvailable,o=a.listColumns,i=a.Component,l=a.selectedItems,s=t.pageItems&&t.pageItems.length>0?t.pageItems.filter(e=>e.name!==window.W_L.temporary_dashboard):[];return n.a.createElement("div",{className:"page-dashboard-list"},n.a.createElement("div",{className:"container"},n.a.createElement(xf,{title:t.params.pageTitle,actions:H.hasPermission("create_dashboard")?n.a.createElement(m.a,{block:!0,type:"primary",onClick:()=>Qp.showModal()},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.create):null}),n.a.createElement(eS,null,n.a.createElement(eS.Sidebar,{className:"m-b-0"},n.a.createElement(bS,{placeholder:window.W_L.search_dashboard,label:window.W_L.search_dashboard,value:t.searchTerm,onChange:t.updateSearch}),n.a.createElement(hS,{items:PS,selected:t.params.currentPage}),n.a.createElement(vS,{url:"api/dashboards/tags",onChange:t.updateSelectedTags,showUnselectAll:!0})),n.a.createElement(eS.Content,null,n.a.createElement("div",{"data-test":"DashboardLayoutContent"},t.isLoaded&&t.isEmpty?n.a.createElement(SS,{page:t.params.currentPage,searchTerm:t.searchTerm,selectedTags:t.selectedTags}):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:me()({"m-b-10":r})},n.a.createElement(i,{selectedItems:l})),n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(vb,{items:s,loading:!t.isLoaded,columns:o,orderByField:t.orderByField,orderByReverse:t.orderByReverse,toggleSorting:t.toggleSorting}),n.a.createElement(Db,{showPageSizeSelect:!0,totalCount:t.totalItemsCount,pageSize:t.itemsPerPage,onPageSizeChange:e=>t.updatePagination({itemsPerPage:e}),page:t.page,onChange:e=>t.updatePagination({page:e})}))))))))}kS.propTypes={controller:nh.isRequired};var NS=oh(kS,()=>new wh({getResource(e){var t=e.params.currentPage;return{all:Rp.query.bind(Rp),my:Rp.myDashboards.bind(Rp),favorites:Rp.favorites.bind(Rp)}[t]},getItemProcessor:()=>e=>new Rp(e)}),()=>new jh({orderByField:"created_at",orderByReverse:!0}));function AS(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function TS(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function WS(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?TS(Object(a),!0).forEach((function(t){IS(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):TS(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function IS(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function qS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return DS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return DS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function DS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function RS(e){var t=e.apiKey,a=e.currentRoute,o=e.renderChildren,i=qS(Object(r.useState)(!1),2),l=i[0],s=i[1],c=Object(r.useContext)(E).handleError;return Object(r.useEffect)(()=>{var e=!1;return X.setApiKey(t),X.loadConfig().then(()=>{e||s(!0)}).catch(()=>{e||s(!1)}),()=>{e=!0}},[t]),!l||Y.disablePublicUrls?null:n.a.createElement(n.a.Fragment,{key:a.key},o(WS(WS({},a.routeParams),{},{pageTitle:a.title,onError:c,apiKey:t})))}function MS(e){var t=e.render,a=e.getApiKey;return WS(WS({},AS(e,["render","getApiKey"])),{},{render:e=>n.a.createElement(RS,{apiKey:a(e),currentRoute:e,renderChildren:t})})}yf.register("Dashboards.List",pa({path:"/dashboards",title:window.W_L.dashboards,render:e=>n.a.createElement(NS,CS({},e,{currentPage:"all"}))})),yf.register("Dashboards.Favorites",pa({path:"/dashboards/favorites",title:window.W_L.my_favorite_dashboard,render:e=>n.a.createElement(NS,CS({},e,{currentPage:"favorites"}))})),yf.register("Dashboards.My",pa({path:"/dashboards/my",title:window.W_L.my_dashboard,render:e=>n.a.createElement(NS,CS({},e,{currentPage:"my"}))})),RS.propTypes={apiKey:ae.a.string.isRequired,renderChildren:ae.a.func},RS.defaultProps={renderChildren:()=>null};a(1373);function zS(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function FS(e){var t=e.dashboard,a=UE(t),r=a.globalParameters,o=a.filters,i=a.setFilters,s=a.refreshDashboard,c=a.loadWidget,u=a.refreshWidget;return n.a.createElement("div",{className:"container p-t-10 p-b-20"},n.a.createElement(xf,{title:t.name}),!Object(l.isEmpty)(r)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(Qv,{parameters:r,onValuesChange:s})),!Object(l.isEmpty)(o)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(uw,{filters:o,onChange:i})),n.a.createElement("div",{id:"dashboard-container"},n.a.createElement(BO,{dashboard:t,widgets:t.widgets,filters:o,isEditing:!1,isPublic:!0,onLoadWidget:c,onRefreshWidget:u})))}FS.propTypes={dashboard:ae.a.object.isRequired};class VS extends n.a.Component{constructor(){super(...arguments),zS(this,"state",{loading:!0,dashboard:null})}componentDidMount(){Rp.getByToken({token:this.props.token}).then(e=>this.setState({dashboard:e,loading:!1})).catch(e=>this.props.onError(e))}render(){var e=this.state,t=e.loading,a=e.dashboard;return n.a.createElement("div",{className:"public-dashboard-page"},t?n.a.createElement("div",{className:"container loading-message"},n.a.createElement(Pe,{className:"",icon:"fa-spinner fa-2x fa-pulse",message:"Loading..."})):n.a.createElement(FS,{dashboard:a}))}}zS(VS,"propTypes",{token:ae.a.string.isRequired,onError:ae.a.func}),zS(VS,"defaultProps",{onError:()=>{}}),yf.register("Dashboards.ViewShared",MS({path:"/public/dashboards/:token",render:e=>n.a.createElement(VS,e),getApiKey:e=>e.routeParams.token}));a(1374);function US(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return BS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return BS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function BS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function HS(){return(HS=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function YS(e){var t=e.item,a=e.keySuffix,r={key:"card".concat(a),className:"visual-card",onClick:t.onClick,children:n.a.createElement(n.a.Fragment,null,n.a.createElement("img",{alt:t.title,src:t.imgSrc}),n.a.createElement("h3",null,t.title))};return t.href?n.a.createElement(g,HS({href:t.href},r)):n.a.createElement(be,HS({type:"link"},r))}function QS(e){var t=e.items,a=void 0===t?[]:t,o=e.showSearch,i=void 0!==o&&o,s=US(Object(r.useState)(""),2),c=s[0],u=s[1],d=a.filter(e=>Object(l.isEmpty)(c)||Object(l.includes)(e.title.toLowerCase(),c.toLowerCase()));return n.a.createElement("div",{"data-test":"CardsList"},i&&n.a.createElement("div",{className:"row p-10"},n.a.createElement("div",{className:"col-md-4 col-md-offset-4"},n.a.createElement(ba.a.Search,{placeholder:"{window.W_L.search}","aria-label":"{window.W_L.search}",onChange:e=>u(e.target.value),autoFocus:!0}))),Object(l.isEmpty)(d)?n.a.createElement(Qj,{className:""}):n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-lg-12 d-inline-flex flex-wrap visual-card-list"},d.map((e,t)=>n.a.createElement(YS,{key:t,item:e,keySuffix:t.toString()})))))}QS.propTypes={items:ae.a.arrayOf(ae.a.shape({title:ae.a.string.isRequired,imgSrc:ae.a.string.isRequired,onClick:ae.a.func,href:ae.a.string})),showSearch:ae.a.bool};var KS=a(430),$S=a.n(KS);function GS(){return(GS=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function JS(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function XS(e){var t=e.collapsed,a=e.children,r=e.className,o=JS(e,["collapsed","children","className"]);return n.a.createElement(Im.a,GS({},o,{activeKey:t?null:"content",className:me()(r,"ant-collapse-headerless")}),n.a.createElement(Im.a.Panel,{key:"content",header:""},a))}function ZS(e){var t=e.title,a=e.name;return t||sb(a)}XS.propTypes={collapsed:ae.a.bool,children:ae.a.node,className:ae.a.string},XS.defaultProps={collapsed:!0,children:null,className:""};var eC=a(305),tC=a.n(eC);a(1380);function aC(){return(aC=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var rC=Object(r.forwardRef)((function(e,t){return n.a.createElement("div",{className:"ace-editor-input","data-test":e["data-test"]},n.a.createElement(tC.a,aC({ref:t,mode:"sql",theme:"textmate",height:"100px",editorProps:{$blockScrolling:1/0},showPrintMargin:!1},e)))}));function nC(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function oC(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var iC=a(317),lC=a.n(iC),sC=a(318),cC=a.n(sC);function uC(){return(uC=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function dC(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function mC(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function pC(e){e.form,e.field;var t=mC(e,["form","field"]);return n.a.createElement(ba.a,t)}function fC(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function bC(){return(bC=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function hC(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function gC(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function yC(){return(yC=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function vC(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function wC(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?vC(Object(a),!0).forEach((function(t){OC(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):vC(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function OC(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function EC(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var _C=ae.a.shape({name:ae.a.string.isRequired,title:ae.a.string,type:ae.a.oneOf(["ace","text","textarea","email","password","number","checkbox","file","select","content"]).isRequired,initialValue:ae.a.oneOfType([ae.a.string,ae.a.number,ae.a.bool,ae.a.arrayOf(ae.a.string),ae.a.arrayOf(ae.a.number)]),content:ae.a.node,mode:ae.a.string,required:ae.a.bool,extra:ae.a.bool,readOnly:ae.a.bool,autoFocus:ae.a.bool,minLength:ae.a.number,placeholder:ae.a.string,contentAfter:ae.a.oneOfType([ae.a.node,ae.a.func]),loading:ae.a.bool,props:ae.a.object}),jC={checkbox:function(e){e.form;var t=e.field,a=oC(e,["form","field"]),r=ZS(t);return n.a.createElement(dn.a,a,r)},file:function(e){var t=e.form,a=e.field,r=dC(e,["form","field"]),o=a.name,i=a.initialValue,l=t.getFieldValue,s=void 0!==l(o)&&l(o)!==i;return n.a.createElement(lC.a,uC({},r,{beforeUpload:()=>!1}),n.a.createElement(m.a,{disabled:s},n.a.createElement(cC.a,null)," ",window.W_L.upload))},select:function(e){e.form;var t=e.field,a=hC(e,["form","field"]),r=t.readOnly;return n.a.createElement(ln.a,bC({},a,{optionFilterProp:"children",loading:t.loading||!1,mode:t.mode,getPopupContainer:e=>e.parentNode}),t.options&&t.options.map(e=>n.a.createElement(ln.a.Option,{key:"".concat(e.value),value:e.value,disabled:r},e.name||e.value)))},number:function(e){e.form,e.field;var t=fC(e,["form","field"]);return n.a.createElement(cn.a,t)},textarea:function(e){e.form,e.field;var t=gC(e,["form","field"]);return n.a.createElement(ba.a.TextArea,t)},ace:function(e){e.form,e.field;var t=nC(e,["form","field"]);return n.a.createElement(rC,t)},content:function(e){return e.field.content}};function SC(e){var t=e.form,a=e.field,r=EC(e,["form","field"]),o=a.name,i=a.type,s=a.readOnly,c=a.autoFocus,u=ZS(a),d=wC(wC({},a.props),{},{className:"w-100",name:o,type:i,readOnly:s,autoFocus:c,placeholder:a.placeholder,"data-test":u},r),m=Object(l.get)(jC,i,pC);return n.a.createElement(m,yC({},d,{form:t,field:a}))}function CC(e,t,a){var r=new Array(t.length);return Object.keys(e).forEach(n=>{var o=t.indexOf(n),i={name:n,title:e[n].title,type:e[n].type,placeholder:Object(l.isNil)(e[n].default)?null:e[n].default.toString(),required:e[n].required,extra:e[n].extra,initialValue:a[n]};"select"===i.type&&(i.placeholder="Select an option",i.options=e[n].options),o>-1?r[o]=i:r.push(i)}),r}function PC(e){Object(l.each)(e.properties,(t,a)=>{"password"!==a&&"passwd"!==a||(t.type="password"),a.endsWith("File")&&(t.type="file"),"boolean"===t.type&&(t.type="checkbox"),"string"===t.type&&(t.type="text"),Object(l.isEmpty)(t.enum)||(t.type="select",t.options=Object(l.map)(t.enum,e=>({value:e,name:e}))),Object(l.isEmpty)(t.extendedEnum)||(t.type="select",t.options=t.extendedEnum),t.required=Object(l.includes)(e.required,a),t.extra=Object(l.includes)(e.extra_options,a)}),e.order=e.order||[]}function xC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.properties;Object.keys(a).forEach(e=>{var r=a[e];if(Object(l.isUndefined)(r.default)||"checkbox"!==r.type||(t[e]=r.default),"select"===r.type){var n=Object(l.map)(r.options,e=>e.value);t[e]=Object(l.includes)(n,r.default)?r.default:n[0]}})}SC.propTypes={field:_C.isRequired};var LC={getFields:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{options:{}},a=e.configuration_schema;PC(a);var r=Object.keys(t.options).length>0;r||xC(a,t.options);var o=!t.id,i=[{name:"name",title:window.W_L.name,type:"text",required:!0,initialValue:t.name,contentAfter:n.a.createElement("hr"),placeholder:"My ".concat(e.name),autoFocus:o},...CC(a.properties,a.order,t.options)];return i},updateTargetWithValues:function(e,t){e.name=t.name,Object.keys(t).forEach(a=>{"name"!==a&&(e.options[a]=t[a])})},getBase64:function(e){return new Promise((t,a)=>{var r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result.substr(r.result.indexOf(",")+1)),r.onerror=e=>a(e)})},hasFilledExtraField:function(e,t){var a=Object(l.get)(e,"configuration_schema.extra_options",[]);return Object(l.some)(a,a=>{var r=Object(l.get)(e,["configuration_schema","properties",a,"default"]),n=Object(l.get)(t,["options",a]);return!Object(l.isNil)(n)&&n!==r})}};a(1397);function kC(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return NC(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return NC(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function NC(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var AC=ae.a.shape({name:ae.a.string.isRequired,callback:ae.a.func.isRequired,type:ae.a.string,pullRight:ae.a.bool,disabledWhenDirty:ae.a.bool}),TC=ae.a.shape({validateFieldsAndScroll:ae.a.func}),WC=e=>{var t=e.type,a=e.required,r=e.minLength,n=a,o=r&&Object(l.includes)(["text","email","password"],t),i="email"===t;return[n&&{required:a,message:window.W_L.required},o&&{min:r,message:window.W_L.short},i&&{type:"email",message:window.W_L.email_error}].filter(e=>e)};function IC(e){var t=e.fields,a=e.feedbackIcons,r=e.form;return t.map(e=>{var t=e.name,o=e.type,i=e.initialValue,s=e.contentAfter,c=ZS(e),u={name:t,className:"m-b-10",hasFeedback:"checkbox"!==o&&"file"!==o&&a,label:"checkbox"===o?"":c,rules:WC(e),valuePropName:"checkbox"===o?"checked":"value",initialValue:i};return"file"===o&&(u.valuePropName="data-value",u.getValueFromEvent=e=>{e&&e.fileList[0]&&LC.getBase64(e.file).then(e=>{r.setFieldsValue({[t]:e})})}),n.a.createElement(n.a.Fragment,{key:t},n.a.createElement(ag.a.Item,u,n.a.createElement(SC,{field:e,form:r})),Object(l.isFunction)(s)?s(r.getFieldValue(t)):s)})}IC.propTypes={fields:ae.a.arrayOf(_C),feedbackIcons:ae.a.bool,form:TC.isRequired},IC.defaultProps={fields:[],feedbackIcons:!1};var qC=(e,t)=>(t.inProgress?e.add(t.actionName):e.delete(t.actionName),new Set(e));function DC(e){var t=e.actions,a=e.isFormDirty,o=kC(Object(r.useReducer)(qC,new Set),2),i=o[0],s=o[1],c=Object(r.useCallback)(e=>{var t=e.name;Object(l.isFunction)(e.callback)&&(s({actionName:t,inProgress:!0}),e.callback(()=>{s({actionName:t,inProgress:!1})}))},[]);return t.map(e=>n.a.createElement(m.a,{key:e.name,htmlType:"button",className:me()("m-t-10",{"pull-right":e.pullRight}),type:e.type,disabled:a&&e.disableWhenDirty,loading:i.has(e.name),onClick:()=>c(e)},e.name))}function RC(e){var t=e.id,a=e.fields,o=e.actions,i=e.feedbackIcons,s=e.hideSubmitButton,c=e.defaultShowExtraFields,u=e.saveText,d=e.onSubmit,p=kC(Object(r.useState)(!1),2),f=p[0],b=p[1],h=kC(Object(r.useState)(!1),2),g=h[0],y=h[1],v=kC(Object(r.useState)(c),2),w=v[0],O=v[1],E=kC(ag.a.useForm(),1)[0],_=Object(l.filter)(a,{extra:!0}),j=Object(l.difference)(a,_),S=Object(r.useCallback)(e=>{b(!0),e=function(e,t){return Object(l.mapValues)(t,(t,a)=>{var r=(Object(l.find)(e,{name:a})||{}).initialValue;return null!=r&&""!==r||""!==t?t:null})}(a,e),d(e,e=>{b(!1),y(!1),of.success(e)},e=>{b(!1),of.error(e)})},[a,d]),C=Object(r.useCallback)(e=>{var t=e.errorFields;E.scrollToField(t[0].name)},[E]);return n.a.createElement(ag.a,{form:E,onFieldsChange:()=>{y(!0)},id:t,className:"dynamic-form",layout:"vertical",onFinish:S,onFinishFailed:C},n.a.createElement(IC,{fields:j,feedbackIcons:i,form:E}),!Object(l.isEmpty)(_)&&n.a.createElement("div",{className:"extra-options"},n.a.createElement(m.a,{type:"dashed",block:!0,className:"extra-options-button",onClick:()=>O(e=>!e)},window.W_L.add_params,n.a.createElement("i",{className:me()("fa m-l-5",{"fa-caret-up":w,"fa-caret-down":!w}),"aria-hidden":"true"})),n.a.createElement(XS,{collapsed:!w,className:"extra-options-content"},n.a.createElement(IC,{fields:_,feedbackIcons:i,form:E}))),!s&&n.a.createElement(m.a,{className:"w-100 m-t-20",type:"primary",htmlType:"submit",disabled:f},u),n.a.createElement(DC,{actions:o,isFormDirty:g}))}function MC(){return(MC=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function zC(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}DC.propTypes={actions:ae.a.arrayOf(AC),isFormDirty:ae.a.bool},DC.defaultProps={actions:[],isFormDirty:!1},RC.propTypes={id:ae.a.string,fields:ae.a.arrayOf(_C),actions:ae.a.arrayOf(AC),feedbackIcons:ae.a.bool,hideSubmitButton:ae.a.bool,defaultShowExtraFields:ae.a.bool,saveText:ae.a.string,onSubmit:ae.a.func},RC.defaultProps={id:null,fields:[],actions:[],feedbackIcons:!1,hideSubmitButton:!1,defaultShowExtraFields:!1,saveText:window.W_L.save,onSubmit:()=>{}};var FC=$S.a.Step,VC=ba.a.Search,UC=0,BC=1,HC=2;class YC extends n.a.Component{constructor(){super(...arguments),zC(this,"state",{searchText:"",selectedType:null,savingSource:!1,currentStep:UC}),zC(this,"formId",Object(l.uniqueId)("sourceForm")),zC(this,"selectType",e=>{this.setState({selectedType:e,currentStep:BC})}),zC(this,"resetType",()=>{this.state.currentStep===BC&&this.setState({searchText:"",selectedType:null,currentStep:UC})}),zC(this,"createSource",(e,t,a)=>{var r=this.state,n=r.selectedType;r.savingSource||(this.setState({savingSource:!0,currentStep:HC}),this.props.onCreate(n,e).then(e=>{t(window.W_L.save_success),this.props.dialog.close({success:!0,data:e})}).catch(e=>{this.setState({savingSource:!1,currentStep:BC}),a(Object(l.get)(e,"response.data.message",window.W_L.save_failed))}))})}renderTypeSelector(){var e=this.props.types,t=this.state.searchText,a=e.filter(e=>Object(l.isEmpty)(t)||Object(l.includes)(e.name.toLowerCase(),t.toLowerCase()));return n.a.createElement("div",{className:"m-t-10"},n.a.createElement(VC,{placeholder:window.W_L.search,"aria-label":window.W_L.search,onChange:e=>this.setState({searchText:e.target.value}),autoFocus:!0,"data-test":"SearchSource"}),n.a.createElement("div",{className:"scrollbox p-5 m-t-10",style:{minHeight:"30vh",maxHeight:"40vh"}},Object(l.isEmpty)(a)?n.a.createElement(Qj,{className:""}):n.a.createElement(Ah.a,{size:"small",dataSource:a,renderItem:e=>this.renderItem(e)})))}renderForm(){var e=this.props,t=e.imageFolder,a=e.helpTriggerPrefix,r=this.state.selectedType,o=LC.getFields(r),i="".concat(a).concat(Object(l.toUpper)(r.type));return n.a.createElement("div",null,n.a.createElement("div",{className:"d-flex justify-content-center align-items-center"},n.a.createElement("img",{className:"p-5",src:"".concat(t,"/").concat(r.type,".png"),alt:r.name,width:"48"}),n.a.createElement("h4",{className:"m-0"},r.name)),n.a.createElement("div",{className:"text-right"},Ye[i]&&n.a.createElement($e,{className:"f-13",type:i},window.W_L.setting_info," ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(",window.W_L.help,")"))),n.a.createElement(RC,{id:this.formId,fields:o,onSubmit:this.createSource,feedbackIcons:!0,hideSubmitButton:!0}),"databricks"===r.type&&n.a.createElement("small",null,window.W_L.jdbc_info," ",n.a.createElement(g,{href:"https://databricks.com/spark/odbc-driver-download",target:"_blank",rel:"noopener noreferrer"},window.W_L.jdbc_download_name),"."))}renderItem(e){var t=this.props.imageFolder;return n.a.createElement(Ah.a.Item,{className:"p-l-10 p-r-10 clickable",onClick:()=>this.selectType(e)},n.a.createElement(aE,{title:e.name,imageUrl:"".concat(t,"/").concat(e.type,".png"),roundedImage:!1,"data-test":"PreviewItem","data-test-type":e.type},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"})))}render(){var e=this.state,t=e.currentStep,a=e.savingSource,r=this.props,o=r.dialog,i=r.sourceType;return n.a.createElement(R.a,MC({},o.props,{title:window.W_L.create+" ".concat(i),footer:t===UC?[n.a.createElement(m.a,{key:"cancel",onClick:()=>o.dismiss(),"data-test":"CreateSourceCancelButton"},window.W_L.cancel),n.a.createElement(m.a,{key:"submit",type:"primary",disabled:!0},window.W_L.create)]:[n.a.createElement(m.a,{key:"previous",onClick:this.resetType},window.W_L.previous),n.a.createElement(m.a,{key:"submit",htmlType:"submit",form:this.formId,type:"primary",loading:a,"data-test":"CreateSourceSaveButton"},window.W_L.create)]}),n.a.createElement("div",{"data-test":"CreateSourceDialog"},n.a.createElement($S.a,{className:"hidden-xs m-b-10",size:"small",current:t,progressDot:!0},t===BC?n.a.createElement(FC,{title:window.W_L.type_select,className:"clickable",onClick:this.resetType}):n.a.createElement(FC,{title:window.W_L.type}),n.a.createElement(FC,{title:window.W_L.setting}),n.a.createElement(FC,{title:window.W_L.done})),t===UC&&this.renderTypeSelector(),t!==UC&&this.renderForm()))}}zC(YC,"propTypes",{dialog:wa.isRequired,types:ae.a.arrayOf(ae.a.object),sourceType:ae.a.string.isRequired,imageFolder:ae.a.string.isRequired,helpTriggerPrefix:ae.a.string,onCreate:ae.a.func.isRequired}),zC(YC,"defaultProps",{types:[],helpTriggerPrefix:null});var QC=Oa(YC);var KC=function(e,t,a){return gt.add(e,t),function(e){var t=gt.getActiveItem(A.path);return n.a.createElement("div",{className:"settings-screen"},n.a.createElement("div",{className:"container"},n.a.createElement(xf,{title:window.W_L.setting}),n.a.createElement("div",{className:"bg-white tiled"},n.a.createElement(ue.a,{selectedKeys:[t&&t.title],selectable:!1,mode:"horizontal"},gt.getAvailableItems().map(e=>n.a.createElement(ue.a.Item,{key:e.title},n.a.createElement(g,{href:e.path,"data-test":"SettingsScreenItem"},e.title)))),n.a.createElement("div",{className:"p-15"},n.a.createElement("div",null,n.a.createElement(a,e))))))}};function $C(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function GC(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$C(Object(a),!0).forEach((function(t){JC(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$C(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function JC(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function XC(e){return Object(l.map)(e,e=>Object(l.isObject)(e)?e:{name:e})}var ZC={query:()=>B.get("api/data_sources"),get:e=>{var t=e.id;return B.get("api/data_sources/".concat(t))},types:()=>B.get("api/data_sources/types"),create:e=>B.post("api/data_sources",e),save:e=>B.post("api/data_sources/".concat(e.id),e),test:e=>B.post("api/data_sources/".concat(e.id,"/test")),delete:e=>{var t=e.id;return B.delete("api/data_sources/".concat(t))},fetchSchema:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={};return t&&(a.refresh=!0),B.get("api/data_sources/".concat(e.id,"/schema"),{params:a}).then(e=>Object(l.has)(e,"job")?rr(e.job.id).catch(t=>1===t.code?[]:Promise.reject(new Error(e.job.error))):Object(l.has)(e,"schema")?e.schema:Promise.reject()).then(e=>Object(l.map)(e,e=>GC(GC({},e),{},{columns:XC(e.columns)})))}};function eP(){return(eP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function tP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}le("DataSourcesListComponent",(function(e){var t=e.dataSources,a=e.onClickCreate,r=t.map(e=>({title:e.name,imgSrc:"".concat("static/images/db-logos","/").concat(e.type,".png"),href:"data_sources/".concat(e.id)}));return Object(l.isEmpty)(t)?n.a.createElement("div",{className:"text-center"},window.W_L.no_datasource,Z.isCreateDataSourceEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(be,{type:"link",onClick:a,"data-test":"CreateDataSourceLink"},window.W_L.connect_new_datasource)," ")):n.a.createElement(QS,{items:r})}));class aP extends n.a.Component{constructor(){var e;super(...arguments),e=this,tP(this,"state",{dataSourceTypes:[],dataSources:[],loading:!0}),tP(this,"newDataSourceDialog",null),tP(this,"createDataSource",(e,t)=>{var a={options:{},type:e.type};return LC.updateTargetWithValues(a,t),ZC.create(a).then(e=>(this.setState({loading:!0}),ZC.query().then(e=>this.setState({dataSources:e,loading:!1})),e))}),tP(this,"showCreateSourceDialog",()=>{Sa("view","page","data_sources/new"),this.newDataSourceDialog=QC.showModal({types:Object(l.reject)(this.state.dataSourceTypes,"deprecated"),sourceType:window.W_L.data_source,imageFolder:"static/images/db-logos",helpTriggerPrefix:"DS_",onCreate:this.createDataSource}),this.newDataSourceDialog.onClose((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.newDataSourceDialog=null,t.success&&Ea("data_sources/".concat(t.data.id))})).onDismiss(()=>{this.newDataSourceDialog=null,Ea("data_sources",!0)})})}componentDidMount(){Promise.all([ZC.query(),ZC.types()]).then(e=>this.setState({dataSources:e[0],dataSourceTypes:e[1],loading:!1},()=>{this.props.isNewDataSourcePage&&(Z.canCreateDataSource()?this.showCreateSourceDialog():Ea("data_sources",!0))})).catch(e=>this.props.onError(e))}componentWillUnmount(){this.newDataSourceDialog&&this.newDataSourceDialog.dismiss()}render(){var e={type:"primary",onClick:Z.isCreateDataSourceEnabled()?this.showCreateSourceDialog:null,disabled:!Z.isCreateDataSourceEnabled(),"data-test":"CreateDataSourceButton"};return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(m.a,e,n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.new_data_source),n.a.createElement(se,{name:"DataSourcesListExtra"})),this.state.loading?n.a.createElement(Ch,{className:""}):n.a.createElement(se,{name:"DataSourcesListComponent",dataSources:this.state.dataSources,onClickCreate:this.showCreateSourceDialog}))}}tP(aP,"propTypes",{isNewDataSourcePage:ae.a.bool,onError:ae.a.func}),tP(aP,"defaultProps",{isNewDataSourcePage:!1,onError:()=>{}});var rP=KC("DataSources.List",{permission:"admin",title:window.W_L.data_source,path:"data_sources",order:1},aP);function nP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}yf.register("DataSources.List",pa({path:"/data_sources",title:window.W_L.data_source,render:e=>n.a.createElement(rP,e)})),yf.register("DataSources.New",pa({path:"/data_sources/new",title:window.W_L.data_source,render:e=>n.a.createElement(rP,eP({},e,{isNewDataSourcePage:!0}))}));class oP extends n.a.Component{constructor(){super(...arguments),nP(this,"state",{dataSource:null,type:null,loading:!0}),nP(this,"saveDataSource",(e,t,a)=>{var r=this.state.dataSource;LC.updateTargetWithValues(r,e),ZC.save(r).then(()=>t(window.W_L.save_success)).catch(e=>{var t=Object(l.get)(e,"response.data.message",window.W_L.save_failed);a(t)})}),nP(this,"deleteDataSource",e=>{var t=this.state.dataSource;R.a.confirm({title:window.W_L.delete_datasource,content:window.W_L.delete_datasource_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>{ZC.delete(t).then(()=>{of.success(window.W_L.datasource_delete_success),Ea("data_sources")}).catch(()=>{e()})},onCancel:e,maskClosable:!0,autoFocusButton:null})}),nP(this,"testConnection",e=>{var t=this.state.dataSource;ZC.test({id:t.id}).then(t=>{t.ok?of.success(window.W_L.connect_success):of.error(window.W_L.connect_failed,t.message,{duration:10}),e()}).catch(()=>{of.error(window.W_L.connect_failed,window.W_L.connect_failed_tip,{duration:10}),e()})})}componentDidMount(){ZC.get({id:this.props.dataSourceId}).then(e=>{var t=e.type;this.setState({dataSource:e}),ZC.types().then(e=>this.setState({type:Object(l.find)(e,{type:t}),loading:!1}))}).catch(e=>this.props.onError(e))}renderForm(){var e=this.state,t=e.dataSource,a=e.type,r=LC.getFields(a,t),o="DS_".concat(Object(l.toUpper)(a.type)),i={fields:r,type:a,actions:[{name:window.W_L.delete,type:"danger",callback:this.deleteDataSource},{name:window.W_L.connect_test,pullRight:!0,callback:this.testConnection,disableWhenDirty:!0}],onSubmit:this.saveDataSource,feedbackIcons:!0,defaultShowExtraFields:LC.hasFilledExtraField(a,t)};return n.a.createElement("div",{className:"row","data-test":"DataSource"},n.a.createElement("div",{className:"text-right m-r-10"},Ye[o]&&n.a.createElement($e,{className:"f-13",type:o},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(help)"))),n.a.createElement("div",{className:"text-center m-b-10"},n.a.createElement("img",{className:"p-5",src:"".concat("static/images/db-logos","/").concat(a.type,".png"),alt:a.name,width:"64"}),n.a.createElement("h3",{className:"m-0"},a.name)),n.a.createElement("div",{className:"col-md-4 col-md-offset-4 m-b-10"},n.a.createElement(RC,i)))}render(){return this.state.loading?n.a.createElement(Ch,{className:""}):this.renderForm()}}nP(oP,"propTypes",{dataSourceId:ae.a.string.isRequired,onError:ae.a.func}),nP(oP,"defaultProps",{onError:()=>{}});var iP=KC("DataSources.Edit",null,oP);function lP(){return(lP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function sP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}yf.register("DataSources.Edit",pa({path:"/data_sources/:dataSourceId",title:window.W_L.data_source,render:e=>n.a.createElement(iP,e)}));class cP extends n.a.Component{constructor(){super(...arguments),sP(this,"state",{destinationTypes:[],destinations:[],loading:!0}),sP(this,"createDestination",(e,t)=>{var a={options:{},type:e.type};return LC.updateTargetWithValues(a,t),Rg.create(a).then(e=>(this.setState({loading:!0}),Rg.query().then(e=>this.setState({destinations:e,loading:!1})),e))}),sP(this,"showCreateSourceDialog",()=>{QC.showModal({types:Object(l.reject)(this.state.destinationTypes,"deprecated"),sourceType:window.W_L.alert_setting,imageFolder:Dg,onCreate:this.createDestination}).onClose((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.success&&Ea("destinations/".concat(e.data.id))})).onDismiss(()=>{Ea("destinations",!0)})})}componentDidMount(){Promise.all([Rg.query(),Rg.types()]).then(e=>this.setState({destinations:e[0],destinationTypes:e[1],loading:!1},()=>{this.props.isNewDestinationPage&&(Z.canCreateDestination()?this.showCreateSourceDialog():Ea("destinations",!0))})).catch(e=>this.props.onError(e))}renderDestinations(){var e=this.state.destinations,t=e.map(e=>({title:e.name,imgSrc:"".concat(Dg,"/").concat(e.type,".png"),href:"destinations/".concat(e.id)}));return Object(l.isEmpty)(e)?n.a.createElement("div",{className:"text-center"},window.W_L.no_alert_setting,Z.isCreateDestinationEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(be,{type:"link",onClick:this.showCreateSourceDialog},window.W_L.add_alert_setting)," ")):n.a.createElement(QS,{items:t})}render(){var e={type:"primary",onClick:Z.isCreateDestinationEnabled()?this.showCreateSourceDialog:null,disabled:!Z.isCreateDestinationEnabled()};return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(m.a,e,n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.add_alert_setting)),this.state.loading?n.a.createElement(Ch,{className:""}):this.renderDestinations())}}sP(cP,"propTypes",{isNewDestinationPage:ae.a.bool,onError:ae.a.func}),sP(cP,"defaultProps",{isNewDestinationPage:!1,onError:()=>{}});var uP=KC("AlertDestinations.List",{permission:"admin",title:window.W_L.alert_setting,path:"destinations",order:4},cP);function dP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}yf.register("AlertDestinations.List",pa({path:"/destinations",title:window.W_L.alert_setting,render:e=>n.a.createElement(uP,e)})),yf.register("AlertDestinations.New",pa({path:"/destinations/new",title:window.W_L.alert_setting,render:e=>n.a.createElement(uP,lP({},e,{isNewDestinationPage:!0}))}));class mP extends n.a.Component{constructor(){super(...arguments),dP(this,"state",{destination:null,type:null,loading:!0}),dP(this,"saveDestination",(e,t,a)=>{var r=this.state.destination;LC.updateTargetWithValues(r,e),Rg.save(r).then(()=>t(window.W_L.save_success)).catch(e=>{var t=Object(l.get)(e,"response.data.message",window.W_L.save_failed);a(t)})}),dP(this,"deleteDestination",e=>{var t=this.state.destination;R.a.confirm({title:window.W_L.delete_alert,content:window.W_L.delete_alert_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>{Rg.delete(t).then(()=>{of.success(window.W_L.alert_delete_success),Ea("destinations")}).catch(()=>{e()})},onCancel:e,maskClosable:!0,autoFocusButton:null})})}componentDidMount(){Rg.get({id:this.props.destinationId}).then(e=>{var t=e.type;this.setState({destination:e}),Rg.types().then(e=>this.setState({type:Object(l.find)(e,{type:t}),loading:!1}))}).catch(e=>this.props.onError(e))}renderForm(){var e=this.state,t=e.destination,a=e.type,r={fields:LC.getFields(a,t),type:a,actions:[{name:window.W_L.delete,type:"danger",callback:this.deleteDestination}],onSubmit:this.saveDestination,defaultShowExtraFields:LC.hasFilledExtraField(a,t),feedbackIcons:!0};return n.a.createElement("div",{className:"row","data-test":"Destination"},n.a.createElement("div",{className:"text-center m-b-10"},n.a.createElement("img",{className:"p-5",src:"".concat(Dg,"/").concat(a.type,".png"),alt:a.name,width:"64"}),n.a.createElement("h3",{className:"m-0"},a.name)),n.a.createElement("div",{className:"col-md-4 col-md-offset-4 m-b-10"},n.a.createElement(RC,r)))}render(){return this.state.loading?n.a.createElement(Ch,{className:""}):this.renderForm()}}dP(mP,"propTypes",{destinationId:ae.a.string.isRequired,onError:ae.a.func}),dP(mP,"defaultProps",{onError:()=>{}});var pP=KC("AlertDestinations.Edit",null,mP);function fP(){return(fP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function bP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}yf.register("AlertDestinations.Edit",pa({path:"/destinations/:destinationId",title:window.W_L.alert_setting,render:e=>n.a.createElement(pP,e)}));class hP extends n.a.Component{constructor(){super(...arguments),bP(this,"state",{name:""}),bP(this,"save",()=>{this.props.dialog.close({name:this.state.name})})}render(){var e=this.props.dialog;return n.a.createElement(R.a,fP({},e.props,{title:window.W_L.create_role,okText:window.W_L.create,cancelText:window.W_L.cancel,onOk:()=>this.save()}),n.a.createElement(ba.a,{className:"form-control",defaultValue:this.state.name,onChange:e=>this.setState({name:e.target.value}),onPressEnter:()=>this.save(),placeholder:window.W_L.role_name,"aria-label":window.W_L.role_name,autoFocus:!0}))}}bP(hP,"propTypes",{dialog:wa.isRequired});var gP=Oa(hP),yP={query:()=>B.get("api/groups"),get:e=>{var t=e.id;return B.get("api/groups/".concat(t))},create:e=>B.post("api/groups",e),save:e=>B.post("api/groups/".concat(e.id),e),delete:e=>B.delete("api/groups/".concat(e.id)),members:e=>{var t=e.id;return B.get("api/groups/".concat(t,"/members"))},addMember:(e,t)=>{var a=e.id;return B.post("api/groups/".concat(a,"/members"),t)},removeMember:e=>{var t=e.id,a=e.userId;return B.delete("api/groups/".concat(t,"/members/").concat(a))},dataSources:e=>{var t=e.id;return B.get("api/groups/".concat(t,"/data_sources"))},addDataSource:(e,t)=>{var a=e.id;return B.post("api/groups/".concat(a,"/data_sources"),t)},removeDataSource:e=>{var t=e.id,a=e.dataSourceId;return B.delete("api/groups/".concat(t,"/data_sources/").concat(a))},updateDataSource:(e,t)=>{var a=e.id,r=e.dataSourceId;return B.post("api/groups/".concat(a,"/data_sources/").concat(r),t)}};function vP(){return(vP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function wP(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function OP(e){var t=e.group,a=e.title,r=e.onClick,o=e.children,i=wP(e,["group","title","onClick","children"]);if(!t)return null;var s=n.a.createElement(m.a,vP({},i,{type:"danger",onClick:e=>function(e,t,a){R.a.confirm({title:window.W_L.del_role,content:window.W_L.del_role_confirm,okText:window.W_L.ok_text,okType:"danger",cancelText:window.W_L.cancel,onOk:()=>{yP.delete(t).then(()=>{of.success(window.W_L.del_role_success),a()})}})}(0,t,r)}),o);return Object(l.isString)(a)&&""!==a?n.a.createElement(we,{placement:"top",title:a,mouseLeaveDelay:0},s):s}function EP(){return(EP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function _P(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}OP.propTypes={group:ae.a.object,title:ae.a.string,onClick:ae.a.func,children:ae.a.node},OP.defaultProps={group:null,title:null,onClick:()=>{},children:null};class jP extends n.a.Component{constructor(){super(...arguments),_P(this,"listColumns",[yb.custom((e,t)=>n.a.createElement("div",null,n.a.createElement(g,{href:"groups/"+t.id},t.name),"builtin"===t.type&&n.a.createElement("span",{className:"label label-default m-l-10"},window.W_L.built_in)),{field:"name",width:null}),yb.custom((e,t)=>n.a.createElement(m.a.Group,null,n.a.createElement(g.Button,{href:"groups/".concat(t.id)},window.W_L.members),H.isAdmin&&n.a.createElement(g.Button,{href:"groups/".concat(t.id,"/data_sources")},window.W_L.data_source)),{width:"1%",className:"text-nowrap"}),yb.custom((e,t)=>{var a="builtin"!==t.type;return n.a.createElement(OP,{className:"w-100",disabled:!a,group:t,title:a?null:window.W_L.built_in_role_delete_tip,onClick:()=>this.onGroupDeleted()},window.W_L.delete)},{width:"1%",className:"text-nowrap p-l-0",isAvailable:()=>H.isAdmin})]),_P(this,"createGroup",()=>{gP.showModal().onClose(e=>yP.create(e).then(e=>Ea("groups/".concat(e.id))))}),_P(this,"onGroupDeleted",()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"GroupList"},H.isAdmin&&n.a.createElement("div",{className:"m-b-15"},n.a.createElement(m.a,{type:"primary",onClick:this.createGroup},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.create_role)),!e.isLoaded&&n.a.createElement(Ch,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement(Qj,{className:""}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(vb,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Db,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}_P(jP,"propTypes",{controller:nh.isRequired});var SP=KC("Groups.List",{permission:"list_users",title:window.W_L.role,path:"groups",order:3},oh(jP,()=>new wh({isPlainList:!0,getRequest:()=>({}),getResource:()=>yP.query.bind(yP)}),()=>new _h({orderByField:"name",itemsPerPage:10})));yf.register("Groups.List",pa({path:"/groups",title:window.W_L.role,render:e=>n.a.createElement(SP,EP({},e,{currentPage:"groups"}))}));var CP=a(241),PP=a.n(CP);function xP(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function LP(e){var t=e.group,a=e.onChange,r=xP(e,["group","onChange"]);if(!t)return null;var o=H.isAdmin&&"builtin"!==t.type;return n.a.createElement("h3",r,n.a.createElement(YE,{className:"edit-in-place",isEditable:o,ignoreBlanks:!0,onDone:e=>function(e,t,a){e.name=t,yP.save(e),a()}(t,e,a),value:t.name}))}function kP(e){var t=e.controller,a=e.group,r=e.items,o=e.canAddMembers,i=e.onAddMembersClick,l=e.canAddDataSources,s=e.onAddDataSourcesClick,c=e.onGroupDeleted,u=a&&H.isAdmin&&"builtin"!==a.type;return n.a.createElement(n.a.Fragment,null,n.a.createElement(hS,{items:r,selected:t.params.currentPage}),o&&n.a.createElement(m.a,{className:"w-100 m-t-5",type:"primary",onClick:i},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.add_user),l&&n.a.createElement(m.a,{className:"w-100 m-t-5",type:"primary",onClick:s},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.add_datasource),u&&n.a.createElement(n.a.Fragment,null,n.a.createElement(lg.a,{dashed:!0,className:"m-t-10 m-b-10"}),n.a.createElement(OP,{className:"w-100",group:a,onClick:c},window.W_L.del_role)))}function NP(){return(NP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function AP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}LP.propTypes={group:ae.a.shape({name:ae.a.string.isRequired}),onChange:ae.a.func},LP.defaultProps={group:null,onChange:()=>{}},kP.propTypes={controller:nh.isRequired,group:ae.a.object,items:ae.a.array.isRequired,canAddMembers:ae.a.bool,onAddMembersClick:ae.a.func,canAddDataSources:ae.a.bool,onAddDataSourcesClick:ae.a.func,onGroupDeleted:ae.a.func},kP.defaultProps={group:null,canAddMembers:!1,onAddMembersClick:null,canAddDataSources:!1,onAddDataSourcesClick:null,onGroupDeleted:null};class TP extends n.a.Component{constructor(){super(...arguments),AP(this,"groupId",parseInt(this.props.controller.params.groupId,10)),AP(this,"group",null),AP(this,"sidebarMenu",[{key:"users",href:"groups/".concat(this.groupId),title:window.W_L.members},{key:"datasources",href:"groups/".concat(this.groupId,"/data_sources"),title:window.W_L.data_source,isAvailable:()=>H.isAdmin}]),AP(this,"listColumns",[yb.custom((e,t)=>n.a.createElement(nE,{dataSource:t,withLink:!0}),{title:window.W_L.name,field:"name",width:null}),yb.custom((e,t)=>{var a=n.a.createElement(ue.a,{selectedKeys:[t.view_only?"viewonly":"full"],onClick:e=>this.setDataSourcePermissions(t,e.key)},n.a.createElement(ue.a.Item,{key:"full"},window.W_L.full_access),n.a.createElement(ue.a.Item,{key:"viewonly"},window.W_L.view_only));return n.a.createElement(aa.a,{trigger:["click"],overlay:a},n.a.createElement(m.a,{className:"w-100","aria-label":"Permissions"},t.view_only?window.W_L.view_only:window.W_L.full_access,n.a.createElement(PP.a,{"aria-hidden":"true"})))},{width:"1%",className:"p-r-0",isAvailable:()=>H.isAdmin}),yb.custom((e,t)=>n.a.createElement(m.a,{className:"w-100",type:"danger",onClick:()=>this.removeGroupDataSource(t)},"Remove"),{width:"1%",isAvailable:()=>H.isAdmin})]),AP(this,"removeGroupDataSource",e=>{yP.removeDataSource({id:this.groupId,dataSourceId:e.id}).then(()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()}).catch(()=>{of.error(window.W_L.datasource_delete_failed)})}),AP(this,"setDataSourcePermissions",(e,t)=>{var a="full"!==t;yP.updateDataSource({id:this.groupId,dataSourceId:e.id},{view_only:a}).then(()=>{e.view_only=a,this.forceUpdate()}).catch(()=>{of.error(window.W_L.change_datasource_permission_failed)})}),AP(this,"addDataSources",()=>{var e=ZC.query(),t=Object(l.map)(this.props.controller.allItems,e=>e.id);qg.showModal({dialogTitle:window.W_L.new_data_source,inputPlaceholder:window.W_L.search_database,selectedItemsTitle:window.W_L.new_data_source,searchItems:t=>(t=Object(l.toLower)(t),e.then(e=>Object(l.filter)(e,e=>Object(l.includes)(Object(l.toLower)(e.name),t)))),renderItem:(e,a)=>{var r=a.isSelected,o=Object(l.includes)(t,e.id);return{content:n.a.createElement(nE,{dataSource:e},n.a.createElement(zg,{isSelected:r,alreadyInGroup:o})),isDisabled:o,className:r||o?"selected":""}},renderStagedItem:(e,t)=>{var a=t.isSelected;return{content:n.a.createElement(nE,{dataSource:e},n.a.createElement(zg,{isSelected:a,isStaged:!0}))}}}).onClose(e=>{var t=Object(l.map)(e,e=>yP.addDataSource({id:this.groupId},{data_source_id:e.id}));return Promise.all(t).then(()=>this.props.controller.update())})})}componentDidMount(){yP.get({id:this.groupId}).then(e=>{this.group=e,this.forceUpdate()}).catch(e=>{this.props.controller.handleError(e)})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"Group"},n.a.createElement(LP,{className:"d-block m-t-0 m-b-15",group:this.group,onChange:()=>this.forceUpdate()}),n.a.createElement(eS,null,n.a.createElement(eS.Sidebar,null,n.a.createElement(kP,{controller:e,group:this.group,items:this.sidebarMenu,canAddDataSources:H.isAdmin,onAddDataSourcesClick:this.addDataSources,onGroupDeleted:()=>Ea("groups")})),n.a.createElement(eS.Content,null,!e.isLoaded&&n.a.createElement(Ch,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},n.a.createElement("p",null,window.W_L.group_no_datasource),H.isAdmin&&n.a.createElement(m.a,{type:"primary",onClick:this.addDataSources},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.new_data_source)),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(vb,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Db,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}AP(TP,"propTypes",{controller:nh.isRequired});var WP=KC("Groups.DataSources",null,oh(TP,()=>new wh({isPlainList:!0,getRequest:(e,t)=>({id:t.params.groupId}),getResource:()=>yP.dataSources.bind(yP)}),()=>new _h({orderByField:"name"})));function IP(){return(IP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function qP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}yf.register("Groups.DataSources",pa({path:"/groups/:groupId/data_sources",title:window.W_L.group_datasource,render:e=>n.a.createElement(WP,NP({},e,{currentPage:"datasources"}))}));class DP extends n.a.Component{constructor(){super(...arguments),qP(this,"groupId",parseInt(this.props.controller.params.groupId,10)),qP(this,"group",null),qP(this,"sidebarMenu",[{key:"users",href:"groups/".concat(this.groupId),title:window.W_L.members},{key:"datasources",href:"groups/".concat(this.groupId,"/data_sources"),title:window.W_L.data_source,isAvailable:()=>H.isAdmin}]),qP(this,"listColumns",[yb.custom((e,t)=>n.a.createElement(rE,{user:t,withLink:!0}),{title:window.W_L.name,field:"name",width:null}),yb.custom((e,t)=>this.group?"builtin"===this.group.type&&H.id===t.id?null:n.a.createElement(m.a,{className:"w-100",type:"danger",onClick:e=>this.removeGroupMember(e,t)},window.W_L.remove):null,{width:"1%",isAvailable:()=>H.isAdmin})]),qP(this,"removeGroupMember",(e,t)=>yP.removeMember({id:this.groupId,userId:t.id}).then(()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()}).catch(()=>{of.error(window.W_L.remove_member_failed)})),qP(this,"addMembers",()=>{var e=Object(l.map)(this.props.controller.allItems,e=>e.id);qg.showModal({dialogTitle:window.W_L.add_member,inputPlaceholder:window.W_L.search_member,selectedItemsTitle:window.W_L.add_member,searchItems:e=>lE.query({q:e}).then(e=>e.results),renderItem:(t,a)=>{var r=a.isSelected,o=Object(l.includes)(e,t.id);return{content:n.a.createElement(rE,{user:t},n.a.createElement(zg,{isSelected:r,alreadyInGroup:o})),isDisabled:o,className:r||o?"selected":""}},renderStagedItem:(e,t)=>{var a=t.isSelected;return{content:n.a.createElement(rE,{user:e},n.a.createElement(zg,{isSelected:a,isStaged:!0}))}}}).onClose(e=>{var t=Object(l.map)(e,e=>yP.addMember({id:this.groupId},{user_id:e.id}));return Promise.all(t).then(()=>this.props.controller.update())})})}componentDidMount(){yP.get({id:this.groupId}).then(e=>{this.group=e,this.forceUpdate()}).catch(e=>{this.props.controller.handleError(e)})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"Group"},n.a.createElement(LP,{className:"d-block m-t-0 m-b-15",group:this.group,onChange:()=>this.forceUpdate()}),n.a.createElement(eS,null,n.a.createElement(eS.Sidebar,null,n.a.createElement(kP,{controller:e,group:this.group,items:this.sidebarMenu,canAddMembers:H.isAdmin,onAddMembersClick:this.addMembers,onGroupDeleted:()=>Ea("groups")})),n.a.createElement(eS.Content,null,!e.isLoaded&&n.a.createElement(Ch,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},n.a.createElement("p",null,window.W_L.role_no_member),H.isAdmin&&n.a.createElement(m.a,{type:"primary",onClick:this.addMembers},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.add_member)),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(vb,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Db,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}qP(DP,"propTypes",{controller:nh.isRequired});var RP=KC("Groups.Members",null,oh(DP,()=>new wh({isPlainList:!0,getRequest:(e,t)=>({id:t.params.groupId}),getResource:()=>yP.members.bind(yP)}),()=>new _h({orderByField:"name"})));function MP(e){var t=e.page,a=e.searchTerm,r=e.selectedTags;if(""!==a)return n.a.createElement(Pe,{message:window.W_L.find_nothing,icon:"fa-search"});if(r.length>0)return n.a.createElement(jS,{objectType:"queries",tags:r});switch(t){case"favorites":return n.a.createElement(Pe,{message:window.W_L.my_favorite_query,icon:"fa-star"});case"archive":return n.a.createElement(Pe,{message:window.W_L.archived_query,icon:"fa-archive"});case"my":var o=H.hasPermission("create_query")?n.a.createElement("span",null,n.a.createElement(g.Button,{href:"queries/new",type:"primary",size:"small"},window.W_L.create_query)," ",n.a.createElement($e,{className:"f-13",type:"QUERIES",showTooltip:!1},window.W_L.need_help,"?")):n.a.createElement("span",null,window.W_L.find_nothing);return n.a.createElement(Pe,{icon:"fa-search"},o);default:return n.a.createElement(se,{name:"QueriesList.EmptyState"},n.a.createElement(Xp,{icon:"fa fa-code",illustration:"query",description:window.W_L.get_data_from_datasource,helpMessage:n.a.createElement(Gp,{helpTriggerType:"QUERIES"})}))}}yf.register("Groups.Members",pa({path:"/groups/:groupId",title:window.W_L.members,render:e=>n.a.createElement(RP,IP({},e,{currentPage:"users"}))})),MP.propTypes={page:ae.a.string.isRequired,searchTerm:ae.a.string.isRequired,selectedTags:ae.a.array.isRequired};a(1398);function zP(){return(zP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var FP=[{key:"all",href:"queries",title:window.W_L.all_queries,icon:()=>n.a.createElement(gS,{icon:"fa fa-code"})},{key:"my",href:"queries/my",title:window.W_L.my_queries,icon:()=>n.a.createElement(yS,{user:H})},{key:"favorites",href:"queries/favorites",title:window.W_L.my_favorite_query,icon:()=>n.a.createElement(gS,{icon:"fa fa-star"})},{key:"archive",href:"queries/archive",title:window.W_L.archived_query,icon:()=>n.a.createElement(gS,{icon:"fa fa-archive"})}],VP=[yb.favorites({className:"p-r-0"}),yb.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g,{className:"table-main-title",href:"queries/"+t.id},t.name),n.a.createElement(Qb,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:window.W_L.name,field:"name",width:null}),yb.custom((e,t)=>t.user.name,{title:window.W_L.create_user,width:"1%"}),yb.dateTime.sortable({title:window.W_L.create_time,field:"created_at",width:"1%"}),yb.dateTime.sortable({title:window.W_L.last_exec_datetime,field:"retrieved_at",orderByField:"executed_at",width:"1%"}),yb.custom.sortable((e,t)=>n.a.createElement(Xb,{schedule:t.schedule,isNew:t.isNew()}),{title:window.W_L.auto_flush,field:"schedule",width:"1%"})];function UP(e){return n.a.createElement(se,zP({name:"QueriesList.Actions"},e))}function BP(e){var t=e.controller,a=Object(r.useRef)();a.current=t,Object(r.useEffect)(()=>{var e=A.listen((e,t)=>{var r=A.search.q||"";"PUSH"===t&&r!==a.current.searchTerm&&a.current.updateSearch(r)});return()=>{e()}},[]);var o=_S(t,VP,UP),i=o.areExtraActionsAvailable,l=o.listColumns,s=o.Component,c=o.selectedItems;return console.log(t,"controller===="),console.log(VP,"listColumns===="),console.log(l,"tableColumns-----"),n.a.createElement("div",{className:"page-queries-list"},n.a.createElement("div",{className:"container"},n.a.createElement(xf,{title:t.params.pageTitle,actions:H.hasPermission("create_query")?n.a.createElement(g.Button,{block:!0,type:"primary",href:"queries/new"},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.new_query):null}),n.a.createElement(eS,null,n.a.createElement(eS.Sidebar,{className:"m-b-0"},n.a.createElement(bS,{placeholder:window.W_L.search_query,label:window.W_L.search_query,value:t.searchTerm,onChange:t.updateSearch}),n.a.createElement(hS,{items:FP,selected:t.params.currentPage}),n.a.createElement(vS,{url:"api/queries/tags",onChange:t.updateSelectedTags,showUnselectAll:!0})),n.a.createElement(eS.Content,null,t.isLoaded&&t.isEmpty?n.a.createElement(MP,{page:t.params.currentPage,searchTerm:t.searchTerm,selectedTags:t.selectedTags}):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:me()({"m-b-10":i})},n.a.createElement(s,{selectedItems:c})),n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(vb,{items:t.pageItems,loading:!t.isLoaded,columns:l,orderByField:t.orderByField,orderByReverse:t.orderByReverse,toggleSorting:t.toggleSorting}),n.a.createElement(Db,{showPageSizeSelect:!0,totalCount:t.totalItemsCount,pageSize:t.itemsPerPage,onPageSizeChange:e=>t.updatePagination({itemsPerPage:e}),page:t.page,onChange:e=>t.updatePagination({page:e})})))))))}BP.propTypes={controller:nh.isRequired};var HP=oh(BP,()=>new wh({getResource(e){var t=e.params.currentPage;return{all:pr.query.bind(pr),my:pr.myQueries.bind(pr),favorites:pr.favorites.bind(pr),archive:pr.archive.bind(pr)}[t]},getItemProcessor:()=>e=>new pr(e)}),()=>new jh({orderByField:"created_at",orderByReverse:!0}));yf.register("Queries.List",pa({path:"/queries",title:window.W_L.all_queries,render:e=>n.a.createElement(HP,zP({},e,{currentPage:"all"}))})),yf.register("Queries.Favorites",pa({path:"/queries/favorites",title:window.W_L.my_favorite_query,render:e=>n.a.createElement(HP,zP({},e,{currentPage:"favorites"}))})),yf.register("Queries.Archived",pa({path:"/queries/archive",title:window.W_L.archived_query,render:e=>n.a.createElement(HP,zP({},e,{currentPage:"archive"}))})),yf.register("Queries.My",pa({path:"/queries/my",title:window.W_L.my_queries,render:e=>n.a.createElement(HP,zP({},e,{currentPage:"my"}))}));var YP=a(417);a(1399);function QP(){return(QP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function KP(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function $P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?KP(Object(a),!0).forEach((function(t){GP(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):KP(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function GP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function JP(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return XP(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return XP(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function XP(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ZP(e){var t=e.toggleShortcut,a=e.direction,o=e.sizeAttribute,i=e.children,l=JP(Object(r.useState)(0),2),s=l[0],c=l[1],u=Object(r.useRef)(),d=Object(r.useRef)(!1),m=Object(r.useRef)(!1),p="horizontal"===a?"width":"height";o=o||p;var f=Object(r.useCallback)(()=>u.current?Math.floor(u.current.getBoundingClientRect()[p]):0,[p]),b=Object(r.useRef)(null),h=Object(r.useCallback)(()=>{if(u.current){var e,t=Ur.a.select(u.current);null===b.current?(e="0px",b.current="".concat(f(),"px")):(e=b.current,b.current=null),t.style(o,b.current||"0px").transition().duration(200).ease("swing").style(o,e),c(parseInt(e)||0)}},[f,o]),g=Object(r.useMemo)(()=>n.a.createElement("span",{className:"react-resizable-handle react-resizable-handle-".concat(a),role:"separator",onClick:()=>{!d.current&&m.current||h(),d.current=!1,m.current=!1}}),[a,h]);Object(r.useEffect)(()=>{if(t){var e={[t]:h};return jy.bind(e),()=>{jy.unbind(e)}}},[t,h]);var y=Object(r.useMemo)(()=>({onResizeStart:()=>{c(f())},onResize:(e,t)=>{Ur.a.select(u.current).style(o,"".concat(t.size[p],"px")),c(t.size[p]),m.current=!0},onResizeStop:()=>{m.current&&(b.current=null)}}),[p,f,o]),v=Object(r.useMemo)(()=>({onMouseDown:e=>{"touchstart"===e.type&&(d.current=!0),c(f())}}),[f]);return i?(i=n.a.createElement(i.type,$P($P({},i.props),{},{ref:u})),n.a.createElement(YP.Resizable,QP({className:"resizable-component",axis:"horizontal"===a?"x":"y",resizeHandles:["horizontal"===a?"e":"s"],handle:g,width:"horizontal"===a?s:0,height:"vertical"===a?s:0,minConstraints:[0,0]},y,{draggableOpts:v}),i)):null}ZP.propTypes={direction:ae.a.oneOf(["horizontal","vertical"]),sizeAttribute:ae.a.string,toggleShortcut:ae.a.string,children:ae.a.element},ZP.defaultProps={direction:"horizontal",sizeAttribute:null,toggleShortcut:null,children:null};var ex=a(685),tx=a.n(ex),ax={sql:e=>tx.a.format(Object(l.trim)(e)),json:e=>JSON.stringify(JSON.parse(e),null,4)};function rx(e){return e in ax}function nx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t=t||{view_only:!0},Object(r.useMemo)(()=>({isNew:Object(l.isNil)(e.id),isDraft:e.is_draft,isArchived:e.is_archived,canCreate:H.hasPermission("create_query"),canView:H.hasPermission("view_query"),canEdit:H.hasPermission("edit_query")&&Z.canEdit(e),canViewSource:H.hasPermission("view_source"),canExecute:!Object(l.isEmpty)(e.query)&&Z.canRun(e)&&(e.is_safe||H.hasPermission("execute_query")&&!t.view_only),canFork:H.hasPermission("edit_query")&&!t.view_only,canSchedule:H.hasPermission("schedule_query")}),[e,t.view_only])}function ox(e,t){var a=mw(t);return Object(r.useCallback)(()=>{new Promise((e,t)=>{R.a.confirm({title:window.W_L.archived_search,content:n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},window.W_L.archived_confirm),n.a.createElement("div",null,window.W_L.archived_tip)),okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>{e()},onCancel:()=>{t()},maskClosable:!0,autoFocusButton:null})}).then(()=>function(e){return pr.delete({id:e.id}).then(()=>Object(l.extend)(e.clone(),{is_archived:!0,schedule:null})).catch(e=>(of.error(window.W_L.archived_failed),Promise.reject(e)))}(e)).then(a)},[e,a])}function ix(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function lx(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ix(Object(a),!0).forEach((function(t){sx(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ix(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function sx(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class cx extends(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)){constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e),this.detailedMessage=t}}class ux extends cx{constructor(){super(window.W_L.change_not_save,n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},window.W_L.query_has_change),n.a.createElement("div",null,window.W_L.self_copy_save_and_reload)))}}function dx(){return new Promise((e,t)=>{R.a.confirm({title:window.W_L.overwrite_query,content:n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},window.W_L.query_has_change),n.a.createElement("div",null,window.W_L.overwrite_query_confirm)),okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>{e()},onCancel:()=>{t()},maskClosable:!0,autoFocusButton:null})})}function mx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.canOverwrite,r=void 0!==a&&a;return Object(l.isObject)(e.options)&&e.options.parameters&&(e.options=lx(lx({},e.options),{},{parameters:Object(l.map)(e.options.parameters,e=>e.toSaveableObject())})),pr.save(e).catch(t=>409===Object(l.get)(t,"response.status")?r?dx().then(()=>pr.save(Object(l.omit)(e,["version"]))).catch(()=>Promise.reject(new ux)):Promise.reject(new ux):Promise.reject(new cx(window.W_L.save_failed)))}function px(e,t){var a=mw(t);return Object(r.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.successMessage,o=void 0===n?window.W_L.save_success:n;if(Object(l.isObject)(t)){if(e.isNew())return void a(Object(l.extend)(e.clone(),t));t=lx(lx({},t),{},{id:e.id,version:e.version})}else t=Object(l.pick)(e,["id","version","schedule","query","description","name","data_source_id","options","latest_query_data_id","is_draft","tags"]);return mx(t,{canOverwrite:Z.canEdit(e)}).then(r=>{Object(l.isNil)(o)||of.success(o),a(Object(l.extend)(e.clone(),r.id!==e.id?r:Object(l.pick)(r,Object(l.uniq)(["id","version",...Object(l.keys)(t)]))))}).catch(e=>{var t={};e instanceof ux&&(t.duration=null),of.error(e.message,e.detailedMessage,t)})}),[e,a])}var fx=a(431),bx=a.n(fx);function hx(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return gx(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return gx(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gx(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function yx(e){var t=hx(Object(r.useState)(!1),2),a=t[0],n=t[1],o=Object(r.useCallback)(()=>{var t="duplicatedQueryTab/".concat(Math.random().toString()),a=window.open("",t);n(!0),pr.fork({id:e.id}).then(e=>{a.location=function(e){var t=C.a.parse(window.location.search);e=bx.a.parse(e);var a=C.a.parse(e.search);return bx.a.format(Object(l.extend)(Object(l.pick)(e,["protocol","auth","host","pathname","hash"]),{search:C.a.stringify(Object(l.extend)(t,a))}))}(e.getUrl(!0))}).finally(()=>{n(!1)})},[e.id]);return[a,a?l.noop:o]}a(1458);function vx(){return(vx=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function wx(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Ox(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ex extends n.a.Component{constructor(e){super(e),Ox(this,"state",{copied:null}),Ox(this,"copy",()=>{window.getSelection().selectAllChildren(this.ref.current);try{if(!document.execCommand("copy"))throw new Error;this.setState({copied:window.W_L.copy_success})}catch(e){this.setState({copied:window.W_L.copy_failed})}window.getSelection().removeAllRanges(),this.resetCopyState=setTimeout(()=>this.setState({copied:null}),2e3)}),this.ref=n.a.createRef(),this.copyFeatureEnabled=e.copyable&&document.queryCommandSupported("copy"),this.resetCopyState=null}componentWillUnmount(){this.resetCopyState&&clearTimeout(this.resetCopyState)}render(){var e=this.props,t=(e.copyable,e.children),a=wx(e,["copyable","children"]),r=n.a.createElement(we,{title:this.state.copied||window.W_L.copy},n.a.createElement(m.a,{icon:n.a.createElement(gE.a,null),type:"dashed",size:"small",onClick:this.copy}));return n.a.createElement("div",{className:"code-block"},n.a.createElement("code",vx({},a,{ref:this.ref}),t),this.copyFeatureEnabled&&r)}}Ox(Ex,"propTypes",{copyable:ae.a.bool,children:ae.a.node}),Ox(Ex,"defaultProps",{copyable:!1,children:null});a(1459);function _x(){return(_x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function jx(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Sx(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Sx(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Sx(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Cx(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Px(e){var t=e.dialog,a=Cx(e,["dialog"]),o=jx(Object(r.useState)(a.query),2),i=o[0],s=o[1],c=jx(Object(r.useState)(!1),2),u=c[0],d=c[1],p=Object(r.useCallback)(()=>{d(!0),B.post("api/queries/".concat(i.id,"/regenerate_api_key")).then(e=>{d(!1),s(Object(l.extend)(i.clone(),{api_key:e.api_key}))}).catch(()=>{d(!1),of.error(window.W_L.fail_update_api_key)})},[i]),f=Object(r.useMemo)(()=>({csvUrl:"".concat(Y.basePath,"api/queries/").concat(i.id,"/results.csv?api_key=").concat(i.api_key),jsonUrl:"".concat(Y.basePath,"api/queries/").concat(i.id,"/results.json?api_key=").concat(i.api_key)}),[i.id,i.api_key]),b=f.csvUrl,h=f.jsonUrl,g=Se("csv-results-label"),y=Se("json-results-label");return n.a.createElement(R.a,_x({},t.props,{width:600,footer:n.a.createElement(m.a,{onClick:()=>t.close(i)},window.W_L.close)}),n.a.createElement("div",{className:"query-api-key-dialog-wrapper"},n.a.createElement("h5",null,"API Key"),n.a.createElement("div",{className:"m-b-20"},n.a.createElement(ba.a.Group,{compact:!0},n.a.createElement(ba.a,{readOnly:!0,value:i.api_key,"aria-label":"Query API Key"}),Z.canEdit(i)&&n.a.createElement(m.a,{disabled:u,loading:u,onClick:p},window.W_L.re_generate))),n.a.createElement("h5",null,window.W_L.api_example,"："),n.a.createElement("div",{className:"m-b-10"},n.a.createElement("span",{id:g},window.W_L.result_as_csv,"："),n.a.createElement(Ex,{"aria-labelledby":g,copyable:!0},b)),n.a.createElement("div",null,n.a.createElement("span",{id:y},window.W_L.result_as_json,"："),n.a.createElement(Ex,{"aria-labelledby":y,copyable:!0},h))))}Px.propTypes={dialog:wa.isRequired,query:ae.a.shape({id:ae.a.number.isRequired,api_key:ae.a.string,can_edit:ae.a.bool}).isRequired};var xx=Oa(Px);a(1460);function Lx(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return kx(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return kx(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kx(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Nx(){return KE("api/queries/tags").then(e=>Object(l.map)(e,e=>e.name))}function Ax(e){var t=e.query,a=e.dataSource,o=e.sourceMode,i=e.selectedVisualization,s=e.headerExtra,c=e.tagsExtra,u=e.onChange,d=Jo()({minWidth:768}),p=nx(t,a),f=function(e,t){var a=px(e,t);return Object(r.useCallback)(t=>{Sa("edit_name","query",e.id);var r={name:t},n={};e.is_draft&&Y.autoPublishNamedQueries&&t!==window.W_L.new_query&&(r.is_draft=!1,n.successMessage=window.W_L.query_save_publish_success),a(r,n)},[e.id,e.is_draft,a])}(t,u),b=function(e,t){var a=px(e,t);return Object(r.useCallback)(t=>{Sa("edit_tags","query",e.id),a({tags:t})},[e.id,a])}(t,u),h=ox(t,u),y=function(e,t){var a=px(e,t);return Object(r.useCallback)(()=>{Sa("toggle_published","query",e.id),a({is_draft:!1})},[e.id,a])}(t,u),v=function(e,t){var a=px(e,t);return Object(r.useCallback)(()=>{Sa("toggle_published","query",e.id),a({is_draft:!0})},[e.id,a])}(t,u),w=Lx(yx(t),2),O=w[0],E=w[1],_=function(e,t){var a=mw(t);return Object(r.useCallback)(()=>{xx.showModal({query:e}).onClose(a)},[e,a])}(t,u),j=function(e){return Object(r.useCallback)(()=>{bE.showModal({aclUrl:"api/queries/".concat(e.id,"/acl"),context:"query",author:e.user})},[e.id,e.user])}(t),S=Object(r.useMemo)(()=>{return e=[{fork:{isEnabled:!p.isNew&&p.canFork&&!O,title:n.a.createElement(n.a.Fragment,null,window.W_L.copy," ",n.a.createElement("i",{className:"fa fa-external-link m-l-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")),onClick:E}},{archive:{isAvailable:!p.isNew&&p.canEdit&&!p.isArchived,title:window.W_L.archived,onClick:h},managePermissions:{isAvailable:!p.isNew&&p.canEdit&&!p.isArchived&&Y.showPermissionsControl,title:window.W_L.mange_permissions,onClick:j},publish:{isAvailable:!d&&p.isDraft&&!p.isArchived&&!p.isNew&&p.canEdit,title:window.W_L.publish,onClick:y},unpublish:{isAvailable:!Y.disablePublish&&!p.isNew&&p.canEdit&&!p.isDraft,title:window.W_L.draft,onClick:v}},{showAPIKey:{isAvailable:!Y.disablePublicUrls&&!p.isNew,title:window.W_L.show+" API Key",onClick:_}}],t={},a=Object(l.map)(e,e=>Object(l.filter)(Object(l.map)(e,(e,a)=>(e=Object(l.extend)({isAvailable:!0,isEnabled:!0,onClick:()=>{}},e)).isAvailable?(t[a]=e.onClick,n.a.createElement(ue.a.Item,{key:a,disabled:!e.isEnabled},e.title)):null))),n.a.createElement(ue.a,{onClick:e=>{var a=e.key;return t[a]()}},Object(l.reduce)(Object(l.filter)(a,e=>e.length>0),(e,t,a)=>{var r=e.length>0?n.a.createElement(ue.a.Divider,{key:"divider".concat(a)}):null;return[...e,r,...t]},[]));var e,t,a},[p.isNew,p.canFork,p.canEdit,p.isArchived,p.isDraft,O,E,h,j,d,y,v,_]);return n.a.createElement("div",{className:"query-page-header"},n.a.createElement("div",{className:"title-with-tags"},n.a.createElement("div",{className:"page-title"},n.a.createElement("div",{className:"d-flex align-items-center"},!p.isNew&&n.a.createElement(Df,{item:t}),n.a.createElement("h3",null,n.a.createElement(YE,{isEditable:p.canEdit,onDone:f,ignoreBlanks:!0,value:t.name})))),n.a.createElement("div",{className:"query-tags"},n.a.createElement(Qb,{tags:t.tags,isDraft:p.isDraft,isArchived:p.isArchived,canEdit:p.canEdit,getAvailableTags:Nx,onEdit:b,tagsExtra:c}))),n.a.createElement("div",{className:"header-actions"},s,d&&p.isDraft&&!p.isArchived&&!p.isNew&&p.canEdit&&n.a.createElement(m.a,{className:"m-r-5",onClick:y},n.a.createElement("i",{className:"fa fa-paper-plane m-r-5","aria-hidden":"true"})," ",window.W_L.publish),!p.isNew&&p.canViewSource&&n.a.createElement("span",null,!o&&n.a.createElement(g.Button,{className:"m-r-5",href:t.getUrl(!0,i)},n.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5"},window.W_L.edit_source)),o&&n.a.createElement(g.Button,{className:"m-r-5",href:t.getUrl(!1,i),"data-test":"QueryPageShowResultOnly"},n.a.createElement("i",{className:"fa fa-table","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5"},window.W_L.show_result_only))),!p.isNew&&n.a.createElement(aa.a,{overlay:S,trigger:["click"]},n.a.createElement(m.a,{"data-test":"QueryPageHeaderMoreButton","aria-label":"More actions"},n.a.createElement(Jh.a,{rotate:90,"aria-hidden":"true"})))))}Ax.propTypes={query:ae.a.shape({id:ae.a.oneOfType([ae.a.number,ae.a.string]),name:ae.a.string,tags:ae.a.arrayOf(ae.a.string)}).isRequired,dataSource:ae.a.object,sourceMode:ae.a.bool,selectedVisualization:ae.a.number,headerExtra:ae.a.node,tagsExtra:ae.a.node,onChange:ae.a.func},Ax.defaultProps={dataSource:null,sourceMode:!1,selectedVisualization:null,headerExtra:null,tagsExtra:null,onChange:()=>{}};a(1461);function Tx(e){var t=e.query,a=e.dataSource,r=e.layout,o=e.onEditSchedule;return n.a.createElement("div",{className:"query-metadata query-metadata-".concat(r)},n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("img",{className:"profile__image_thumb",src:t.user.profile_image_url,alt:"Avatar"}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("strong",{className:me()("query-metadata-label",{"text-muted":t.user.is_disabled})},t.user.name),n.a.createElement("span",{className:"query-metadata-value"},window.W_L.create_time," ",n.a.createElement("strong",null,n.a.createElement(Gf,{date:t.created_at}))))),n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("img",{className:"profile__image_thumb",src:t.last_modified_by.profile_image_url,alt:"Avatar"}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("strong",{className:me()("query-metadata-label",{"text-muted":t.last_modified_by.is_disabled})},t.last_modified_by.name),n.a.createElement("span",{className:"query-metadata-value"},window.W_L.update_time," ",n.a.createElement("strong",null,n.a.createElement(Gf,{date:t.updated_at}))))),n.a.createElement("div",{className:"query-metadata-space"}),Object(l.has)(a,"name")&&Object(l.has)(a,"type")&&n.a.createElement("div",{className:"query-metadata-item"},window.W_L.data_source,"：",n.a.createElement("img",{src:"".concat("static/images/db-logos","/").concat(a.type,".png"),width:"20",alt:a.type}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("div",{className:"query-metadata-label"},a.name))),n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("span",{className:"query-metadata-label"},n.a.createElement("span",{className:"zmdi zmdi-refresh m-r-5"}),window.W_L.auto_flush),n.a.createElement("span",{className:"query-metadata-value"},n.a.createElement(Xb,{isLink:Object(l.isFunction)(o),isNew:t.isNew(),schedule:t.schedule,onClick:o})))))}Tx.propTypes={layout:ae.a.oneOf(["table","horizontal"]),query:ae.a.shape({created_at:ae.a.oneOfType([ae.a.string,Qf]).isRequired,updated_at:ae.a.oneOfType([ae.a.string,Qf]).isRequired,user:ae.a.shape({name:ae.a.string.isRequired,profile_image_url:ae.a.string.isRequired,is_disabled:ae.a.bool}).isRequired,last_modified_by:ae.a.shape({name:ae.a.string.isRequired,profile_image_url:ae.a.string.isRequired,is_disabled:ae.a.bool}).isRequired,schedule:ae.a.object}).isRequired,dataSource:ae.a.shape({type:ae.a.string,name:ae.a.string}),onEditSchedule:ae.a.func},Tx.defaultProps={layout:"table",dataSource:null,onEditSchedule:null};a(1462);function Wx(){return(Wx=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ix(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return qx(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return qx(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qx(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Dx(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Rx=mo.a.TabPane;function Mx(e){var t=e.title,a=e.message,r=e.refreshButton;return n.a.createElement("div",{className:"query-results-empty-state"},n.a.createElement("div",{className:"empty-state-content"},n.a.createElement("div",null,n.a.createElement("img",{src:"static/images/illustrations/no-query-results.svg",alt:window.W_L.find_nothing})),n.a.createElement("h3",null,t),n.a.createElement("div",{className:"m-b-20"},a),r))}function zx(e){var t=e.visualizationName,a=e.canDelete,o=e.onDelete,i=Dx(e,["visualizationName","canDelete","onDelete"]),l=Object(r.useCallback)(e=>{e.stopPropagation(),R.a.confirm({title:window.W_L.delete_view,content:window.W_L.delete_view_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:o,maskClosable:!0,autoFocusButton:null})},[o]);return n.a.createElement("span",i,t,a&&n.a.createElement(be,{className:"delete-visualization-button",onClick:l,"aria-label":"Close",title:"Close"},n.a.createElement("i",{className:"zmdi zmdi-close","aria-hidden":"true"})))}Mx.propTypes={title:ae.a.string.isRequired,message:ae.a.string.isRequired,refreshButton:ae.a.node},Mx.defaultProps={refreshButton:null},zx.propTypes={visualizationName:ae.a.string.isRequired,canDelete:ae.a.bool,onDelete:ae.a.func},zx.defaultProps={canDelete:!1,onDelete:()=>{}};var Fx=[{type:"TABLE",name:window.W_L.table,id:null,options:{}}];function Vx(e){var t=e.queryResult,a=e.selectedTab,o=e.showNewVisualizationButton,i=e.canDeleteVisualizations,s=e.onChangeTab,c=e.onAddVisualization,u=e.onDeleteVisualization,d=e.refreshButton,p=e.canRefresh,f=Dx(e,["queryResult","selectedTab","showNewVisualizationButton","canDeleteVisualizations","onChangeTab","onAddVisualization","onDeleteVisualization","refreshButton","canRefresh"]),b=Object(r.useMemo)(()=>f.visualizations.length>0?f.visualizations:Fx,[f.visualizations]),h={};Object(l.find)(b,{id:a})&&(h.activeKey="".concat(a)),o&&(h.tabBarExtraContent=n.a.createElement(m.a,{className:"add-visualization-button","data-test":"NewVisualization",type:"link",onClick:()=>c()},n.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5 hidden-xs"},window.W_L.add_view)));var g=Object(r.useMemo)(()=>Object(l.orderBy)(b,["id"]),[b]),y=Object(r.useCallback)(e=>e===g[0].id,[g]),v=Jo()({maxWidth:768}),w=Ix(Object(r.useState)([]),2),O=w[0],E=w[1];return n.a.createElement(mo.a,Wx({},h,{type:"card",className:me()("query-visualization-tabs card-style"),"data-test":"QueryPageVisualizationTabs",animated:!1,tabBarGutter:0,onChange:e=>s(+e),destroyInactiveTabPane:!0}),g.map(e=>n.a.createElement(Rx,{key:"".concat(e.id),tab:n.a.createElement(zx,{"data-test":"QueryPageVisualizationTab".concat(e.id),canDelete:!v&&i&&!y(e.id),visualizationName:e.name,onDelete:()=>u(e.id)})},t?n.a.createElement(kw,{visualization:e,queryResult:t,context:"query",filters:O,onFiltersChange:E}):n.a.createElement(Mx,{title:window.W_L.find_nothing,message:p?window.W_L.please_exec_flush:window.W_L.no_permission_exec,refreshButton:d}))))}function Ux(e){var t=e.status,a=e.updatedAt,r=e.error,o=e.isCancelling,i=e.onCancel,s="failed"===t?"error":"info",c="failed"!==t&&a,d=Object(l.includes)(["waiting","processing"],t),p=o?n.a.createElement(n.a.Fragment,null,"Cancelling…"):null;switch(t){case"waiting":o||(p=n.a.createElement(n.a.Fragment,null,window.W_L.query_queue,"…"));break;case"processing":o||(p=n.a.createElement(n.a.Fragment,null,window.W_L.exec_query,"…"));break;case"loading-result":p=n.a.createElement(n.a.Fragment,null,window.W_L.loading_query_result,"…");break;case"failed":p=n.a.createElement(n.a.Fragment,null,window.W_L.query_run_error,"：",n.a.createElement("strong",null,r))}return n.a.createElement(u.a,{"data-test":"QueryExecutionStatus",type:s,message:n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("div",{className:"flex-fill p-t-5 p-b-5"},p," ",c&&n.a.createElement(Gv,{from:a})),n.a.createElement("div",null,d&&n.a.createElement(m.a,{className:"m-l-10",type:"primary",size:"small",disabled:o,onClick:i},window.W_L.cancel)))})}Vx.propTypes={queryResult:ae.a.object,visualizations:ae.a.arrayOf(ae.a.object),selectedTab:ae.a.number,showNewVisualizationButton:ae.a.bool,canDeleteVisualizations:ae.a.bool,onChangeTab:ae.a.func,onAddVisualization:ae.a.func,onDeleteVisualization:ae.a.func,refreshButton:ae.a.node,canRefresh:ae.a.bool},Vx.defaultProps={queryResult:null,visualizations:[],selectedTab:null,showNewVisualizationButton:!1,canDeleteVisualizations:!1,onChangeTab:()=>{},onAddVisualization:()=>{},onDeleteVisualization:()=>{},refreshButton:null,canRefresh:!0},Ux.propTypes={status:ae.a.string,updatedAt:ae.a.any,error:ae.a.string,isCancelling:ae.a.bool,onCancel:ae.a.func},Ux.defaultProps={status:"waiting",updatedAt:null,error:null,isCancelling:!0,onCancel:()=>{}};a(1463);function Bx(e){var t=e.query,a=e.dataSourcesAvailable,r=nx(t),o=null;return r.isNew&&!r.canCreate?o=n.a.createElement(n.a.Fragment,null,n.a.createElement(jn.a.Title,{level:4},window.W_L.no_datasource_cant_create_query),n.a.createElement("p",null,n.a.createElement(jn.a.Text,{type:"secondary"},window.W_L.apply_permission))):a||(o=H.isAdmin?n.a.createElement(n.a.Fragment,null,n.a.createElement(jn.a.Title,{level:4},window.W_L.no_datasource_or_permission),n.a.createElement("p",null,n.a.createElement(jn.a.Text,{type:"secondary"},window.W_L.first_create_datasource)),n.a.createElement("div",{className:"query-source-alerts-actions"},n.a.createElement(g.Button,{type:"primary",href:"data_sources/new"},window.W_L.add_datasource),n.a.createElement(g.Button,{type:"default",href:"groups"},window.W_L.mange_permissions))):n.a.createElement(n.a.Fragment,null,n.a.createElement(jn.a.Title,{level:4},window.W_L.no_datasource_or_permission),n.a.createElement("p",null,n.a.createElement(jn.a.Text,{type:"secondary"},window.W_L.first_create_datasource)))),o?n.a.createElement("div",{className:"query-source-alerts"},n.a.createElement(bn.a,null,n.a.createElement(se,{name:"QuerySource.Alerts",query:t,dataSourcesAvailable:a},n.a.createElement("div",{className:"query-source-alerts-icon"},n.a.createElement(og.a,null)),o))):null}function Hx(){return(Hx=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Yx(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qx(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Qx(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qx(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Kx(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function $x(e){function t(t){var a=t.queryId,o=t.onError,i=Kx(t,["queryId","onError"]),l=Yx(Object(r.useState)(null),2),s=l[0],c=l[1],u=mw(o);return Object(r.useEffect)(()=>{var e=!1;return(a?pr.get({id:a}):Promise.resolve(pr.newQuery())).then(t=>{e||c(t)}).catch(u),()=>{e=!0}},[a,u]),s?n.a.createElement(e,Hx({query:s,onError:o},i)):n.a.createElement(Ch,{className:"flex-fill"})}return t.propTypes={queryId:ae.a.oneOfType([ae.a.number,ae.a.string])},t.defaultProps={queryId:null},t}Bx.propTypes={query:ae.a.object.isRequired,dataSourcesAvailable:ae.a.bool},Bx.defaultProps={dataSourcesAvailable:!1};var Gx=a(689),Jx=a.n(Gx);a(1464);function Xx(){return(Xx=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Zx(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return eL(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return eL(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eL(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function tL(e){var t=e.dialog,a=e.visualization,o=Zx(Object(r.useState)(""),2),i=o[0],s=o[1],c=Zx(Eg(e=>Object(l.isString)(e)&&""!==e?Rp.query({q:e}).then(e=>e.results).catch(()=>[]):Promise.resolve([]),{initialResults:[]}),3),u=c[0],d=c[1],m=c[2],p=Zx(Object(r.useState)(null),2),f=p[0],b=p[1],h=Zx(Object(r.useState)(!1),2),y=h[0],v=h[1];Object(r.useEffect)(()=>{u(i)},[u,i]);var w=f?[f]:d;return n.a.createElement(R.a,Xx({},t.props,{title:window.W_L.widget_add_dashboard,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okButtonProps:{disabled:!f||y,loading:y},cancelButtonProps:{disabled:y},onOk:function(){Rp.get(f).then(e=>(e.addWidget(a),e)).then(e=>{t.close();var a="notification-".concat(Math.random().toString(36).substr(2,10));of.success(window.W_L.widget_add_dashboard,n.a.createElement(n.a.Fragment,null,n.a.createElement(g,{href:"".concat(e.url),onClick:()=>of.close(a)},e.name),n.a.createElement(Qb,{isDraft:e.is_draft,tags:e.tags})),{key:a})}).catch(()=>{of.error(window.W_L.widget_add_failed)}).finally(()=>{v(!1)})}}),n.a.createElement("label",{htmlFor:"add-to-dashboard-dialog-dashboard"},window.W_L.select_query_to_dashboard,"："),!f&&n.a.createElement(ba.a,{id:"add-to-dashboard-dialog-dashboard",className:"w-100",autoComplete:"off",autoFocus:!0,placeholder:window.W_L.filter_by_name,value:i,onChange:e=>s(e.target.value),suffix:n.a.createElement(be,{className:""===i?"hidden":null,onClick:()=>s("")},n.a.createElement(je.a,null))}),(w.length>0||m)&&n.a.createElement(Ah.a,{className:f?"add-to-dashboard-dialog-selection":"add-to-dashboard-dialog-search-results",bordered:!0,itemLayout:"horizontal",loading:m,dataSource:w,renderItem:e=>n.a.createElement(Ah.a.Item,{key:"dashboard-".concat(e.id),actions:f?[n.a.createElement(be,{onClick:()=>b(null)},n.a.createElement(je.a,null))]:[],onClick:f?null:()=>b(e)},n.a.createElement("div",{className:"add-to-dashboard-dialog-item-content"},e.name,n.a.createElement(Qb,{isDraft:e.is_draft,tags:e.tags})))}))}tL.propTypes={dialog:wa.isRequired,visualization:ae.a.object.isRequired};var aL=Oa(tL);a(1465);function rL(){return(rL=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function nL(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class oL extends n.a.Component{constructor(e){super(e),nL(this,"state",{enableChangeIframeSize:!1,iframeWidth:720,iframeHeight:391}),nL(this,"urlEmbedLabelId",Object(l.uniqueId)("url-embed-label")),nL(this,"iframeEmbedLabelId",Object(l.uniqueId)("iframe-embed-label"));var t=e.query,a=e.visualization;this.embedUrl="".concat(Y.basePath,"embed/query/").concat(t.id,"/visualization/").concat(a.id,"?api_key=").concat(t.api_key,"&").concat(t.getParameters().toUrlParams()),window.snapshotUrlBuilder&&(this.snapshotUrl=window.snapshotUrlBuilder(t,a))}render(){var e=this.props,t=e.query,a=e.dialog,r=this.state,o=r.enableChangeIframeSize,i=r.iframeWidth,l=r.iframeHeight;return n.a.createElement(R.a,rL({},a.props,{className:"embed-query-dialog",title:window.W_L.embed_query,footer:n.a.createElement(m.a,{onClick:a.dismiss},window.W_L.close)}),t.is_safe?n.a.createElement(n.a.Fragment,null,n.a.createElement("h5",{id:this.urlEmbedLabelId,className:"m-t-0"},window.W_L.public_url),n.a.createElement("div",{className:"m-b-30"},n.a.createElement(Ex,{"aria-labelledby":this.urlEmbedLabelId,"data-test":"EmbedIframe",copyable:!0},this.embedUrl)),n.a.createElement("h5",{id:this.iframeEmbedLabelId,className:"m-t-0"},window.W_L.iframe_embed),n.a.createElement("div",null,n.a.createElement(Ex,{"aria-labelledby":this.iframeEmbedLabelId,copyable:!0},'<iframe src="'.concat(this.embedUrl,'" width="').concat(i,'" height="').concat(l,'"></iframe>')),n.a.createElement(ag.a,{className:"m-t-10",layout:"inline"},n.a.createElement(ag.a.Item,null,n.a.createElement(dn.a,{checked:o,onChange:e=>this.setState({enableChangeIframeSize:e.target.checked})})),n.a.createElement(ag.a.Item,{label:"Width"},n.a.createElement(cn.a,{className:"size-input",value:i,onChange:e=>this.setState({iframeWidth:e}),size:"small",disabled:!o})),n.a.createElement(ag.a.Item,{label:"Height"},n.a.createElement(cn.a,{className:"size-input",value:l,onChange:e=>this.setState({iframeHeight:e}),size:"small",disabled:!o})))),this.snapshotUrl&&n.a.createElement(n.a.Fragment,null,n.a.createElement("h5",null,window.W_L.image_embed),n.a.createElement(Ex,{copyable:!0},this.snapshotUrl))):n.a.createElement(u.a,{message:window.W_L.query_embed_sql_error,type:"error","data-test":"EmbedErrorAlert"}))}}nL(oL,"propTypes",{dialog:wa.isRequired,query:ae.a.object.isRequired,visualization:ae.a.object.isRequired});var iL=Oa(oL);var lL=a(686),sL=a.n(lL),cL=a(687),uL=a.n(cL),dL=a(206),mL=a.n(dL),pL=a(319),fL=a.n(pL);function bL(e){var t="",a=e.query,r=e.queryResult,o=e.fileType,i=r.getId&&r.getId(),l=r.getData&&r.getData();return i&&l&&a.name&&(t=a.id?"api/queries/".concat(a.id,"/results/").concat(i,".").concat(o).concat(e.embed?"?api_key=".concat(e.apiKey):""):"api/query_results/".concat(i,".").concat(o)),n.a.createElement(g,{target:"_blank",rel:"noopener noreferrer",disabled:e.disabled,href:t,download:!0},e.children)}function hL(e){var t=n.a.createElement(ue.a,null,!e.query.isNew()&&(!e.query.is_draft||!e.query.is_archived)&&n.a.createElement(ue.a.Item,null,n.a.createElement(be,{onClick:()=>e.openAddToDashboardForm(e.selectedTab)},n.a.createElement(sL.a,null)," ",window.W_L.add_to_dashboard)),!Y.disablePublicUrls&&!e.query.isNew()&&n.a.createElement(ue.a.Item,null,n.a.createElement(be,{onClick:()=>e.showEmbedDialog(e.query,e.selectedTab),"data-test":"ShowEmbedDialogButton"},n.a.createElement(uL.a,null)," ",window.W_L.embed_other)),n.a.createElement(ue.a.Item,null,n.a.createElement(bL,{fileType:"csv",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(mL.a,null)," ",window.W_L.save_as_csv)),n.a.createElement(ue.a.Item,null,n.a.createElement(bL,{fileType:"tsv",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(mL.a,null)," ",window.W_L.save_as_tsv)),n.a.createElement(ue.a.Item,null,n.a.createElement(bL,{fileType:"xlsx",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(fL.a,null)," ",window.W_L.save_as_excel)));return n.a.createElement(aa.a,{trigger:["click"],overlay:t,overlayClassName:"query-control-dropdown-overlay"},n.a.createElement(m.a,{"data-test":"QueryControlDropdownButton"},n.a.createElement(Jh.a,{rotate:90})))}bL.propTypes={query:ae.a.object.isRequired,queryResult:ae.a.object,fileType:ae.a.string,disabled:ae.a.bool.isRequired,embed:ae.a.bool,apiKey:ae.a.string,children:ae.a.oneOfType([ae.a.arrayOf(ae.a.node),ae.a.node]).isRequired},bL.defaultProps={queryResult:{},fileType:"csv",embed:!1,apiKey:""},hL.propTypes={query:ae.a.object.isRequired,queryResult:ae.a.object,queryExecuting:ae.a.bool.isRequired,showEmbedDialog:ae.a.func.isRequired,embed:ae.a.bool,apiKey:ae.a.string,selectedTab:ae.a.oneOfType([ae.a.string,ae.a.number]),openAddToDashboardForm:ae.a.func.isRequired},hL.defaultProps={queryResult:{},embed:!1,apiKey:"",selectedTab:""};var gL=a(688),yL=a.n(gL);function vL(e){return n.a.createElement(m.a,{"data-test":"EditVisualization",className:"edit-visualization",onClick:()=>e.openVisualizationEditor(e.selectedTab)},n.a.createElement(yL.a,null),n.a.createElement("span",{className:"hidden-xs hidden-s hidden-m"},window.W_L.edit_view))}vL.propTypes={openVisualizationEditor:ae.a.func.isRequired,selectedTab:ae.a.oneOfType([ae.a.string,ae.a.number])},vL.defaultProps={selectedTab:""};a(1476);function wL(e){var t=e.query,a=e.queryResult,o=e.isQueryExecuting,i=e.selectedVisualization,s=e.showEditVisualizationButton,c=e.onEditVisualization,u=e.extraActions,d=dw(a),m=function(e){return Object(r.useCallback)(t=>{var a=Object(l.find)(e.visualizations,{id:t});aL.showModal({visualization:a})},[e.visualizations])}(t),p=function(e){return Object(r.useCallback)((t,a)=>{var r=Object(l.find)(e.visualizations,{id:a});iL.showModal({query:e,visualization:r})},[e])}(t);return n.a.createElement("div",{className:"query-execution-metadata"},n.a.createElement("span",{className:"m-r-5"},n.a.createElement(hL,{query:t,queryResult:a,queryExecuting:o,showEmbedDialog:p,embed:!1,apiKey:t.api_key,selectedTab:i,openAddToDashboardForm:m})),u,s&&n.a.createElement(vL,{openVisualizationEditor:c,selectedTab:i}),n.a.createElement("span",{className:"m-l-5 m-r-10"},n.a.createElement("span",null,!0===d.truncated&&n.a.createElement("span",{className:"m-r-5"},n.a.createElement(we,{title:"Result truncated to "+d.rows.length+window.W_L.redash_cut_data_tip},n.a.createElement(Jx.a,{twoToneColor:"#FF9800"}))),n.a.createElement("strong",null,d.rows.length)," ",ib("row",d.rows.length)),n.a.createElement("span",{className:"m-l-5"},!o&&n.a.createElement(n.a.Fragment,null,n.a.createElement("strong",null,lb(d.runtime)),n.a.createElement("span",{className:"hidden-xs"}," ",window.W_L.run_time)),o&&n.a.createElement("span",null,window.W_L.runing,"…")),d.metadata.data_scanned&&n.a.createElement("span",{className:"m-l-5"},"Data Scanned",n.a.createElement("strong",null,db(d.metadata.data_scanned)))),n.a.createElement("div",null,n.a.createElement("span",{className:"m-r-10"},n.a.createElement("span",{className:"hidden-xs"},window.W_L.flush_time,"："),n.a.createElement("strong",null,n.a.createElement(Gf,{date:d.retrievedAt,placeholder:"-"})))))}wL.propTypes={query:ae.a.object.isRequired,queryResult:ae.a.object.isRequired,isQueryExecuting:ae.a.bool,selectedVisualization:ae.a.number,showEditVisualizationButton:ae.a.bool,onEditVisualization:ae.a.func,extraActions:ae.a.node},wL.defaultProps={isQueryExecuting:!1,selectedVisualization:null,showEditVisualizationButton:!1,onEditVisualization:()=>{},extraActions:null};var OL=a(690),EL=a.n(OL),_L=a(691),jL=a.n(_L);function SL(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return CL(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return CL(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function CL(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function PL(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return e?ZC.fetchSchema(e,t).catch(()=>(of.error(window.W_L.flush_error,window.W_L.wait_retry),Promise.resolve([]))):Promise.resolve([])}function xL(){return(xL=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function LL(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function kL(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?LL(Object(a),!0).forEach((function(t){NL(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):LL(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function NL(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function AL(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return TL(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return TL(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function TL(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function WL(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var IL=ae.a.shape({name:ae.a.string.isRequired,type:ae.a.string}),qL=ae.a.shape({name:ae.a.string.isRequired,size:ae.a.number,loading:ae.a.bool,columns:ae.a.arrayOf(IL).isRequired});function DL(e){var t=e.item,a=e.expanded,o=e.onToggle,i=e.onSelect,s=WL(e,["item","expanded","onToggle","onSelect"]),c=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation();for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];i(...a)}),[i]);if(!t)return null;var u=t.displayName||t.name;return n.a.createElement("div",s,n.a.createElement("div",{className:"schema-list-item"},n.a.createElement(be,{className:"table-name",onClick:o},n.a.createElement("i",{className:"fa fa-table m-r-5","aria-hidden":"true"}),n.a.createElement("strong",null,n.a.createElement("span",{title:t.name},u),!Object(l.isNil)(t.size)&&n.a.createElement("span",null," (",t.size,")"))),n.a.createElement(we,{title:"Insert table name into query text",mouseEnterDelay:0,mouseLeaveDelay:0,placement:"topRight",arrowPointAtCenter:!0},n.a.createElement(be,{className:"copy-to-editor",onClick:e=>c(e,t.name)},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"})))),a&&n.a.createElement("div",{className:"table-open"},t.loading?n.a.createElement("div",{className:"table-open"},"Loading..."):Object(l.map)(t.columns,e=>{var t=Object(l.get)(e,"name"),a=Object(l.get)(e,"type");return n.a.createElement(we,{title:"Insert column name into query text",mouseEnterDelay:0,mouseLeaveDelay:0,placement:"rightTop"},n.a.createElement(be,{key:t,className:"table-open-item",onClick:e=>c(e,t)},n.a.createElement("div",null,t," ",a&&n.a.createElement("span",{className:"column-type"},a)),n.a.createElement("div",{className:"copy-to-editor"},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"}))))})))}function RL(){return n.a.createElement("div",{className:"schema-loading-state"},n.a.createElement(Ch,{className:""}))}function ML(e){var t=e.loading,a=e.schema,o=e.expandedFlags,i=e.onTableExpand,l=e.onItemSelect,s=AL(Object(r.useState)(null),2),c=s[0],u=s[1];return Object(r.useEffect)(()=>{c&&c.recomputeRowHeights()},[c,a,o]),n.a.createElement("div",{className:"schema-browser"},t&&n.a.createElement(RL,null),!t&&n.a.createElement(EL.a,null,e=>{var t=e.width,r=e.height;return n.a.createElement(jL.a,{ref:u,width:t,height:r,rowCount:a.length,rowHeight:e=>{var t=e.index,r=a[t],n=r.loading?1:r.columns.length;return 22+18*(o[r.name]?n:0)},rowRenderer:e=>{var t=e.key,r=e.index,s=e.style,c=a[r];return n.a.createElement(DL,{key:t,style:s,item:c,expanded:o[c.name],onToggle:()=>i(c.name),onSelect:l})}})}))}function zL(e,t){var a=Object(l.filter)(t.toLowerCase().split(/\s+/),e=>e.length>0);if(0===a.length)return e;if(1===a.length){var r=a[0],n=a[0];return Object(l.filter)(e,e=>Object(l.includes)(e.name.toLowerCase(),r)||Object(l.some)(e.columns,e=>Object(l.includes)(Object(l.get)(e,"name").toLowerCase(),n)))}var o=a[0],i=a[1];return Object(l.filter)(Object(l.map)(e,e=>{if(Object(l.includes)(e.name.toLowerCase(),o))return(e=kL(kL({},e),{},{columns:Object(l.filter)(e.columns,e=>Object(l.includes)(Object(l.get)(e,"name").toLowerCase(),i))})).columns.length>0?e:null}))}function FL(e){var t=e.dataSource,a=e.onSchemaUpdate,o=e.onItemSelect,i=(e.options,e.onOptionsUpdate,WL(e,["dataSource","onSchemaUpdate","onItemSelect","options","onOptionsUpdate"])),l=AL(function(e){var t=SL(Object(r.useState)([]),2),a=t[0],n=t[1],o=SL(Object(r.useState)(!0),2),i=o[0],l=o[1],s=Object(r.useRef)(null),c=Object(r.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;l(!0);var a=Math.random().toString(36).substr(2);s.current=a,PL(e,t).then(e=>{s.current===a&&n(e)}).finally(()=>{s.current===a&&l(!1)})}),[e]);return Object(r.useEffect)(()=>{c()},[c]),Object(r.useEffect)(()=>()=>{s.current=null},[]),Object(r.useMemo)(()=>[a,i,c],[a,i,c])}(t),3),s=l[0],c=l[1],u=l[2],d=AL(Object(r.useState)(""),2),p=d[0],f=d[1],b=Object(r.useMemo)(()=>zL(s,p),[s,p]),h=AL(Object(Ml.a)(f,500),1)[0],g=AL(Object(r.useState)({}),2),y=g[0],v=g[1],w=mw(a);if(Object(r.useEffect)(()=>{v({}),w(s)},[s,w]),0===s.length&&!c)return null;return n.a.createElement("div",xL({className:"schema-container"},i),n.a.createElement("div",{className:"schema-control"},n.a.createElement(ba.a,{className:"m-r-5",placeholder:window.W_L.search_schema,"aria-label":window.W_L.search_schema,disabled:0===s.length,onChange:e=>h(e.target.value)}),n.a.createElement(we,{title:window.W_L.flush_schema},n.a.createElement(m.a,{onClick:()=>u(!0)},n.a.createElement("i",{className:me()("zmdi zmdi-refresh",{"zmdi-hc-spin":c}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},c?"Loading, please wait.":"Press to refresh.")))),n.a.createElement(ML,{loading:c&&0===s.length,schema:b,expandedFlags:y,onTableExpand:function(e){v(kL(kL({},y),{},{[e]:!y[e]}))},onItemSelect:o}))}DL.propTypes={item:qL,expanded:ae.a.bool,onToggle:ae.a.func,onSelect:ae.a.func},DL.defaultProps={item:null,expanded:!1,onToggle:()=>{},onSelect:()=>{}},FL.propTypes={dataSource:ae.a.object,onSchemaUpdate:ae.a.func,onItemSelect:ae.a.func},FL.defaultProps={dataSource:null,onSchemaUpdate:()=>{},onItemSelect:()=>{}};var VL=a(172),UL=a.n(VL),BL=(a(1550),a(1551),a(1552),a(1553),a(1554),a(1555),a(1556),UL.a.acequire("ace/ext/language_tools")),HL=UL.a.acequire("ace/snippets");function YL(e){UL.a.define("ace/snippets/".concat(e),["require","exports","module"],(t,a)=>{a.snippetText="",a.scope=e})}function QL(e){var t=[],a={},r={};return e.forEach(e=>{t.push({name:e.name,value:e.name,score:100,meta:"Table"}),r[e.name]=function(e){var t=[];return e.columns.forEach(a=>{var r=Object(l.get)(a,"name");t.push({name:"".concat(e.name,".").concat(r),value:"".concat(e.name,".").concat(r),score:100,meta:Object(l.capitalize)(Object(l.get)(a,"type","Column"))})}),t}(e),e.columns.forEach(e=>{var t=Object(l.get)(e,"name",e);a[t]=Object(l.capitalize)(Object(l.get)(e,"type","Column"))})}),{table:t,column:Object(l.map)(a,(e,t)=>({name:t,value:t,score:50,meta:e})),tableColumn:r}}YL("python"),YL("sql"),YL("json"),YL("yaml");var KL={};function $L(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;KL[e]=Object(l.isNil)(t)?null:QL(t)}BL.setCompleters([BL.snippetCompleter,BL.keyWordCompleter,BL.textCompleter,{identifierRegexps:[/[a-zA-Z_0-9.\-\u00A2-\uFFFF]/],getCompletions:(e,t,a,r,n)=>{var o=KL[e.id]||{table:[],column:[],tableColumn:[]},i=o.table,l=o.column,s=o.tableColumn;if(0!==r.length&&0!==i.length)if("."!==r[r.length-1])n(null,i.concat(l));else{var c=r.substring(0,r.length-1);n(null,i.concat(s[c]))}else n(null,[])}}]);class GL{constructor(e){Object(l.extend)(this,e)}getSnippet(){var e=this.trigger;return""!==this.description&&(e="".concat(this.trigger,": ").concat(this.description)),{name:e,content:this.snippet,tabTrigger:this.trigger}}}var JL=e=>new GL(e),XL={get:e=>B.get("api/query_snippets/".concat(e.id)).then(JL),query:()=>B.get("api/query_snippets").then(e=>Object(l.map)(e,JL)),create:e=>B.post("api/query_snippets",e).then(JL),save:e=>B.post("api/query_snippets/".concat(e.id),e).then(JL),delete:e=>B.delete("api/query_snippets/".concat(e.id))};a(1557);function ZL(e){var t=e.available,a=e.enabled,o=e.onToggle,i=window.W_L.auto_enable,l="icon-flash";a||(i=window.W_L.auto_disable,l="icon-flash-off"),t||(i=window.W_L.auto_info,l="icon-flash-off");var s=Object(r.useCallback)(()=>{Sa("toggle_autocomplete","screen","query_editor",{state:!a}),o(!a)},[a,o]);return n.a.createElement(we,{placement:"top",title:i},n.a.createElement(m.a,{className:"query-editor-controls-button m-r-5",disabled:!t,onClick:s,"aria-label":a?"Disable live autocomplete":"Enable live autocomplete"},n.a.createElement("i",{className:"icon "+l,"aria-hidden":"true"})))}ZL.propTypes={available:ae.a.bool.isRequired,enabled:ae.a.bool.isRequired,onToggle:ae.a.func.isRequired};a(1558);function ek(e){var t=e.available,a=e.checked,o=e.onChange,i=Object(r.useCallback)(()=>{Sa("checkbox_auto_limit","screen","query_editor",{state:!a}),o(!a)},[a,o]),l=null;return l=t?window.W_L.limit_1000:window.W_L.not_limit,n.a.createElement(we,{placement:"top",title:l},n.a.createElement(dn.a,{className:"query-editor-controls-checkbox",disabled:!t,onClick:i,checked:t&&a},window.W_L.return_1000))}function tk(){return(tk=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ak(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function rk(e){var t=e.title,a=e.shortcut,r=ak(e,["title","shortcut"]);return a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,a={mod:Object(l.upperFirst)(wy),alt:Object(l.upperFirst)(Oy)};return e=Object(l.toLower)(Object(l.toString)(e)),e=Object(l.filter)(Object(l.map)(e.split(","),l.trim),e=>""!==e).slice(0,t),""!==(e=Object(l.map)(e,e=>(e=Object(l.filter)(Object(l.map)(e.split("+")),e=>""!==e),Object(l.map)(e,e=>a[e]||Object(l.upperFirst)(e)).join(" + "))).join(", "))?e:null}(a,1),t=t&&a?n.a.createElement(n.a.Fragment,null,t," (",n.a.createElement("i",null,a),")"):t||a,n.a.createElement(we,tk({placement:"top",title:t},r))}function nk(e){var t=e.addParameterButtonProps,a=e.formatButtonProps,o=e.saveButtonProps,i=e.executeButtonProps,s=e.autocompleteToggleProps,c=e.autoLimitCheckboxProps,u=e.dataSourceSelectorProps;return Object(r.useEffect)(()=>{var e=Object(l.filter)([t,a,o,i],e=>e.shortcut&&Object(l.isFunction)(e.onClick));if(e.length>0){var r=Object(l.fromPairs)(Object(l.map)(e,e=>[e.shortcut,e.disabled?l.noop:e.onClick]));return jy.bind(r),()=>{jy.unbind(r)}}},[t,a,o,i]),n.a.createElement("div",{className:"query-editor-controls"},!1!==t&&n.a.createElement(rk,{title:t.title,shortcut:t.shortcut},n.a.createElement(m.a,{className:"query-editor-controls-button m-r-5",disabled:t.disabled,onClick:t.onClick},"{{"," ","}}")),!1!==a&&n.a.createElement(rk,{title:a.title,shortcut:a.shortcut},n.a.createElement(m.a,{className:"query-editor-controls-button m-r-5",disabled:a.disabled,onClick:a.onClick},n.a.createElement("span",{className:"zmdi zmdi-format-indent-increase"}),a.text)),!1!==s&&n.a.createElement(ZL,{available:s.available,enabled:s.enabled,onToggle:s.onToggle}),!1!==c&&n.a.createElement(ek,c),!1===u&&n.a.createElement("span",{className:"query-editor-controls-spacer"}),!1!==u&&n.a.createElement(ln.a,{className:"w-100 flex-fill datasource-small",disabled:u.disabled,value:u.value,onChange:u.onChange},Object(l.map)(u.options,e=>n.a.createElement(ln.a.Option,{key:"option-".concat(e.value),value:e.value},e.label))),!1!==o&&n.a.createElement(rk,{title:o.title,shortcut:o.shortcut},n.a.createElement(m.a,{className:"query-editor-controls-button m-l-5",disabled:o.disabled,loading:o.loading,onClick:o.onClick,"data-test":"SaveButton"},!o.loading&&n.a.createElement("span",{className:"fa fa-floppy-o"}),o.text)),!1!==i&&n.a.createElement(rk,{title:i.title,shortcut:i.shortcut},n.a.createElement(m.a,{className:"query-editor-controls-button m-l-5",type:"primary",disabled:i.disabled,onClick:i.onClick,"data-test":"ExecuteButton"},n.a.createElement("span",{className:"zmdi zmdi-play"}),i.text)))}ek.propTypes={available:ae.a.bool,checked:ae.a.bool.isRequired,onChange:ae.a.func.isRequired},rk.propTypes={title:ae.a.node,shortcut:ae.a.string},rk.defaultProps={title:null,shortcut:null};var ok=ae.a.oneOfType([ae.a.bool,ae.a.shape({title:ae.a.node,disabled:ae.a.bool,loading:ae.a.bool,onClick:ae.a.func,text:ae.a.node,shortcut:ae.a.string})]);nk.propTypes={addParameterButtonProps:ok,formatButtonProps:ok,saveButtonProps:ok,executeButtonProps:ok,autocompleteToggleProps:ae.a.oneOfType([ae.a.bool,ae.a.shape({available:ae.a.bool,enabled:ae.a.bool,onToggle:ae.a.func})]),autoLimitCheckboxProps:ae.a.oneOfType([ae.a.bool,ae.a.shape(ek.propTypes)]),dataSourceSelectorProps:ae.a.oneOfType([ae.a.bool,ae.a.shape({disabled:ae.a.bool,value:ae.a.oneOfType([ae.a.string,ae.a.number]),options:ae.a.arrayOf(ae.a.shape({value:ae.a.oneOfType([ae.a.string,ae.a.number]),label:ae.a.node})),onChange:ae.a.func})])},nk.defaultProps={addParameterButtonProps:!1,formatButtonProps:!1,saveButtonProps:!1,executeButtonProps:!1,autocompleteToggleProps:!1,autoLimitCheckboxProps:!1,dataSourceSelectorProps:!1};a(1559);function ik(){return(ik=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function lk(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return sk(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return sk(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sk(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ck(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var uk={$blockScrolling:1/0},dk=n.a.forwardRef((function(e,t){var a=e.className,o=e.syntax,i=e.value,l=e.autocompleteEnabled,s=e.schema,c=e.onChange,u=e.onSelectionChange,d=ck(e,["className","syntax","value","autocompleteEnabled","schema","onChange","onSelectionChange"]),m=lk(Object(r.useState)(null),2),p=m[0],f=m[1],b=lk(Object(r.useState)(null),2),h=b[0],g=b[1],y=lk(Object(r.useState)(i),2),v=y[0],w=y[1];Object(r.useEffect)(()=>{w(i)},[i]);var O=Object(r.useCallback)(e=>{w(e),c(e)},[c]),E=Object(r.useMemo)(()=>({behavioursEnabled:!0,enableSnippets:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:l,autoScrollEditorIntoView:!0}),[l]);Object(r.useEffect)(()=>{if(h){var e=h.editor.id;return $L(e,s),()=>{$L(e,null)}}},[s,h]),Object(r.useEffect)(()=>{function e(){h&&h.editor.resize()}if(p)return e(),Yr(p,e)},[p,h]);var _=Object(r.useCallback)(e=>{var t=h.editor.session.doc.getTextRange(e.getRange()),a=t.length>1?t:null;u(a)},[h,u]),j=Object(r.useCallback)(e=>{e.commands.bindKey({win:"Ctrl+L",mac:"Cmd+L"},null),e.commands.bindKey({win:"Ctrl+Shift+F",mac:"Cmd+Shift+F"},null),e.commands.bindKey({win:"Ctrl+P",mac:null},null),e.commands.bindKey({win:null,mac:"Ctrl+P"},"golineup"),e.commands.bindKey({win:"Esc",mac:"Esc"},()=>{e.blur()});var t=null;e.on("focus",()=>{t=function(e){var t=e.text,a=e.expiry,r=void 0===a?1e3:a,n=e.container,o=void 0===n?document.body:n,i=e.politeness,l=void 0===i?"polite":i,s=document.createElement("div"),c="speak-".concat(Date.now());s.id=c,s.className="sr-only",s.textContent=t,s.setAttribute("role","alert"),s.setAttribute("aria-live",l),o.appendChild(s);var u=null,d=!1,m=()=>{if(!d){d=!0;try{o.removeChild(s)}catch(e){console.error(e)}u&&window.clearTimeout(u)}};return u=window.setTimeout(m,r),m}({text:"You've entered the SQL editor. To exit press the ESC key.",politeness:"assertive"})}),e.on("blur",()=>{t&&t()}),e.commands.on("afterExec",t=>{"insertstring"===t.command.name&&"."===t.args&&e.completer&&e.completer.showPopup(e)}),XL.query().then(e=>{var t=HL.snippetManager,a={snippetText:""};a.snippets=t.parseSnippetFile(a.snippetText),e.forEach(e=>{a.snippets.push(e.getSnippet())}),t.register(a.snippets||[],a.scope)}),e.focus()},[]);return Object(r.useImperativeHandle)(t,()=>({paste:e=>{if(h){var t=h.editor;t.session.doc.replace(t.selection.getRange(),e);var a=t.selection.getRange();c(t.session.getValue()),t.selection.setRange(a)}},focus:()=>{h&&h.editor.focus()}}),[h,c]),n.a.createElement("div",ik({className:me()("query-editor-container",a)},d,{ref:f}),n.a.createElement(tC.a,{ref:g,theme:"textmate",mode:o||"sql",value:v,editorProps:uk,width:"100%",height:"100%",setOptions:E,showPrintMargin:!1,wrapEnabled:!1,onLoad:j,onChange:O,onSelectionChange:_}))}));dk.propTypes={className:ae.a.string,syntax:ae.a.string,value:ae.a.string,autocompleteEnabled:ae.a.bool,schema:ae.a.arrayOf(qL),onChange:ae.a.func,onSelectionChange:ae.a.func},dk.defaultProps={className:null,syntax:null,value:null,autocompleteEnabled:!0,schema:[],onChange:()=>{},onSelectionChange:()=>{}},dk.Controls=nk;var mk=dk,pk=a(692),fk=a.n(pk);function bk(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function hk(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?bk(Object(a),!0).forEach((function(t){gk(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):bk(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function gk(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function yk(e){return Object(l.has)(e,"job.id")?rr(e.job.id,1e3):e}function vk(e){return Object(l.has)(e,"error")?Promise.reject(new Error(e.error.message)):e}var wk=hk(hk({},ZC),{},{getDatabases:function(e){var t=e.id,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={};return a&&(r.refresh=!0),B.get("api/databricks/databases/".concat(t),{params:r}).then(yk).then(vk)},getDatabaseTables:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={};return a&&(r.refresh=!0),B.get("api/databricks/databases/".concat(e.id,"/").concat(t,"/tables"),{params:r}).then(yk).then(vk)},getTableColumns:(e,t,a)=>B.get("api/databricks/databases/".concat(e.id,"/").concat(t,"/columns/").concat(a)).then(yk).then(vk)});function Ok(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ek(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ek(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ek(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function jk(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_k(Object(a),!0).forEach((function(t){Sk(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_k(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Sk(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ck(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?wk.getDatabases(e,t).catch(()=>(of.error("Failed to load Database list.","Please try again later."),Promise.reject())):Promise.resolve([])}function Pk(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e&&t?wk.getDatabaseTables(e,t,a).catch(()=>(of.error("Failed to load tables for ".concat(t,"."),"Please try again later."),Promise.reject())):Promise.resolve([])}function xk(e,t){return t?Object(l.map)(e,e=>{var a=t+".",r=e.name;return Object(l.startsWith)(e.name,a)&&(r=e.name.slice(a.length)),jk(jk({},e),{},{displayName:r})}):e}a(1560);function Lk(){return(Lk=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function kk(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Nk(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?kk(Object(a),!0).forEach((function(t){Ak(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kk(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ak(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Tk(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wk(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Wk(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wk(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ik(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function qk(e){var t=e.dataSource,a=e.options,o=e.onOptionsUpdate,i=e.onSchemaUpdate,s=e.onItemSelect,c=Ik(e,["dataSource","options","onOptionsUpdate","onSchemaUpdate","onItemSelect"]),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=Object(r.useState)([]),o=Ok(n,2),i=o[0],s=o[1],c=Object(r.useState)(!0),u=Ok(c,2),d=u[0],m=u[1],p=Object(r.useState)(),f=Ok(p,2),b=f[0],h=f[1],g=Object(r.useState)({}),y=Ok(g,2),v=y[0],w=y[1],O=Object(r.useState)(!1),E=Ok(O,2),_=E[0],j=E[1],S=Object(r.useState)(!1),C=Ok(S,2),P=C[0],x=C[1],L=Object(r.useCallback)(e=>w(t=>jk(jk({},t),{},{[b]:e})),[b]),k=Object(r.useRef)();k.current=b;var N=Object(r.useCallback)(t=>{wk.getTableColumns(e,b,t.substring(b.length+1)).then(e=>{k.current===b&&w(a=>{var r=Object(l.get)(a,b,[]),n=Object(l.map)(r,a=>a.name===t?jk(jk({},a),{},{columns:e,loading:!1}):a);return jk(jk({},a),{},{[b]:n})})})},[e,b]),A=Object(r.useMemo)(()=>xk(Object(l.get)(v,b,[]),b),[v,b]),T=Object(r.useCallback)(()=>{if(!P){x(!0);var t=Ck(e,!0).then(s),a=Pk(e,b,!0).then(e=>{var t=e.schema;return L(t)});Promise.all([a.catch(()=>{}),t.catch(()=>{})]).then(()=>x(!1))}},[e,b,L,P]),W=Object(r.useRef)();W.current=v,Object(r.useEffect)(()=>{var t=!1;return b&&!Object(l.has)(W.current,b)&&(j(!0),Pk(e,b).catch(()=>Promise.resolve({schema:[],has_columns:!0})).then(a=>{var r=a.schema,n=a.has_columns;t||(n||Object(l.isEmpty)(r)||(r=Object(l.map)(r,e=>jk(jk({},e),{},{loading:!0})),Pk(e,b,!0).then(e=>{var a=e.schema;t||L(a)})),L(r))}).finally(()=>{t||j(!1)})),()=>{t=!0}},[e,b,L]);var I=Object(r.useRef)();I.current=Object(l.get)(t,"selectedDatabase",null),Object(r.useEffect)(()=>{var t=!1;return m(!0),h(void 0),w({}),Ck(e).catch(()=>Promise.resolve([])).then(a=>{if(!t){s(a);var r=I.current||localStorage.getItem("lastSelectedDatabricksDatabase_".concat(e.id));r||(r=Object(l.includes)(a,"default")?"default":Object(l.first)(a)||null),h(r)}}).finally(()=>{t||m(!1)}),()=>{t=!0}},[e]);var q=Object(r.useCallback)(r=>{if(r)try{localStorage.setItem("lastSelectedDatabricksDatabase_".concat(e.id),r)}catch(e){}h(r),Object(l.isFunction)(a)&&r!==I.current&&a(jk(jk({},t),{},{selectedDatabase:r}))},[e.id,t,a]);return{databases:i,loadingDatabases:d,schema:A,loadingSchema:_,currentDatabaseName:b,setCurrentDatabase:q,loadTableColumns:N,refreshAll:T,refreshing:P}}(t,a,o),d=u.databases,p=u.loadingDatabases,f=u.schema,b=u.loadingSchema,h=u.loadTableColumns,g=u.currentDatabaseName,y=u.setCurrentDatabase,v=u.refreshAll,w=u.refreshing,O=Tk(Object(r.useState)(""),2),E=O[0],_=O[1],j=Tk(Object(r.useState)(""),2),S=j[0],C=j[1],P=Object(r.useMemo)(()=>zL(f,E),[f,E]),x=Tk(Object(r.useState)(!1),2),L=x[0],k=x[1],N=Tk(Object(r.useState)({}),2),A=N[0],T=N[1],W=Tk(Object(Ml.a)(_,500),1)[0],I=Tk(Object(Ml.a)(C,500),2),q=I[0],D=I[1],R=Object(r.useCallback)(e=>{y(e),D(),C("")},[D,y]),M=Object(r.useMemo)(()=>Object(l.filter)(d,e=>Object(l.includes)(e.toLowerCase(),S.toLowerCase())),[d,S]),z=mw(i);return Object(r.useEffect)(()=>{z(f)},[f,z]),Object(r.useEffect)(()=>{T({})},[g]),n.a.createElement("div",Lk({className:"databricks-schema-browser schema-container"},c),n.a.createElement("div",{className:"schema-control"},n.a.createElement(ba.a,{className:L?"database-select-open":"",placeholder:window.W_L.filter_table_columns,"aria-label":"{window.W_L.search_schema}",disabled:p||b,onChange:e=>W(e.target.value),addonBefore:n.a.createElement(ln.a,{dropdownClassName:"databricks-schema-browser-db-dropdown",loading:p,disabled:p,onChange:R,value:g,showSearch:!0,onSearch:q,onDropdownVisibleChange:k,placeholder:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-database m-r-5","aria-hidden":"true"})," Database")},M.map(e=>n.a.createElement(ln.a.Option,{key:e},n.a.createElement("i",{className:"fa fa-database m-r-5","aria-hidden":"true"}),e)))})),n.a.createElement("div",{className:"schema-list-wrapper"},n.a.createElement(ML,{loading:p||b,schema:P,expandedFlags:A,onTableExpand:function(e){var t=Object(l.find)(f,{name:e});!A[e]&&Object(l.get)(t,"loading",!1)&&h(e),T(Nk(Nk({},A),{},{[e]:!A[e]}))},onItemSelect:s}),!(b||p)&&n.a.createElement("div",{className:"load-button"},n.a.createElement(we,{title:w?null:"Refresh Databases and Current Schema"},n.a.createElement(m.a,{type:"link",onClick:v,disabled:w},n.a.createElement(fk.a,{spin:w}))))))}function Dk(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Rk(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Dk(Object(a),!0).forEach((function(t){Mk(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Dk(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Mk(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}qk.propTypes={dataSource:ae.a.object,options:ae.a.object,onOptionsUpdate:ae.a.func,onSchemaUpdate:ae.a.func,onItemSelect:ae.a.func},qk.defaultProps={dataSource:null,options:null,onOptionsUpdate:()=>{},onSchemaUpdate:()=>{},onItemSelect:()=>{}};var zk=new Map,Fk="SchemaBrowser",Vk="QueryEditor";function Uk(e,t,a){Object(l.isNil)(a)&&(a=[null]),Object(l.isArray)(a)||(a=[a]),Object(l.each)(a,a=>{zk.set(a,Rk(Rk({},zk.get(a)),{},{[e]:t}))})}function Bk(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Hk(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Hk(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hk(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Yk(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qk(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Qk(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qk(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Kk(e){var t=Object(r.useMemo)(()=>Object(l.first)(Object(l.orderBy)(e,["id"]))||{},[e]),a=Yk(Object(r.useState)(+A.hash||t.id),2),n=a[0],o=a[1];return Object(r.useEffect)(()=>{var e=n!==t.id?"".concat(n):null;return A.hash!==e&&A.setHash(e),A.listen(()=>{A.hash!==e&&o(+A.hash||t.id)})},[t.id,n]),Object(r.useEffect)(()=>{Object(l.find)(e,{id:n})||o(t.id)},[t.id,n,e]),Object(r.useMemo)(()=>[n,o],[n])}function $k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Gk(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Gk(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gk(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Jk(e){var t=Object(r.useMemo)(()=>function(e){return Object(l.reduce)(e,(e,t)=>e+t.columns.length,0)}(e)<=5e3,[e]),a=$k(Object(r.useState)(lr.get("liveAutocomplete",!0)),2),n=a[0],o=a[1],i=Object(r.useCallback)(e=>{o(e),lr.set("liveAutocomplete",e)},[]);return Object(r.useMemo)(()=>[t,n,i],[t,n,i])}function Xk(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Zk(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Xk(Object(a),!0).forEach((function(t){eN(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Xk(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function eN(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function tN(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return aN(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return aN(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function aN(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function rN(e,t,a){var n=function(e){return Object(l.get)(e,"supports_auto_limit",!1)}(e),o=tN(Object(r.useState)(t.options.apply_auto_limit),2),i=o[0],s=o[1];return t.options.apply_auto_limit=i,[n,i,Object(r.useCallback)(e=>{s(e),lr.set("applyAutoLimit",e),a(Object(l.extend)(t.clone(),{options:Zk(Zk({},t.options),{},{apply_auto_limit:e})}))},[t,a])]}Uk(Fk,FL),Uk(Vk,mk),Uk(Fk,qk,["databricks","databricks_internal"]);var nN=v()("redash:notifications"),oN=window.Notification||null;oN||nN("HTML5 notifications are not supported.");var iN=Object(l.find)(["hidden","webkitHidden","mozHidden","msHidden"],e=>e in document);var lN={getPermissions:function(){oN&&"default"===oN.permission&&oN.requestPermission()},showNotification:function(e,t){oN&&document[iN]&&"granted"===oN.permission&&(new oN(e,{tag:e+t,body:t,icon:vt.a}).onclick=function(){window.focus(),this.close(),Sa("click","notification")})}};function sN(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return cN(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return cN(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cN(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function uN(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function dN(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?uN(Object(a),!0).forEach((function(t){mN(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):uN(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function mN(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var pN=(e,t)=>dN(dN({},e),t);function fN(e){var t=sN(Object(r.useReducer)(pN,{queryResult:null,isExecuting:!1,loadedInitialResults:!1,executionStatus:null,isCancelling:!1,cancelCallback:null,error:null}),2),a=t[0],n=t[1],o=Object(r.useRef)(null);Object(r.useEffect)(()=>()=>{o.current=null},[]);var i=mw((function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;t=i?i():e.getQueryResult(r),Sa("execute","query",e.id),lN.getPermissions(),o.current=t,n({updatedAt:t.getUpdatedAt(),executionStatus:t.getStatus(),isExecuting:!0,cancelCallback:()=>{Sa("cancel_execute","query",e.id),n({isCancelling:!0}),t.cancelExecution()}});var l=e=>{o.current===t&&n({updatedAt:t.getUpdatedAt(),executionStatus:e})};t.toPromise(l).then(r=>{o.current===t&&(r&&r.query_result.query===e.query&&(e.latest_query_data_id=r.getId(),e.queryResult=r),a.loadedInitialResults&&lN.showNotification("Holmes","".concat(e.name," updated.")),n({queryResult:r,loadedInitialResults:!0,error:null,isExecuting:!1,isCancelling:!1,executionStatus:null}))}).catch(r=>{o.current===t&&(a.loadedInitialResults&&lN.showNotification("Holmes","".concat(e.name," failed to run: ").concat(r.getError())),n({queryResult:r,loadedInitialResults:!0,error:r.getError(),isExecuting:!1,isCancelling:!1,executionStatus:Xa}))})})),l=Object(r.useRef)(e);return l.current=e,Object(r.useEffect)(()=>{var e;l.current.hasResult()||l.current.paramsRequired()?i(void 0!==(e=A.search.maxAge)?e:-1):n({loadedInitialResults:!0})},[i]),dN(dN({},a),{executeQuery:i})}function bN(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return hN(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return hN(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hN(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function gN(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return yN(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yN(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yN(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function vN(e){var t=Object(r.useMemo)(()=>e.getParametersDefs(),[e]),a=gN(Object(r.useState)(e.getParameters().hasPendingValues()),2),n=a[0],o=a[1],i=Object(r.useCallback)(t=>{t=Object(l.isUndefined)(t)?e.getParameters().hasPendingValues():t,o(t)},[e]);return Object(r.useEffect)(()=>{var t=e.getParameters().hasPendingValues();t!==n&&o(t)},[e,t,n]),Object(r.useMemo)(()=>[t,n,i],[t,n,i])}var wN=a(693),ON=a.n(wN);function EN(){return(EN=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function _N(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function jN(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return SN(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return SN(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function SN(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var CN=Da.a.weekdaysShort(),PN=Da.a.weekdays(),xN=ln.a.Option,LN=ln.a.OptGroup;function kN(e){var t=jN(Object(r.useState)(e.defaultValue),2),a=t[0],o=t[1],i=a&&!a.isUTC();return n.a.createElement(n.a.Fragment,null,n.a.createElement(ON.a,{allowClear:!1,value:a,format:"HH:mm",minuteStep:5,onChange:function(t){o(t),e.onChange(t)}}),i&&n.a.createElement("span",{className:"utc","data-testid":"utc"},"(",Da.a.utc(a).format("HH:mm")," UTC)"))}kN.propTypes={defaultValue:Qf,onChange:ae.a.func.isRequired},kN.defaultProps={defaultValue:null};class NN extends n.a.Component{constructor(){super(...arguments),_N(this,"state",this.getState()),_N(this,"setTime",e=>{this.newSchedule={time:Da()(e).utc().format("HH:mm")}}),_N(this,"setInterval",e=>{var t=this.state.newSchedule,a=ob(e).interval;a===Zf.NEVER&&(t.until=null),-1!==[Zf.NEVER,Zf.MINUTES,Zf.HOURS].indexOf(a)&&(t.time=null),a!==Zf.WEEKS&&(t.day_of_week=null),a!==Zf.DAYS&&a!==Zf.WEEKS||this.state.minute&&this.state.hour||(t.time=Da()().hour("00").minute("15").utc().format("HH:mm")),a!==Zf.WEEKS||this.state.dayOfWeek||(t.day_of_week=PN[0]),t.interval=e;var r=jN(t.time?nb(t.time).split(":"):[null,null],2),n=r[0],o=r[1];this.setState({interval:a,seconds:e,hour:n,minute:o,dayOfWeek:t.day_of_week?CN[PN.indexOf(t.day_of_week)]:null}),this.newSchedule=t}),_N(this,"setScheduleUntil",(e,t)=>{this.newSchedule={until:t}}),_N(this,"setWeekday",e=>{var t=e.target.value;this.setState({dayOfWeek:t}),this.newSchedule={day_of_week:t?PN[CN.indexOf(t)]:null}}),_N(this,"setUntilToggle",e=>{var t=e.target.value?Da()().format("YYYY-MM-DD"):null;this.setScheduleUntil(null,t)})}getState(){var e=Object(l.clone)(this.props.schedule||NN.defaultProps.schedule),t=e.time,a=e.interval,r=e.day_of_week,n=ob(a).interval,o=jN(t?nb(t).split(":"):[null,null],2);return{hour:o[0],minute:o[1],seconds:a,interval:n,dayOfWeek:r?CN[PN.indexOf(r)]:null,newSchedule:e}}get intervals(){var e={[Zf.NEVER]:[]};return this.props.refreshOptions.forEach(t=>{var a=ob(t),r=a.count,n=a.interval;n in e||(e[n]=[]),e[n].push([r,t])}),Object.defineProperty(this,"intervals",{value:e}),e}set newSchedule(e){this.setState(t=>({newSchedule:EN(t.newSchedule,e)}))}save(){var e=this.state.newSchedule;(()=>{var t=Object(l.omitBy)(e,l.isNil),a=Object(l.omitBy)(this.props.schedule,l.isNil);return!Object(l.isEqual)(t,a)})()&&(e.interval?this.props.dialog.close(Object(l.clone)(e)):this.props.dialog.close(null)),this.props.dialog.dismiss()}render(){var e=this.props.dialog,t=this.state,a=t.interval,r=t.minute,o=t.hour,i=t.seconds,s=t.newSchedule.until;return n.a.createElement(R.a,EN({},e.props,{title:window.W_L.auto_flush,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,className:"schedule",onOk:()=>this.save()}),n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,window.W_L.flush_hz),n.a.createElement("div",{"data-testid":"interval"},n.a.createElement(ln.a,{className:"input",value:i,onChange:this.setInterval,dropdownMatchSelectWidth:!1},n.a.createElement(xN,{value:null,key:"never"},window.W_L.flush_never),Object.keys(this.intervals).filter(e=>!Object(l.isEmpty)(this.intervals[e])).map(e=>n.a.createElement(LN,{label:Object(l.capitalize)(ib(e)),key:e},this.intervals[e].map(t=>{var a=jN(t,2),r=a[0],o=a[1];return n.a.createElement(xN,{value:o,key:"".concat(e,"-").concat(r)},lb(o))})))))),-1!==[Zf.DAYS,Zf.WEEKS].indexOf(a)?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,window.W_L.on_time),n.a.createElement("div",{"data-testid":"time"},n.a.createElement(kN,{defaultValue:o?Da()().hour(o).minute(r):null,onChange:this.setTime}))):null,Zf.WEEKS===a?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,window.W_L.on_day),n.a.createElement("div",{"data-testid":"weekday"},n.a.createElement(Bn.a.Group,{size:"medium",defaultValue:this.state.dayOfWeek,onChange:this.setWeekday},CN.map(e=>n.a.createElement(Bn.a.Button,{value:e,key:e,className:"input"},e[0]))))):null,a!==Zf.NEVER?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,window.W_L.ends),n.a.createElement("div",{className:"ends","data-testid":"ends"},n.a.createElement(Bn.a.Group,{size:"medium",value:!!s,onChange:this.setUntilToggle},n.a.createElement(Bn.a,{value:!1},window.W_L.never),n.a.createElement(Bn.a,{value:!0},window.W_L.on)),s?n.a.createElement(Ay.a,{size:"small",className:"datepicker",value:Da()(s),allowClear:!1,format:"YYYY-MM-DD",onChange:this.setScheduleUntil}):null)):null)}}_N(NN,"propTypes",{schedule:Mf,refreshOptions:ae.a.arrayOf(ae.a.number).isRequired,dialog:wa.isRequired}),_N(NN,"defaultProps",{schedule:zf});var AN=Oa(NN);function TN(e,t){var a=nx(e),n=px(e,t);return Object(r.useCallback)(()=>{if(a.canEdit&&a.canSchedule){var t=Y.queryRefreshIntervals,r=Z.getQueryRefreshIntervals(),o=Object(l.isArray)(r)?Object(l.intersection)(t,r):t;AN.showModal({schedule:e.schedule,refreshOptions:o}).onClose(t=>{Sa("edit_schedule","query",e.id),n({schedule:t})})}},[e.id,e.schedule,a.canEdit,a.canSchedule,n])}var WN={save:e=>B.post((e=>e.id?"api/visualizations/".concat(e.id):"api/visualizations")(e),e),delete:e=>B.delete("api/visualizations/".concat(e.id))};a(1563);function IN(){return(IN=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function qN(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return DN(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return DN(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function DN(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function RN(e){var t=e.dialog,a=e.visualization,o=e.query,i=e.queryResult,s=Object(r.useRef)(),c=!a,u=dw(i),d=qN(Object(r.useState)(u.filters),2),m=d[0],p=d[1],f=Object(r.useMemo)(()=>({columns:u.columns,rows:sw(u.rows,m)}),[u,m]),b=Object(r.useMemo)(()=>{var e=a?gp[a.type]:yp(),t=e.getOptions(c?{}:a.options,u);return{type:e.type,name:c?e.name:a.name,options:t,originalOptions:t}},[u,c,a]),h=qN(Object(r.useState)(b.type),2),g=h[0],y=h[1],v=qN(Object(r.useState)(b.name),2),w=v[0],O=v[1],E=qN(Object(r.useState)(!1),2),_=E[0],j=E[1],S=qN(Object(r.useState)(b.options),2),C=S[0],P=S[1],x=qN(Object(r.useState)(!1),2),L=x[0],k=x[1];function N(e){var t=gp[g];P(t.getOptions(e,u))}Object(r.useEffect)(()=>{s.current&&s.current.reset()},[u,C]);var A=c?Object(l.filter)(gp,e=>!e.isDeprecated):Object(l.pick)(gp,[g]),T=Se("visualization-type"),W=Se("visualization-name");return n.a.createElement(R.a,IN({},t.props,{wrapClassName:"ant-modal-fullscreen",title:window.W_L.edit_view,okText:window.W_L.save,cancelText:window.W_L.cancel,okButtonProps:{loading:L,disabled:L},onOk:function(){k(!0);var e=C;"TABLE"===g&&(e=Object(l.omit)(e,["paginationSize"])),function(e){return e.id?Sa("update","visualization",e.id,{type:e.type}):Sa("create","visualization",null,{type:e.type}),WN.save(e).then(e=>(of.success(window.W_L.view_save_success),e)).catch(e=>(of.error(window.W_L.view_save_failed),Promise.reject(e)))}(Object(l.extend)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e?hp[e]:yp();return{type:a.type,name:a.name,description:"",options:t}}(g),a,{name:w,options:e,query_id:o.id})).then(e=>{!function(e,t){var a=Object(l.findIndex)(e.visualizations,e=>e.id===t.id);a>-1?e.visualizations[a]=t:e.visualizations.push(t),e.visualizations=[...e.visualizations]}(o,e),t.close(e)})},onCancel:function(){var e,a=!Object(l.isEqual)(C,b.originalOptions);(e=_||a,new Promise((t,a)=>{e?R.a.confirm({title:window.W_L.edit_view,content:window.W_L.quit_with_not_save,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,onOk:()=>t(),onCancel:()=>a()}):t()})).then(t.dismiss)},wrapProps:{"data-test":"EditVisualizationDialog"}}),n.a.createElement("div",{className:"edit-visualization-dialog"},n.a.createElement("div",{className:"visualization-settings"},n.a.createElement("div",{className:"m-b-15"},n.a.createElement("label",{htmlFor:T},window.W_L.view_type),n.a.createElement(ln.a,{"data-test":"VisualizationType",id:T,className:"w-100",disabled:!c,value:g,onChange:function(e){y(e);var t=gp[e];_||O(t.name),P(t.getOptions(c?{}:a.options,u))}},Object(l.map)(A,e=>n.a.createElement(ln.a.Option,{key:e.type,"data-test":"VisualizationType."+e.type},e.name)))),n.a.createElement("div",{className:"m-b-15"},n.a.createElement("label",{htmlFor:W},window.W_L.view_name),n.a.createElement(ba.a,{"data-test":"VisualizationName",id:W,className:"w-100",value:w,onChange:e=>{return t=e.target.value,O(t),void j(t!==w);var t}})),n.a.createElement("div",{"data-test":"VisualizationEditor"},n.a.createElement(_w,{type:g,data:u,options:C,visualizationName:w,onOptionsChange:N}))),n.a.createElement("div",{className:"visualization-preview"},n.a.createElement("label",{htmlFor:"visualization-preview",className:"invisible hidden-xs"},window.W_L.preview),n.a.createElement(uw,{filters:m,onChange:p}),n.a.createElement("div",{className:"scrollbox","data-test":"VisualizationPreview"},n.a.createElement(Ew,{type:g,data:f,options:C,visualizationName:w,onOptionsChange:N})))))}RN.propTypes={dialog:wa.isRequired,query:ae.a.object.isRequired,visualization:$r,queryResult:ae.a.object.isRequired},RN.defaultProps={visualization:null};var MN=Oa(RN);function zN(e,t,a){var n=mw(a);return Object(r.useCallback)((function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=Object(l.find)(e.visualizations,{id:a})||null;MN.showModal({query:e,visualization:r,queryResult:t}).onClose(t=>{var a=Object(l.filter)(e.visualizations,e=>e.id!==t.id);n(Object(l.extend)(e.clone(),{visualizations:[...a,t]}),t)})}),[e,t,n])}function FN(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return VN(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return VN(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function VN(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function UN(e,t){var a=mw(t);return Object(r.useCallback)(t=>WN.delete({id:t}).then(()=>{var r=Object(l.filter)(e.visualizations,e=>e.id!==t);a(Object(l.extend)(e.clone(),{visualizations:r}))}).catch(()=>{of.error("Error deleting visualization.","Maybe it's used in a dashboard?")}),[e,a])}function BN(e,t){var a=px(e,t);return Object(r.useCallback)(t=>{Sa("edit_description","query",e.id),a({description:t})},[e.id,a])}function HN(e){return n.a.createElement("img",{src:"".concat("","/static/images/db-logos/").concat(e.type,".png"),width:"20",alt:e.alt})}function YN(e){var t=e.dataSource,a=e.children;return n.a.createElement(n.a.Fragment,null,n.a.createElement(HN,{type:t.type,"aria-label":t.name,title:t.name}),a||n.a.createElement("span",null,t.name))}function QN(e){return n.a.createElement(ln.a,{className:"w-100","data-test":"SelectDataSource",placeholder:"Choose data source...",value:e.value,disabled:e.disabled,loading:e.loading,optionFilterProp:"data-name",showSearch:!0,onChange:e.onChange},Object(l.map)(e.dataSources,e=>n.a.createElement(ln.a.Option,{key:"ds-".concat(e.id),value:e.id,"data-name":e.name,"data-test":"SelectDataSource".concat(e.id)},n.a.createElement(se,{name:"QuerySourceDropdownItem",dataSource:e}))))}HN.propTypes={type:ae.a.string,alt:ae.a.string},YN.propTypes={dataSource:ae.a.shape({name:ae.a.string,id:ae.a.oneOfType([ae.a.string,ae.a.number]),type:ae.a.string}).isRequired,children:ae.a.element},le("QuerySourceDropdownItem",YN),QN.propTypes={dataSources:ae.a.any,value:ae.a.oneOfType([ae.a.string,ae.a.number]),disabled:ae.a.bool,loading:ae.a.bool,onChange:ae.a.func},le("QuerySourceDropdown",QN);a(1564);function KN(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function $N(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?KN(Object(a),!0).forEach((function(t){GN(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):KN(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function GN(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function JN(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return XN(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return XN(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function XN(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ZN(e){var t,a=function(e){var t=Bk(Object(r.useState)(e),2),a=t[0],n=t[1],o=Bk(Object(r.useState)(e.query),2),i=o[0],s=o[1],c=Bk(Object(r.useState)(a.options.apply_auto_limit),2),u=c[0],d=c[1],m=px(a,e=>{e.id!==a.id&&Ea(e.getUrl(!0),!0),n(e),s(e.query),d(e.options.apply_auto_limit)});return Object(r.useMemo)(()=>({query:a,setQuery:n,isDirty:a.query!==i||!Object(l.isEmpty)(a.query)&&a.options.apply_auto_limit!==u,saveQuery:()=>m()}),[a,i,m,u])}(e.query),o=a.query,i=a.setQuery,s=a.isDirty,c=a.saveQuery,u=function(e){var t=bN(Object(r.useState)([]),2),a=t[0],n=t[1],o=bN(Object(r.useState)(!1),2),i=o[0],s=o[1],c=Object(r.useMemo)(()=>Object(l.filter)(a,t=>!t.view_only||t.id===e.data_source_id),[a,e.data_source_id]),u=Object(r.useMemo)(()=>Object(l.find)(c,t=>Object(l.toString)(t.id)===Object(l.toString)(e.data_source_id))||null,[e.data_source_id,c]);return Object(r.useEffect)(()=>{var e=!1;return ZC.query().then(t=>{e||(s(!0),n(t))}),()=>{e=!0}},[]),Object(r.useMemo)(()=>({dataSourcesLoaded:i,dataSources:c,dataSource:u}),[i,c,u])}(o),d=u.dataSourcesLoaded,p=u.dataSources,f=u.dataSource,b=JN(Object(r.useState)([]),2),h=b[0],g=b[1],y=nx(o,f),v=JN(vN(o),3),w=v[0],O=v[1],E=v[2],_=JN(Kk(o.visualizations),2),j=_[0],S=_[1],C=(t=f&&f.type,Rk(Rk({},zk.get(null)),zk.get(t))),P=C.QueryEditor,x=C.SchemaBrowser,L=!Jo()({minWidth:768});!function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(r.useRef)();t.current=e,Object(r.useEffect)(()=>{var e=window.W_L.leave_lost_warning,a="".concat(e,"\n")+window.W_L.leave_lost_confirm,r=window.onbeforeunload;window.onbeforeunload=function(){return t.current?e:void 0};var n=A.confirmChange((e,r)=>{if(t.current&&e.path!==r.path)return a});return()=>{window.onbeforeunload=r,n()}},[])}(s);var k=fN(o),N=k.queryResult,T=k.isExecuting,W=k.executionStatus,I=k.executeQuery,q=k.error,D=k.cancelCallback,R=k.isCancelling,M=k.updatedAt,z=k.loadedInitialResults,F=dw(N),V=Object(r.useRef)(null),U=JN(Jk(h),3),B=U[0],H=U[1],Y=U[2],Q=JN(rN(f,o,i),3),K=Q[0],$=Q[1],G=Q[2],J=JN(Object(Ml.a)(e=>{i(Object(l.extend)(o.clone(),{query:e}))},100),1)[0];Object(r.useEffect)(()=>{Sa("view_source","query",o.id)},[o.id]),Object(r.useEffect)(()=>{document.title=o.name},[o.name]);var X=px(o,i),Z=BN(o,i),ee=f?f.syntax||"sql":null,te=rx(ee),ae=Object(r.useCallback)(e=>{if(e)try{localStorage.setItem("lastSelectedDataSourceId",e)}catch(e){}if(o.data_source_id!==e){Sa("update_data_source","query",o.id,{dataSourceId:e});var t={data_source_id:e,latest_query_data_id:null,latest_query_data:null};i(Object(l.extend)(o.clone(),t)),X(t,{successMessage:null})}},[o,i,X]);Object(r.useEffect)(()=>{if(d&&y.isNew){var e=p.length>0?p[0].id:null;ae((t=[o.data_source_id,localStorage.getItem("lastSelectedDataSourceId"),e],a=p,a=Object(l.map)(a,e=>e.id),Object(l.find)(t,e=>Object(l.includes)(a,e))||null))}var t,a},[o.data_source_id,y.isNew,d,p,ae]);var re=TN(o,i),ne=function(e,t){var a=mw(t);return Object(r.useCallback)(()=>{Bv.showModal({parameter:{title:null,name:"",type:"text",value:null},existingParams:Object(l.map)(e.getParameters().get(),e=>e.name)}).onClose(t=>{var r=e.clone();t=r.getParameters().add(t),a(r,t)})},[e,a])}(o,(e,t)=>{V.current&&(V.current.paste(t.toQueryTextFragment()),V.current.focus()),i(e)}),oe=Object(r.useCallback)(e=>{V.current&&V.current.paste(e)},[]),ie=JN(Object(r.useState)(null),2),le=ie[0],ce=ie[1],ue=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];y.canExecute&&(e||!O&&!T)&&(s||!Object(l.isEmpty)(le)?I(null,()=>o.getQueryResultByText(0,le)):I())}),[o,y.canExecute,O,T,s,le,I]),de=JN(Object(r.useState)(!1),2),pe=de[0],fe=de[1],be=Object(r.useCallback)(()=>{pe||(fe(!0),c().finally(()=>fe(!1)))},[pe,c]),he=function(e,t,a,n){var o=nx(e),i=zN(e,t,n),l=FN(Object(r.useState)(!1),2),s=l[0],c=l[1];return Object(r.useEffect)(()=>{!o.isNew&&s&&(c(!1),i())},[o.isNew,s,i]),Object(r.useCallback)(()=>{o.isNew?(c(!0),a()):i()},[o.isNew,a,i])}(o,N,be,(e,t)=>{i(e),S(t.id)}),ge=zN(o,N,e=>i(e)),ye=UN(o,i);return n.a.createElement("div",{className:me()("query-page-wrapper",{"query-fixed-layout":!L})},n.a.createElement(Bx,{query:o,dataSourcesAvailable:!d||p.length>0}),n.a.createElement("div",{className:"container w-100 p-b-10"},n.a.createElement(Ax,{query:o,dataSource:f,sourceMode:!0,selectedVisualization:j,headerExtra:n.a.createElement(se,{name:"QuerySource.HeaderExtra",query:o}),onChange:i})),n.a.createElement("main",{className:"query-fullscreen"},n.a.createElement(ZP,{direction:"horizontal",sizeAttribute:"flex-basis",toggleShortcut:"Alt+Shift+D, Alt+D"},n.a.createElement("nav",null,d&&n.a.createElement("div",{className:"editor__left__data-source"},n.a.createElement(se,{name:"QuerySourceDropdown",dataSources:p,value:f?f.id:void 0,disabled:!y.canEdit||!d||0===p.length,loading:!d,onChange:ae})),n.a.createElement("div",{className:"editor__left__schema"},n.a.createElement(x,{dataSource:f,options:o.options.schemaOptions,onOptionsUpdate:e=>i(Object(l.extend)(o.clone(),{options:$N($N({},o.options),{},{schemaOptions:e})})),onSchemaUpdate:g,onItemSelect:oe})),!o.isNew()&&n.a.createElement("div",{className:"query-page-query-description"},n.a.createElement(YE,{isEditable:y.canEdit,markdown:!0,ignoreBlanks:!1,placeholder:window.W_L.new_desc,value:o.description,onDone:Z,multiline:!0})),!o.isNew()&&n.a.createElement(Tx,{layout:"table",query:o,onEditSchedule:re}))),n.a.createElement("div",{className:"content"},n.a.createElement("div",{className:"flex-fill p-relative"},n.a.createElement("div",{className:"p-absolute d-flex flex-column p-l-15 p-r-15",style:{left:0,top:0,right:0,bottom:0,overflow:"auto"}},n.a.createElement(ZP,{direction:"vertical",sizeAttribute:"flex-basis"},n.a.createElement("div",{className:"row editor"},n.a.createElement("section",{className:"query-editor-wrapper","data-test":"QueryEditor"},n.a.createElement(P,{ref:V,"data-executing":T?"true":null,syntax:f?f.syntax:null,value:o.query,schema:h,autocompleteEnabled:B&&H,onChange:J,onSelectionChange:ce}),n.a.createElement(P.Controls,{addParameterButtonProps:{title:window.W_L.new_params,shortcut:"mod+p",onClick:ne},formatButtonProps:{title:te?window.W_L.query_format:window.W_L.query_format_not_support,disabled:!f||!te,shortcut:te?"mod+shift+f":null,onClick:()=>{try{var e=(t=o.query,rx(a=ee)?(0,ax[a])(t):t);i(Object(l.extend)(o.clone(),{query:e}))}catch(e){of.error(String(e))}var t,a}},saveButtonProps:y.canEdit&&{text:n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"hidden-xs"},window.W_L.save),s&&!pe?"*":null),shortcut:"mod+s",onClick:be,loading:pe},executeButtonProps:{disabled:!y.canExecute||T||O,shortcut:"mod+enter, alt+enter, ctrl+enter, shift+enter",onClick:ue,text:n.a.createElement("span",{className:"hidden-xs"},null===le?window.W_L.exec_query:window.W_L.exec_select_query)},autocompleteToggleProps:{available:B,enabled:H,onToggle:Y},autoLimitCheckboxProps:{available:K,checked:$,onChange:G},dataSourceSelectorProps:!!f&&{disabled:!y.canEdit,value:f.id,onChange:ae,options:Object(l.map)(p,e=>({value:e.id,label:e.name}))}})))),!y.isNew&&n.a.createElement(Tx,{layout:"horizontal",query:o,onEditSchedule:re}),n.a.createElement("section",{className:"query-results-wrapper"},o.hasParameters()&&n.a.createElement("div",{className:"query-parameters-wrapper"},n.a.createElement(Qv,{editable:y.canEdit,sortable:y.canEdit,disableUrlUpdate:y.isNew,parameters:w,onPendingValuesChange:()=>E(),onValuesChange:()=>{E(!1),ue(!0)},onParametersEdit:()=>{s||c()}})),(q||T)&&n.a.createElement("div",{className:"query-alerts"},n.a.createElement(Ux,{status:W,updatedAt:M,error:q,isCancelling:R,onCancel:D})),n.a.createElement(n.a.Fragment,null,F.log.length>0&&n.a.createElement("div",{className:"query-results-log"},n.a.createElement("p",null,"Log Information:"),Object(l.map)(F.log,(e,t)=>n.a.createElement("p",{key:"log-line-".concat(t),className:"query-log-line"},e))),z&&!(y.isNew&&!N)&&n.a.createElement(Vx,{queryResult:N,visualizations:o.visualizations,showNewVisualizationButton:y.canEdit&&F.status===Ja,canDeleteVisualizations:y.canEdit,selectedTab:j,onChangeTab:S,onAddVisualization:he,onDeleteVisualization:ye,refreshButton:n.a.createElement(m.a,{type:"primary",disabled:!y.canExecute||O,loading:T,onClick:ue},!T&&n.a.createElement("i",{className:"zmdi zmdi-refresh m-r-5","aria-hidden":"true"}),window.W_L.flush)}))))),N&&!N.getError()&&n.a.createElement("div",{className:"bottom-controller-container"},n.a.createElement(wL,{query:o,queryResult:N,selectedVisualization:j,isQueryExecuting:T,showEditVisualizationButton:!y.isNew&&y.canEdit,onEditVisualization:ge})))))}ZN.propTypes={query:ae.a.object.isRequired};var eA=$x(ZN);yf.register("Queries.New",pa({path:"/queries/new",render:e=>n.a.createElement(eA,e),bodyClass:"fixed-layout"})),yf.register("Queries.Edit",pa({path:"/queries/:queryId/source",render:e=>n.a.createElement(eA,e),bodyClass:"fixed-layout"}));var tA=a(695),aA=a.n(tA),rA=a(694),nA=a.n(rA);function oA(){return(oA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function iA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function sA(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function cA(e){var t=e.title,a=e.shortcut,o=e.disabled,i=e.children,l=e.onClick,s=sA(e,["title","shortcut","disabled","children","onClick"]),c=iA(Object(r.useState)(!1),2),u=c[0],d=c[1],p=Object(r.useMemo)(()=>({onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1)}),[]);return Object(r.useEffect)(()=>{o&&d(!1)},[o]),Object(r.useEffect)(()=>{if(a){var e={[a]:l};return jy.bind(e),()=>{jy.unbind(e)}}},[a,l]),n.a.createElement(rk,{title:t,shortcut:a,visible:u},n.a.createElement("span",p,n.a.createElement(m.a,oA({"data-test":"ExecuteButton",disabled:o,onClick:l,style:o?{pointerEvents:"none"}:{}},s),i)))}cA.propTypes={className:ae.a.string,shortcut:ae.a.string,disabled:ae.a.bool,children:ae.a.node,onClick:ae.a.func},cA.defaultProps={className:null,shortcut:null,disabled:!1,children:null,onClick:()=>{}};a(1565);function uA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return dA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function mA(e){var t=uA(Object(r.useState)(e.query),2),a=t[0],o=t[1],i=uA(Object(r.useState)(),2),l=i[0],s=i[1],c=nx(a,l),u=uA(vN(a),3),d=u[0],p=u[1],f=u[2],b=uA(Kk(a.visualizations),2),h=b[0],g=b[1],y=Jo()({minWidth:768}),v=Jo()({minHeight:500})&&y,w=uA(CE(),2),O=w[0],E=w[1],_=uA(Object(r.useState)(!1),2),j=_[0],S=_[1],C=fN(a),P=C.queryResult,x=C.loadedInitialResults,L=C.isExecuting,k=C.executionStatus,N=C.executeQuery,A=C.error,T=C.cancelCallback,W=C.isCancelling,I=C.updatedAt,q=dw(P),D=BN(a,o),R=TN(a,o),M=zN(a,P,(e,t)=>{o(e),g(t.id)}),z=zN(a,P,e=>o(e)),F=UN(a,o),V=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];c.canExecute&&(e||!p&&!L)&&N()}),[p,N,L,c.canExecute]);return Object(r.useEffect)(()=>{document.title=a.name},[a.name]),Object(r.useEffect)(()=>{ZC.get({id:a.data_source_id}).then(s)},[a.data_source_id]),n.a.createElement("div",{className:me()("query-page-wrapper",{"query-view-fullscreen":O,"query-fixed-layout":v})},n.a.createElement("div",{className:"container w-100"},n.a.createElement(Ax,{query:a,dataSource:l,onChange:o,selectedVisualization:h,headerExtra:n.a.createElement(se,{name:"QueryView.HeaderExtra",query:a},Z.canRun(a)&&n.a.createElement(cA,{className:"m-r-5",type:"primary",shortcut:"mod+enter, alt+enter, ctrl+enter",disabled:!c.canExecute||L||p,onClick:V},window.W_L.flush)),tagsExtra:!a.description&&c.canEdit&&!j&&!O&&n.a.createElement(be,{className:"label label-tag hidden-xs",role:"none",onClick:()=>S(!0)},n.a.createElement("i",{className:"zmdi zmdi-plus m-r-5","aria-hidden":"true"}),window.W_L.new_desc)}),(a.description||j)&&n.a.createElement("div",{className:me()("m-t-5",{hidden:O})},n.a.createElement(YE,{className:"w-100",value:a.description,isEditable:c.canEdit,onDone:D,onStopEditing:()=>S(!1),placeholder:"Add description",ignoreBlanks:!1,editorProps:{autoSize:{minRows:2,maxRows:4}},defaultEditing:j,multiline:!0}))),n.a.createElement("div",{className:"query-view-content"},a.hasParameters()&&n.a.createElement("div",{className:me()("bg-white tiled p-15 m-t-15 m-l-15 m-r-15",{hidden:O})},n.a.createElement(Qv,{parameters:d,onValuesChange:()=>{f(!1),V(!0)},onPendingValuesChange:()=>f()})),n.a.createElement("div",{className:"query-results m-t-15"},x&&n.a.createElement(Vx,{queryResult:P,visualizations:a.visualizations,showNewVisualizationButton:c.canEdit&&q.status===Ja,canDeleteVisualizations:c.canEdit,selectedTab:h,onChangeTab:g,onAddVisualization:M,onDeleteVisualization:F,refreshButton:Z.canRun(a)&&n.a.createElement(m.a,{type:"primary",disabled:!c.canExecute||p,loading:L,onClick:V},!L&&n.a.createElement("i",{className:"zmdi zmdi-refresh m-r-5","aria-hidden":"true"}),window.W_L.flush_now),canRefresh:Z.canRun(a)}),n.a.createElement("div",{className:"query-results-footer"},P&&!P.getError()&&n.a.createElement(wL,{query:a,queryResult:P,selectedVisualization:h,isQueryExecuting:L,showEditVisualizationButton:c.canEdit,onEditVisualization:z,extraActions:n.a.createElement(cA,{className:"icon-button m-r-5 hidden-xs",title:window.W_L.toggle_screen,type:"default",shortcut:"alt+f",onClick:E},O?n.a.createElement(nA.a,null):n.a.createElement(aA.a,null))}),(A||L)&&n.a.createElement("div",{className:"query-execution-status"},n.a.createElement(Ux,{status:k,error:A,isCancelling:W,onCancel:T,updatedAt:I})))),n.a.createElement("div",{className:me()("p-t-15 p-r-15 p-l-15",{hidden:O})},n.a.createElement(Tx,{layout:"horizontal",query:a,dataSource:l,onEditSchedule:R}))))}mA.propTypes={query:ae.a.object.isRequired};var pA=$x(mA);function fA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return bA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function hA(e){var t=e.queryName,a=e.queryDescription,r=e.visualization;return n.a.createElement("div",{className:"embed-heading p-b-10 p-r-15 p-l-15"},n.a.createElement("h3",null,n.a.createElement("img",{src:vt.a,alt:"Holmes Logo",style:{height:"24px",verticalAlign:"text-bottom"}}),n.a.createElement(Xv,{visualization:r})," ",t,a&&n.a.createElement("small",null,n.a.createElement(We,{className:"markdown text-muted"},Ie.markdown.toHTML(a||"")))))}function gA(e){var t=e.query,a=e.queryResults,r=e.updatedAt,o=e.refreshStartedAt,i=e.queryUrl,l=e.hideTimestamp,s=e.apiKey,c=n.a.createElement(ue.a,null,n.a.createElement(ue.a.Item,null,n.a.createElement(bL,{fileType:"csv",query:t,queryResult:a,apiKey:s,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(mL.a,null)," ",window.W_L.save_as_csv)),n.a.createElement(ue.a.Item,null,n.a.createElement(bL,{fileType:"tsv",query:t,queryResult:a,apiKey:s,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(mL.a,null)," ",window.W_L.save_as_tsv)),n.a.createElement(ue.a.Item,null,n.a.createElement(bL,{fileType:"xlsx",query:t,queryResult:a,apiKey:s,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(fL.a,null),window.W_L.save_as_excel)));return n.a.createElement("div",{className:"tile__bottom-control"},!l&&n.a.createElement("span",null,n.a.createElement("span",{className:"small hidden-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",o?n.a.createElement(Gv,{from:o}):n.a.createElement(Gf,{date:r})),n.a.createElement("span",{className:"small visible-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",ab(r))),i&&n.a.createElement("span",{className:"hidden-print"},n.a.createElement(we,{title:window.W_L.open_in_redash},n.a.createElement(g.Button,{className:"icon-button",href:i,target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Open in Tap"))),!t.hasParameters()&&n.a.createElement(aa.a,{overlay:c,disabled:!a,trigger:["click"],placement:"topLeft"},n.a.createElement(m.a,{loading:!a&&!!o,className:"m-l-5"},window.W_L.save_as,n.a.createElement("i",{className:"fa fa-caret-up m-l-5","aria-hidden":"true"})))))}function yA(e){var t=e.queryId,a=e.visualizationId,o=e.apiKey,i=e.onError,s=fA(Object(r.useState)(null),2),c=s[0],u=s[1],d=fA(Object(r.useState)(null),2),m=d[0],p=d[1],f=fA(Object(r.useState)(null),2),b=f[0],h=f[1],g=fA(Object(r.useState)(null),2),y=g[0],v=g[1],w=mw(i);Object(r.useEffect)(()=>{var e=!1;return pr.get({id:t}).then(t=>{e||u(t)}).catch(w),()=>{e=!0}},[t,w]);var O=Object(r.useCallback)(()=>{c&&(p(null),h(Da()()),c.getQueryResultPromise().then(e=>{v(e)}).catch(e=>{p(e.getError())}).finally(()=>h(null)))},[c]);if(Object(r.useEffect)(()=>{document.querySelector("body").classList.add("headless"),O()},[O]),!c)return null;var E=Object(l.has)(A.search,"hide_header"),_=Object(l.has)(A.search,"hide_parameters"),j=Object(l.has)(A.search,"hide_link"),S=Object(l.has)(A.search,"hide_timestamp"),C=Object(l.has)(A.search,"showDescription");a=parseInt(a,10);var P=Object(l.find)(c.visualizations,e=>e.id===a);return P?n.a.createElement("div",{className:"tile m-t-10 m-l-10 m-r-10 p-t-10 embed__vis","data-test":"VisualizationEmbed"},!E&&n.a.createElement(hA,{queryName:c.name,queryDescription:C?c.description:null,visualization:P}),n.a.createElement("div",{className:"col-md-12 query__vis"},!_&&c.hasParameters()&&n.a.createElement("div",{className:"p-t-15 p-b-10"},n.a.createElement(Qv,{parameters:c.getParametersDefs(),onValuesChange:O})),m&&n.a.createElement("div",{className:"alert alert-danger","data-test":"ErrorMessage"},"Error: ".concat(m)),!m&&y&&n.a.createElement(kw,{visualization:P,queryResult:y,context:"widget"}),!y&&b&&n.a.createElement("div",{className:"d-flex justify-content-center"},n.a.createElement("div",{className:"spinner"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin zmdi-hc-5x","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Refreshing...")))),n.a.createElement(gA,{query:c,queryResults:y,updatedAt:y?y.getUpdatedAt():void 0,refreshStartedAt:b,queryUrl:j?null:c.getUrl(),hideTimestamp:S,apiKey:o})):(setTimeout(()=>{i(new Error(window.W_L.view_not_exist))},10),null)}function vA(){return(vA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function wA(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function OA(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?wA(Object(a),!0).forEach((function(t){EA(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):wA(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function EA(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _A(e){var t=e.querySnippet,a=e.dialog,o=e.readOnly,i=Object(r.useCallback)((e,r,n)=>{var o=Object(l.get)(t,"id");Object(l.isNil)(e.description)&&(e.description=""),a.close(o?OA({id:o},e):e).then(()=>r(window.W_L.save_success)).catch(()=>n(window.W_L.save_failed))},[a,t]),s=!!Object(l.get)(t,"id"),c=[{name:"trigger",title:window.W_L.code,type:"text",required:!0,autoFocus:!s},{name:"description",title:window.W_L.desc,type:"text"},{name:"snippet",title:window.W_L.query_code,type:"ace",required:!0}].map(e=>OA(OA({},e),{},{readOnly:o,initialValue:Object(l.get)(t,e.name,"")})),u=Se("querySnippetForm");return n.a.createElement(R.a,vA({},a.props,{title:s?t.trigger:window.W_L.create_query,footer:[n.a.createElement(m.a,vA({key:"cancel"},a.props.cancelButtonProps,{onClick:a.dismiss}),o?window.W_L.close:window.W_L.cancel),!o&&n.a.createElement(m.a,vA({key:"submit"},a.props.okButtonProps,{disabled:o||a.props.okButtonProps.disabled,htmlType:"submit",type:"primary",form:u,"data-test":"SaveQuerySnippetButton"}),s?window.W_L.save:window.W_L.create)],wrapProps:{"data-test":"QuerySnippetDialog"}}),n.a.createElement(RC,{id:u,fields:c,onSubmit:i,hideSubmitButton:!0,feedbackIcons:!0}))}yf.register("Queries.View",pa({path:"/queries/:queryId",render:e=>n.a.createElement(pA,e)})),hA.propTypes={queryName:ae.a.string.isRequired,queryDescription:ae.a.string,visualization:$r.isRequired},hA.defaultProps={queryDescription:""},gA.propTypes={query:ae.a.object.isRequired,queryResults:ae.a.object,updatedAt:ae.a.string,refreshStartedAt:Qf,queryUrl:ae.a.string,hideTimestamp:ae.a.bool,apiKey:ae.a.string},gA.defaultProps={queryResults:null,updatedAt:null,refreshStartedAt:null,queryUrl:null,hideTimestamp:!1,apiKey:null},yA.propTypes={queryId:ae.a.string.isRequired,visualizationId:ae.a.string,apiKey:ae.a.string.isRequired,onError:ae.a.func},yA.defaultProps={onError:()=>{}},yf.register("Visualizations.ViewShared",MS({path:"/embed/query/:queryId/visualization/:visualizationId",render:e=>n.a.createElement(yA,e),getApiKey:()=>A.search.api_key})),_A.propTypes={dialog:wa.isRequired,querySnippet:ae.a.object,readOnly:ae.a.bool},_A.defaultProps={querySnippet:null,readOnly:!1};var jA=Oa(_A);a(1570);function SA(){return(SA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function CA(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var PA=e=>H.isAdmin||H.id===Object(l.get)(e,"user.id");class xA extends n.a.Component{constructor(){var e;super(...arguments),e=this,CA(this,"listColumns",[yb.custom.sortable((e,t)=>n.a.createElement(be,{type:"link",className:"table-main-title",onClick:()=>this.showSnippetDialog(t)},t.trigger),{title:window.W_L.snippet_script,field:"trigger",className:"text-nowrap"}),yb.custom.sortable(e=>e,{title:window.W_L.desc,field:"description",className:"text-nowrap"}),yb.custom(e=>n.a.createElement("code",{className:"snippet-content"},e),{title:window.W_L.script,field:"snippet"}),yb.avatar({field:"user",className:"p-l-0 p-r-0"},e=>window.W_L.create_user+" ".concat(e)),yb.date.sortable({title:window.W_L.create_time,field:"created_at",className:"text-nowrap",width:"1%"}),yb.custom((e,t)=>PA(t)&&n.a.createElement(m.a,{type:"danger",className:"w-100",onClick:e=>this.deleteQuerySnippet(e,t)},window.W_L.delete),{width:"1%"})]),CA(this,"saveQuerySnippet",e=>(e.id?XL.save:XL.create)(e)),CA(this,"deleteQuerySnippet",(e,t)=>{R.a.confirm({title:window.W_L.delete_snippet_script,content:window.W_L.delete_snippet_script_confirm,okText:window.W_L.ok_text,okType:"danger",cancelText:window.W_L.cancel,onOk:()=>{XL.delete(t).then(()=>{of.success(window.W_L.delete_snippet_script_success),this.props.controller.update()}).catch(()=>{of.error(window.W_L.delete_snippet_script_failed)})}})}),CA(this,"showSnippetDialog",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=!t||PA(t);Ea("query_snippets/"+Object(l.get)(t,"id","new"),!0);var r=()=>Ea("query_snippets",!0);jA.showModal({querySnippet:t,readOnly:!a}).onClose(t=>e.saveQuerySnippet(t).then(()=>{e.props.controller.update(),r()})).onDismiss(r)}))}componentDidMount(){var e=this.props.controller.params,t=e.isNewOrEditPage,a=e.querySnippetId;t&&("new"===a?Z.isCreateQuerySnippetEnabled()?this.showSnippetDialog():Ea("query_snippets",!0):XL.get({id:a}).then(this.showSnippetDialog).catch(e=>{this.props.controller.handleError(e)}))}render(){var e=this.props.controller;return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(m.a,{type:"primary",onClick:()=>this.showSnippetDialog(),disabled:!Z.isCreateQuerySnippetEnabled()},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.new_snippet_script)),!e.isLoaded&&n.a.createElement(Ch,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},window.W_L.no_snippet_script,Z.isCreateQuerySnippetEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(be,{type:"link",onClick:()=>this.showSnippetDialog()},window.W_L.new_snippet_script)," ")),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive query-snippets-table"},n.a.createElement(vb,{items:e.pageItems,columns:this.listColumns,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Db,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}CA(xA,"propTypes",{controller:nh.isRequired});var LA=KC("QuerySnippets.List",{permission:"create_query",title:window.W_L.snippet_script,path:"query_snippets",order:5},oh(xA,()=>new wh({isPlainList:!0,getRequest:()=>({}),getResource:()=>XL.query.bind(XL)}),()=>new _h({orderByField:"trigger",itemsPerPage:10})));yf.register("QuerySnippets.List",pa({path:"/query_snippets",title:window.W_L.snippet_script,render:e=>n.a.createElement(LA,SA({},e,{currentPage:"query_snippets"}))})),yf.register("QuerySnippets.NewOrEdit",pa({path:"/query_snippets/:querySnippetId",title:window.W_L.snippet_script,render:e=>n.a.createElement(LA,SA({},e,{currentPage:"query_snippets",isNewOrEditPage:!0}))}));a(1571);function kA(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function NA(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?kA(Object(a),!0).forEach((function(t){AA(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kA(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function AA(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function TA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return WA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return WA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function WA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function IA(e){var t=e.onError,a=TA(Object(r.useState)({}),2),n=a[0],o=a[1],i=TA(Object(r.useState)({}),2),s=i[0],c=i[1],u=TA(Object(r.useState)(!0),2),d=u[0],m=u[1],p=TA(Object(r.useState)(!1),2),f=p[0],b=p[1],h=mw(t);Object(r.useEffect)(()=>{Sa("view","page","org_settings");var e=!1;return lf().then(t=>{if(!e){var a=Object(l.get)(t,"settings");o(a),c(NA({},a)),m(!1)}}).catch(t=>{e||h(t)}),()=>{e=!0}},[h]);var g=Object(r.useCallback)(e=>{c(t=>NA(NA({},t),e))},[]),y=Object(r.useCallback)(()=>{f||(b(!0),sf(s).then(e=>{var t,a=Object(l.get)(e,"settings");o(a),c(NA({},a)),t={dateFormat:s.date_format,timeFormat:s.time_format,dateTimeFormat:"".concat(s.date_format," ").concat(s.time_format)},Object(l.extend)(Y,t)}).catch(h).finally(()=>b(!1)))},[f,s,h]);return{settings:n,currentValues:s,isLoading:d,isSaving:f,handleSubmit:y,handleChange:g}}var qA={settings:ae.a.object,values:ae.a.object,onChange:ae.a.func,loading:ae.a.bool},DA={settings:{},values:{},onChange:()=>{},loading:!1};function RA(){return(RA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function MA(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(se,RA({name:"OrganizationSettings.FormatSettings"},e),n.a.createElement(ag.a.Item,{label:window.W_L.date_format},r?n.a.createElement(If.a.Input,{style:{width:300},active:!0}):n.a.createElement(ln.a,{value:t.date_format,onChange:e=>a({date_format:e}),"data-test":"DateFormatSelect"},Y.dateFormatList.map(e=>n.a.createElement(ln.a.Option,{key:e,"data-test":"DateFormatSelect:".concat(e)},e)))),n.a.createElement(ag.a.Item,{label:window.W_L.time_format},r?n.a.createElement(If.a.Input,{style:{width:300},active:!0}):n.a.createElement(ln.a,{value:t.time_format,onChange:e=>a({time_format:e}),"data-test":"TimeFormatSelect"},Y.timeFormatList.map(e=>n.a.createElement(ln.a.Option,{key:e},e)))))}function zA(){return(zA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function FA(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(se,zA({name:"OrganizationSettings.PlotlySettings"},e),n.a.createElement(ag.a.Item,{label:window.W_L.hidden_tool_bar+"(Chart)"},r?n.a.createElement(If.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(dn.a,{name:"hide_plotly_mode_bar",checked:t.hide_plotly_mode_bar,onChange:e=>a({hide_plotly_mode_bar:e.target.checked})},window.W_L.hidden_tool_bar)))}MA.propTypes=qA,MA.defaultProps=DA,FA.propTypes=qA,FA.defaultProps=DA;var VA=a(204),UA=a.n(VA);function BA(){return(BA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function HA(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(se,BA({name:"OrganizationSettings.FeatureFlagsSettings"},e),n.a.createElement(ag.a.Item,{label:window.W_L.feature_flags},r?n.a.createElement(n.a.Fragment,null,n.a.createElement(UA.a,null,n.a.createElement(If.a,{title:!1,paragraph:{width:[300,300,300],rows:3},active:!0}))):n.a.createElement(n.a.Fragment,null,n.a.createElement(se,BA({name:"OrganizationSettings.FeatureFlagsSettings.PermissionsControl"},e),n.a.createElement(UA.a,null,n.a.createElement(dn.a,{name:"feature_show_permissions_control",checked:t.feature_show_permissions_control,onChange:e=>a({feature_show_permissions_control:e.target.checked})},window.W_L.enable_multiple_owners_tip))),n.a.createElement(UA.a,null,n.a.createElement(dn.a,{name:"send_email_on_failed_scheduled_queries",checked:t.send_email_on_failed_scheduled_queries,onChange:e=>a({send_email_on_failed_scheduled_queries:e.target.checked})},window.W_L.when_query_error_info_by_email)),n.a.createElement(UA.a,null,n.a.createElement(dn.a,{name:"multi_byte_search_enabled",checked:t.multi_byte_search_enabled,onChange:e=>a({multi_byte_search_enabled:e.target.checked})},window.W_L.dashboard_language_tip)))))}function YA(){return(YA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function QA(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(se,YA({name:"OrganizationSettings.BeaconConsentSettings"},e),n.a.createElement(ag.a.Item,{label:n.a.createElement("span",null,window.W_L.help_share_anonymous_data,n.a.createElement($e,{className:"m-l-5 m-r-5",type:"USAGE_DATA_SHARING"}))},r?n.a.createElement(If.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(dn.a,{name:"beacon_consent",checked:t.beacon_consent,onChange:e=>a({beacon_consent:e.target.checked})},window.W_L.help_redash_improve_tip)))}function KA(){return(KA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function $A(e){return n.a.createElement(se,KA({name:"OrganizationSettings.GeneralSettings"},e),n.a.createElement("h3",{className:"m-t-0"},window.W_L.params),n.a.createElement("hr",null),n.a.createElement(MA,e),n.a.createElement(FA,e),n.a.createElement(HA,e),n.a.createElement(QA,e))}function GA(){return(GA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function JA(e){var t=e.settings,a=e.values,r=e.onChange,o=e.loading,i=!Y.googleLoginEnabled&&!Y.ldapLoginEnabled&&!a.auth_saml_enabled;return n.a.createElement(se,GA({name:"OrganizationSettings.PasswordLoginSettings"},e),!o&&!t.auth_password_login_enabled&&n.a.createElement(u.a,{message:window.W_L.disable_password_tip,type:"warning",className:"m-t-15 m-b-15"}),n.a.createElement(ag.a.Item,{label:window.W_L.password_login},o?n.a.createElement(If.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(dn.a,{checked:a.auth_password_login_enabled,disabled:i,onChange:e=>r({auth_password_login_enabled:e.target.checked})},n.a.createElement(we,{title:i?window.W_L.enable_password_login_tip:null,placement:"right"},window.W_L.enable_password))))}function XA(){return(XA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ZA(e){var t=e.values,a=e.onChange;return Y.googleLoginEnabled?n.a.createElement(se,XA({name:"OrganizationSettings.GoogleLoginSettings"},e),n.a.createElement("h4",null,window.W_L.google_login),n.a.createElement(ag.a.Item,{label:"{window.W_L.allow} Google Apps Domains"},n.a.createElement(ln.a,{mode:"tags",value:t.auth_google_apps_domains,onChange:e=>a({auth_google_apps_domains:e})}),!Object(l.isEmpty)(t.auth_google_apps_domains)&&n.a.createElement(u.a,{message:n.a.createElement("p",null,window.W_L.google_login_tip,n.a.createElement("strong",null,Object(l.join)(t.auth_google_apps_domains,", ")),window.W_L.google_login_auto_reg),className:"m-t-15"}))):null}function eT(){return(eT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function tT(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(se,eT({name:"OrganizationSettings.SAMLSettings"},e),n.a.createElement("h4",null,"SAML"),n.a.createElement(ag.a.Item,{label:window.W_L.enable_saml},r?n.a.createElement(If.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(Bn.a.Group,{onChange:e=>{var t={auth_saml_enabled:!!e.target.value};e.target.value&&(t.auth_saml_type=e.target.value),a(t)},value:t.auth_saml_enabled&&(t.auth_saml_type||"dynamic")},n.a.createElement(Bn.a,{value:!1},window.W_L.disable),n.a.createElement(Bn.a,{value:"static"},window.W_L.enable,"(",window.W_L.static,")"),n.a.createElement(Bn.a,{value:"dynamic"},window.W_L.enable,"(",window.W_L.dynamic,")"))),t.auth_saml_enabled&&n.a.createElement(n.a.Fragment,null,"static"===t.auth_saml_type&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ag.a.Item,{label:"SAML Single Sign-on URL"},n.a.createElement(ba.a,{value:t.auth_saml_sso_url,onChange:e=>a({auth_saml_sso_url:e.target.value})})),n.a.createElement(ag.a.Item,{label:"SAML Entity ID"},n.a.createElement(ba.a,{value:t.auth_saml_entity_id,onChange:e=>a({auth_saml_entity_id:e.target.value})})),n.a.createElement(ag.a.Item,{label:"SAML x509 cert"},n.a.createElement(ba.a,{value:t.auth_saml_x509_cert,onChange:e=>a({auth_saml_x509_cert:e.target.value})}))),"dynamic"===t.auth_saml_type&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ag.a.Item,{label:"SAML Metadata URL"},n.a.createElement(ba.a,{value:t.auth_saml_metadata_url,onChange:e=>a({auth_saml_metadata_url:e.target.value})})),n.a.createElement(ag.a.Item,{label:"SAML Entity ID"},n.a.createElement(ba.a,{value:t.auth_saml_entity_id,onChange:e=>a({auth_saml_entity_id:e.target.value})})),n.a.createElement(ag.a.Item,{label:"SAML NameID Format"},n.a.createElement(ba.a,{value:t.auth_saml_nameid_format,onChange:e=>a({auth_saml_nameid_format:e.target.value})})))))}function aT(){return(aT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function rT(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function nT(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?rT(Object(a),!0).forEach((function(t){oT(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):rT(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function oT(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function iT(e){var t=e.values,a=e.onChange,o=Object(r.useCallback)(e=>{var r=nT(nT({},t),e);!Y.googleLoginEnabled&&!Y.ldapLoginEnabled&&!r.auth_saml_enabled&&(e=nT(nT({},e),{},{auth_password_login_enabled:!0})),a(e)},[t,a]);return n.a.createElement(se,aT({name:"OrganizationSettings.AuthSettings"},e),n.a.createElement("h3",{className:"m-t-0"},window.W_L.authentication," ",n.a.createElement($e,{type:"AUTHENTICATION_OPTIONS"})),n.a.createElement("hr",null),n.a.createElement(JA,aT({},e,{onChange:o})),n.a.createElement(ZA,aT({},e,{onChange:o})),n.a.createElement(tT,aT({},e,{onChange:o})))}function lT(){return(lT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function sT(e){var t=IA(e.onError),a=t.settings,r=t.currentValues,o=t.isLoading,i=t.isSaving,l=t.handleSubmit,s=t.handleChange;return n.a.createElement("div",{className:"row","data-test":"OrganizationSettings"},n.a.createElement("div",{className:"m-r-20 m-l-20"},n.a.createElement(ag.a,lT({},{labelCol:{xs:{span:24},sm:{span:6},lg:{span:4}},wrapperCol:{xs:{span:24},sm:{span:12},lg:{span:10}},layout:"horizontal",className:"ant-form-horizontal--labels-left"},{onFinish:l}),n.a.createElement($A,{loading:o,settings:a,values:r,onChange:s}),n.a.createElement(iT,{loading:o,settings:a,values:r,onChange:s}),n.a.createElement(ag.a.Item,{wrapperCol:{xs:{span:24},sm:{span:12,offset:6},lg:{span:12,offset:4}}},o?n.a.createElement(If.a.Button,{active:!0}):n.a.createElement(m.a,{type:"primary",htmlType:"submit",loading:i,"data-test":"OrganizationSettingsSaveButton"},window.W_L.save)))))}HA.propTypes=qA,HA.defaultProps=DA,QA.propTypes=qA,QA.defaultProps=DA,JA.propTypes=qA,JA.defaultProps=DA,ZA.propTypes=qA,ZA.defaultProps=DA,tT.propTypes=qA,tT.defaultProps=DA,iT.propTypes=qA,iT.defaultProps=DA,sT.propTypes={onError:ae.a.func},sT.defaultProps={onError:()=>{}};var cT=KC("Settings.Organization",{permission:"admin",title:window.W_L.sys_setting,path:"settings/general",order:6},sT);function uT(e){var t=new URL(e,window.location);return t.protocol=window.location.protocol,t.host=window.location.host,t.toString()}function dT(){return(dT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function mT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pT(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pT(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pT(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}yf.register("Settings.Organization",pa({path:"/settings/general",title:window.W_L.sys_setting,render:e=>n.a.createElement(cT,e)}));var fT=[{required:!0,name:"name",title:window.W_L.user_name,type:"text",autoFocus:!0},{required:!0,name:"email",title:"Email",type:"email"}];function bT(e){var t=e.dialog,a=mT(Object(r.useState)(null),2),o=a[0],i=a[1];Object(r.useEffect)(()=>{Sa("view","page","users/new")},[]);var l=Object(r.useCallback)(e=>t.close(e).catch(i),[t]),s=Se("userForm");return n.a.createElement(R.a,dT({},t.props,{title:window.W_L.create_user,footer:[n.a.createElement(m.a,dT({key:"cancel"},t.props.cancelButtonProps,{onClick:t.dismiss}),window.W_L.cancel),n.a.createElement(m.a,dT({key:"submit"},t.props.okButtonProps,{htmlType:"submit",type:"primary",form:s,"data-test":"SaveUserButton"}),window.W_L.create)],wrapProps:{"data-test":"CreateUserDialog"}}),n.a.createElement(RC,{id:s,fields:fT,onSubmit:l,hideSubmitButton:!0}),o&&n.a.createElement(u.a,{message:o.message,type:"error",showIcon:!0,"data-test":"CreateUserErrorAlert"}))}bT.propTypes={dialog:wa.isRequired};var hT=Oa(bT);function gT(){return(gT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function yT(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function vT(e){var t=e.user,a=e.enableUser,r=e.disableUser,o=e.deleteUser;return t.id===H.id?null:t.is_invitation_pending?n.a.createElement(m.a,{type:"danger",className:"w-100",onClick:e=>o(e,t)},window.W_L.delete):t.is_disabled?n.a.createElement(m.a,{type:"primary",className:"w-100",onClick:e=>a(e,t)},window.W_L.enable):n.a.createElement(m.a,{className:"w-100",onClick:e=>r(e,t)},window.W_L.disable)}vT.propTypes={user:ae.a.shape({id:ae.a.number,is_invitation_pending:ae.a.bool,is_disabled:ae.a.bool}).isRequired,enableUser:ae.a.func.isRequired,disableUser:ae.a.func.isRequired,deleteUser:ae.a.func.isRequired};class wT extends n.a.Component{constructor(){super(...arguments),yT(this,"sidebarMenu",[{key:"active",href:"users",title:window.W_L.enable_user},{key:"pending",href:"users/pending",title:window.W_L.invite_user},{key:"disabled",href:"users/disabled",title:window.W_L.disable_user,isAvailable:()=>Z.canCreateUser()}]),yT(this,"listColumns",[yb.custom.sortable((e,t)=>n.a.createElement(rE,{user:t,withLink:!0}),{title:window.W_L.account,field:"name",width:null}),yb.custom.sortable((e,t)=>Object(l.map)(t.groups,e=>n.a.createElement(g,{key:"group"+e.id,className:"label label-tag",href:"groups/"+e.id},e.name)),{title:window.W_L.role,field:"groups"}),yb.timeAgo.sortable({title:window.W_L.create_time,field:"created_at",className:"text-nowrap",width:"1%"}),yb.timeAgo.sortable({title:window.W_L.active_time,field:"active_at",className:"text-nowrap",width:"1%"}),yb.custom((e,t)=>n.a.createElement(vT,{user:t,enableUser:this.enableUser,disableUser:this.disableUser,deleteUser:this.deleteUser}),{width:"1%",isAvailable:()=>Z.canCreateUser()})]),yT(this,"createUser",e=>lE.create(e).then(e=>{of.success(window.W_L.save_seccess),e.invite_link&&R.a.warning({title:window.W_L.email_send_error,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,content:n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,window.W_L.email_not_setting,n.a.createElement("b",null,e.name),":"),n.a.createElement(vE,{value:uT(e.invite_link),"aria-label":"Invite link",readOnly:!0}))})}).catch(e=>{var t=Object(l.find)([Object(l.get)(e,"response.data.message"),Object(l.get)(e,"message"),window.W_L.save_failed],l.isString);return Promise.reject(new Error(t))})),yT(this,"showCreateUserDialog",()=>{if(Z.isCreateUserEnabled()){var e=()=>{this.props.controller.params.isNewUserPage&&Ea("users")};hT.showModal().onClose(t=>this.createUser(t).then(()=>{this.props.controller.update(),e()})).onDismiss(e)}}),yT(this,"enableUser",(e,t)=>lE.enableUser(t).then(()=>this.props.controller.update())),yT(this,"disableUser",(e,t)=>lE.disableUser(t).then(()=>this.props.controller.update())),yT(this,"deleteUser",(e,t)=>lE.deleteUser(t).then(()=>this.props.controller.update()))}componentDidMount(){this.props.controller.params.isNewUserPage&&this.showCreateUserDialog()}renderPageHeader(){return Z.canCreateUser()?n.a.createElement("div",{className:"m-b-15"},n.a.createElement(m.a,{type:"primary",disabled:!Z.isCreateUserEnabled(),onClick:this.showCreateUserDialog},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.create_user),n.a.createElement(se,{name:"UsersListExtra"})):null}render(){var e=this.props.controller;return n.a.createElement(n.a.Fragment,null,this.renderPageHeader(),n.a.createElement(eS,null,n.a.createElement(eS.Sidebar,{className:"m-b-0"},n.a.createElement(bS,{value:e.searchTerm,onChange:e.updateSearch,label:"Search users"}),n.a.createElement(hS,{items:this.sidebarMenu,selected:e.params.currentPage})),n.a.createElement(eS.Content,null,!e.isLoaded&&n.a.createElement(Ch,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement(Qj,{className:""}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive","data-test":"UserList"},n.a.createElement(vb,{items:e.pageItems,columns:this.listColumns,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Db,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}yT(wT,"propTypes",{controller:nh.isRequired});var OT=KC("Users.List",{permission:"list_users",title:window.W_L.account,path:"users",isActive:e=>e.startsWith("/users")&&"/users/me"!==e,order:2},oh(wT,()=>new wh({getRequest(e,t){switch(t.params.currentPage){case"active":e.pending=!1;break;case"pending":e.pending=!0;break;case"disabled":e.disabled=!0}return e},getResource:()=>lE.query.bind(lE)}),()=>new jh({orderByField:"created_at",orderByReverse:!0})));yf.register("Users.New",pa({path:"/users/new",title:window.W_L.account,render:e=>n.a.createElement(OT,gT({},e,{currentPage:"active",isNewUserPage:!0}))})),yf.register("Users.List",pa({path:"/users",title:window.W_L.enable_user,render:e=>n.a.createElement(OT,gT({},e,{currentPage:"active"}))})),yf.register("Users.Pending",pa({path:"/users/pending",title:window.W_L.invite_user,render:e=>n.a.createElement(OT,gT({},e,{currentPage:"pending"}))})),yf.register("Users.Disabled",pa({path:"/users/disabled",title:window.W_L.disable_user,render:e=>n.a.createElement(OT,gT({},e,{currentPage:"disabled"}))}));a(1572);function ET(){return(ET=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function _T(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function jT(e){var t=e.groups,a=e.linkGroups,r=_T(e,["groups","linkGroups"]);return n.a.createElement("div",ET({className:"user-groups"},r),Object(l.map)(t,e=>n.a.createElement(Iw.a,{key:e.id},a?n.a.createElement(g,{href:"groups/".concat(e.id)},e.name):e.name)))}function ST(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return CT(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return CT(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function CT(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function PT(e){var t=ST(Object(r.useState)([]),2),a=t[0],n=t[1],o=ST(Object(r.useState)(!0),2),i=o[0],s=o[1],c=Object(r.useMemo)(()=>Object(l.filter)(a,t=>Object(l.includes)(e.groupIds,t.id)),[a,e]);return Object(r.useEffect)(()=>{yP.query().then(e=>{n(Object(l.isArray)(e)?e:[]),s(!1)})},[]),Object(r.useMemo)(()=>({groups:c,allGroups:a,isLoading:i}),[c,a,i])}function xT(){return(xT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function LT(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function kT(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?LT(Object(a),!0).forEach((function(t){NT(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):LT(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function NT(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function AT(e){var t=e.user,a=e.onChange,o=PT(t),i=o.groups,s=o.allGroups,c=o.isLoading,u=mw(a),d=Object(r.useCallback)((e,a,r)=>{var n=kT(kT({},e),{},{id:t.id});lE.save(n).then(e=>{a(window.W_L.save_success),u(lE.convertUserInfo(e))}).catch(e=>{r(Object(l.get)(e,"response.data.message","Failed saving."))})},[t,u]),m=Object(r.useMemo)(()=>Object(l.map)([{name:"name",title:window.W_L.name,type:"text",initialValue:t.name},{name:"email",title:window.W_L.email,type:"email",initialValue:t.email},t.isDisabled||H.id===t.id?{name:"group_ids",title:window.W_L.role,type:"content",required:!1,content:c?window.W_L.loading:n.a.createElement(jT,{"data-test":"Groups",groups:i})}:{name:"group_ids",title:window.W_L.role,type:"select",mode:"multiple",options:Object(l.map)(s,e=>({name:e.name,value:e.id})),initialValue:t.groupIds,loading:c,placeholder:c?window.W_L.loading:""}],e=>kT({readOnly:t.isDisabled,required:!0},e)),[t,i,s,c]);return n.a.createElement(se,xT({name:"UserProfile.UserInfoForm"},e),n.a.createElement(RC,{fields:m,onSubmit:d,hideSubmitButton:t.isDisabled}))}function TT(){return(TT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function WT(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function IT(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?WT(Object(a),!0).forEach((function(t){qT(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):WT(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function qT(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function DT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return RT(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return RT(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function RT(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function MT(e){var t=e.user,a=e.onChange,o=DT(Object(r.useState)(!1),2),i=o[0],l=o[1],s=mw(a),c=Se("apiKey"),u=Object(r.useCallback)(()=>{R.a.confirm({title:window.W_L.re_generate_api_key,content:window.W_L.re_generate_api_key_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,onOk:()=>{l(!0),lE.regenerateApiKey(t).then(e=>{e&&s(IT(IT({},t),{},{apiKey:e}))}).finally(()=>{l(!1)})},maskClosable:!0,autoFocusButton:null})},[t,s]);return n.a.createElement(se,TT({name:"UserProfile.ApiKeyForm"},e),n.a.createElement(ag.a,{layout:"vertical"},n.a.createElement("hr",null),n.a.createElement(ag.a.Item,{label:"API Key",className:"m-b-10"},n.a.createElement(vE,{id:c,className:"hide-in-percy",value:t.apiKey,"data-test":"ApiKey",readOnly:!0})),n.a.createElement(m.a,{className:"w-100",onClick:u,loading:i,"data-test":"RegenerateApiKey"},window.W_L.re_generate_api_key)))}function zT(){return(zT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function FT(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function VT(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?FT(Object(a),!0).forEach((function(t){UT(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):FT(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function UT(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}jT.propTypes={groups:ae.a.arrayOf(ae.a.shape({id:ae.a.oneOfType([ae.a.number,ae.a.string]).isRequired,name:ae.a.string})),linkGroups:ae.a.bool},jT.defaultProps={groups:[],linkGroups:!0},AT.propTypes={user:Ff.isRequired,onChange:ae.a.func},AT.defaultProps={onChange:()=>{}},MT.propTypes={user:Ff.isRequired,onChange:ae.a.func},MT.defaultProps={onChange:()=>{}};class BT extends n.a.Component{constructor(e){super(e),UT(this,"fieldError",(e,t)=>0===t.length?window.W_L.required:"currentPassword"!==e&&t.length<6?window.W_L.too_short:"repeatPassword"===e&&t!==this.state.newPassword.value?window.W_L.do_not_match:null),UT(this,"validateFields",e=>{var t=this.state,a=t.currentPassword,r=t.newPassword,n=t.repeatPassword,o={currentPassword:this.fieldError("currentPassword",a.value),newPassword:this.fieldError("newPassword",r.value),repeatPassword:this.fieldError("repeatPassword",n.value)};this.setState({currentPassword:VT(VT({},a),{},{error:o.currentPassword}),newPassword:VT(VT({},r),{},{error:o.newPassword}),repeatPassword:VT(VT({},n),{},{error:o.repeatPassword})}),Object(l.isFunction)(e)&&e(o.currentPassword||o.newPassword||o.repeatPassword?o:null)}),UT(this,"updatePassword",()=>{var e=this.state,t=e.currentPassword,a=e.newPassword;e.updatingPassword||this.validateFields(e=>{if(e)this.setState(e=>({currentPassword:VT(VT({},e.currentPassword),{},{touched:!0}),newPassword:VT(VT({},e.newPassword),{},{touched:!0}),repeatPassword:VT(VT({},e.repeatPassword),{},{touched:!0})}));else{var r={id:this.props.user.id,old_password:t.value,password:a.value};this.setState({updatingPassword:!0}),lE.save(r).then(()=>{of.success(window.W_L.save_success),this.props.dialog.close({success:!0})}).catch(e=>{of.error(Object(l.get)(e,"response.data.message",window.W_L.save_failed)),this.setState({updatingPassword:!1})})}})}),UT(this,"handleChange",e=>{var t=e.target,a=t.name,r=t.value,n=this.state[a].error;this.setState({[a]:{value:r,error:n,touched:!0}},()=>{this.validateFields()})}),this.state={currentPassword:{value:"",error:null,touched:!1},newPassword:{value:"",error:null,touched:!1},repeatPassword:{value:"",error:null,touched:!1},updatingPassword:!1}}render(){var e=this.props.dialog,t=this.state,a=t.currentPassword,r=t.newPassword,o=t.repeatPassword,i=t.updatingPassword,l={className:"m-b-10",required:!0},s={onChange:this.handleChange,onPressEnter:this.updatePassword};return n.a.createElement(R.a,zT({},e.props,{okButtonProps:{loading:i},onOk:this.updatePassword,title:window.W_L.change_password,okText:window.W_L.ok_text,cancelText:window.W_L.cancel}),n.a.createElement(ag.a,{layout:"vertical"},n.a.createElement(ag.a.Item,zT({},l,{validateStatus:a.touched&&a.error?"error":null,help:a.touched?a.error:null,label:window.W_L.current_password}),n.a.createElement(ba.a.Password,zT({},s,{name:"currentPassword","data-test":"CurrentPassword",autoFocus:!0}))),n.a.createElement(ag.a.Item,zT({},l,{validateStatus:r.touched&&r.error?"error":null,help:r.touched?r.error:null,label:window.W_L.new_password}),n.a.createElement(ba.a.Password,zT({},s,{name:"newPassword","data-test":"NewPassword"}))),n.a.createElement(ag.a.Item,zT({},l,{validateStatus:o.touched&&o.error?"error":null,help:o.touched?o.error:null,label:window.W_L.repeat_password}),n.a.createElement(ba.a.Password,zT({},s,{name:"repeatPassword","data-test":"RepeatPassword"})))))}}UT(BT,"propTypes",{user:Ff.isRequired,dialog:wa.isRequired});var HT=Oa(BT);function YT(){return(YT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function QT(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function KT(e){var t=e.user,a=e.passwordLink,r=QT(e,["user","passwordLink"]);return Object(l.isString)(a)?n.a.createElement(se,YT({name:"UserProfile.PasswordLinkAlert"},e),n.a.createElement(u.a,YT({message:window.W_L.email_send_error,description:n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,window.W_L.email_not_setting,n.a.createElement("b",null,t.name),":"),n.a.createElement(vE,{value:uT(a),"aria-label":"Password link",readOnly:!0})),type:"warning",className:"m-t-20",closable:!0},r))):null}function $T(){return($T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function GT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return JT(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return JT(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function JT(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function XT(e){var t=e.user,a=GT(Object(r.useState)(!1),2),o=a[0],i=a[1],l=GT(Object(r.useState)(null),2),s=l[0],c=l[1],u=Object(r.useCallback)(()=>{i(!0),lE.sendPasswordReset(t).then(e=>{c(e)}).finally(()=>{i(!1)})},[t]);return n.a.createElement(se,$T({name:"UserProfile.PasswordResetForm"},e),n.a.createElement(m.a,{className:"w-100 m-t-10",onClick:u,loading:o},window.W_L.email_reset_password_send),n.a.createElement(KT,{user:t,passwordLink:s,afterClose:()=>c(null)}))}function ZT(){return(ZT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function eW(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tW(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return tW(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tW(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function aW(e){var t=e.user,a=eW(Object(r.useState)(!1),2),o=a[0],i=a[1],l=eW(Object(r.useState)(null),2),s=l[0],c=l[1],u=Object(r.useCallback)(()=>{i(!0),lE.resendInvitation(t).then(e=>{c(e)}).finally(()=>{i(!1)})},[t]);return n.a.createElement(se,ZT({name:"UserProfile.ResendInvitationForm"},e),n.a.createElement(m.a,{className:"w-100 m-t-10",onClick:u,loading:o},window.W_L.email_re_send_invite),n.a.createElement(KT,{user:t,passwordLink:s,afterClose:()=>c(null)}))}function rW(){return(rW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function nW(e){var t=e.user,a=Object(r.useCallback)(()=>{HT.showModal({user:t})},[t]);return n.a.createElement(se,rW({name:"UserProfile.PasswordForm"},e),n.a.createElement("h5",null,window.W_L.password),t.id===H.id&&n.a.createElement(m.a,{className:"w-100 m-t-10",onClick:a,"data-test":"ChangePassword"},window.W_L.change_password),t.id!==H.id&&H.isAdmin&&n.a.createElement(n.a.Fragment,null,t.isInvitationPending?n.a.createElement(aW,{user:t}):n.a.createElement(XT,{user:t})))}function oW(){return(oW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function iW(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lW(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lW(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lW(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function sW(e){var t=e.user,a=e.onChange,o=iW(Object(r.useState)(!1),2),i=o[0],l=o[1],s=mw(a),c=Object(r.useCallback)(()=>{var e=t.isDisabled?lE.enableUser:lE.disableUser;l(!0),e(t).then(e=>{e&&s(lE.convertUserInfo(e))}).finally(()=>{l(!1)})},[t,s]);if(!H.isAdmin||t.id===H.id)return null;var u={type:t.isDisabled?"primary":"danger",children:t.isDisabled?window.W_L.enable_user:window.W_L.disable_user};return n.a.createElement(se,{name:"UserProfile.ToggleUserForm"},n.a.createElement(m.a,oW({className:"w-100 m-t-10",onClick:c,loading:i},u)))}function cW(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return uW(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return uW(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uW(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function dW(e){var t=cW(Object(r.useState)(e.user),2),a=t[0],o=t[1];return Object(r.useEffect)(()=>{o(e.user)},[e.user]),n.a.createElement("div",{className:"col-md-4 col-md-offset-4"},n.a.createElement("img",{alt:"Profile",src:a.profileImageUrl,className:"profile__image",width:"40"}),n.a.createElement("h3",{className:"profile__h3"},a.name),n.a.createElement("hr",null),n.a.createElement(AT,{user:a,onChange:o}),!a.isDisabled&&n.a.createElement(n.a.Fragment,null,n.a.createElement(MT,{user:a,onChange:o}),n.a.createElement("hr",null),n.a.createElement(nW,{user:a})),n.a.createElement("hr",null),n.a.createElement(sW,{user:a,onChange:o}))}function mW(e){var t=e.user,a=PT(t),r=a.groups,o=a.isLoading;return n.a.createElement("div",{className:"col-md-4 col-md-offset-4 profile__container"},n.a.createElement("img",{alt:"profile",src:t.profileImageUrl,className:"profile__image",width:"40"}),n.a.createElement("h3",{className:"profile__h3"},t.name),n.a.createElement("hr",null),n.a.createElement("dl",{className:"profile__dl"},n.a.createElement("dt",null,window.W_L.name,"："),n.a.createElement("dd",null,t.name),n.a.createElement("dt",null,window.W_L.email,"："),n.a.createElement("dd",null,t.email),n.a.createElement("dt",{className:"m-b-5"},window.W_L.role,"："),n.a.createElement("dd",null,o?window.W_L.loading:n.a.createElement(jT,{groups:r}))))}KT.propTypes={user:Ff.isRequired,passwordLink:ae.a.string},KT.defaultProps={passwordLink:null},XT.propTypes={user:Ff.isRequired},aW.propTypes={user:Ff.isRequired},nW.propTypes={user:Ff.isRequired},sW.propTypes={user:Ff.isRequired,onChange:ae.a.func},sW.defaultProps={onChange:()=>{}},dW.propTypes={user:Ff.isRequired},mW.propTypes={user:Ff.isRequired};a(1573);function pW(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fW(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fW(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fW(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function bW(e){var t=e.userId,a=e.onError,o=pW(Object(r.useState)(null),2),i=o[0],l=o[1],s=mw(a);Object(r.useEffect)(()=>{var e=!1;return lE.get({id:t||H.id}).then(t=>{e||l(lE.convertUserInfo(t))}).catch(t=>{e||s(t)}),()=>{e=!0}},[t,s]);var c=i&&(H.isAdmin||H.id===i.id);return n.a.createElement(n.a.Fragment,null,n.a.createElement(Fg,{featureName:window.W_L.invite_email,className:"m-b-20",adminOnly:!0}),n.a.createElement("div",{className:"row"},!i&&n.a.createElement(Ch,{className:""}),i&&n.a.createElement(se,{name:"UserProfile",user:i},!c&&n.a.createElement(mW,{user:i}),c&&n.a.createElement(dW,{user:i}))))}bW.propTypes={userId:ae.a.string,onError:ae.a.func},bW.defaultProps={userId:null,onError:()=>{}};var hW=KC("Users.Account",{title:window.W_L.personal_setting,path:"users/me",order:7},bW);yf.register("Users.Account",pa({path:"/users/me",title:window.W_L.personal_setting,render:e=>n.a.createElement(hW,e)})),yf.register("Users.ViewOrEdit",pa({path:"/users/:userId",title:window.W_L.account,render:e=>n.a.createElement(hW,e)}));var gW=a(238),yW=a.n(gW);function vW(){return(vW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var wW=e=>{var t=e.excelList,a=e.delList;function r(e){var t=e.item,r=e.keySuffix,o={key:"card".concat(r),className:"visual-card",children:n.a.createElement("div",{style:{display:"flex",alignItems:"center",position:"relative",height:"100%",width:"100%"}},n.a.createElement("div",{style:{position:"absolute",right:"0",top:"-10px",fontSize:"16px",color:"#999898"},onClick:()=>(e=>{a(e)})(t)}," ",n.a.createElement(yW.a,null)),n.a.createElement("img",{alt:t.source_name,src:N_.a}),n.a.createElement("h3",null,t.source_name))};return n.a.createElement(be,vW({type:"link"},o))}return n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-lg-12 d-inline-flex flex-wrap visual-card-list"},t.map((e,t)=>n.a.createElement(r,{key:t,item:e,keySuffix:t.toString()}))))};a(1574);function OW(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return EW(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return EW(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function EW(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var _W=()=>{var e=OW(Object(r.useState)([]),2),t=e[0],a=e[1],o=OW(Object(r.useState)(!1),2),i=o[0],l=o[1],s=()=>{var e,t;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(B.get("api/upload"));case 2:e=r.sent,t=e.data,a(t);case 5:case"end":return r.stop()}}),null,null,null,Promise)};Object(r.useEffect)(()=>{s()},[]);var c={name:"file",accept:".csv,.xlsx,.xls",customRequest:e=>{l(!0);var t=new FormData;t.append("file",e.file),B.post("/api/upload",t).then(t=>{e.onSuccess(),l(!1),s()}).catch(t=>{e.onError(),l(!1)})},onChange(e){}};return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"row1"},!t&&n.a.createElement(Ch,{className:""}),t&&n.a.createElement(n.a.Fragment,null,n.a.createElement(lC.a,c,n.a.createElement(m.a,{type:"primary",disabled:i}," ",n.a.createElement(cC.a,null),window.W_L.upload)),n.a.createElement(wW,{excelList:t,delList:e=>regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(B.delete("api/upload/".concat(e.id)));case 2:s();case 3:case"end":return t.stop()}}),null,null,null,Promise)}))))},jW=KC("Upload.ExcelUpload",{title:window.W_L.excel_upload,path:"upload/excel",order:8},_W);function SW(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return CW(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return CW(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function CW(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}yf.register("Upload.ExcelUpload",pa({path:"/upload/excel",title:window.W_L.excel_upload,render:e=>n.a.createElement(jW,e)}));var PW,xW,LW=()=>{var e=SW(ag.a.useForm(),1)[0],t=SW(Object(r.useState)(!1),2),a=t[0],o=t[1],i=SW(Object(r.useState)("DeepThought"),2),l=i[0],s=i[1],c=Object(r.useCallback)(()=>{var t,a,r,n;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:return o(!0),i.next=3,regeneratorRuntime.awrap(B.get("/api/ai_token"));case 3:t=i.sent,(a=t.data).in_use?(s(a.in_use),r=a.OpenAI,n=a.DeepThought,e.setFieldsValue({ApiKey:n.ApiKey||"",OpenaiApiKey:r.OpenaiApiKey||"",HttpProxyHost:r.HttpProxyHost||"",HttpProxyPort:r.HttpProxyPort||"",ApiHost:r.ApiHost||""})):e.setFieldsValue(a),Ft(),o(!1);case 8:case"end":return i.stop()}}),null,null,null,Promise)},[e]);Object(r.useEffect)(()=>{c()},[c]);var u=()=>{var t={in_use:l,OpenAI:{OpenaiApiKey:e.getFieldValue("OpenaiApiKey")||"",HttpProxyHost:e.getFieldValue("HttpProxyHost")||"",HttpProxyPort:e.getFieldValue("HttpProxyPort")||"",ApiHost:e.getFieldValue("ApiHost")||""},DeepThought:{ApiKey:e.getFieldValue("ApiKey")||""}};B.post("/api/ai_token",t).then(e=>{200===e.code?(of.success(window.W_L.save_success),Wt&&Wt.close(),c()):of.error(window.W_L.save_failed),o(!1)}).catch(e=>{of.error(window.W_L.save_failed),o(!1)})},d=()=>{Wt?((()=>{try{Wt.onmessage=e=>{var t;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:"api"===(t=JSON.parse(e.data)).receiver&&(of.info(t.data.content),o(!1));case 2:case"end":return a.stop()}}),null,null,null,Promise)}}catch(e){o(!1)}})(),e.validateFields().then(e=>{o(!0);var t={state:200,receiver:"sender",chat_type:"test",data:{data_type:"apikey",content:e,language_mode:window.W_L.language_mode}};Wt.send(JSON.stringify(t))})):Ft()};return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"row1",style:{width:"50%",margin:"auto"}},n.a.createElement(ag.a,{form:e,layout:"vertical",disabled:a,onFinish:e=>{o(!0),void 0===e.HttpProxyPort&&(e.HttpProxyPort=""),void 0===e.HttpProxyHost&&(e.HttpProxyHost=""),void 0===e.ApiHost&&(e.ApiHost=""),u()}},n.a.createElement(ag.a.Item,null,n.a.createElement("div",{style:{display:"flex",alignItems:"center"}},n.a.createElement("h4",{style:{marginRight:"30px"}},"AI:"),n.a.createElement(Bn.a.Group,{onChange:e=>{s(e.target.value)},value:l},n.a.createElement(Bn.a,{value:"DeepThought"},"DeepThought"),n.a.createElement(Bn.a,{value:"OpenAI"},"OpenAI")))),"DeepThought"===l&&n.a.createElement(ag.a.Item,{name:"ApiKey",label:"ApiKey",rules:[{required:!0,message:"Please enter API key"}]},n.a.createElement(ba.a,{placeholder:"ApiKey"})),"OpenAI"===l&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ag.a.Item,{name:"OpenaiApiKey",label:"OpenaiApiKey",rules:[{required:!0,message:window.W_L.please_enter_api_key}]},n.a.createElement(ba.a,{placeholder:"OpenaiApiKey"})),n.a.createElement(ag.a.Item,{name:"HttpProxyHost",label:"HttpProxyHost"},n.a.createElement(ba.a,{placeholder:"HttpProxyHost"})),n.a.createElement(ag.a.Item,{name:"HttpProxyPort",label:"HttpProxyPort"},n.a.createElement(ba.a,{placeholder:"HttpProxyPort"})),n.a.createElement(ag.a.Item,{name:"ApiHost",label:"ApiHost"},n.a.createElement(ba.a,{placeholder:"ApiHost"}))),n.a.createElement(ag.a.Item,{style:{textAlign:"right"}},n.a.createElement(m.a,{disabled:a,style:{marginRight:"10px"},onClick:()=>d()},window.W_L.connect_test),n.a.createElement(m.a,{disabled:a,htmlType:"submit",type:"primary"},window.W_L.apply)))))},kW=KC("Settings.OpenKey",{title:"API Key",path:"settings/OpenKey",order:9},LW);function NW(e){for(var t=e.target;t&&"A"!==t.tagName;)t=t.parentNode;if(t&&t.hasAttribute("href")&&!t.hasAttribute("download")&&!t.dataset.skipRouter&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var a=t.getAttribute("target");Object(l.isString)(a)&&"_blank"===a.toLowerCase()||(e.preventDefault(),Ea(t.href))}}yf.register("Settings.OpenKey",pa({path:"/settings/OpenKey",title:"API Key",render:e=>n.a.createElement(kW,e)})),Tf.a.setDefaultIndicator(n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading..."))),(PW=a(1575)).keys().forEach(PW),(xW=a(1720)).keys().map(xW).map(e=>e.default).filter(l.isFunction).filter(e=>e.init).map(e=>e());var AW=a(29),TW=a.n(AW),WW=a(696),IW=a.n(WW);a(1721);function qW(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return DW(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return DW(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function DW(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var RW={init(){window.addEventListener("offline",()=>{var e;of.warning("Please check your Internet connection.",null,{key:"connectionNotification",duration:null}),e="connectionNotification",window.addEventListener("online",(function t(){of.close(e),window.removeEventListener("online",t)}))})}};i.a.render(n.a.createElement((function(){var e=qW(Object(r.useState)(null),2),t=e[0],a=e[1],o=qW(Object(r.useState)(null),2),i=o[0],l=o[1];return Object(r.useEffect)(()=>{t&&t.title&&(document.title=t.title)},[t]),Object(r.useEffect)(()=>{function e(e){e.preventDefault(),l(e.error)}return document.body.addEventListener("click",NW,!1),window.addEventListener("error",e,!1),()=>{document.body.removeEventListener("click",NW,!1),window.removeEventListener("error",e,!1)}},[]),i?n.a.createElement(nt,{error:i}):("CN"===window.W_L.language_mode?Da.a.locale("zh-cn"):Da.a.locale("en"),n.a.createElement(TW.a,{locale:"CN"===window.W_L.language_mode?IW.a:""},n.a.createElement(mt,{routes:yf.items,onRouteChange:a})))}),null),document.getElementById("application-root"),()=>{RW.init()})},245:function(e,t,a){e.exports=a.p+"images/db-logos/excel.png"},418:function(e,t,a){e.exports=a.p+"images/db-logos/pg.png"},419:function(e,t,a){e.exports=a.p+"images/db-logos/mysql.png"},422:function(e,t,a){e.exports=a.p+"images/copy.png"},426:function(e){e.exports=JSON.parse('"dev"')},437:function(e,t,a){e.exports=a.p+"images/avatar.svg"},586:function(e,t,a){},596:function(e,t,a){},597:function(e,t,a){},598:function(e,t,a){},599:function(e,t,a){},650:function(e,t){e.exports="# Holmes 使用说明\n\n\n## 1，配置 API KEY\n\n- [设置]-[API KEY]\n\n### 1.1, 关于 OPENAI API KEY:\n\n- API KEY 需要 OPENAI GPT4 模型的访问权限\n- 后续会陆续支持其他大模型，敬请期待\n\n### 1.2, 关于 代理:\n\n- OPENAI API 访问可能需要科学上网,请小伙伴们自行配置代理\n\n- KEY和代理配置完毕后，配置完毕后，点击【连接测试】，显示 测试通过 即可。\n测试不通过的情况，请自行检查 API KEY是否可用，以及代理是否配置正确。\n\n![doc_0.png](/static/images/cn/img/doc_0.png)\n\n## 2, 配置 数据源\n\n- 目前支持的数据源有， MySql，Doris, starRocks, PostgreSql, 和 CSV\n- 后续会陆续支持更多数据源，如sqlserver，clickhouse，SQLite等，敬请期待\n\n### 2.1, CSV数据源配置:\n\n- 【设置】-【CSV数据源】-【点击上传】- 选择需上传的csv文件即可\n\n![doc.png](/static/images/cn/img/doc_1.png)\n\n### 2.2, [MySql，Doris, starRocks, PostgreSql] 数据源配置:\n\n- 【设置】-【数据源】-【新建一个数据源】\n- 选择数据源，填写数据库信息，并保存\n- 配置完毕后，点击【连接测试】，显示 连接成功 即可\n\n![doc.png](/static/images/cn/img/doc_2.png)\n\n![doc.png](/static/images/cn/img/doc_3.png)\n\n## 3, 数据分析\n\n### 3.1, [数据分析] - [对话]\n\n#### 3.1.1. 勾选数据（数据源和表）\n\n- 勾选的数据会作为对话数据分析中AI的基础数据\n\n#### 3.1.2, 填写注释，提交AI检测\n\n- 尽量完善表格和字段注释，协助AI更好的理解这些数据，使Agent更好的完成数据分析任务\n\n![doc.png](/static/images/cn/img/doc_4.png)\n\n#### 3.1.3, 修改未通过的注释，再次提交\n\n- AI会反馈未通过的注释，请修改补充后，再次提交，直到所有注释通过检测\n\n![doc.png](/static/images/cn/img/doc_5.png)\n\n#### 3.1.4, 所有注释检测通过后，开始对话\n\n- 🔥 注: 若要生成持久化报表，请使用【报表】-【报表生成】，数据分析中出现的报表均为临时报表，不支持持久化\n\n![doc.png](/static/images/cn/img/doc_6.png)\n\n#### 3.1.5, 重选数据源\n\n- 若要重选数据源，进行新一轮对话，请点击【新对话】，重置当前对话，当前对话记录会存储进【历史对话】中\n\n![doc.png](/static/images/cn/img/doc_7.png)\n\n### 3.2, 【数据分析】-【历史对话】\n- 可查看历史对话记录\n\n![doc.png](/static/images/cn/img/doc_8.png)\n\n## 4, 报表 \n\n### 4.1,【报表】-【报表生成】\n\n#### 4.1.1. Check the data (data source and table)\n\n- 勾选的数据会作为报表生成中AI的基础数据\n- 🔥注: 目前CSV数据源不支持【报表生成】\n\n#### 4.1.2, 填写注释，提交AI检测\n\n- 尽量完善表格和字段注释，协助AI更好的理解这些数据，使Agent更好的完成报表生成任务\n\n![doc.png](/static/images/cn/img/doc_9.png)\n\n#### 4.1.3, 修改未通过的注释，再次提交\n\n- AI会反馈未通过的注释，请修改补充后，再次提交, 直到所有注释检测通过\n\n![doc.png](/static/images/cn/img/doc_10.png)\n\n#### 4.1.4, 所有注释检测通过后，开始对话生成报表\n\n- 点击【编辑报表】，可直接编辑 新生成的报表.\n- 🔥 注: 【报表生成】模块目前仅支持持久化报表生成任务，分析类问题，请使用【数据分析】-【对话】\n\n![doc.png](/static/images/cn/img/doc_11.png)\n\n#### 4.1.5, 重选数据源 \n\n- 若要重选数据源，进行新一轮对话，请点击【新对话】，重置当前对话\n\n![doc.png](/static/images/cn/img/doc_12.png)\n\n### 4.2, 【报表】-【报表列表】\n\n#### 4.2.1, 报表状态\n\n- 【报表生成】中新生成的报表会出现在【报表列表】中，此时报表为 草稿 状态，若想要在【仪表盘】展示该报表，请点击 【发布】 按钮，将报表状态变更为 已发布 状态\n\n![doc.png](/static/images/cn/img/doc_13.png)\n\n![doc.png](/static/images/cn/img/doc_14.png)\n\n#### 4.2.2, 修改SQL语句\n\n- 点击【编辑源】，可自定义修改报表的SQL语句.\n\n![doc.png](/static/images/cn/img/doc_15.png)\n\n#### 4.2.3, 修改图表样式\n\n- 点击【编辑可视化】，可自定义编辑 可视化图表样式\n- 点击【新增可视化】，可增加可视化图表\n\n![doc.png](/static/images/cn/img/doc_16.png)\n\n![doc.png](/static/images/cn/img/doc_17.png)\n\n#### 4.2.4, 删除报表\n\n- 点击【归档】，可将报表状态变更为 归档（删除）状态\n\n![doc.png](/static/images/cn/img/doc_18.png)\n\n### 5, 仪表盘\n\n#### 5.1, 新建仪表盘\n\n- 【仪表盘】-【新建】- 编辑仪表盘\n\n![doc.png](/static/images/cn/img/doc_19.png)\n\n- 将刚生成的【已发布 】报表，添加进仪表盘\n\n![doc.png](/static/images/cn/img/doc_20.png)\n\n- 点击【发布】仪表盘\n\n![doc.png](/static/images/cn/img/doc_21.png)\n\n#### 5.2 分享仪表盘\n\n- 点击【发布】后，即可分享仪表盘\n\n![doc.png](/static/images/cn/img/doc_22.png)"},651:function(e,t){e.exports='# Holmes User Manual\n\n## 1，Configure API KEY\n\n- [Setting]-[API KEY]\n\n### 1.1, About OPENAI API KEY:\n\n- Requires access to gpt4 models.\n- Other large models will be supported in the future, so stay tuned.\n\n### 1.2, About the proxy:\n\n- OPENAI API access may require proxy configuration, please configure the proxy yourself.\n\n- After the KEY and proxy are configured, click [Connection Test] and "Test success" will be displayed. If the test\n  fails, please check whether the API KEY is available and whether the proxy is configured correctly.\n\n![doc_0.png](/static/images/en/img/doc_0.png)\n\n## 2,Configure Data Source\n\n- Currently supported data sources are MySql, Doris, starRocks, PostgreSql, and CSV. More data sources will be supported\n  in the future, such as sqlserver, clickhouse, SQLite, etc., so stay tuned.\n\n### 2.1, CSV data source configure:\n\n- [Setting]-[CSV Data Source]-[Click to upload]-select the csv file to be uploaded\n\n![doc.png](/static/images/en/img/doc_1.png)\n\n### 2.2, [MySql, Doris, starRocks, PostgreSql] data source configure:\n\n- [Setting]-[Data Sources]-[New Data Source]\n- Select the data source, fill in the database information, and save. After the configuration is completed,\n  click [Test Connection ] and "Connection Success" will be displayed.\n\n![doc.png](/static/images/en/img/doc_2.png)\n\n![doc.png](/static/images/en/img/doc_3.png)\n\n## 3,Chat Builder\n\n### 3.1, [Chat Builder] - [Dialogue]\n\n#### 3.1.1. Check the data (data source and table)\n\n- The checked data will be used as the basic data for AI in conversation data analysis.\n\n#### 3.1.2, fill in the comments and submit for AI detection\n\n- Try to improve the form and field annotations as much as possible to help AI better understand the data and enable the\n  Agent to better complete the data analysis task.\n\n![doc.png](/static/images/en/img/doc_4.png)\n\n#### 3.1.3, modify the failed comments and submit again\n\n- AI will feedback the comments that have not passed. Please revise and add them and submit again until all the comments\n  pass.\n\n![doc.png](/static/images/en/img/doc_5.png)\n\n#### 3.1.4, after all annotations pass the detection, start the conversation\n\n- 🔥 Note: If you want to generate a persistent report, please use [Query Builder]-[Report Generation]. The reports that\n  appear in [Chat Builder] are temporary reports and do not support persistence.\n\n![doc.png](/static/images/en/img/doc_6.png)\n\n#### 3.1.5, reselect data source\n\n- If you want to reselect the data source and start a new round of dialogue, please click [New Dialogue] to reset the\n  current conversation. The current conversation record will be stored in [History Dialogue].\n\n![doc.png](/static/images/en/img/doc_7.png)\n\n### 3.2, [Chat Builder] - [History Dialogue]\nCan view historical conversation records\n\n![doc.png](/static/images/en/img/doc_8.png)\n\n## 4, Query Builder \n\n### 4.1, [Query Builder]-[Report Generation]\n\n#### 4.1.1. Check the data (data source and table)\n\n- The checked data will be used as the basic data of AI in report generation. \n- 🔥Note: Currently the CSV data source does\n  not support [Report Generation]\n\n#### 4.1.2, fill in the comments and submit for AI detection\n\n- Try to improve the form and field annotations as much as possible to help AI better understand the data and enable the\n  Agent to better complete the report generation task.\n\n![doc.png](/static/images/en/img/doc_9.png)\n\n#### 4.1.3, modify the failed comments and submit again\n\n- AI will feedback the annotations that have failed. Please revise and add them and submit again until all annotations\n  pass the test.\n\n![doc.png](/static/images/en/img/doc_10.png)\n\n#### 4.1.4, after all annotations pass the detection, start the dialogue to generate reports\n\n- Click [Edit Report] to directly edit the newly generated report.\n- 🔥 Note: The [Report Generation] module currently only supports persistent report generation tasks. For analysis\n  questions, please use [Chat Builder] - [Dialogue].\n\n![doc.png](/static/images/en/img/doc_11.png)\n\n#### 4.1.5, reselect data source \n\n- If you want to reselect the data source and start a new round of dialogue, please click [New Dialogue] to reset the current dialogue.\n\n![doc.png](/static/images/en/img/doc_12.png)\n\n### 4.2, [Query]-[Report List]\n\n#### 4.2.1, Report status\n\n- The newly generated report in [Report Generation] will appear in the [Report List]. At this time, the report is in\n  draft status. If you want to display the report in the [Dashboards], please click the [Publish] button, change report\n  status to published status.\n\n![doc.png](/static/images/en/img/doc_13.png)\n\n![doc.png](/static/images/en/img/doc_14.png)\n\n#### 4.2.2, Modify SQL statement\n\n- Click [Edit Source] to customize the SQL statement of the report.\n\n![doc.png](/static/images/en/img/doc_15.png)\n\n#### 4.2.3, modify chart style\n\n- Click [Edit Visualization] to customize and edit the visualization chart style.\n- Click [Add Visualization] to add a visual chart.\n\n![doc.png](/static/images/en/img/doc_16.png)\n\n![doc.png](/static/images/en/img/doc_17.png)\n\n#### 4.2.4. Deleting a report\n\n- Click [Archive] to change the report status to archive (delete) status.\n\n![doc.png](/static/images/en/img/doc_18.png)\n\n### 5, Dashboards\n\n#### 5.1, create a new dashboard\n\n- [Dashboards]-[Create]-Edit Dashboard\n\n![doc.png](/static/images/en/img/doc_19.png)\n\n- Add the newly generated Published report to the dashboard\n\n![doc.png](/static/images/en/img/doc_20.png)\n\n- Click [Publish] Dashboard\n\n![doc.png](/static/images/en/img/doc_21.png)\n\n#### 5.2 Share Dashboard \n\n- After clicking [Publish], you can share the dashboard\n\n![doc.png](/static/images/en/img/doc_22.png)\n\n\n\n'},677:function(e,t,a){e.exports=a.p+"data/0962607.countries.geo.json"},678:function(e,t,a){e.exports=a.p+"data/eed73d1.usa-albers.geo.json"},679:function(e,t,a){e.exports=a.p+"data/dac34f3.japan.prefectures.geo.json"},700:function(e,t,a){a(1730),a(1726),e.exports=a(1727)},808:function(e,t,a){},815:function(e,t,a){},816:function(e,t,a){},817:function(e,t,a){},843:function(e,t,a){},849:function(e,t,a){},852:function(e,t,a){var r={"./en-SG":475,"./en-SG.js":475,"./en-au":476,"./en-au.js":476,"./en-ca":477,"./en-ca.js":477,"./en-gb":478,"./en-gb.js":478,"./en-ie":479,"./en-ie.js":479,"./en-il":480,"./en-il.js":480,"./en-nz":481,"./en-nz.js":481};function n(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=o,e.exports=n,n.id=852},855:function(e,t,a){},856:function(e,t,a){},857:function(e,t,a){},886:function(e,t,a){},887:function(e,t,a){},895:function(e,t,a){},905:function(e,t,a){},906:function(e,t,a){},907:function(e,t,a){},909:function(e,t,a){},910:function(e,t,a){},926:function(e,t){}});
//# sourceMappingURL=app.1cc9a8f83919bcbf32d5.js.map
